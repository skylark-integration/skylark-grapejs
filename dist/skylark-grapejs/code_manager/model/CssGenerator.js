/**
 * skylark-grapejs - A version of garpejs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-grapejs/
 * @license MIT
 */
define(["skylark-backbone","skylark-underscore"],function(e,t){"use strict";const s=Number.MAX_VALUE;return e.Model.extend({initialize(){this.compCls=[],this.ids=[]},buildFromModel(e,t={}){let s="";const i=this.em,l=i&&i.getConfig("avoidInlineStyle"),o=e.styleToString(),r=e.get("classes"),n=t.wrapperIsBody,c=e.get("wrapper");if(this.ids.push(`#${e.getId()}`),r.each(e=>this.compCls.push(e.getFullName())),!l&&o){let t=`#${e.getId()}`;s=`${t=n&&c?"body":t}{${o}}`}return e.components().each(e=>s+=this.buildFromModel(e,t)),s},build(e,s={}){const i=s.cssc,l=s.em||"";this.em=l,this.compCls=[],this.ids=[];var o=this.buildFromModel(e,s);const r=t.isUndefined(s.clearStyles)&&l?l.getConfig("clearStyles"):s.clearStyles;if(i){const e=i.getAll(),t={},n=[];e.each(e=>{const i=e.getAtRule();if(i){const s=t[i];s?s.push(e):t[i]=[e]}else o+=this.buildFromRule(e,n,s)}),this.sortMediaObject(t).forEach(e=>{let t="";const i=e.key;e.value.forEach(e=>{const l=this.buildFromRule(e,n,s);e.get("singleAtRule")?o+=`${i}{${l}}`:t+=l}),t&&(o+=`${i}{${t}}`)}),l&&r&&e.remove(n)}return o},buildFromRule(e,t,s={}){let i="";const l=e.selectorsToString({skipAdd:1}),o=e.get("selectorsAdd"),r=e.get("singleAtRule");let n;if(e.get("selectors").each(e=>{const t=e.getFullName();(this.compCls.indexOf(t)>=0||this.ids.indexOf(t)>=0||s.keepUnusedStyles)&&(n=1)}),l&&n||o||r){const t=e.getDeclaration();t&&(i+=t)}else t.push(e);return i},getQueryLength(e){const t=/(-?\d*\.?\d+)\w{0,}/.exec(e);return t?parseFloat(t[1]):s},sortMediaObject(e={}){const s=[];return t.each(e,(e,t)=>s.push({key:t,value:e})),s.sort((e,t)=>{const s=[e.key,t.key].every(e=>-1!==e.indexOf("min-width")),i=s?e.key:t.key,l=s?t.key:e.key;return this.getQueryLength(i)-this.getQueryLength(l)})}})});
//# sourceMappingURL=../../sourcemaps/code_manager/model/CssGenerator.js.map
