/**
 * skylark-grapejs - A version of garpejs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-grapejs/
 * @license MIT
 */
define(["skylark-backbone","skylark-underscore"],function(e,t){"use strict";const s=Number.MAX_VALUE;return e.Model.extend({initialize(){this.compCls=[],this.ids=[]},buildFromModel(e,t={}){let s="";const i=this.em,n=i&&i.getConfig("avoidInlineStyle"),l=e.styleToString(),o=e.get("classes"),r=t.wrapperIsBody,d=e.get("wrapper");if(this.ids.push(`#${e.getId()}`),o.undefined(e=>this.compCls.push(e.getFullName())),!n&&l){let t=`#${e.getId()}`;s=`${t=r&&d?"body":t}{${l}}`}return e.components().undefined(e=>s+=this.buildFromModel(e,t)),s},build(e,s={}){const i=s.cssc,n=s.em||"";this.em=n,this.compCls=[],this.ids=[];var l=this.buildFromModel(e,s);const o=t.isUndefined(s.clearStyles)&&n?n.getConfig("clearStyles"):s.clearStyles;if(i){const e=i.getAll(),t={},r=[];e.undefined(e=>{const i=e.getAtRule();if(i){const s=t[i];s?s.push(e):t[i]=[e]}else l+=this.buildFromRule(e,r,s)}),this.sortMediaObject(t).forEach(e=>{let t="";const i=e.key;e.value.forEach(e=>{const n=this.buildFromRule(e,r,s);e.get("singleAtRule")?l+=`${i}{${n}}`:t+=n}),t&&(l+=`${i}{${t}}`)}),n&&o&&e.remove(r)}return l},buildFromRule(e,t,s={}){let i="";const n=e.selectorsToString({skipAdd:1}),l=e.get("selectorsAdd"),o=e.get("singleAtRule");let r;if(e.get("selectors").undefined(e=>{const t=e.getFullName();(this.compCls.indexOf(t)>=0||this.ids.indexOf(t)>=0||s.keepUnusedStyles)&&(r=1)}),n&&r||l||o){const t=e.getDeclaration();t&&(i+=t)}else t.push(e);return i},getQueryLength(e){const t=/(-?\d*\.?\d+)\w{0,}/.exec(e);return t?parseFloat(t[1]):s},sortMediaObject(e={}){const s=[];return t.each(e,(e,t)=>s.push({key:t,value:e})),s.sort((e,t)=>{const s=[e.key,t.key].every(e=>-1!==e.indexOf("min-width")),i=s?e.key:t.key,n=s?t.key:e.key;return this.getQueryLength(i)-this.getQueryLength(n)})}})});
//# sourceMappingURL=../../sourcemaps/code_manager/model/CssGenerator.js.map
