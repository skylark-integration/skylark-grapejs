/**
 * skylark-grapejs - A version of garpejs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-grapejs/
 * @license MIT
 */
define(["skylark-underscore","./view/CommandAbstract","./config/config","../../dom_components/model/Component"],function(e,t,n,o){"use strict";return()=>{let r,s={};const a={},i={},c={},l=[["preview","Preview","preview"],["resize","Resize","resize"],["fullscreen","Fullscreen","fullscreen"],["copy","CopyComponent"],["paste","PasteComponent"],["canvas-move","CanvasMove"],["canvas-clear","CanvasClear"],["open-code","ExportTemplate","export-template"],["open-layers","OpenLayers","open-layers"],["open-styles","OpenStyleManager","open-sm"],["open-traits","OpenTraitManager","open-tm"],["open-blocks","OpenBlocks","open-blocks"],["open-assets","OpenAssets","open-assets"],["component-select","SelectComponent","select-comp"],["component-outline","SwitchVisibility","sw-visibility"],["component-offset","ShowOffset","show-offset"],["component-move","MoveComponent","move-comp"],["component-next","ComponentNext"],["component-prev","ComponentPrev"],["component-enter","ComponentEnter"],["component-exit","ComponentExit","select-parent"],["component-delete","ComponentDelete"],["component-style-clear","ComponentStyleClear"],["component-drag","ComponentDrag"]];return{CommandAbstract:t,name:"Commands",init(t={}){s={...n,...t},r=s.em;const a=s.pStylePrefix;a&&(s.stylePrefix=a+s.stylePrefix);for(let e in s.defaults){const t=s.defaults[e];t.id&&this.add(t.id,t)}return i["tlb-delete"]={run:e=>e.runCommand("core:component-delete")},i["tlb-clone"]={run(e){e.runCommand("core:copy"),e.runCommand("core:paste")}},i["tlb-move"]={run(t,n,r={}){let s;const a=t.getModel(),i=r&&r.event,{target:c}=r,l=c||t.getSelected(),d=c?[c]:[...t.getSelectedAll()],m=i&&"dragstart"==i.type,p={preserveSelected:1},u=l.get("dmode")||a.get("dmode"),g=()=>a.stopDefault(p),f=e.includes(["absolute","translate"],u);if(d.forEach(e=>e.trigger("disable")),!l||!l.get("draggable"))return a.logWarning("The element is not draggable");m?setTimeout(g,0):g();const v=e=>{a.trigger(`${o.eventDrag}:start`,e)},C=e=>{a.trigger(o.eventDrag,e)},h=(e,n,r)=>{a.runDefault(p),d.forEach(e=>e.set("status","selected")),t.select(d),l.emitUpdate(),a.trigger(`${o.eventDrag}:end`,r),(f||r.cancelled)&&a.set("_cmpDrag",1)};if(f)s=t.runCommand("core:component-drag",{guidesInfo:1,mode:u,target:l,onStart:v,onDrag:C,onEnd:h,event:i});else{m&&i.dataTransfer.setDragImage(l.view.el,0,0);const e=t.Commands.get("move-comp");e.onStart=v,e.onDrag=C,e.onEndMoveFromModel=h,e.initSorterFromModels(d)}d.forEach(e=>e.set("status","freezed-selected"))}},i["core:undo"]=(e=>e.UndoManager.undo()),i["core:redo"]=(e=>e.UndoManager.redo()),l.forEach(e=>{const t=e[2],n=require(`./view/${e[1]}`).default,o=`core:${e[0]}`;i[o]=n,t&&(i[t]=n,["run","stop"].forEach(e=>{r.on(`${e}:${t}`,(...t)=>r.trigger(`${e}:${o}`,...t))}))}),s.em&&(s.model=s.em.get("Canvas")),this.loadDefaultCommands(),this},add:function(n,o){return e.isFunction(o)&&(o={run:o}),o.stop||(o.noStop=1),delete o.initialize,o.id=n,a[n]=t.extend(o),this},get(t){let n=a[t];return e.isFunction(n)?(n=new n(s),a[t]=n):n||r.logWarning(`'${t}' command not found`),n},extend(e,t={}){const n=this.get(e);if(n){const o={...n.constructor.prototype,...t};this.add(e,o);const r=l.filter(t=>`core:${t[0]}`===e&&t[2])[0];r&&this.add(r[2],o)}return this},has:e=>!!a[e],getAll:()=>a,run(e,t={}){return this.runCommand(this.get(e),t)},stop(e,t={}){return this.stopCommand(this.get(e),t)},isActive(e){return this.getActive().hasOwnProperty(e)},getActive:()=>c,loadDefaultCommands(){for(var e in i)this.add(e,i[e]);return this},runCommand(e,t={}){let n;if(e&&e.run){const o=e.id,a=r.get("Editor");this.isActive(o)&&!t.force&&s.strict||(n=e.callRun(a,t),o&&e.stop&&!e.noStop&&!t.abort&&(c[o]=n))}return n},stopCommand(e,t={}){let n;if(e&&e.run){const o=e.id,a=r.get("Editor");(this.isActive(o)||t.force||!s.strict)&&(o&&delete c[o],n=e.callStop(a,t))}return n},create:e=>(e.stop||(e.noStop=1),new(t.extend(e))(s))}}});
//# sourceMappingURL=../sourcemaps/commands/index.js.map
