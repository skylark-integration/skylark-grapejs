/**
 * skylark-grapejs - A version of garpejs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-grapejs/
 * @license MIT
 */
define(["skylark-underscore"],function(e){"use strict";return t=>{var s=t;return{compTypes:"",modelAttrStart:"data-gjs-",splitPropsFromAttr(t={}){const s={},r={};return e.each(t,(t,n)=>{if(0===n.indexOf(this.modelAttrStart)){const r=n.replace("data-gjs-",""),o=t.length,a=t&&e.isString(t),l=a&&t.substr(0,1),i=a&&t.substr(o-1);t="false"!==(t="true"===t||t)&&t;try{t="{"==l&&"}"==i||"["==l&&"]"==i?JSON.parse(t):t}catch(e){}s[r]=t}else r[n]=t}),{props:s,attrs:r}},parseStyle(e){for(var t={},s=e.split(";"),r=0,n=s.length;r<n;r++){var o=s[r].trim();if(o){var a=o.split(":");t[a[0].trim()]=a.slice(1).join(":").trim()}}return t},parseClass(e){const t=[],s=e.split(" ");for(let e=0,r=s.length;e<r;e++){const r=s[e].trim();r&&t.push(r)}return t},parseNode(e){const r=[],n=e.childNodes;for(var o=0,a=n.length;o<a;o++){const e=n[o],a=e.attributes||[],l=a.length,i=r[r.length-1],c=e.childNodes.length,p=this.compTypes;let d={};if(p){let t="",s=e.getAttribute&&e.getAttribute("data-gjs-type");if(s)d={type:s};else{for(let s=0;s<p.length;s++){const r=p[s];if(t=r.model.isComponent(e)){"object"!=typeof t&&(t={type:r.id});break}}d=t}}d.tagName||(d.tagName=e.tagName?e.tagName.toLowerCase():""),l&&(d.attributes={});for(let e=0;e<l;e++){const t=a[e].nodeName;let s=a[e].nodeValue;if("style"==t)d.style=this.parseStyle(s);else if("class"==t)d.classes=this.parseClass(s);else{if("contenteditable"==t)continue;if(0===t.indexOf("data-gjs-")){const e=t.replace("data-gjs-",""),r=s.length,n=s&&s.substr(0,1),o=s&&s.substr(r-1);s="false"!==(s="true"===s||s)&&s;try{s="{"==n&&"}"==o||"["==n&&"]"==o?JSON.parse(s):s}catch(e){}d[e]=s}else d.attributes[t]=s}}if(c&&!d.components){const t=e.childNodes[0];1===c&&3===t.nodeType?(!d.type&&(d.type="text"),d.content=t.nodeValue):d.components=this.parseNode(e)}if("textnode"==d.type){if(i&&"textnode"==i.type){i.content+=d.content;continue}if(!t.keepEmptyTextNodes){const t=e.nodeValue;if(" "!=t&&!t.trim())continue}}const f=d.components;if(!d.type&&f){let e=1,t=0;for(let r=0;r<f.length;r++){const n=f[r],o=n.type;if(["text","textnode"].indexOf(o)<0&&s.textTags.indexOf(n.tagName)<0){e=0;break}"textnode"==o&&(t=1)}e&&t&&(d.type="text")}(d.tagName||"textnode"==d.type)&&r.push(d)}return r},parse(e,t){var r=s.em&&s.em.get("Config")||{},n={html:"",css:""},o=document.createElement("div");o.innerHTML=e;var a=o.querySelectorAll("script"),l=a.length;if(!r.allowScripts)for(;l--;)a[l].parentNode.removeChild(a[l]);if(t){for(var i="",c=o.querySelectorAll("style"),p=c.length;p--;)i=c[p].innerHTML+i,c[p].parentNode.removeChild(c[p]);i&&(n.css=t.parse(i))}var d=this.parseNode(o);return 1==d.length&&(d=d[0]),n.html=d,n}}}});
//# sourceMappingURL=../../sourcemaps/parser/model/ParserHtml.js.map
