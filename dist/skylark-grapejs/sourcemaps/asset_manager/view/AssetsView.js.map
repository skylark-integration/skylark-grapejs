{"version":3,"sources":["asset_manager/view/AssetsView.js"],"names":["define","Backbone","View","extend","events","submit","[object Object]","pfx","ppfx","em","this","form","config","showUrlInput","t","o","options","stylePrefix","pStylePrefix","coll","collection","listenTo","renderAssets","addToAsset","removedAsset","deselectAll","e","preventDefault","input","getAddInput","url","value","trim","handleAdd","getAssetsEl","scrollTop","bind","globalCollection","add","at","el","querySelector","inputUrl","model","length","toggleNoAssets","addAsset","fragmentEl","fragment","rendered","typeView","render","appendChild","assetsEl","insertBefore","firstChild","hide","$el","find","empty","noAssets","append","removeClass","document","createDocumentFragment","assets","each","fuRendered","fu","template","className"],"mappings":";;;;;;;AAAAA,QACI,oBACD,SAAUC,GACT,aACA,OAAOA,EAASC,KAAKC,QACjBC,QAAUC,OAAQ,gBAOlBC,WACI,MAAMC,IACFA,EAAGC,KACHA,EAAIC,GACJA,GACAC,KACJ,IAAIC,EAAO,GAYX,OAXID,KAAKE,OAAOC,eACZF,8BACUJ,yCACCC,UAAeD,mDACLE,GAAMA,EAAGK,EAAE,+EAElBN,cAAmBC,GAAMA,EAAGK,EAAE,kIAMzCP,qCACEA,6BACVI,sCAEUJ,4FAKbD,WAAWS,GACPL,KAAKM,QAAUD,EACfL,KAAKE,OAASG,EAAEH,OAChBF,KAAKH,IAAMG,KAAKE,OAAOK,aAAe,GACtCP,KAAKF,KAAOE,KAAKE,OAAOM,cAAgB,GACxCR,KAAKD,GAAKC,KAAKE,OAAOH,GACtB,MAAMU,EAAOT,KAAKU,WAClBV,KAAKW,SAASF,EAAM,QAAST,KAAKY,cAClCZ,KAAKW,SAASF,EAAM,MAAOT,KAAKa,YAChCb,KAAKW,SAASF,EAAM,SAAUT,KAAKc,cACnCd,KAAKW,SAASF,EAAM,cAAeT,KAAKe,cAE5CnB,aAAaoB,GACTA,EAAEC,iBACF,MAAMC,EAAQlB,KAAKmB,cACbC,EAAMF,GAASA,EAAMG,MAAMC,OAC3BC,EAAYvB,KAAKE,OAAOqB,UACzBH,IAGLF,EAAMG,MAAQ,GACdrB,KAAKwB,cAAcC,UAAY,EAC3BF,EACAA,EAAUG,KAAK1B,KAAfuB,CAAqBH,GAErBpB,KAAKM,QAAQqB,iBAAiBC,IAAIR,GAAOS,GAAI,MAGrDjC,cACI,OAAOI,KAAK8B,GAAGC,kBAAmB/B,KAAKH,cAE3CD,cAGI,OAFKI,KAAKgC,UAAahC,KAAKgC,SAASX,QACjCrB,KAAKgC,SAAWhC,KAAK8B,GAAGC,kBAAmB/B,KAAKH,uBAC7CG,KAAKgC,UAEhBpC,aAAaqC,GACJjC,KAAKU,WAAWwB,QACjBlC,KAAKmC,kBAGbvC,WAAWqC,GACuB,GAA1BjC,KAAKU,WAAWwB,QAChBlC,KAAKmC,eAAe,GAExBnC,KAAKoC,SAASH,IAElBrC,SAASqC,EAAOI,EAAa,MACzB,MAAMC,EAAWD,EACX3B,EAAaV,KAAKU,WAClBR,EAASF,KAAKE,OACdqC,EAAW,IAAIN,EAAMO,UACvBP,MAAAA,EACAvB,WAAAA,EACAR,OAAAA,IACDuC,SAASX,GACZ,GAAIQ,EACAA,EAASI,YAAYH,OAClB,CACH,MAAMI,EAAW3C,KAAKwB,cAClBmB,GACAA,EAASC,aAAaL,EAAUI,EAASE,YAGjD,OAAON,GAEX3C,eAAekD,GACX,MAAMH,EAAW3C,KAAK+C,IAAIC,SAAUhD,KAAKH,aACzC,GAAIiD,EACAH,EAASM,YACN,CACH,MAAMC,EAAWlD,KAAKE,OAAOgD,SAC7BA,GAAYP,EAASQ,OAAOD,KAGpCtD,cACI,MAAMC,EAAMG,KAAKH,IACjBG,KAAK+C,IAAIC,SAAUnD,cAAiBuD,eAAgBvD,eAExDD,eACI,MAAM0C,EAAWe,SAASC,yBACpBC,EAASvD,KAAK+C,IAAIC,SAAUhD,KAAKH,aACvC0D,EAAON,QACPjD,KAAKmC,eAAenC,KAAKU,WAAWwB,QACpClC,KAAKU,WAAW8C,KAAKvB,GAASjC,KAAKoC,SAASH,EAAOK,IACnDiB,EAAOJ,OAAOb,IAElB1C,SACI,MAAM6D,EAAazD,KAAKM,QAAQoD,GAAGjB,SAASX,GAM5C,OALA9B,KAAK+C,IAAIE,QACTjD,KAAK+C,IAAII,OAAOM,GAAYN,OAAOnD,KAAK2D,SAAS3D,OACjDA,KAAK8B,GAAG8B,aAAgB5D,KAAKF,oBAC7BE,KAAKY,eACLZ,KAAKuC,SAAW,EACTvC","file":"../../../asset_manager/view/AssetsView.js","sourcesContent":["define([\n    'skylark-backbone'\n], function (Backbone) {\n    'use strict';\n    return Backbone.View.extend({\n        events: { submit: 'handleSubmit' },\n        //template({\n        //    pfx,\n        //    ppfx,\n        //    em,\n        //    ...view\n        //}) {\n        template() {\n            const {\n                pfx,\n                ppfx,\n                em\n            } = this;  // modified by lwf\n            let form = '';\n            if (this.config.showUrlInput) {\n                form = `\n          <form class=\"${ pfx }add-asset\">\n            <div class=\"${ ppfx }field ${ pfx }add-field\">\n              <input placeholder=\"${ em && em.t('assetManager.inputPlh') }\"/>\n            </div>\n            <button class=\"${ ppfx }btn-prim\">${ em && em.t('assetManager.addButton') }</button>\n            <div style=\"clear:both\"></div>\n          </form>\n      `;\n            }\n            return `\n    <div class=\"${ pfx }assets-cont\">\n      <div class=\"${ pfx }assets-header\">\n        ${ form }\n      </div>\n      <div class=\"${ pfx }assets\" data-el=\"assets\"></div>\n      <div style=\"clear:both\"></div>\n    </div>\n    `;\n        },\n        initialize(o) {\n            this.options = o;\n            this.config = o.config;\n            this.pfx = this.config.stylePrefix || '';\n            this.ppfx = this.config.pStylePrefix || '';\n            this.em = this.config.em;\n            const coll = this.collection;\n            this.listenTo(coll, 'reset', this.renderAssets);\n            this.listenTo(coll, 'add', this.addToAsset);\n            this.listenTo(coll, 'remove', this.removedAsset);\n            this.listenTo(coll, 'deselectAll', this.deselectAll);\n        },\n        handleSubmit(e) {\n            e.preventDefault();\n            const input = this.getAddInput();\n            const url = input && input.value.trim();\n            const handleAdd = this.config.handleAdd;\n            if (!url) {\n                return;\n            }\n            input.value = '';\n            this.getAssetsEl().scrollTop = 0;\n            if (handleAdd) {\n                handleAdd.bind(this)(url);\n            } else {\n                this.options.globalCollection.add(url, { at: 0 });\n            }\n        },\n        getAssetsEl() {\n            return this.el.querySelector(`.${ this.pfx }assets`);\n        },\n        getAddInput() {\n            if (!this.inputUrl || !this.inputUrl.value)\n                this.inputUrl = this.el.querySelector(`.${ this.pfx }add-asset input`);\n            return this.inputUrl;\n        },\n        removedAsset(model) {\n            if (!this.collection.length) {\n                this.toggleNoAssets();\n            }\n        },\n        addToAsset(model) {\n            if (this.collection.length == 1) {\n                this.toggleNoAssets(1);\n            }\n            this.addAsset(model);\n        },\n        addAsset(model, fragmentEl = null) {\n            const fragment = fragmentEl;\n            const collection = this.collection;\n            const config = this.config;\n            const rendered = new model.typeView({\n                model,\n                collection,\n                config\n            }).render().el;\n            if (fragment) {\n                fragment.appendChild(rendered);\n            } else {\n                const assetsEl = this.getAssetsEl();\n                if (assetsEl) {\n                    assetsEl.insertBefore(rendered, assetsEl.firstChild);\n                }\n            }\n            return rendered;\n        },\n        toggleNoAssets(hide) {\n            const assetsEl = this.$el.find(`.${ this.pfx }assets`);\n            if (hide) {\n                assetsEl.empty();\n            } else {\n                const noAssets = this.config.noAssets;\n                noAssets && assetsEl.append(noAssets);\n            }\n        },\n        deselectAll() {\n            const pfx = this.pfx;\n            this.$el.find(`.${ pfx }highlight`).removeClass(`${ pfx }highlight`);\n        },\n        renderAssets() {\n            const fragment = document.createDocumentFragment();\n            const assets = this.$el.find(`.${ this.pfx }assets`);\n            assets.empty();\n            this.toggleNoAssets(this.collection.length);\n            this.collection.each(model => this.addAsset(model, fragment));\n            assets.append(fragment);\n        },\n        render() {\n            const fuRendered = this.options.fu.render().el;\n            this.$el.empty();\n            this.$el.append(fuRendered).append(this.template(this));\n            this.el.className = `${ this.ppfx }asset-manager`;\n            this.renderAssets();\n            this.rendered = 1;\n            return this;\n        }\n    });\n});"]}