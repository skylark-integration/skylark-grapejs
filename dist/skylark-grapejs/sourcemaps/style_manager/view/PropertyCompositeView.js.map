{"version":3,"sources":["style_manager/view/PropertyCompositeView.js"],"names":["define","Backbone","PropertyView","PropertiesView","$","extend","[object Object]","pfx","this","args","model","get","prototype","inputValueChanged","apply","e","props","properties","forEach","propView","clear","arguments","length","$input","input","$props","each","prop","index","remove","console","warn","parent","propsView","getPropsConfig","render","$el","find","append","opts","that","result","config","highlightComputed","collection","target","propTarget","el","view","set","getFullValue","customValue","property","mIndex","valueOnIndex","onChange","value","targetValue","getTargetValue","ignoreDefault","split","getSplitSeparator","ignoreCustomValue","clearCached"],"mappings":";;;;;;;AAAAA,QACI,mBACA,iBACA,oBACD,SACCC,EACAC,EACAC,GAEA,aACA,MAAMC,EAAIH,EAASG,EACnB,OAAOF,EAAaG,QAChBC,gBACI,MAAMC,EAAMC,KAAKD,IACjB,6BACSA,UAAcA,mCACdA,8CAIbD,qBAAqBG,GACZD,KAAKE,MAAMC,IAAI,aAChBT,EAAaU,UAAUC,kBAAkBC,MAAMN,KAAMC,IAG7DH,MAAMS,GACF,MAAMC,EAAQR,KAAKS,WACnBD,GAASA,EAAME,QAAQC,GAAYA,EAASC,SAC5ClB,EAAaU,UAAUQ,MAAMN,MAAMN,KAAMa,YAE7Cf,WACI,IAAII,EAAQF,KAAKE,MACbM,EAAQN,EAAMC,IAAI,kBAGtB,GADAH,KAAKS,cACDD,EAAMM,SACDd,KAAKe,SACNf,KAAKe,OAASnB,EAAE,mCAChBI,KAAKgB,MAAQhB,KAAKe,OAAOZ,IAAI,IAE5BH,KAAKQ,QACNR,KAAKQ,MAAQN,EAAMC,IAAI,gBAEtBH,KAAKiB,QAAQ,CACdjB,KAAKQ,MAAMU,KAAK,SAAUC,EAAMC,GACxBD,GAA4B,aAApBA,EAAKhB,IAAI,UACjBH,KAAKQ,MAAMa,OAAOF,GAClBG,QAAQC,KAAK,4CAEjBJ,EAAKK,OAAStB,GACfF,MAEH,IAAIyB,EAAY,IAAI9B,EAAeK,KAAK0B,kBACxC1B,KAAKiB,OAASQ,EAAUE,SAASC,IACjC5B,KAAKS,WAAagB,EAAUhB,WAC5BT,KAAK4B,IAAIC,SAAU7B,KAAKD,mBAAoB+B,OAAO9B,KAAKiB,UAIpEnB,eAAeiC,GACX,IAAIC,EAAOhC,KACX,MAAME,EAAQF,KAAKE,MACnB,IAAI+B,GACAC,WACOlC,KAAKkC,OACRC,kBAAmB,GAEvBC,WAAYpC,KAAKQ,MACjB6B,OAAQrC,KAAKqC,OACbC,WAAYtC,KAAKsC,WACjBxC,SAASyC,EAAIC,EAAMT,GACf7B,EAAMuC,IAAI,QAASvC,EAAMwC,eAAgBX,IAE7CY,YAAW,CAACC,EAAUC,IACXb,EAAKc,aAAaD,EAAQD,IAMzC,OAHI1C,EAAMC,IAAI,oBACH8B,EAAOc,SAEXd,GAEXnC,aAAasB,EAAOoB,GAChB,IAAIQ,EACJ,MAAMC,EAAcjD,KAAKkD,gBAAiBC,cAAe,IACzD,GAAIF,EAAa,CAEbD,EADeC,EAAYG,MAAMpD,KAAKE,MAAMmD,qBAC7BjC,QAEf4B,EAAQR,GAAQA,EAAKU,gBACjBI,kBAAmB,EACnBH,cAAe,IAGvB,OAAOH,GAEXlD,cACIJ,EAAaU,UAAUmD,YAAYjD,MAAMN,KAAMa,WAC/Cb,KAAKe,OAAS,KACdf,KAAKQ,MAAQ,KACbR,KAAKiB,OAAS","file":"../../../style_manager/view/PropertyCompositeView.js","sourcesContent":["define([\n    'skylark-backbone',\n    './PropertyView',\n    \"./PropertiesView\"\n], function (\n    Backbone, \n    PropertyView,\n    PropertiesView\n) {\n    'use strict';\n    const $ = Backbone.$;\n    return PropertyView.extend({\n        templateInput() {\n            const pfx = this.pfx;\n            return `\n      <div class=\"${ pfx }field ${ pfx }composite\">\n        <span id=\"${ pfx }input-holder\"></span>\n      </div>\n    `;\n        },\n        inputValueChanged(...args) {\n            if (!this.model.get('detached')) {\n                PropertyView.prototype.inputValueChanged.apply(this, args);\n            }\n        },\n        clear(e) {\n            const props = this.properties;\n            props && props.forEach(propView => propView.clear());\n            PropertyView.prototype.clear.apply(this, arguments);\n        },\n        onRender() {\n            var model = this.model;\n            var props = model.get('properties') || [];\n            var self = this;\n            this.properties = [];\n            if (props.length) {\n                if (!this.$input) {\n                    this.$input = $('<input type=\"hidden\" value=\"0\">');\n                    this.input = this.$input.get(0);\n                }\n                if (!this.props) {\n                    this.props = model.get('properties');\n                }\n                if (!this.$props) {\n                    this.props.each(function (prop, index) {\n                        if (prop && prop.get('type') == 'composite') {\n                            this.props.remove(prop);\n                            console.warn('Nested composite types not yet allowed.');\n                        }\n                        prop.parent = model;\n                    }, this);\n                    //var PropertiesView = require('./PropertiesView').default;\n                    var propsView = new PropertiesView(this.getPropsConfig());\n                    this.$props = propsView.render().$el;\n                    this.properties = propsView.properties;\n                    this.$el.find(`#${ this.pfx }input-holder`).append(this.$props);\n                }\n            }\n        },\n        getPropsConfig(opts) {\n            var that = this;\n            const model = this.model;\n            var result = {\n                config: {\n                    ...this.config,\n                    highlightComputed: 0\n                },\n                collection: this.props,\n                target: this.target,\n                propTarget: this.propTarget,\n                onChange(el, view, opts) {\n                    model.set('value', model.getFullValue(), opts);\n                },\n                customValue(property, mIndex) {\n                    return that.valueOnIndex(mIndex, property);\n                }\n            };\n            if (model.get('detached')) {\n                delete result.onChange;\n            }\n            return result;\n        },\n        valueOnIndex(index, view) {\n            let value;\n            const targetValue = this.getTargetValue({ ignoreDefault: 1 });\n            if (targetValue) {\n                const values = targetValue.split(this.model.getSplitSeparator());\n                value = values[index];\n            } else {\n                value = view && view.getTargetValue({\n                    ignoreCustomValue: 1,\n                    ignoreDefault: 1\n                });\n            }\n            return value;\n        },\n        clearCached() {\n            PropertyView.prototype.clearCached.apply(this, arguments);\n            this.$input = null;\n            this.props = null;\n            this.$props = null;\n        }\n    });\n});"]}