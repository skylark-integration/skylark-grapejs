{"version":3,"sources":["selector_manager/index.js"],"names":["define","langx","_","b","defaults","Selector","Selectors","ClassTagsView","isId","str","isString","isClass","config","selectors","c","name","getConfig","[object Object]","conf","em","ppfx","pStylePrefix","this","stylePrefix","selectorTags","collection","on","model","trigger","previousAttributes","changedAttributes","m","value","elTo","appendTo","isElement","document","querySelector","appendChild","render","opts","targets","Array","isArray","res","get","setTarget","filter","i","map","sel","isComponent","isRule","getSelectorsString","componentChanged","setState","opt","clone","isObject","substr","type","TYPE_ID","label","escapeName","cname","selector","where","add","getSelector","TYPE_CLASS","item","addSelector","classes","added","trim","split","forEach","push","result","indexOf","getAll","el"],"mappings":"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","file":"../../selector_manager/index.js","sourcesContent":["define([\n    \"skylark-langx/langx\",\n    'skylark-underscore',\n    '../utils/mixins',\n    './config/config',\n    './model/Selector',\n    './model/Selectors',\n    './view/ClassTagsView'\n], function (langx,_, b, defaults, Selector, Selectors, ClassTagsView) {\n    'use strict';\n    const isId = str => _.isString(str) && str[0] == '#';\n    const isClass = str => _.isString(str) && str[0] == '.';\n    return config => {\n        var c = config || {};\n        var selectors;\n        return {\n            Selector,\n            Selectors,\n            name: 'SelectorManager',\n            getConfig() {\n                return c;\n            },\n            init(conf = {}) {\n                c = {...defaults,...conf};\n                const em = c.em;\n                const ppfx = c.pStylePrefix;\n                this.em = em;\n                if (ppfx) {\n                    c.stylePrefix = ppfx + c.stylePrefix;\n                }\n                this.selectorTags = new ClassTagsView({\n                    collection: new Selectors([], {\n                        em,\n                        config: c\n                    }),\n                    config: c\n                });\n                selectors = new Selectors(c.selectors);\n                selectors.on('add', model => em.trigger('selector:add', model));\n                selectors.on('remove', model => em.trigger('selector:remove', model));\n                selectors.on('change', model => em.trigger('selector:update', model, model.previousAttributes(), model.changedAttributes()));\n                em.on('change:state', (m, value) => em.trigger('selector:state', value));\n                return this;\n            },\n            postRender() {\n                const elTo = this.getConfig().appendTo;\n                if (elTo) {\n                    const el = _.isElement(elTo) ? elTo : document.querySelector(elTo);\n                    el.appendChild(this.render([]));\n                }\n            },\n            select(value, opts = {}) {\n                const targets = Array.isArray(value) ? value : [value];\n                const toSelect = this.em.get('StyleManager').setTarget(targets, opts);\n                const res = toSelect.filter(i => i).map(sel => b.isComponent(sel) ? sel : b.isRule(sel) && !sel.get('selectorsAdd') ? sel : sel.getSelectorsString());\n                this.selectorTags.componentChanged({ targets: res });\n                return this;\n            },\n            setState(value) {\n                this.em.setState(value);\n                return this;\n            },\n            getState() {\n                return this.em.setState();\n            },\n            addSelector(name, opt = {}) {\n                let opts = langx.clone(opt);\n                if (_.isObject(name)) {\n                    opts = name;\n                } else {\n                    opts.name = name;\n                }\n                if (isId(opts.name)) {\n                    opts.name = opts.name.substr(1);\n                    opts.type = Selector.TYPE_ID;\n                } else if (isClass(opts.name)) {\n                    opts.name = opts.name.substr(1);\n                }\n                if (opts.label && !opts.name) {\n                    opts.name = this.escapeName(opts.label);\n                }\n                const cname = opts.name;\n                const selector = cname ? this.get(cname, opts.type) : selectors.where(opts)[0];\n                if (!selector) {\n                    return selectors.add(opts, { config: c });\n                }\n                return selector;\n            },\n            getSelector(name, type = Selector.TYPE_CLASS) {\n                if (isId(name)) {\n                    name = name.substr(1);\n                    type = Selector.TYPE_ID;\n                } else if (isClass(name)) {\n                    name = name.substr(1);\n                }\n                return selectors.where({\n                    name,\n                    type\n                })[0];\n            },\n            add(name, opts = {}) {\n                if (_.isArray(name)) {\n                    return name.map(item => this.addSelector(item, opts));\n                } else {\n                    return this.addSelector(name, opts);\n                }\n            },\n            addClass(classes) {\n                const added = [];\n                if (_.isString(classes)) {\n                    classes = classes.trim().split(' ');\n                }\n                classes.forEach(name => added.push(this.addSelector(name)));\n                return added;\n            },\n            get(name, type) {\n                if (_.isArray(name)) {\n                    const result = [];\n                    const selectors = name.map(item => this.getSelector(item)).filter(item => item);\n                    selectors.forEach(item => result.indexOf(item) < 0 && result.push(item));\n                    return result;\n                } else {\n                    return this.getSelector(name, type);\n                }\n            },\n            getAll() {\n                return selectors;\n            },\n            escapeName(name) {\n                const {escapeName} = c;\n                return escapeName ? escapeName(name) : Selector.escapeName(name);\n            },\n            render(selectors) {\n                if (selectors) {\n                    this.selectorTags = new ClassTagsView({\n                        collection: new Selectors(selectors),\n                        config: c\n                    });\n                    return this.selectorTags.render().el;\n                } else\n                    return this.selectorTags.render().el;\n            }\n        };\n    };\n});"]}