{"version":3,"sources":["selector_manager/view/ClassTagsView.js"],"names":["define","a","Backbone","ClassTagView","View","extend","template","labelInfo","labelStates","labelHead","iconSync","iconAdd","pfx","ppfx","events","change [data-states]","click [data-add]","focusout [data-input]","keyup [data-input]","click [data-sync-style]","[object Object]","o","this","config","stylePrefix","pStylePrefix","className","stateInputId","stateInputC","states","em","getStyleEmitter","coll","collection","target","listenTo","componentChanged","__handleStateChange","checkSync","addNew","renderClasses","tagRemoved","delegateEvents","getTarget","cssC","get","selectors","getCommonSelectors","opts","noDisabled","state","mediaText","getCurrentMedia","ruleComponents","rule","add","style","getTargets","forEach","ruleComponent","getIdRule","getId","getStyle","setStyle","push","addStyle","trigger","component","sm","getEmitter","model","updateStateVis","result","name","t","label","join","addToClasses","$addBtn","css","display","$input","show","focus","hide","val","e","keyCode","addNewTag","endNewTag","getState","statesEl","getStates","debounce","targets","updateSelection","trgs","isArray","length","validSelectors","reset","map","tr","getSelectors","getValid","filter","i","_commonSelectors","args","item","indexOf","slice","reduce","acc","$btnSyncEl","hasStyle","componentFirst","isEmpty","getSelected","getSelectedAll","avoidInline","getConfig","getStatesC","updateSelector","elSel","el","querySelector","__getName","innerHTML","checkStates","selectedName","isString","getStyleable","idRes","getName","getFullString","ev","value","set","trim","fragmentEl","fragment","classes","getClasses","rendered","render","appendChild","append","frag","document","createDocumentFragment","empty","each","$el","find","$states","$statesC","tmpOpts","html","renderRes","$classes","getStateOptions","attr"],"mappings":"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","file":"../../../selector_manager/view/ClassTagsView.js","sourcesContent":["define([\n    'skylark-underscore',\n    'skylark-backbone',\n    './ClassTagView'\n], function (a, Backbone, ClassTagView) {\n    'use strict';\n    return Backbone.View.extend({\n        template({labelInfo, labelStates, labelHead, iconSync, iconAdd, pfx, ppfx}) {\n            return `\n    <div id=\"${ pfx }up\" class=\"${ pfx }header\">\n      <div id=\"${ pfx }label\" class=\"${ pfx }header-label\">${ labelHead }</div>\n      <div id=\"${ pfx }status-c\" class=\"${ pfx }header-status\">\n        <span id=\"${ pfx }input-c\" data-states-c>\n          <div class=\"${ ppfx }field ${ ppfx }select\">\n            <span id=\"${ ppfx }input-holder\">\n              <select id=\"${ pfx }states\" data-states>\n                <option value=\"\">${ labelStates }</option>\n              </select>\n            </span>\n            <div class=\"${ ppfx }sel-arrow\">\n              <div class=\"${ ppfx }d-s-arrow\"></div>\n            </div>\n          </div>\n        </span>\n      </div>\n    </div>\n    <div id=\"${ pfx }tags-field\" class=\"${ ppfx }field\">\n      <div id=\"${ pfx }tags-c\" data-selectors></div>\n      <input id=\"${ pfx }new\" data-input/>\n      <span id=\"${ pfx }add-tag\" class=\"${ pfx }tags-btn ${ pfx }tags-btn__add\" data-add>\n        ${ iconAdd }\n      </span>\n      <span class=\"${ pfx }tags-btn ${ pfx }tags-btn__sync\" style=\"display: none\" data-sync-style>\n        ${ iconSync }\n      </span>\n    </div>\n    <div class=\"${ pfx }sels-info\">\n      <div class=\"${ pfx }label-sel\">${ labelInfo }:</div>\n      <div class=\"${ pfx }sels\" data-selected></div>\n      <div style=\"clear:both\"></div>\n    </div>`;\n        },\n        events: {\n            'change [data-states]': 'stateChanged',\n            'click [data-add]': 'startNewTag',\n            'focusout [data-input]': 'endNewTag',\n            'keyup [data-input]': 'onInputKeyUp',\n            'click [data-sync-style]': 'syncStyle'\n        },\n        initialize(o = {}) {\n            this.config = o.config || {};\n            this.pfx = this.config.stylePrefix || '';\n            this.ppfx = this.config.pStylePrefix || '';\n            this.className = this.pfx + 'tags';\n            this.stateInputId = this.pfx + 'states';\n            this.stateInputC = this.pfx + 'input-c';\n            this.states = this.config.states || [];\n            const {em} = this.config;\n            this.em = em; // modified by lwf\n            const emitter = this.getStyleEmitter();\n            const coll = this.collection;\n            this.target = this.config.em;\n            const toList = 'component:toggled component:update:classes';\n            const toListCls = 'component:update:classes change:state';\n            this.listenTo(em, toList, this.componentChanged);\n            //this.listenTo(emitter, 'styleManager:update', this.componentChanged); // modified by lwf\n            this.listenTo(em, toListCls, this.__handleStateChange);\n            this.listenTo(em, 'styleable:change change:device', this.checkSync);\n            this.listenTo(coll, 'add', this.addNew);\n            this.listenTo(coll, 'reset', this.renderClasses);\n            this.listenTo(coll, 'remove', this.tagRemoved);\n            this.delegateEvents();\n        },\n        syncStyle() {\n            const {em} = this;\n            const target = this.getTarget();\n            const cssC = em.get('CssComposer');\n            const opts = { noDisabled: 1 };\n            const selectors = this.getCommonSelectors({ opts });\n            const state = em.get('state');\n            const mediaText = em.getCurrentMedia();\n            const ruleComponents = [];\n            const rule = cssC.get(selectors, state, mediaText) || cssC.add(selectors, state, mediaText);\n            let style;\n            this.getTargets().forEach(target => {\n                const ruleComponent = cssC.getIdRule(target.getId(), {\n                    state,\n                    mediaText\n                });\n                style = ruleComponent.getStyle();\n                ruleComponent.setStyle({});\n                ruleComponents.push(ruleComponent);\n            });\n            style && rule.addStyle(style);\n            em.trigger('component:toggled');\n            em.trigger('component:sync-style', {\n                component: target,\n                selectors,\n                mediaText,\n                rule,\n                ruleComponents,\n                state\n            });\n        },\n        getStyleEmitter() {\n            const {em} = this;\n            const sm = em && em.get('StyleManager');\n            const emitter = sm && sm.getEmitter();\n            return emitter || {};\n        },\n        tagRemoved(model) {\n            this.updateStateVis();\n        },\n        getStateOptions() {\n            const {states, em} = this;\n            let result = [];\n            states.forEach(state => result.push(`<option value=\"${ state.name }\">${ em.t(`selectorManager.states.${ state.name }`) || state.label || state.name }</option>`));\n            return result.join('');\n        },\n        addNew(model) {\n            this.addToClasses(model);\n        },\n        startNewTag() {\n            this.$addBtn.css({ display: 'none' });\n            this.$input.show().focus();\n        },\n        endNewTag() {\n            this.$addBtn.css({ display: '' });\n            this.$input.hide().val('');\n        },\n        onInputKeyUp(e) {\n            if (e.keyCode === 13)\n                this.addNewTag(this.$input.val());\n            else if (e.keyCode === 27)\n                this.endNewTag();\n        },\n        checkStates() {\n            const state = this.em.getState();\n            const statesEl = this.getStates();\n            statesEl && statesEl.val(state);\n        },\n        componentChanged: a.debounce(function ({targets} = {}) {\n            this.updateSelection(targets);\n        }),\n        updateSelection(targets) {\n            let trgs = targets || this.getTargets();\n            trgs = a.isArray(trgs) ? trgs : [trgs];\n            let selectors = [];\n            if (trgs && trgs.length) {\n                selectors = this.getCommonSelectors({ targets: trgs });\n                this.checkSync({ validSelectors: selectors });\n            }\n            this.collection.reset(selectors);\n            this.updateStateVis(trgs);\n            return selectors;\n        },\n        getCommonSelectors({targets, opts = {}} = {}) {\n            const trgs = targets || this.getTargets();\n            const selectors = trgs.map(tr => tr.getSelectors && tr.getSelectors().getValid(opts)).filter(i => i);\n            return this._commonSelectors(...selectors);\n        },\n        _commonSelectors(...args) {\n            if (!args.length)\n                return [];\n            if (args.length === 1)\n                return args[0];\n            if (args.length === 2)\n                return args[0].filter(item => args[1].indexOf(item) >= 0);\n            return args.slice(1).reduce((acc, item) => this._commonSelectors(acc, item), args[0]);\n        },\n        checkSync: a.debounce(function () {\n            const {$btnSyncEl, config, collection} = this;\n            const target = this.getTarget();\n            let hasStyle;\n            if (target && config.componentFirst && collection.length) {\n                const style = target.getStyle();\n                hasStyle = !a.isEmpty(style);\n            }\n            $btnSyncEl && $btnSyncEl[hasStyle ? 'show' : 'hide']();\n        }),\n        getTarget() {\n            return this.target.getSelected();\n        },\n        getTargets() {\n            return this.target.getSelectedAll();\n        },\n        updateStateVis(target) {\n            const em = this.em;\n            const avoidInline = em && em.getConfig('avoidInlineStyle');\n            const display = this.collection.length || avoidInline ? '' : 'none';\n            this.getStatesC().css('display', display);\n            this.updateSelector(target);\n        },\n        __handleStateChange() {\n            this.updateSelector(this.getTargets());\n        },\n        updateSelector(targets) {\n            const elSel = this.el.querySelector('[data-selected]');\n            const result = [];\n            let trgs = targets || this.getTargets();\n            trgs = a.isArray(trgs) ? trgs : [trgs];\n            trgs.forEach(target => result.push(this.__getName(target)));\n            elSel && (elSel.innerHTML = result.join(', '));\n            this.checkStates();\n        },\n        __getName(target) {\n            const {pfx, config, em} = this;\n            const {selectedName, componentFirst} = config;\n            let result;\n            if (a.isString(target)) {\n                result = `<span class=\"${ pfx }sel-gen\">${ target }</span>`;\n            } else {\n                if (!target || !target.get)\n                    return;\n                const selectors = target.getSelectors().getStyleable();\n                const state = em.get('state');\n                const idRes = target.getId ? `<span class=\"${ pfx }sel-cmp\">${ target.getName() }</span><span class=\"${ pfx }sel-id\">#${ target.getId() }</span>` : '';\n                result = this.collection.getFullString(selectors);\n                result = result ? `<span class=\"${ pfx }sel-rule\">${ result }</span>` : target.get('selectorsAdd') || idRes;\n                result = componentFirst && idRes ? idRes : result;\n                result += state ? `<span class=\"${ pfx }sel-state\">:${ state }</span>` : '';\n                result = selectedName ? selectedName({\n                    result,\n                    state,\n                    target\n                }) : result;\n            }\n            return result && `<span class=\"${ pfx }sel\">${ result }</span>`;\n        },\n        stateChanged(ev) {\n            const {em} = this;\n            const {value} = ev.target;\n            em.set('state', value);\n        },\n        addNewTag(label) {\n            const {em} = this;\n            if (!label.trim())\n                return;\n            if (em) {\n                const sm = em.get('SelectorManager');\n                const model = sm.add({ label });\n                this.getTargets().forEach(target => {\n                    target.getSelectors().add(model);\n                    this.collection.add(model);\n                    this.updateStateVis();\n                });\n            }\n            this.endNewTag();\n        },\n        addToClasses(model, fragmentEl = null) {\n            const fragment = fragmentEl;\n            const classes = this.getClasses();\n            const rendered = new ClassTagView({\n                model,\n                config: this.config,\n                coll: this.collection\n            }).render().el;\n            fragment ? fragment.appendChild(rendered) : classes.append(rendered);\n            return rendered;\n        },\n        renderClasses() {\n            const frag = document.createDocumentFragment();\n            const classes = this.getClasses();\n            classes.empty();\n            this.collection.each(model => this.addToClasses(model, frag));\n            classes.append(frag);\n        },\n        getClasses() {\n            return this.$el.find('[data-selectors]');\n        },\n        getStates() {\n            if (!this.$states) {\n                const el = this.$el.find('[data-states]');\n                this.$states = el[0] && el;\n            }\n            return this.$states;\n        },\n        getStatesC() {\n            if (!this.$statesC)\n                this.$statesC = this.$el.find('#' + this.stateInputC);\n            return this.$statesC;\n        },\n        render() {\n            const {em, pfx, ppfx, config, $el, el} = this;\n            const {render, iconSync, iconAdd} = config;\n            const tmpOpts = {\n                iconSync,\n                iconAdd,\n                labelHead: em.t('selectorManager.label'),\n                labelStates: em.t('selectorManager.emptyState'),\n                labelInfo: em.t('selectorManager.selected'),\n                ppfx,\n                pfx,\n                el\n            };\n            $el.html(this.template(tmpOpts));\n            const renderRes = render && render(tmpOpts);\n            renderRes && renderRes !== el && $el.empty().append(renderRes);\n            this.$input = $el.find('[data-input]');\n            this.$addBtn = $el.find('[data-add]');\n            this.$classes = $el.find('#' + pfx + 'tags-c');\n            this.$btnSyncEl = $el.find('[data-sync-style]');\n            this.$input.hide();\n            const statesEl = this.getStates();\n            statesEl && statesEl.append(this.getStateOptions());\n            this.renderClasses();\n            $el.attr('class', `${ this.className } ${ ppfx }one-bg ${ ppfx }two-color`);\n            return this;\n        }\n    });\n});"]}