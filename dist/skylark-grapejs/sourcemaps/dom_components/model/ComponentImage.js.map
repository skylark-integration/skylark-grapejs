{"version":3,"sources":["dom_components/model/ComponentImage.js"],"names":["define","langx","_","Component","svgAttrs","extend","defaults","mixin","prototype","type","tagName","void","droppable","editable","highlightable","resizable","ratioDefault","traits","src","fallback","file","[object Object]","o","opt","initialize","apply","this","arguments","attr","get","set","args","initToolbar","em","has","hasButtonBool","tb","i","length","command","push","attributes","class","getAttrToHTML","getSrcResult","result","substr","window","btoa","uri","el","document","createElement","href","query","qrs","search","substring","split","pair","name","decodeURIComponent","hostname","pathname","protocol","hash","port"],"mappings":";;;;;;;AAAAA,QACI,sBACA,qBACA,eACD,SAAUC,EAAMC,EAAGC,GAClB,aACA,MAAMC,EAAW,4HACjB,OAAOD,EAAUE,QACbC,SAAUL,EAAMM,SAASJ,EAAUK,UAAUF,UACzCG,KAAM,QACNC,QAAS,MACTC,KAAM,EACNC,UAAW,EACXC,SAAU,EACVC,cAAe,EACfC,WAAaC,aAAc,GAC3BC,QAAS,OACTC,YAAcd,yJAGde,iBAAmBf,2LAGnBgB,KAAM,KAEVC,WAAWC,EAAGC,GACVpB,EAAUK,UAAUgB,WAAWC,MAAMC,KAAMC,WAC3C,IAAIC,EAAOF,KAAKG,IAAI,cAChBD,EAAKV,KACLQ,KAAKI,IAAI,MAAOF,EAAKV,MAE7BG,eAAeU,GACX5B,EAAUK,UAAUwB,YAAYP,MAAMC,KAAMK,GAC5C,MAAME,EAAKP,KAAKO,GAChB,GAAIA,EAAI,CAGJ,GAFUA,EAAGJ,IAAI,YAETK,IADM,gBACQ,CAClB,IAAIC,GAAgB,EACpB,IAAIC,EAAKV,KAAKG,IAAI,WAClB,IAAK,IAAIQ,EAAI,EAAGA,EAAID,EAAGE,OAAQD,IAC3B,GAAsB,iBAAlBD,EAAGC,GAAGE,QAA4B,CAClCJ,GAAgB,EAChB,MAGHA,IACDC,EAAGI,MACCC,YAAcC,MAAO,gBACrBH,QAbE,iBAeNb,KAAKI,IAAI,UAAWM,OAKpCf,iBAAiBU,GACb,MAAMH,EAAOzB,EAAUK,UAAUmC,cAAclB,MAAMC,KAAMK,GACrDb,EAAMQ,KAAKkB,eAGjB,OAFI1B,IACAU,EAAKV,IAAMA,GACRU,GAEXP,aAAaE,MACT,MAAML,EAAMQ,KAAKG,IAAIN,EAAIJ,SAAW,WAAa,QAAU,GAC3D,IAAI0B,EAAS3B,EAIb,OAHIA,GAA4B,SAArBA,EAAI4B,OAAO,EAAG,KACrBD,+BAAuCE,OAAOC,KAAK9B,MAEhD2B,GAEXxB,eACI,OAAOK,KAAKG,IAAI,SAAW3B,EAAE2C,OAAOnB,KAAM,YAAYR,KAE1DG,SAAS4B,GACL,IAAIC,EAAKC,SAASC,cAAc,KAChCF,EAAGG,KAAOJ,EAGV,IAFA,IAAIK,KACAC,EAAML,EAAGM,OAAOC,UAAU,GAAGC,MAAM,KAC9BrB,EAAI,EAAGA,EAAIkB,EAAIjB,OAAQD,IAAK,CACjC,IAAIsB,EAAOJ,EAAIlB,GAAGqB,MAAM,KACpBE,EAAOC,mBAAmBF,EAAK,IAC/BC,IACAN,EAAMM,GAAQC,mBAAmBF,EAAK,KAE9C,OACIG,SAAUZ,EAAGY,SACbC,SAAUb,EAAGa,SACbC,SAAUd,EAAGc,SACbR,OAAQN,EAAGM,OACXS,KAAMf,EAAGe,KACTC,KAAMhB,EAAGgB,KACTZ,MAAAA,MAIRjC,YAAY6B,GACR,IAAIL,EAAS,GAIb,MAHkB,OAAdK,EAAGxC,UACHmC,GAAWpC,KAAM,UAEdoC","file":"../../../dom_components/model/ComponentImage.js","sourcesContent":["define([\n    \"skylark-langx/langx\",\n    'skylark-underscore',\n    './Component'\n], function (langx,_, Component) {\n    'use strict';\n    const svgAttrs = 'xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" viewBox=\"0 0 24 24\" style=\"fill: rgba(0,0,0,0.15); transform: scale(0.75)\"';\n    return Component.extend({\n        defaults: langx.mixin({},Component.prototype.defaults,{\n            type: 'image',\n            tagName: 'img',\n            void: 1,\n            droppable: 0,\n            editable: 1,\n            highlightable: 0,\n            resizable: { ratioDefault: 1 },\n            traits: ['alt'],\n            src: `<svg ${ svgAttrs }>\n        <path d=\"M8.5 13.5l2.5 3 3.5-4.5 4.5 6H5m16 1V5a2 2 0 0 0-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2z\"></path>\n      </svg>`,\n            fallback: `<svg ${ svgAttrs }>\n        <path d=\"M2.28 3L1 4.27l2 2V19c0 1.1.9 2 2 2h12.73l2 2L21 21.72 2.28 3m2.55 0L21 19.17V5a2 2 0 0 0-2-2H4.83M8.5 13.5l2.5 3 1-1.25L14.73 18H5l3.5-4.5z\"></path>\n      </svg>`,\n            file: ''\n        }),\n        initialize(o, opt) {\n            Component.prototype.initialize.apply(this, arguments);\n            var attr = this.get('attributes');\n            if (attr.src)\n                this.set('src', attr.src);\n        },\n        initToolbar(...args) {\n            Component.prototype.initToolbar.apply(this, args);\n            const em = this.em;\n            if (em) {\n                var cmd = em.get('Commands');\n                var cmdName = 'image-editor';\n                if (cmd.has(cmdName)) {\n                    let hasButtonBool = false;\n                    var tb = this.get('toolbar');\n                    for (let i = 0; i < tb.length; i++) {\n                        if (tb[i].command === 'image-editor') {\n                            hasButtonBool = true;\n                            break;\n                        }\n                    }\n                    if (!hasButtonBool) {\n                        tb.push({\n                            attributes: { class: 'fa fa-pencil' },\n                            command: cmdName\n                        });\n                        this.set('toolbar', tb);\n                    }\n                }\n            }\n        },\n        getAttrToHTML(...args) {\n            const attr = Component.prototype.getAttrToHTML.apply(this, args);\n            const src = this.getSrcResult();\n            if (src)\n                attr.src = src;\n            return attr;\n        },\n        getSrcResult(opt = {}) {\n            const src = this.get(opt.fallback ? 'fallback' : 'src') || '';\n            let result = src;\n            if (src && src.substr(0, 4) === '<svg') {\n                result = `data:image/svg+xml;base64,${ window.btoa(src) }`;\n            }\n            return result;\n        },\n        isDefaultSrc() {\n            return this.get('src') === _.result(this, 'defaults').src;\n        },\n        parseUri(uri) {\n            var el = document.createElement('a');\n            el.href = uri;\n            var query = {};\n            var qrs = el.search.substring(1).split('&');\n            for (var i = 0; i < qrs.length; i++) {\n                var pair = qrs[i].split('=');\n                var name = decodeURIComponent(pair[0]);\n                if (name)\n                    query[name] = decodeURIComponent(pair[1]);\n            }\n            return {\n                hostname: el.hostname,\n                pathname: el.pathname,\n                protocol: el.protocol,\n                search: el.search,\n                hash: el.hash,\n                port: el.port,\n                query\n            };\n        }\n    }, {\n        isComponent(el) {\n            var result = '';\n            if (el.tagName == 'IMG') {\n                result = { type: 'image' };\n            }\n            return result;\n        }\n    });\n});"]}