{"version":3,"sources":["dom_components/model/ComponentVideo.js"],"names":["define","Component","OComponent","yt","vi","ytnc","extend","defaults","prototype","type","tagName","videoId","void","provider","ytUrl","ytncUrl","viUrl","loop","poster","muted","autoplay","controls","color","rel","modestbranding","sources","attributes","allowfullscreen","toolbar","[object Object]","o","opt","traits","this","get","getYoutubeTraits","getVimeoTraits","getSourceTraits","parseFromSrc","set","initialize","apply","arguments","listenTo","updateTraits","updateSrc","args","initToolbar","prov","uri","parseUri","qr","query","pathname","split","pop","parseInt","getYoutubeSrc","getYoutubeNoCookieSrc","getVimeoSrc","attr","getAttrToHTML","loadTraits","em","trigger","getProviderTrait","label","name","changeProp","options","value","placeholder","getAutoplayTrait","getLoopTrait","getControlsTrait","id","url","replace","el","result","isYtProv","test","src","isYtncProv","isViProv","isExtProv"],"mappings":"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","file":"../../../dom_components/model/ComponentVideo.js","sourcesContent":["define([\n    './ComponentImage',\n    './Component'\n], function (Component, OComponent) {\n    'use strict';\n    const yt = 'yt';\n    const vi = 'vi';\n    const ytnc = 'ytnc';\n    return Component.extend({\n        defaults: {\n            ...Component.prototype.defaults,\n            type: 'video',\n            tagName: 'video',\n            videoId: '',\n            void: 0,\n            provider: 'so',\n            ytUrl: 'https://www.youtube.com/embed/',\n            ytncUrl: 'https://www.youtube-nocookie.com/embed/',\n            viUrl: 'https://player.vimeo.com/video/',\n            loop: 0,\n            poster: '',\n            muted: 0,\n            autoplay: 0,\n            controls: 1,\n            color: '',\n            rel: 1,\n            modestbranding: 0,\n            sources: [],\n            attributes: { allowfullscreen: 'allowfullscreen' },\n            toolbar: OComponent.prototype.defaults.toolbar\n        },\n        initialize(o, opt) {\n            var traits = [];\n            var prov = this.get('provider');\n            switch (prov) {\n            case yt:\n            case ytnc:\n                traits = this.getYoutubeTraits();\n                break;\n            case vi:\n                traits = this.getVimeoTraits();\n                break;\n            default:\n                traits = this.getSourceTraits();\n            }\n            if (this.get('src'))\n                this.parseFromSrc();\n            this.set('traits', traits);\n            Component.prototype.initialize.apply(this, arguments);\n            this.listenTo(this, 'change:provider', this.updateTraits);\n            this.listenTo(this, 'change:videoId change:provider', this.updateSrc);\n        },\n        initToolbar(...args) {\n            OComponent.prototype.initToolbar.apply(this, args);\n        },\n        parseFromSrc() {\n            var prov = this.get('provider');\n            var uri = this.parseUri(this.get('src'));\n            var qr = uri.query;\n            switch (prov) {\n            case yt:\n            case ytnc:\n            case vi:\n                var videoId = uri.pathname.split('/').pop();\n                this.set('videoId', videoId);\n                if (qr.autoplay)\n                    this.set('autoplay', 1);\n                if (qr.loop)\n                    this.set('loop', 1);\n                if (parseInt(qr.controls) === 0)\n                    this.set('controls', 0);\n                if (qr.color)\n                    this.set('color', qr.color);\n                if (qr.rel === '0')\n                    this.set('rel', 0);\n                if (qr.modestbranding === '1')\n                    this.set('modestbranding', 1);\n                break;\n            default:\n            }\n        },\n        updateSrc() {\n            var prov = this.get('provider');\n            switch (prov) {\n            case yt:\n                this.set('src', this.getYoutubeSrc());\n                break;\n            case ytnc:\n                this.set('src', this.getYoutubeNoCookieSrc());\n                break;\n            case vi:\n                this.set('src', this.getVimeoSrc());\n                break;\n            }\n        },\n        getAttrToHTML(...args) {\n            var attr = Component.prototype.getAttrToHTML.apply(this, args);\n            var prov = this.get('provider');\n            switch (prov) {\n            case yt:\n            case ytnc:\n            case vi:\n                break;\n            default:\n                if (this.get('loop'))\n                    attr.loop = 'loop';\n                if (this.get('autoplay'))\n                    attr.autoplay = 'autoplay';\n                if (this.get('controls'))\n                    attr.controls = 'controls';\n            }\n            return attr;\n        },\n        updateTraits() {\n            var prov = this.get('provider');\n            var traits = this.getSourceTraits();\n            switch (prov) {\n            case yt:\n            case ytnc:\n                this.set('tagName', 'iframe');\n                traits = this.getYoutubeTraits();\n                break;\n            case vi:\n                this.set('tagName', 'iframe');\n                traits = this.getVimeoTraits();\n                break;\n            default:\n                this.set('tagName', 'video');\n            }\n            this.loadTraits(traits);\n            this.em.trigger('component:toggled');\n        },\n        getProviderTrait() {\n            return {\n                type: 'select',\n                label: 'Provider',\n                name: 'provider',\n                changeProp: 1,\n                options: [\n                    {\n                        value: 'so',\n                        name: 'HTML5 Source'\n                    },\n                    {\n                        value: yt,\n                        name: 'Youtube'\n                    },\n                    {\n                        value: ytnc,\n                        name: 'Youtube (no cookie)'\n                    },\n                    {\n                        value: vi,\n                        name: 'Vimeo'\n                    }\n                ]\n            };\n        },\n        getSourceTraits() {\n            return [\n                this.getProviderTrait(),\n                {\n                    label: 'Source',\n                    name: 'src',\n                    placeholder: 'eg. ./media/video.mp4',\n                    changeProp: 1\n                },\n                {\n                    label: 'Poster',\n                    name: 'poster',\n                    placeholder: 'eg. ./media/image.jpg'\n                },\n                this.getAutoplayTrait(),\n                this.getLoopTrait(),\n                this.getControlsTrait()\n            ];\n        },\n        getYoutubeTraits() {\n            return [\n                this.getProviderTrait(),\n                {\n                    label: 'Video ID',\n                    name: 'videoId',\n                    placeholder: 'eg. jNQXAC9IVRw',\n                    changeProp: 1\n                },\n                this.getAutoplayTrait(),\n                this.getLoopTrait(),\n                this.getControlsTrait(),\n                {\n                    type: 'checkbox',\n                    label: 'Related',\n                    name: 'rel',\n                    changeProp: 1\n                },\n                {\n                    type: 'checkbox',\n                    label: 'Modest',\n                    name: 'modestbranding',\n                    changeProp: 1\n                }\n            ];\n        },\n        getVimeoTraits() {\n            return [\n                this.getProviderTrait(),\n                {\n                    label: 'Video ID',\n                    name: 'videoId',\n                    placeholder: 'eg. 123456789',\n                    changeProp: 1\n                },\n                {\n                    label: 'Color',\n                    name: 'color',\n                    placeholder: 'eg. FF0000',\n                    changeProp: 1\n                },\n                this.getAutoplayTrait(),\n                this.getLoopTrait()\n            ];\n        },\n        getAutoplayTrait() {\n            return {\n                type: 'checkbox',\n                label: 'Autoplay',\n                name: 'autoplay',\n                changeProp: 1\n            };\n        },\n        getLoopTrait() {\n            return {\n                type: 'checkbox',\n                label: 'Loop',\n                name: 'loop',\n                changeProp: 1\n            };\n        },\n        getControlsTrait() {\n            return {\n                type: 'checkbox',\n                label: 'Controls',\n                name: 'controls',\n                changeProp: 1\n            };\n        },\n        getYoutubeSrc() {\n            const id = this.get('videoId');\n            let url = this.get('ytUrl');\n            url += id + '?';\n            url += this.get('autoplay') ? '&autoplay=1' : '';\n            url += !this.get('controls') ? '&controls=0&showinfo=0' : '';\n            url += this.get('loop') ? `&loop=1&playlist=${ id }` : '';\n            url += this.get('rel') ? '' : '&rel=0';\n            url += this.get('modestbranding') ? '&modestbranding=1' : '';\n            return url;\n        },\n        getYoutubeNoCookieSrc() {\n            let url = this.getYoutubeSrc();\n            url = url.replace(this.get('ytUrl'), this.get('ytncUrl'));\n            return url;\n        },\n        getVimeoSrc() {\n            var url = this.get('viUrl');\n            url += this.get('videoId') + '?';\n            url += this.get('autoplay') ? '&autoplay=1' : '';\n            url += this.get('loop') ? '&loop=1' : '';\n            url += !this.get('controls') ? '&title=0&portrait=0&badge=0' : '';\n            url += this.get('color') ? '&color=' + this.get('color') : '';\n            return url;\n        }\n    }, {\n        isComponent(el) {\n            var result = '';\n            var isYtProv = /youtube\\.com\\/embed/.test(el.src);\n            var isYtncProv = /youtube-nocookie\\.com\\/embed/.test(el.src);\n            var isViProv = /player\\.vimeo\\.com\\/video/.test(el.src);\n            var isExtProv = isYtProv || isYtncProv || isViProv;\n            if (el.tagName == 'VIDEO' || el.tagName == 'IFRAME' && isExtProv) {\n                result = { type: 'video' };\n                if (el.src)\n                    result.src = el.src;\n                if (isExtProv) {\n                    if (isYtProv)\n                        result.provider = yt;\n                    else if (isYtncProv)\n                        result.provider = ytnc;\n                    else if (isViProv)\n                        result.provider = vi;\n                }\n            }\n            return result;\n        }\n    });\n});"]}