{"version":3,"sources":["commands/view/MoveComponent.js"],"names":["define","a","Backbone","b","SelectComponent","SelectPosition","$","extend","[object Object]","o","init","apply","this","arguments","bindAll","opt","hoverClass","ppfx","badgeClass","noSelClass","args","enable","getBadgeEl","addClass","getHighlighterEl","wp","$wrapper","css","undefined","initSorter","e","drag","target","data","get","cacheEl","startSelectPosition","frameEl","contentDocument","sorter","draggable","onEndMove","bind","stopSelectComponent","on","getContentWindow","rollback","model","el","view","onEndMoveFromModel","models","lastModel","length","frame","em","getEl","doc","ownerDocument","onStart","toMove","onMoveClb","onDrag","off","force","which","keyCode","moved","endMove","$badge","getBadge","$hl","canvas","getHighlighter","stop","removeClass","unbind"],"mappings":"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","file":"../../../commands/view/MoveComponent.js","sourcesContent":["define([\n    'skylark-underscore',\n    'skylark-backbone',\n    '../../utils/mixins',\n    './SelectComponent',\n    './SelectPosition'\n], function (a, Backbone, b, SelectComponent, SelectPosition) {\n    'use strict';\n    const $ = Backbone.$;\n    return a.extend({}, SelectPosition, SelectComponent, {\n        init(o) {\n            SelectComponent.init.apply(this, arguments);\n            a.bindAll(this, 'initSorter', 'rollback', 'onEndMove');\n            this.opt = o;\n            this.hoverClass = this.ppfx + 'highlighter-warning';\n            this.badgeClass = this.ppfx + 'badge-warning';\n            this.noSelClass = this.ppfx + 'no-select';\n        },\n        enable(...args) {\n            SelectComponent.enable.apply(this, args);\n            this.getBadgeEl().addClass(this.badgeClass);\n            this.getHighlighterEl().addClass(this.hoverClass);\n            var wp = this.$wrapper;\n            wp.css('cursor', 'move');\n            wp.undefined('mousedown', this.initSorter);\n            wp.addClass(this.noSelClass);\n        },\n        toggleClipboard() {\n        },\n        initSorter(e) {\n            var el = $(e.target).data('model');\n            var drag = el.get('draggable');\n            if (!drag)\n                return;\n            this.cacheEl = null;\n            this.startSelectPosition(e.target, this.frameEl.contentDocument);\n            this.sorter.draggable = drag;\n            this.sorter.onEndMove = this.onEndMove.bind(this);\n            this.stopSelectComponent();\n            this.$wrapper.undefined('mousedown', this.initSorter);\n            b.on(this.getContentWindow(), 'keydown', this.rollback);\n        },\n        initSorterFromModel(model) {\n            var drag = model.get('draggable');\n            if (!drag)\n                return;\n            this.cacheEl = null;\n            var el = model.view.el;\n            this.startSelectPosition(el, this.frameEl.contentDocument);\n            this.sorter.draggable = drag;\n            this.sorter.onEndMove = this.onEndMoveFromModel.bind(this);\n            this.stopSelectComponent();\n            b.on(this.getContentWindow(), 'keydown', this.rollback);\n        },\n        initSorterFromModels(models) {\n            this.cacheEl = null;\n            const lastModel = models[models.length - 1];\n            const frame = (this.em.get('currentFrame') || {}).model;\n            const el = lastModel.getEl(frame);\n            const doc = el.ownerDocument;\n            this.startSelectPosition(el, doc, { onStart: this.onStart });\n            this.sorter.draggable = lastModel.get('draggable');\n            this.sorter.toMove = models;\n            this.sorter.onMoveClb = this.onDrag;\n            this.sorter.onEndMove = this.onEndMoveFromModel.bind(this);\n            this.stopSelectComponent();\n            b.on(this.getContentWindow(), 'keydown', this.rollback);\n        },\n        onEndMoveFromModel() {\n            b.off(this.getContentWindow(), 'keydown', this.rollback);\n        },\n        onEndMove() {\n            this.enable();\n            b.off(this.getContentWindow(), 'keydown', this.rollback);\n        },\n        onSelect(e, el) {\n        },\n        rollback(e, force) {\n            var key = e.which || e.keyCode;\n            if (key == 27 || force) {\n                this.sorter.moved = false;\n                this.sorter.endMove();\n            }\n            return;\n        },\n        getBadgeEl() {\n            if (!this.$badge)\n                this.$badge = $(this.getBadge());\n            return this.$badge;\n        },\n        getHighlighterEl() {\n            if (!this.$hl)\n                this.$hl = $(this.canvas.getHighlighter());\n            return this.$hl;\n        },\n        stop(...args) {\n            SelectComponent.stop.apply(this, args);\n            this.getBadgeEl().removeClass(this.badgeClass);\n            this.getHighlighterEl().removeClass(this.hoverClass);\n            var wp = this.$wrapper;\n            wp.css('cursor', '').unbind().removeClass(this.noSelClass);\n        }\n    });\n});"]}