{"version":3,"sources":["commands/view/SelectPosition.js"],"names":["define","Backbone","$","[object Object]","trg","doc","opts","this","isPointed","utils","editorModel","get","container","ownerDocument","body","sorter","Sorter","placer","canvas","getPlacerEl","containerSel","itemSel","pfx","ppfx","direction","document","wmargin","nested","em","canvasRelative","scale","getZoomDecimal","onStart","startSort","frameOff","offset","getFrameEl","canvasOff","getElement","top","left","posTargetCollection","posIndex","posMethod","cDim","length","moved","endMove","posIsLastEl","posTargetEl","outsideElem","parent","posTargetModel","data","startSelectPosition","index","method","dims","i","m","len","isLast","enable","stopSelectPosition","$wrapper","css","unbind"],"mappings":";;;;;;;AAAAA,QAAQ,oBAAqB,SAAUC,GACnC,aACA,MAAMC,EAAID,EAASC,EACnB,OACIC,oBAAoBC,EAAKC,EAAKC,MAC1BC,KAAKC,WAAY,EACjB,IAAIC,EAAQF,KAAKG,YAAYC,IAAI,SACjC,MAAMC,EAAYR,EAAIS,cAAcC,KAChCL,IAAUF,KAAKQ,SACfR,KAAKQ,OAAS,IAAIN,EAAMO,QACpBJ,UAAAA,EACAK,OAAQV,KAAKW,OAAOC,cACpBC,aAAc,IACdC,QAAS,IACTC,IAAKf,KAAKgB,KACVC,UAAW,IACXC,SAAUpB,EACVqB,QAAS,EACTC,OAAQ,EACRC,GAAIrB,KAAKG,YACTmB,eAAgB,EAChBC,MAAO,IAAMvB,KAAKqB,GAAGG,oBAEzBzB,EAAK0B,UACLzB,KAAKQ,OAAOiB,QAAU1B,EAAK0B,SAC/B5B,GAAOG,KAAKQ,OAAOkB,UAAU7B,GAAOQ,UAAAA,KAExCT,eACI,IAAI+B,EAAW3B,KAAK4B,OAAO5B,KAAKW,OAAOkB,cACnCC,EAAY9B,KAAK4B,OAAO5B,KAAKW,OAAOoB,cAGxC,OACIC,IAHML,EAASK,IAAMF,EAAUE,IAI/BC,KAHON,EAASM,KAAOH,EAAUG,OAMzCrC,qBACII,KAAKkC,oBAAsB,KAC3BlC,KAAKmC,SAA6B,SAAlBnC,KAAKoC,WAA6C,IAArBpC,KAAKqC,KAAKC,OAAetC,KAAKmC,SAAW,EAAInC,KAAKmC,SAC3FnC,KAAKQ,SACLR,KAAKQ,OAAO+B,MAAQ,EACpBvC,KAAKQ,OAAOgC,WAEZxC,KAAKqC,OACLrC,KAAKyC,YAAmC,IAArBzC,KAAKqC,KAAKC,QAAkC,SAAlBtC,KAAKoC,WAAwBpC,KAAKmC,UAAYnC,KAAKqC,KAAKC,OACrGtC,KAAK0C,YAAmC,IAArB1C,KAAKqC,KAAKC,OAAe3C,EAAEK,KAAK2C,cAAgB3C,KAAKyC,aAAezC,KAAKqC,KAAKrC,KAAKmC,UAAYxC,EAAEK,KAAKqC,KAAKrC,KAAKmC,UAAU,IAAIS,SAAWjD,EAAEK,KAAK2C,aACnK3C,KAAK6C,eAAiB7C,KAAK0C,YAAYI,KAAK,SAC5C9C,KAAKkC,oBAAsBlC,KAAK0C,YAAYI,KAAK,gBAGzDlD,SACII,KAAK+C,uBAETnD,UAAUoD,EAAOC,EAAQC,GACrB,IAAIC,EAAIH,GAAS,EACbI,EAAIH,GAAU,SACdI,EAAMH,EAAKZ,OACXgB,EAAiB,IAARD,GAAkB,SAALD,GAAgBD,GAAKE,EAC/C,OAAY,IAARA,KAAeC,IAAWJ,EAAKC,GAAG,IAAMD,EAAKC,EAAI,KAAOD,EAAKC,EAAI,GAAG,IAAMG,IAAWJ,EAAKC,EAAI,GAAG,IAC1F,EACJ,GAEXvD,MACII,KAAKuD,UAET3D,OACII,KAAKwD,qBACLxD,KAAKyD,SAASC,IAAI,SAAU,IAC5B1D,KAAKyD,SAASE","file":"../../../commands/view/SelectPosition.js","sourcesContent":["define(['skylark-backbone'], function (Backbone) {\n    'use strict';\n    const $ = Backbone.$;\n    return {\n        startSelectPosition(trg, doc, opts = {}) {\n            this.isPointed = false;\n            var utils = this.editorModel.get('Utils');\n            const container = trg.ownerDocument.body;\n            if (utils && !this.sorter)\n                this.sorter = new utils.Sorter({\n                    container,\n                    placer: this.canvas.getPlacerEl(),\n                    containerSel: '*',\n                    itemSel: '*',\n                    pfx: this.ppfx,\n                    direction: 'a',\n                    document: doc,\n                    wmargin: 1,\n                    nested: 1,\n                    em: this.editorModel,\n                    canvasRelative: 1,\n                    scale: () => this.em.getZoomDecimal()\n                });\n            if (opts.onStart)\n                this.sorter.onStart = opts.onStart;\n            trg && this.sorter.startSort(trg, { container });\n        },\n        getOffsetDim() {\n            var frameOff = this.offset(this.canvas.getFrameEl());\n            var canvasOff = this.offset(this.canvas.getElement());\n            var top = frameOff.top - canvasOff.top;\n            var left = frameOff.left - canvasOff.left;\n            return {\n                top,\n                left\n            };\n        },\n        stopSelectPosition() {\n            this.posTargetCollection = null;\n            this.posIndex = this.posMethod == 'after' && this.cDim.length !== 0 ? this.posIndex + 1 : this.posIndex;\n            if (this.sorter) {\n                this.sorter.moved = 0;\n                this.sorter.endMove();\n            }\n            if (this.cDim) {\n                this.posIsLastEl = this.cDim.length !== 0 && this.posMethod == 'after' && this.posIndex == this.cDim.length;\n                this.posTargetEl = this.cDim.length === 0 ? $(this.outsideElem) : !this.posIsLastEl && this.cDim[this.posIndex] ? $(this.cDim[this.posIndex][5]).parent() : $(this.outsideElem);\n                this.posTargetModel = this.posTargetEl.data('model');\n                this.posTargetCollection = this.posTargetEl.data('model-comp');\n            }\n        },\n        enable() {\n            this.startSelectPosition();\n        },\n        nearFloat(index, method, dims) {\n            var i = index || 0;\n            var m = method || 'before';\n            var len = dims.length;\n            var isLast = len !== 0 && m == 'after' && i == len;\n            if (len !== 0 && (!isLast && !dims[i][4] || dims[i - 1] && !dims[i - 1][4] || isLast && !dims[i - 1][4]))\n                return 1;\n            return 0;\n        },\n        run() {\n            this.enable();\n        },\n        stop() {\n            this.stopSelectPosition();\n            this.$wrapper.css('cursor', '');\n            this.$wrapper.unbind();\n        }\n    };\n});"]}