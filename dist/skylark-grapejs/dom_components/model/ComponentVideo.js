/**
 * skylark-grapejs - A version of garpejs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-grapejs/
 * @license MIT
 */
define(["./ComponentImage","./Component"],function(t,e){"use strict";const o="yt",r="vi",i="ytnc";return t.extend({defaults:{...t.prototype.defaults,type:"video",tagName:"video",videoId:"",void:0,provider:"so",ytUrl:"https://www.youtube.com/embed/",ytncUrl:"https://www.youtube-nocookie.com/embed/",viUrl:"https://player.vimeo.com/video/",loop:0,poster:"",muted:0,autoplay:0,controls:1,color:"",rel:1,modestbranding:0,sources:[],attributes:{allowfullscreen:"allowfullscreen"},toolbar:e.prototype.defaults.toolbar},initialize(e,a){var s=[];switch(this.get("provider")){case o:case i:s=this.getYoutubeTraits();break;case r:s=this.getVimeoTraits();break;default:s=this.getSourceTraits()}this.get("src")&&this.parseFromSrc(),this.set("traits",s),t.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:provider",this.updateTraits),this.listenTo(this,"change:videoId change:provider",this.updateSrc)},initToolbar(...t){e.prototype.initToolbar.apply(this,t)},parseFromSrc(){var t=this.get("provider"),e=this.parseUri(this.get("src")),a=e.query;switch(t){case o:case i:case r:var s=e.pathname.split("/").pop();this.set("videoId",s),a.autoplay&&this.set("autoplay",1),a.loop&&this.set("loop",1),0===parseInt(a.controls)&&this.set("controls",0),a.color&&this.set("color",a.color),"0"===a.rel&&this.set("rel",0),"1"===a.modestbranding&&this.set("modestbranding",1)}},updateSrc(){switch(this.get("provider")){case o:this.set("src",this.getYoutubeSrc());break;case i:this.set("src",this.getYoutubeNoCookieSrc());break;case r:this.set("src",this.getVimeoSrc())}},getAttrToHTML(...e){var a=t.prototype.getAttrToHTML.apply(this,e);switch(this.get("provider")){case o:case i:case r:break;default:this.get("loop")&&(a.loop="loop"),this.get("autoplay")&&(a.autoplay="autoplay"),this.get("controls")&&(a.controls="controls")}return a},updateTraits(){var t=this.get("provider"),e=this.getSourceTraits();switch(t){case o:case i:this.set("tagName","iframe"),e=this.getYoutubeTraits();break;case r:this.set("tagName","iframe"),e=this.getVimeoTraits();break;default:this.set("tagName","video")}this.loadTraits(e),this.em.trigger("component:toggled")},getProviderTrait:()=>({type:"select",label:"Provider",name:"provider",changeProp:1,options:[{value:"so",name:"HTML5 Source"},{value:o,name:"Youtube"},{value:i,name:"Youtube (no cookie)"},{value:r,name:"Vimeo"}]}),getSourceTraits(){return[this.getProviderTrait(),{label:"Source",name:"src",placeholder:"eg. ./media/video.mp4",changeProp:1},{label:"Poster",name:"poster",placeholder:"eg. ./media/image.jpg"},this.getAutoplayTrait(),this.getLoopTrait(),this.getControlsTrait()]},getYoutubeTraits(){return[this.getProviderTrait(),{label:"Video ID",name:"videoId",placeholder:"eg. jNQXAC9IVRw",changeProp:1},this.getAutoplayTrait(),this.getLoopTrait(),this.getControlsTrait(),{type:"checkbox",label:"Related",name:"rel",changeProp:1},{type:"checkbox",label:"Modest",name:"modestbranding",changeProp:1}]},getVimeoTraits(){return[this.getProviderTrait(),{label:"Video ID",name:"videoId",placeholder:"eg. 123456789",changeProp:1},{label:"Color",name:"color",placeholder:"eg. FF0000",changeProp:1},this.getAutoplayTrait(),this.getLoopTrait()]},getAutoplayTrait:()=>({type:"checkbox",label:"Autoplay",name:"autoplay",changeProp:1}),getLoopTrait:()=>({type:"checkbox",label:"Loop",name:"loop",changeProp:1}),getControlsTrait:()=>({type:"checkbox",label:"Controls",name:"controls",changeProp:1}),getYoutubeSrc(){const t=this.get("videoId");let e=this.get("ytUrl");return e+=t+"?",e+=this.get("autoplay")?"&autoplay=1":"",e+=this.get("controls")?"":"&controls=0&showinfo=0",e+=this.get("loop")?`&loop=1&playlist=${t}`:"",e+=this.get("rel")?"":"&rel=0",e+=this.get("modestbranding")?"&modestbranding=1":""},getYoutubeNoCookieSrc(){let t=this.getYoutubeSrc();return t=t.replace(this.get("ytUrl"),this.get("ytncUrl"))},getVimeoSrc(){var t=this.get("viUrl");return t+=this.get("videoId")+"?",t+=this.get("autoplay")?"&autoplay=1":"",t+=this.get("loop")?"&loop=1":"",t+=this.get("controls")?"":"&title=0&portrait=0&badge=0",t+=this.get("color")?"&color="+this.get("color"):""}},{isComponent(t){var e="",a=/youtube\.com\/embed/.test(t.src),s=/youtube-nocookie\.com\/embed/.test(t.src),l=/player\.vimeo\.com\/video/.test(t.src),c=a||s||l;return("VIDEO"==t.tagName||"IFRAME"==t.tagName&&c)&&(e={type:"video"},t.src&&(e.src=t.src),c&&(a?e.provider=o:s?e.provider=i:l&&(e.provider=r))),e}})});
//# sourceMappingURL=../../sourcemaps/dom_components/model/ComponentVideo.js.map
