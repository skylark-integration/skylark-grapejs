/**
 * skylark-grapejs - A version of garpejs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-grapejs/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-backbone","skylark-underscore"],function(e,t,s){"use strict";let o;var n=t.Collection.extend({initialize(e,t={}){this.opt=t,this.listenTo(this,"add",this.onAdd),this.config=t.config,this.em=t.em;const{em:s}=this;this.model=function(e,o){var n;const r=t.em.get("DomComponents").componentTypes;o.em=t.em,o.config=t.config,o.componentTypes=r,o.domc=t.domc;for(var i=0;i<r.length;i++){if(r[i].id==e.type){n=r[i].model;break}}return n||(n=r[r.length-1].model,s&&e.type&&s.logWarning(`Component type '${e.type}' not found`,{attrs:e,options:o})),new n(e,o)}},parseString(t,s={}){const{em:r}=this,{domc:i}=this.opt,p=r.get("CssComposer"),c=r.get("Parser").parseHtml(t);return o||(o=n.Component),o.checkId(c.html,c.css,i.componentsById),c.css&&p&&!s.temporary&&p.addCollection(c.css,e.mixin({},s,{extend:1})),c.html},add(e,o={}){s.isString(e)?e=this.parseString(e,o):s.isArray(e)&&e.forEach((t,n)=>{s.isString(t)&&(e[n]=this.parseString(t,o))});const n=s.isArray(e);return e=(n?e:[e]).filter(e=>e).map(e=>this.processDef(e)),e=n?e:e[0],t.Collection.prototype.add.apply(this,[e,o])},processDef(e){if(e.cid&&e.ccid)return e;const{em:t,config:o={}}=this,{processor:n}=o;let r=e;if(n){const e=n(r={...r});e&&(s.each(r,(e,t)=>delete r[t]),s.extend(r,e))}if(r.$$typeof&&"object"==typeof r.props){(r={...r}).props={...r.props};const e=t.get("DomComponents"),o=t.get("Parser"),{parserHtml:n}=o;s.each(r,(e,t)=>{s.includes(["props","type"],t)||delete r[t]});const{props:i}=r,p=i.children;delete i.children,delete r.props;const c=n.splitPropsFromAttr(i);r.attributes=c.attrs,p&&(r.components=p),r.type?e.getType(r.type)||(r.tagName=r.type,delete r.type):r.type="textnode",s.extend(r,c.props)}return r},onAdd(e,t,o={}){const n=this.em,r=e.getStyle(),i=n&&n.getConfig("avoidInlineStyle");if(!s.isEmpty(r)&&!i&&n&&n.get&&n.getConfig("forceClass")&&!o.temporary){const t=e.cid;n.get("CssComposer").setClassRule(t,r);e.setStyle({}),e.addClass(t)}}});return n});
//# sourceMappingURL=../../sourcemaps/dom_components/model/Components.js.map
