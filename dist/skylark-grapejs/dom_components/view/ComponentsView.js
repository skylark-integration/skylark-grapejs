/**
 * skylark-grapejs - A version of garpejs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-grapejs/
 * @license MIT
 */
define(["skylark-backbone","skylark-underscore"],function(e,t){"use strict";return e.View.extend({initialize(e){this.opts=e||{},this.config=e.config||{},this.em=this.config.em;const t=this.collection;this.listenTo(t,"add",this.addTo),this.listenTo(t,"reset",this.resetChildren),this.listenTo(t,"remove",this.removeChildren)},removeChildren(e,t,o={}){const{em:n}=this.config,i=o.temporary;if(e.views.forEach(e=>{if(!e)return;e.remove.apply(e);const{childrenView:t,scriptContainer:o}=e;t&&t.stopListening(),o&&o.remove()}),e.components().forEach(e=>this.removeChildren(e,t,o)),n&&!i){const t=e.getId();delete n.get("DomComponents").componentsById[t];const o=n.get("CssComposer").getAll();if(o.remove(o.filter(e=>e.getSelectors().getFullString()===`#${t}`)),!e.opt.temporary){const t=n.get("Commands"),o={target:e};e.get("style-signature")&&t.run("core:component-style-clear",o),e.removed(),n.trigger("component:remove",e)}}},addTo(e,t={},o={}){const n=this.config.em,i=this.collection.indexOf(e);if(this.addToCollection(e,null,i),n&&!o.temporary){const t=e=>{n.trigger("component:add",e),e.components().forEach(e=>t(e))};t(e)}},addToCollection(e,o,n){this.compView||(this.compView=require("./ComponentView").default);const{config:i,opts:s,em:r}=this,l=o||null,c=s.componentTypes||r&&r.get("DomComponents").getTypes(),d=e.get("type");let h=this.compView;for(let e=0;e<c.length;e++)if(c[e].id==d){h=c[e].view;break}let m=new h({model:e,config:i,componentTypes:c}).render().el;if(l)l.appendChild(m);else{const e=this.parentEl,o=e.childNodes;if(t.isUndefined(n))e.appendChild(m);else{const t=o.length==n;t&&n--,t||!o.length?e.appendChild(m):e.insertBefore(m,o[n])}}return m},resetChildren(){this.parentEl.innerHTML="",this.collection.each(e=>this.addToCollection(e))},render(e){const t=this.el,o=document.createDocumentFragment();return this.parentEl=e||this.el,this.collection.each(e=>this.addToCollection(e,o)),t.innerHTML="",t.appendChild(o),this}})});
//# sourceMappingURL=../../sourcemaps/dom_components/view/ComponentsView.js.map
