/**
 * skylark-grapejs - A version of garpejs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-grapejs/
 * @license MIT
 */
define(["skylark-backbone","skylark-underscore","../../utils/mixins","./Input"],function(e,t,i,n){"use strict";e.$;return n.extend({events:{"change input":"handleChange","change select":"handleUnitChange","click [data-arrow-up]":"upArrowClick","click [data-arrow-down]":"downArrowClick","mousedown [data-arrows]":"downIncrement"},template(){const e=this.ppfx;return`\n      <span class="${e}input-holder"></span>\n      <span class="${e}field-units"></span>\n      <div class="${e}field-arrows" data-arrows>\n        <div class="${e}field-arrow-u" data-arrow-up></div>\n        <div class="${e}field-arrow-d" data-arrow-down></div>\n      </div>\n    `},inputClass(){const e=this.ppfx;return this.opts.contClass||`${e}field ${e}field-integer`},initialize(e={}){n.prototype.initialize.apply(this,arguments),t.bindAll(this,"moveIncrement","upIncrement"),this.doc=document,this.listenTo(this.model,"change:unit",this.handleModelChange)},setValue(e,t){var i=t||{},n=this.validateInputValue(e,{deepCheck:1}),s={value:n.value};(n.unit||n.force)&&(s.unit=n.unit),this.model.set(s,i),i.silent&&this.handleModelChange()},handleChange(e){e.stopPropagation(),this.setValue(this.getInputEl().value),this.elementUpdated()},handleUnitChange(e){e.stopPropagation();var t=this.getUnitEl().value;this.model.set("unit",t),this.elementUpdated()},elementUpdated(){this.model.trigger("el:change")},handleModelChange(){const e=this.model;this.getInputEl().value=e.get("value");const t=this.getUnitEl();t&&(t.value=e.get("unit")||"")},getUnitEl(){if(!this.unitEl){const e=this.model,t=e.get("units")||[];if(t.length){const i=[];t.forEach(t=>{const n=t==e.get("unit")?"selected":"";i.push(`<option ${n}>${t}</option>`)});const n=document.createElement("div");n.innerHTML=`<select class="${this.ppfx}input-unit">${i.join("")}</select>`,this.unitEl=n.firstChild}}return this.unitEl},upArrowClick(){const e=this.model,t=e.get("step");let i=parseInt(e.get("value"),10);i=this.normalizeValue(i+t);var n=this.validateInputValue(i);e.set("value",n.value),this.elementUpdated()},downArrowClick(){const e=this.model,t=e.get("step"),i=parseInt(e.get("value"),10),n=this.normalizeValue(i-t);var s=this.validateInputValue(n);e.set("value",s.value),this.elementUpdated()},downIncrement(e){e.preventDefault(),this.moved=0;var t=this.model.get("value");t=this.normalizeValue(t),this.current={y:e.pageY,val:t},i.on(this.doc,"mousemove",this.moveIncrement),i.on(this.doc,"mouseup",this.upIncrement)},moveIncrement(e){this.moved=1;const t=this.model,i=t.get("step"),n=this.current;var s=this.normalizeValue(n.val+(n.y-e.pageY)*i);return this.prValue=this.validateInputValue(s).value,t.set("value",this.prValue,{avoidStore:1}),!1},upIncrement(){const e=this.model,t=e.get("step");if(i.off(this.doc,"mouseup",this.upIncrement),i.off(this.doc,"mousemove",this.moveIncrement),this.prValue&&this.moved){var n=this.prValue-t;e.set("value",n,{avoidStore:1}).set("value",n+t),this.elementUpdated()}},normalizeValue(e,t=0){const i=this.model.get("step");let n=0;if(isNaN(e))return t;if(e=parseFloat(e),Math.floor(e)!==e){const e=i.toString().split(".")[1];n=e?e.length:0}return n?parseFloat(e.toFixed(n)):e},validateInputValue(e,i){var n=0,s=i||{},a=this.model;var l=t.isUndefined(e)?"":e,o=a.get("units")||[],r=a.get("unit")||o.length&&o[0]||"",d=a.get("max"),u=a.get("min");if(s.deepCheck){var h=a.get("fixedValues")||[];if(l){var p=new RegExp("^"+h.join("|"),"g");if(h.length&&p.test(l))l=l.match(p)[0],r="",n=1;else{var c=l+"";l+="",l=parseFloat(l.replace(",",".")),l=isNaN(l)?"":l;var v=c.replace(l,"");t.indexOf(o,v)>=0&&(r=v)}}}return t.isUndefined(d)||""===d||(l=l>d?d:l),t.isUndefined(u)||""===u||(l=l<u?u:l),{force:n,value:l,unit:r}},render(){n.prototype.render.call(this),this.unitEl=null;const e=this.getUnitEl();return e&&this.$el.find(`.${this.ppfx}field-units`).get(0).appendChild(e),this}})});
//# sourceMappingURL=../../sourcemaps/domain_abstract/ui/InputNumber.js.map
