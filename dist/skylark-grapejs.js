/**
 * skylark-grapejs - A version of garpejs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-grapejs/
 * @license MIT
 */
!function(e,t){var s=t.define,require=t.require,i="function"==typeof s&&s.amd,n=!i&&"undefined"!=typeof exports;if(!i&&!s){var r={};s=t.define=function(e,t,s){"function"==typeof s?(r[e]={factory:s,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var s=t.split("/"),i=e.split("/");s.pop();for(var n=0;n<i.length;n++)"."!=i[n]&&(".."==i[n]?s.pop():s.push(i[n]));return s.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):r[e]={factory:null,resolved:!0,exports:s}},require=t.require=function(e){if(!r.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=r[e];if(!module.resolved){var s=[];module.deps.forEach(function(e){s.push(require(e))}),module.exports=module.factory.apply(t,s)||null,module.resolved=!0}return module.exports}}if(!s)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-grapejs/editor/config/config",[],function(){"use strict";return{stylePrefix:"gjs-",components:"",style:"",fromElement:0,noticeOnUnload:!0,showOffsets:!1,showOffsetsSelected:!1,forceClass:!0,height:"900px",width:"100%",log:["warning","error"],baseCss:"\n    * {\n      box-sizing: border-box;\n    }\n    html, body, [data-gjs-type=wrapper] {\n      min-height: 100%;\n    }\n    body {\n      margin: 0;\n      height: 100%;\n      background-color: #fff\n    }\n    [data-gjs-type=wrapper] {\n      overflow: auto;\n      overflow-x: hidden;\n    }\n\n    * ::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.1)\n    }\n\n    * ::-webkit-scrollbar-thumb {\n      background: rgba(255, 255, 255, 0.2)\n    }\n\n    * ::-webkit-scrollbar {\n      width: 10px\n    }\n  ",protectedCss:"* { box-sizing: border-box; } body {margin: 0;}",canvasCss:"",defaultCommand:"select-comp",showToolbar:1,allowScripts:0,showDevices:1,devicePreviewMode:0,mediaCondition:"max-width",tagVarStart:"{[ ",tagVarEnd:" ]}",keepEmptyTextNodes:0,jsInHtml:!0,nativeDnD:1,multipleSelection:1,exportWrapper:0,wrapperIsBody:1,avoidInlineStyle:1,avoidDefaults:1,clearStyles:0,dragMode:0,cssIcons:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css",el:"",i18n:{},undoManager:{},assetManager:{},canvas:{},layers:{},storageManager:{},richTextEditor:{},domComponents:{},modal:{},codeManager:{},panels:{},commands:{},cssComposer:{},selectorManager:{},deviceManager:{devices:[{id:"desktop",name:"Desktop",width:""},{id:"tablet",name:"Tablet",width:"768px",widthMedia:"992px"},{id:"mobileLandscape",name:"Mobile landscape",width:"568px",widthMedia:"768px"},{id:"mobilePortrait",name:"Mobile portrait",width:"320px",widthMedia:"480px"}]},styleManager:{sectors:[{name:"General",open:!1,buildProps:["float","display","position","top","right","left","bottom"]},{name:"Flex",open:!1,buildProps:["flex-direction","flex-wrap","justify-content","align-items","align-content","order","flex-basis","flex-grow","flex-shrink","align-self"]},{name:"Dimension",open:!1,buildProps:["width","height","max-width","min-height","margin","padding"]},{name:"Typography",open:!1,buildProps:["font-family","font-size","font-weight","letter-spacing","color","line-height","text-align","text-shadow"],properties:[{property:"text-align",list:[{value:"left",className:"fa fa-align-left"},{value:"center",className:"fa fa-align-center"},{value:"right",className:"fa fa-align-right"},{value:"justify",className:"fa fa-align-justify"}]}]},{name:"Decorations",open:!1,buildProps:["border-radius-c","background-color","border-radius","border","box-shadow","background"]},{name:"Extra",open:!1,buildProps:["transition","perspective","transform"]}]},blockManager:{},traitManager:{},textViewCode:"Code",keepUnusedStyles:0,multiFrames:0}}),e("skylark-grapejs/utils/extender",["skylark-underscore"],function(e){"use strict";return({$:e})=>{}}),e("skylark-grapejs/utils/mixins",["skylark-underscore"],function(e){"use strict";const t=window.Element.prototype,s=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector,i=(t,s={})=>{const n=e.isArray(t)?[...t]:[t];if(n.length){const e=n.shift();if(e&&(!s.unique||!document.querySelector(`link[href="${e}"]`))){const{head:t}=document,i=document.createElement("link");i.href=e,i.rel="stylesheet",s.prepand?t.insertBefore(i,t.firstChild):t.appendChild(i)}i(n)}},n=e=>e[0].toUpperCase()+e.toLowerCase().slice(1),r=e=>e&&3===e.nodeType,o=e=>e&&8===e.nodeType,a=e=>e.which||e.keyCode;return{isCommentNode:o,isTaggableNode:e=>e&&!r(e)&&!o(e),on:(e,t,s)=>{t=t.split(/\s+/),e=e instanceof Array?e:[e];for(let i=0;i<t.length;++i)e.forEach(e=>e.addEventListener(t[i],s))},off:(e,t,s)=>{t=t.split(/\s+/),e=e instanceof Array?e:[e];for(let i=0;i<t.length;++i)e.forEach(e=>e.removeEventListener(t[i],s))},hasDnd:e=>"draggable"in document.createElement("i")&&(e?e.get("Config").nativeDnD:1),upFirst:n,matches:s,getModel:(t,s)=>{let i=t;return e.isElement(t)&&(i=s(t).data("model")),i},getElRect:e=>{const t={top:0,left:0,width:0,height:0};if(!e)return t;let s;if(r(e)){const t=document.createRange();t.selectNode(e),s=t.getBoundingClientRect(),t.detach()}return s||(e.getBoundingClientRect?e.getBoundingClientRect():t)},camelCase:e=>{const t=e.split("-").filter(String);return t[0].toLowerCase()+t.slice(1).map(n)},isTextNode:r,getKeyCode:a,getKeyChar:e=>String.fromCharCode(a(e)),isEscKey:e=>27===a(e),getElement:t=>{if(e.isElement(t)||r(t))return t;if(t&&t.getEl)return t.getEl()},shallowDiff:(t,s)=>{const i={},n=e.keys(s);for(let e in t)if(t.hasOwnProperty(e)){const r=t[e],o=s[e];n.indexOf(e)>=0?r!==o&&(i[e]=o):i[e]=null}for(let n in s)s.hasOwnProperty(n)&&e.isUndefined(t[n])&&(i[n]=s[n]);return i},normalizeFloat:(e,t=1,s=0)=>{let i=0;if(isNaN(e))return s;if(e=parseFloat(e),Math.floor(e)!==e){const e=t.toString().split(".")[1];i=e?e.length:0}return i?parseFloat(e.toFixed(i)):e},getPointerEvent:e=>e.touches&&e.touches[0]?e.touches[0]:e,getUnitFromValue:e=>e.replace(parseFloat(e),""),capitalize:e=>e&&e.charAt(0).toUpperCase()+e.substring(1),getViewEl:e=>e.__gjsv,setViewEl:(e,t)=>{e.__gjsv=t},appendStyles:i,isComponent:e=>e&&e.toHTML,isRule:e=>e&&e.toCSS}}),e("skylark-grapejs/utils/Dragger",["skylark-langx/langx","skylark-underscore","./mixins"],function(e,t,s){"use strict";return class{constructor(e={}){return this.opts={container:null,onStart:null,onDrag:null,onEnd:null,setPosition:null,getPosition:null,guidesStatic:null,guidesTarget:null,snapOffset:5,doc:0,scale:1},t.bindAll(this,"drag","stop","keyHandle","handleScroll"),this.setOptions(e),this.delta={x:0,y:0},this}setOptions(t={}){this.opts=e.mixin({},this.opts,t)}toggleDrag(e){const t=this.getDocumentEl(),i=this.getContainerEl(),n=this.getWindowEl(),r=e?"on":"off";s[r](i,"mousemove dragover",this.drag),s[r](t,"mouseup dragend touchend",this.stop),s[r](t,"keydown",this.keyHandle),s[r](n,"scroll",this.handleScroll)}handleScroll(){const{lastScroll:e,delta:t}=this,s=this.getScrollInfo(),i={x:s.x-e.x,y:s.y-e.y};this.move(t.x+i.x,t.y+i.y),this.lastScrollDiff=i}start(e){const{opts:s}=this,{onStart:i}=s;this.toggleDrag(1),this.startPointer=this.getPointerPos(e),this.guidesStatic=t.result(s,"guidesStatic")||[],this.guidesTarget=t.result(s,"guidesTarget")||[],t.isFunction(i)&&i(e,this),this.startPosition=this.getStartPosition(),this.lastScrollDiff={x:0,y:0},this.globScrollDiff={x:0,y:0},this.drag(e)}drag(s){const{opts:i,lastScrollDiff:n,globScrollDiff:r}=this,{onDrag:o}=i,{startPointer:a}=this,l=this.getPointerPos(s),c={x:r.x+n.x,y:r.y+n.y};this.globScrollDiff=c;const d={x:l.x-a.x+c.x,y:l.y-a.y+c.y};this.lastScrollDiff={x:0,y:0};let{lockedAxis:h}=this;"x"===(h=s.shiftKey?!h&&this.detectAxisLock(d.x,d.y):null)?d.x=a.x:"y"===h&&(d.y=a.y);const p=e=>{["x","y"].forEach(s=>e[s]=e[s]*t.result(i,"scale")),this.delta=e,this.move(e.x,e.y),t.isFunction(o)&&o(s,this)},g=e.clone(d);if(this.currentPointer=l,this.lockedAxis=h,this.lastScroll=this.getScrollInfo(),p(d),this.guidesTarget.length){const{newDelta:e,trgX:t,trgY:s}=this.snapGuides(g);(t||s)&&p(e)}0===s.which&&this.stop(s)}snapGuides(e){const s=e;let{trgX:i,trgY:n}=this;return this.guidesTarget.forEach(s=>{s.x&&this.trgX||s.y&&this.trgY||(s.active=0,this.guidesStatic.forEach(r=>{if(s.y&&r.x||s.x&&r.y)return;const o=s.y&&r.y,a=o?"y":"x",l=s[a],c=r[a],d=e[a],h=o?n:i;if(this.isPointIn(l,c)&&t.isUndefined(h)){const e=d-(l-c);this.setGuideLock(s,e)}}))}),i=this.trgX,n=this.trgY,["x","y"].forEach(i=>{const n=i.toUpperCase();let r=this[`trg${n}`];r&&!this.isPointIn(e[i],r.lock)&&(this.setGuideLock(r,null),r=null),r&&!t.isUndefined(r.lock)&&(s[i]=r.lock)}),{newDelta:s,trgX:this.trgX,trgY:this.trgY}}isPointIn(e,t,{offset:s}={}){const i=s||this.opts.snapOffset;return e>=t&&e<=t+i||e<=t&&e>=t-i}setGuideLock(e,s){const i=t.isUndefined(e.x)?"Y":"X",n=`trg${i}`;return null!==s?(e.active=1,e.lock=s,this[n]=e):(delete e.active,delete e.lock,delete this[n]),e}stop(e,s={}){const{delta:i}=this,n=s.cancel,r=n?0:i.x,o=n?0:i.y;this.toggleDrag(),this.lockedAxis=null,this.move(r,o,1);const{onEnd:a}=this.opts;t.isFunction(a)&&a(e,this,{cancelled:n})}keyHandle(e){s.isEscKey(e)&&this.stop(e,{cancel:1})}move(e,s,i){const{el:n,opts:r}=this,o=this.startPosition;if(!o)return;const{setPosition:a}=r,l=o.x+e,c=o.y+s;this.position={x:l,y:c,end:i},t.isFunction(a)&&a(this.position),n&&(n.style.left=`${l}px`,n.style.top=`${c}px`)}getContainerEl(){const{container:e}=this.opts;return e?[e]:this.getDocumentEl()}getWindowEl(){const e=this.getContainerEl();return e.map(e=>{const t=e.ownerDocument||e;return t.defaultView||t.parentWindow})}getDocumentEl(e){const{doc:t}=this.opts;if(e=e||this.el,!this.docs){const s=[document];e&&s.push(e.ownerDocument),t&&s.push(t),this.docs=s}return this.docs}getPointerPos(e){const t=this.opts.getPointerPosition,i=s.getPointerEvent(e);return t?t(e):{x:i.clientX,y:i.clientY}}getStartPosition(){const{el:e,opts:s}=this,i=s.getPosition;let n={x:0,y:0};return t.isFunction(i)?n=i():e&&(n={x:parseFloat(e.style.left),y:parseFloat(e.style.top)}),n}getScrollInfo(){const{doc:e}=this.opts,t=e&&e.body;return{y:t?t.scrollTop:0,x:t?t.scrollLeft:0}}detectAxisLock(e,t){const s=e,i=t,n=Math.abs(s),r=Math.abs(i);return i>=n||i<=-n?"x":s>r||s<-r?"y":void 0}}}),e("skylark-grapejs/utils/Sorter",["skylark-backbone","skylark-underscore","./mixins"],function(e,t,s){"use strict";const i=e.$;return e.View.extend({initialize(e){this.opt=e||{},t.bindAll(this,"startSort","onMove","endMove","rollback","updateOffset","moveDragHelper");var s=e||{};this.elT=0,this.elL=0,this.borderOffset=s.borderOffset||10;var n=s.container;this.el="string"==typeof n?document.querySelector(n):n,this.$el=i(this.el),this.containerSel=s.containerSel||"div",this.itemSel=s.itemSel||"div",this.draggable=s.draggable||!0,this.nested=s.nested||0,this.pfx=s.pfx||"",this.ppfx=s.ppfx||"",this.freezeClass=s.freezeClass||this.pfx+"freezed",this.onStart=s.onStart||"",this.onEndMove=s.onEndMove||"",this.direction=s.direction||"v",this.onMoveClb=s.onMove||"",this.relative=s.relative||0,this.ignoreViewChildren=s.ignoreViewChildren||0,this.ignoreModels=s.ignoreModels||0,this.plh=s.placer||"",this.wmargin=s.wmargin||0,this.offTop=s.offsetTop||0,this.offLeft=s.offsetLeft||0,this.document=s.document||document,this.$document=i(this.document),this.dropContent=null,this.em=s.em||"",this.dragHelper=null,this.canvasRelative=s.canvasRelative||0,this.selectOnEnd=!s.avoidSelectOnEnd,this.scale=s.scale,this.activeTextModel=null,this.em&&this.em.on&&(this.em.on("change:canvasOffset",this.updateOffset),this.updateOffset())},getScale(){return t.result(this,scale)||1},getContainerEl(e){if(e&&(this.el=e),!this.el){var t=this.opt.container;this.el="string"==typeof t?document.querySelector(t):t,this.$el=i(this.el)}return this.el},getDocuments(e){const t=this.em,s=e?e.ownerDocument:t&&t.get("Canvas").getBody().ownerDocument,i=[document];return s&&i.push(s),i},updateOffset(){const e=this.em.get("canvasOffset")||{};this.offTop=e.top,this.offLeft=e.left},setDropContent(e){this.dropModel=null,this.dropContent=e},updateTextViewCursorPosition(e){const t=this.em.get("Canvas"),i=t.getDocument();let n=null;if(i.caretRangeFromPoint){const t=s.getPointerEvent(e);n=i.caretRangeFromPoint(t.clientX,t.clientY)}else e.rangeParent&&(n=i.createRange()).setStart(e.rangeParent,e.rangeOffset);const r=t.getWindow().getSelection();t.getFrameEl().focus(),r.removeAllRanges(),n&&r.addRange(n)},setContentEditable(e,t){if(e){const s=e.getEl();s.contentEditable!=t&&(s.contentEditable=t)}},toggleSortCursor(e){const{em:t}=this,s=t&&t.get("Canvas");s&&(e?s.startAutoscroll():s.stopAutoscroll())},setDragHelper(e,t){const s=t||"",n=e.cloneNode(1),r=e.getBoundingClientRect(),o=getComputedStyle(e);let a="";for(var l=0;l<o.length;l++){const e=o[l];a+=`${e}:${o.getPropertyValue(e)};`}document.body.appendChild(n),n.className+=` ${this.pfx}bdrag`,n.setAttribute("style",a),this.dragHelper=n,n.style.width=`${r.width}px`,n.style.height=`${r.height}px`,s&&this.moveDragHelper(s),this.em&&i(this.em.get("Canvas").getBody().ownerDocument).on("mousemove",this.moveDragHelper).on("mousemove",this.moveDragHelper),i(document).on("mousemove",this.moveDragHelper).on("mousemove",this.moveDragHelper)},moveDragHelper(e){const t=e.target.ownerDocument;if(!this.dragHelper||!t)return;let s=e.pageY,i=e.pageX,n=0,r=0;const o=t.defaultView||t.parentWindow,a=o.frameElement,l=this.dragHelper.style;if(a){const t=a.getBoundingClientRect();n=t.top+document.documentElement.scrollTop,r=t.left+document.documentElement.scrollLeft,s=e.clientY,i=e.clientX}l.top=s+n+"px",l.left=i+r+"px"},matches:(e,t,i)=>s.matches.call(e,t),closest(e,t){if(e){for(var s=e.parentNode;s&&1===s.nodeType;){if(this.matches(s,t))return s;s=s.parentNode}return null}},offset(e){var t=e.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}},createPlaceholder(){var e=this.pfx,t=document.createElement("div"),s=document.createElement("div");return t.className=e+"placeholder",t.style.display="none",t.style["pointer-events"]="none",s.className=e+"placeholder-int",t.appendChild(s),t},startSort(e,t={}){const i=this.em,n=this.itemSel,r=this.containerSel,o=this.getContainerEl(t.container),a=this.getDocuments(e),l=this.onStart;let c,d=this.plh;this.dropModel=null,this.target=null,this.prevTarget=null,this.moved=0,e&&!this.matches(e,`${n}, ${r}`)&&(e=this.closest(e,n)),this.eV=e,d||(d=this.createPlaceholder(),o.appendChild(d),this.plh=d),e&&((c=this.getSourceModel(e))&&c.set&&c.set("status","freezed"),this.srcModel=c),s.on(o,"mousemove dragover",this.onMove),s.on(a,"mouseup dragend touchend",this.endMove),s.on(a,"keydown",this.rollback),l&&l({target:c,parent:c&&c.parent(),index:c&&c.index()}),i&&i.clearSelection(),this.toggleSortCursor(1),i&&i.trigger("sorter:drag:start",e,c)},getTargetModel(e){let t=e||this.target;return i(t).data("model")},getSourceModel(e,{target:t,avoidChildren:s=1}={}){const{em:n,eV:r}=this,o=e||r;let{dropModel:a,dropContent:l}=this;const c=e=>e&&t&&e.opt&&e.opt.avoidChildren&&this.isTextableActive(e,t);if(l&&n){if(c(a)&&(a=null),!a){const e=n.get("DomComponents").getComponents(),i={avoidChildren:s,avoidStore:1,avoidUpdateStyle:1},r=e.add(l,{...i,temporary:1});if(a=(a=e.remove(r,i))instanceof Array?a[0]:a,this.dropModel=a,c(a))return this.getSourceModel(o,{target:t,avoidChildren:0})}return a}return o&&i(o).data("model")},selectTargetModel(t){if(t instanceof e.Collection)return;const{targetModel:s}=this;s&&s!==this.srcModel&&s.set("status",""),t&&t.set&&(t.set("status","selected-parent"),this.targetModel=t)},onMove(e){const s=e,{em:n,onMoveClb:r,plh:o}=this;this.moved=1;var a=o.style.display;a&&"none"!==a||(o.style.display="block");var l=this.offset(this.el);this.elT=this.wmargin?Math.abs(l.top):l.top,this.elL=this.wmargin?Math.abs(l.left):l.left;var c=e.pageY-this.elT+this.el.scrollTop,d=e.pageX-this.elL+this.el.scrollLeft;if(this.canvasRelative&&n){const t=n.get("Canvas").getMouseRelativeCanvas(e,{noScroll:1});d=t.x,c=t.y}this.rX=d,this.rY=c,this.eventMove=e;const h=this.getSourceModel(),p=this.dimsFromTarget(e.target,d,c),g=this.target,u=g&&this.getTargetModel(g);if(this.selectTargetModel(u),u||(o.style.display="none"),!g)return;this.lastDims=p;const m=this.findPosition(p,d,c);this.isTextableActive(h,u)?(this.activeTextModel=u,this.setContentEditable(u,!0),o.style.display="none",this.lastPos=m,this.updateTextViewCursorPosition(s)):(this.disableTextable(),this.activeTextModel=null,this.lastPos&&this.lastPos.index==m.index&&this.lastPos.method==m.method||(this.movePlaceholder(this.plh,p,m,this.prevTargetDim),this.$plh||(this.$plh=i(this.plh)),this.canvasRelative||(this.offTop&&this.$plh.css("top","+="+this.offTop+"px"),this.offLeft&&this.$plh.css("left","+="+this.offLeft+"px")),this.lastPos=m)),t.isFunction(r)&&r({event:e,target:h,parent:u,index:m.index+("after"==m.method?1:0)}),n&&n.trigger("sorter:drag",{target:g,targetModel:u,sourceModel:h,dims:p,pos:m,x:d,y:c})},isTextableActive:(e,t)=>e&&e.get&&e.get("textable")&&t&&t.is("text"),disableTextable(){const{activeTextModel:e}=this;e&&e.getView().disableEditing()},isInFlow(e,t){if(!e)return!1;t=t||document.body;var s=e;return s.offsetHeight,!!this.styleInFlow(s,t)},styleInFlow(e,t){if(s.isTextNode(e))return;const n=e.style||{},r=i(e),o=t&&i(t);if(!(n.overflow&&"visible"!==n.overflow||"none"!==r.css("float")||o&&"flex"==o.css("display")&&"column"!==o.css("flex-direction"))){switch(n.position){case"static":case"relative":case"":break;default:return}switch(e.tagName){case"TR":case"TBODY":case"THEAD":case"TFOOT":return!0}switch(r.css("display")){case"block":case"list-item":case"table":case"flex":return!0}}},validTarget(s,i){const n=this.getTargetModel(s),r=this.getSourceModel(i,{target:n});i=r&&r.view&&r.view.el,s=n&&n.view&&n.view.el;let o={valid:!0,src:i,srcModel:r,trg:s,trgModel:n};if(!i||!s)return o.valid=!1,o;let a=r.get("draggable");a=a instanceof Array?a.join(", "):a,o.dragInfo=a,a=t.isString(a)?this.matches(s,a):a,o.draggable=a;let l=n.get("droppable");return l=(l=l instanceof e.Collection?1:l)instanceof Array?l.join(", "):l,o.dropInfo=l,l=t.isString(l)?this.matches(i,l):l,l=a&&this.isTextableActive(r,n)?1:l,o.droppable=l,l&&a||(o.valid=!1),o},dimsFromTarget(e,t,s){const i=this.em;var n=[];if(!e)return n;if(this.matches(e,`${this.itemSel}, ${this.containerSel}`)||(e=this.closest(e,this.itemSel)),this.draggable instanceof Array&&(e=this.closest(e,this.draggable.join(","))),!e)return n;if(this.prevTarget&&this.prevTarget!=e&&(this.prevTarget=null),!this.prevTarget){this.targetP=this.closest(e,this.containerSel);let n=this.validTarget(e);if(i&&i.trigger("sorter:drag:validation",n),!n.valid&&this.targetP)return this.dimsFromTarget(this.targetP,t,s);this.prevTarget=e,this.prevTargetDim=this.getDim(e),this.cacheDimsP=this.getChildrenDim(this.targetP),this.cacheDims=this.getChildrenDim(e)}if(this.prevTarget==e&&(n=this.cacheDims),this.target=this.prevTarget,this.nearBorders(this.prevTargetDim,t,s)||!this.nested&&!this.cacheDims.length){const e=this.targetP;e&&this.validTarget(e).valid&&(n=this.cacheDimsP,this.target=e)}return this.lastPos=null,n},getTargetFromEl(e){let t,s=e,i=this.targetPrev;const n=this.em,r=this.containerSel,o=this.itemSel;if(this.matches(s,`${o}, ${r}`)||(s=this.closest(s,o)),this.draggable instanceof Array&&(s=this.closest(s,this.draggable.join(","))),i&&i!=s&&(this.targetPrev=""),!this.targetPrev){t=this.closest(s,r);const e=this.validTarget(s);if(n&&n.trigger("sorter:drag:validation",e),!e.valid&&t)return this.getTargetFromEl(t);this.targetPrev=s}return this.nearElBorders(s)&&(t=this.closest(s,r))&&this.validTarget(t).valid&&(s=t),s},nearElBorders(e){const t=e.getBoundingClientRect(),s=e.ownerDocument.body,{x:i,y:n}=this.getCurrentPos(),r=t.top+s.scrollTop,o=t.left+s.scrollLeft,a=t.width,l=t.height;if(n<r+10||n>r+l-10||i<o+10||i>o+a-10)return 1},getCurrentPos(){const e=this.eventMove,t=e.pageX||0,s=e.pageY||0;return{x:t,y:s}},getDim(e){const{em:t,canvasRelative:s}=this;var i,n,r,o;if(s&&t){const s=t.get("Canvas"),a=s.getElementPos(e,{noScroll:1}),l=s.getElementOffsets(e);i=a.top-l.marginTop,n=a.left-l.marginLeft,r=a.height+l.marginTop+l.marginBottom,o=a.width+l.marginLeft+l.marginRight}else{var a=this.offset(e);i=this.relative?e.offsetTop:a.top-(this.wmargin?-1:1)*this.elT,n=this.relative?e.offsetLeft:a.left-(this.wmargin?-1:1)*this.elL,r=e.offsetHeight,o=e.offsetWidth}return[i,n,r,o]},getChildrenDim(e){const n=[];if(!e)return n;const r=this.getTargetModel(e);if(r&&r.view&&!this.ignoreViewChildren){const t=r.getCurrentView?r.getCurrentView():r.view;e=t.getChildrenContainer()}return t.each(e.children,(t,r)=>{const o=s.getModel(t,i),a=o&&o.index?o.index():r;if(!s.isTextNode(t)&&!this.matches(t,this.itemSel))return;const l=this.getDim(t);let c=this.direction;c="v"==c||"h"!=c&&this.isInFlow(t,e),l.push(c,t,a),n.push(l)}),n},nearBorders(e,t,s){var i=0,n=this.borderOffset,r=t||0,o=s||0,a=e[0],l=e[1],c=e[2],d=e[3];return(a+n>o||o>a+c-n||l+n>r||r>l+d-n)&&(i=1),!!i},findPosition(e,t,s){for(var i={index:0,indexEl:0,method:"before"},n=0,r=0,o=0,a=0,l=0,c=0,d=0,h=0,p=0,g=e.length;p<g;p++)if(h=e[p],o=h[1]+h[3],d=h[0]+h[2],l=h[1]+h[3]/2,c=h[0]+h[2]/2,!(r&&h[1]>r||a&&c>=a||n&&o<n))if(i.index=p,i.indexEl=h[6],h[4]){if(s<c){i.method="before";break}i.method="after"}else s<d&&(a=d),t<l?(r=l,i.method="before"):(n=l,i.method="after");return i},movePlaceholder(e,t,s,i){var n=0,r=0,o=0,a=0,l="px",c=s.method,d=t[s.index];if(e.style.borderColor="transparent #62c462",e.style.borderWidth="3px 5px",e.style.margin="-3px 0 0",d)d[4]?(o=d[3]+l,a="auto",n="before"==c?d[0]-0:d[0]+d[2]-0,r=d[1]):(o="auto",a=d[2]-0+l,n=d[0]+0,r="before"==c?d[1]-0:d[1]+d[3]-0,e.style.borderColor="#62c462 transparent",e.style.borderWidth="5px 3px",e.style.margin="0 0 0 -3px");else{if(!this.nested)return void(e.style.display="none");i&&(n=i[0]+5,r=i[1]+5,o=parseInt(i[3])-10+l,a="auto")}e.style.top=n+l,e.style.left=r+l,o&&(e.style.width=o),a&&(e.style.height=a)},endMove(e){const i=this.eV,n=[],r=this.getDocuments(),o=this.getContainerEl(),a=this.onEndMove,{target:l,lastPos:c}=this;let d;if(s.off(o,"mousemove dragover",this.onMove),s.off(r,"mouseup dragend touchend",this.endMove),s.off(r,"keydown",this.rollback),this.plh.style.display="none",i&&(d=this.getSourceModel(),this.selectOnEnd&&d&&d.set&&(d.set("status",""),d.set("status","selected"))),this.moved){const e=this.toMove,s=t.isArray(e)?e:e?[e]:[i];s.forEach(e=>{n.push(this.move(l,e,c))})}this.plh&&(this.plh.style.display="none");var h=this.dragHelper;if(h&&(h.parentNode.removeChild(h),this.dragHelper=null),this.disableTextable(),this.selectTargetModel(),this.toggleSortCursor(),this.toMove=null,t.isFunction(a)){const e={target:d,parent:d&&d.parent(),index:d&&d.index()};n.length?n.forEach(t=>a(t,this,e)):a(null,this,{...e,cancelled:1})}},move(t,n,r){const{em:o,activeTextModel:a,dropContent:l}=this,c=s.getElement(n);o&&o.trigger("component:dragEnd:before",t,c,r);var d,h,p,g=[],u=r.indexEl,m=this.validTarget(t,c),f=i(t).data("collection"),v=m.srcModel,y=m.droppable,b=m.draggable,k=m.dropInfo,w=m.dragInfo;const{trgModel:x}=m;y=x instanceof e.Collection?1:y;const C=this.isTextableActive(v,x);if(f&&y&&b){var S={at:u="after"===r.method?u+1:u,noIncrement:1};if(l?(d=l,S.silent=!1,S.avoidUpdateStyle=1):(S.temporary=1,h=f.add({},{...S}),v.collection&&(d=v.collection.remove(v,{temporary:1}))),C){const e=a.getView();a.trigger("active");const{activeRte:t}=e,s=v.getEl();delete v.opt.temporary,v.getView().render(),s.setAttribute("data-gjs-textable","true");const{outerHTML:i}=s;t.insertHTML&&t.insertHTML(i)}else p=f.add(d,S);l?this.dropContent=null:f.remove(h),this.prevTarget=null}else f||g.push("Target collection not found"),y||g.push(`Target is not droppable, accepts [${k}]`),b||g.push(`Component not draggable, acceptable by [${w}]`),console.warn("Invalid target position: "+g.join(", "));return o&&o.trigger("component:dragEnd",f,d,g),o&&o.trigger("sorter:drag:end",{targetCollection:f,modelToDrop:d,warns:g,validResult:m,dst:t,srcEl:c}),p},rollback(e){s.off(this.getDocuments(),"keydown",this.rollback);const t=e.which||e.keyCode;27==t&&(this.moved=0,this.endMove())}})}),e("skylark-grapejs/utils/Resizer",["skylark-langx/langx","skylark-underscore","./mixins"],function(e,t,s){"use strict";var i={mousePosFetcher:null,updateTarget:null,ratioDefault:0,posFetcher:null,onStart:null,onMove:null,onEnd:null,onUpdateContainer:()=>{},step:1,minDim:32,maxDim:"",unitHeight:"px",unitWidth:"px",keyHeight:"height",keyWidth:"width",currentUnit:1,silentFrames:0,avoidContainerUpdate:0,keepAutoHeight:!1,keepAutoWidth:!1,autoHeight:!1,autoWidth:!1,tl:1,tc:1,tr:1,cl:1,cr:1,bl:1,bc:1,br:1},n=(e,t)=>{var s=t.prefix||"",i=document.createElement("i");return i.className=s+"resizer-h "+s+"resizer-h-"+e,i.setAttribute("data-"+s+"handler",e),i},r=(e,t)=>{var s=t||window,i=e.getBoundingClientRect();return{left:i.left+s.pageXOffset,top:i.top+s.pageYOffset,width:i.width,height:i.height}};return{init:o=>new class{constructor(e={}){return this.setOptions(e),t.bindAll(this,"handleKeyDown","handleMouseDown","move","stop"),this}getConfig(){return this.opts}setOptions(e={}){this.opts=t.defaults(e,i),this.setup()}setup(){const e=this.opts,t=e.prefix||"",s=e.appendTo||document.body;let i=this.container;for(i||((i=document.createElement("div")).className=`${t}resizer-c`,s.appendChild(i),this.container=i);i.firstChild;)i.removeChild(i.firstChild);const r={};["tl","tc","tr","cl","cr","bl","bc","br"].forEach(t=>r[t]=e[t]?n(t,e):"");for(let e in r){const t=r[e];t&&i.appendChild(t)}this.handlers=r,this.mousePosFetcher=e.mousePosFetcher,this.updateTarget=e.updateTarget,this.posFetcher=e.posFetcher,this.onStart=e.onStart,this.onMove=e.onMove,this.onEnd=e.onEnd,this.onUpdateContainer=e.onUpdateContainer}toggleFrames(e){if(this.opts.silentFrames){const s=document.querySelectorAll("iframe");t.each(s,t=>t.style.pointerEvents=e?"none":"")}}isHandler(e){var t=this.handlers;for(var s in t)if(t[s]===e)return!0;return!1}getFocusedEl(){return this.el}getDocumentEl(){return[this.el.ownerDocument,document]}getElementPos(e,t={}){var s=this.posFetcher||"";return s?s(e,t):r(e)}focus(e){e&&e===this.el||(this.el=e,this.updateContainer({forceShow:1}),s.on(this.getDocumentEl(),"mousedown",this.handleMouseDown))}blur(){this.container.style.display="none",this.el&&(s.off(this.getDocumentEl(),"mousedown",this.handleMouseDown),this.el=null)}start(e){if(0!==e.button)return;e.preventDefault(),e.stopPropagation();const i=this.el,n=this.opts||{};var r="data-"+n.prefix+"handler",o=this.getElementPos(i,{target:"el"});this.handlerAttr=e.target.getAttribute(r),this.clickedHandler=e.target,this.startDim={t:o.top,l:o.left,w:o.width,h:o.height},this.rectDim={t:o.top,l:o.left,w:o.width,h:o.height},this.startPos={x:e.clientX,y:e.clientY};var a=this.getDocumentEl();s.on(a,"mousemove",this.move),s.on(a,"keydown",this.handleKeyDown),s.on(a,"mouseup",this.stop),t.isFunction(this.onStart)&&this.onStart(e,{docs:a,config:n,el:i,resizer:this}),this.toggleFrames(1),this.move(e)}move(e){const t=this.onMove;var s=this.mousePosFetcher,i=s?s(e):{x:e.clientX,y:e.clientY};this.currentPos=i,this.delta={x:i.x-this.startPos.x,y:i.y-this.startPos.y},this.keys={shift:e.shiftKey,ctrl:e.ctrlKey,alt:e.altKey},this.rectDim=this.calc(this),this.updateRect(0),t&&t(e),0===e.which&&this.stop(e)}stop(e){const i=this.opts;var n=this.getDocumentEl();s.off(n,"mousemove",this.move),s.off(n,"keydown",this.handleKeyDown),s.off(n,"mouseup",this.stop),this.updateRect(1),this.toggleFrames(),t.isFunction(this.onEnd)&&this.onEnd(e,{docs:n,config:i})}updateRect(e){const s=this.el,i=this,n=this.opts,r=this.rectDim,o=this.updateTarget,a=this.getSelectedHandler(),{unitHeight:l,unitWidth:c,keyWidth:d,keyHeight:h}=n;if(t.isFunction(o))o(s,r,{store:e,selectedHandler:a,resizer:i,config:n});else{const e=s.style;e[d]=r.w+c,e[h]=r.h+l}this.updateContainer()}updateContainer(t={}){const{opts:s,container:i,el:n}=this,{style:r}=i;!s.avoidContainerUpdate&&n&&t.forceShow&&(r.display="block"),this.onUpdateContainer({el:i,resizer:this,opts:e.mixin({},s,t)})}getSelectedHandler(){var e=this.handlers;if(this.selectedHandler)for(let t in e)if(e[t]===this.selectedHandler)return t}handleKeyDown(e){27===e.keyCode&&(this.rectDim=this.startDim,this.stop(e))}handleMouseDown(e){var t=e.target;this.isHandler(t)?(this.selectedHandler=t,this.start(e)):t!==this.el&&(this.selectedHandler="",this.blur())}calc(e){let t;const i=this.opts||{},n=i.step,r=this.startDim,o=i.minDim,a=i.maxDim,l=e.delta.x,c=e.delta.y,d=r.w,h=r.h;var p={t:0,l:0,w:d,h:h};if(e){var g=e.handlerAttr;~g.indexOf("r")&&(t=s.normalizeFloat(d+l*n,n),t=Math.max(o,t),a&&(t=Math.min(a,t)),p.w=t),~g.indexOf("b")&&(t=s.normalizeFloat(h+c*n,n),t=Math.max(o,t),a&&(t=Math.min(a,t)),p.h=t),~g.indexOf("l")&&(t=s.normalizeFloat(d-l*n,n),t=Math.max(o,t),a&&(t=Math.min(a,t)),p.w=t),~g.indexOf("t")&&(t=s.normalizeFloat(h-c*n,n),t=Math.max(o,t),a&&(t=Math.min(a,t)),p.h=t);var u=i.ratioDefault?!e.keys.shift:e.keys.shift;if(g.indexOf("c")<0&&u){var m=r.w/r.h;p.w/p.h>m?p.h=Math.round(p.w/m):p.w=Math.round(p.h*m)}return~g.indexOf("l")&&(p.l=r.w-p.w),~g.indexOf("t")&&(p.t=r.h-p.h),p}}}(o)}}),e("skylark-grapejs/utils/index",["./Dragger","./Sorter","./Resizer"],function(e,t,s){"use strict";return()=>({name:"Utils",init(){return this},Sorter:t,Resizer:s,Dragger:e})}),e("skylark-grapejs/i18n/locale/en",[],function(){"use strict";const e={placeholder:"eg. Text here"};return{assetManager:{addButton:"Add image",inputPlh:"http://path/to/the/image.jpg",modalTitle:"Select Image",uploadTitle:"Drop files here or click to upload"},blockManager:{labels:{},categories:{}},domComponents:{names:{"":"Box",wrapper:"Body",text:"Text",comment:"Comment",image:"Image",video:"Video",label:"Label",link:"Link",map:"Map",tfoot:"Table foot",tbody:"Table body",thead:"Table head",table:"Table",row:"Table row",cell:"Table cell"}},deviceManager:{device:"Device",devices:{desktop:"Desktop",tablet:"Tablet",mobileLandscape:"Mobile Landscape",mobilePortrait:"Mobile Portrait"}},panels:{buttons:{titles:{preview:"Preview",fullscreen:"Fullscreen","sw-visibility":"View components","export-template":"View code","open-sm":"Open Style Manager","open-tm":"Settings","open-layers":"Open Layer Manager","open-blocks":"Open Blocks"}}},selectorManager:{label:"Classes",selected:"Selected",emptyState:"- State -",states:{hover:"Hover",active:"Click","nth-of-type(2n)":"Even/Odd"}},styleManager:{empty:"Select an element before using Style Manager",layer:"Layer",fileButton:"Images",sectors:{general:"General",layout:"Layout",typography:"Typography",decorations:"Decorations",extra:"Extra",flex:"Flex",dimension:"Dimension"},properties:{}},traitManager:{empty:"Select an element before using Trait Manager",label:"Component settings",traits:{labels:{},attributes:{id:e,alt:e,title:e,href:{placeholder:"eg. https://google.com"}},options:{target:{false:"This window",_blank:"New window"}}}}}}),e("skylark-grapejs/i18n/config",["./locale/en"],function(e){"use strict";return{locale:"en",localeFallback:"en",detectLocale:1,debug:0,messages:{en:e}}}),e("skylark-grapejs/i18n/index",["skylark-langx/langx","skylark-underscore","./config"],function(e,t,s){"use strict";const i=e=>!Array.isArray(e)&&null!==e&&"object"==typeof e,n=(...e)=>{const t=lang.mixin({},e[0]);for(let s=1;s<e.length;s++){const r=lang.mixin({},e[s]);for(let e in r){const s=t[e],o=r[e];i(s)&&i(o)?t[e]=n(s,o):t[e]=o}}return t};return()=>({name:"I18n",config:s,init(t={}){return this.config=e.mixin({},s,t,{messages:e.mixin({},s.messages,t.messages)}),this.config.detectLocale&&(this.config.locale=this._localLang()),this.em=t.em,this},getConfig(){return this.config},setLocale(e){const{em:t,config:s}=this,i={value:e,valuePrev:s.locale};return t&&t.trigger("i18n:locale",i),s.locale=e,this},getLocale(){return this.config.locale},getMessages(e,t={}){const{messages:s}=this.config;return e&&!s[e]&&this._debug(`'${e}' i18n lang not found`,t),e?s[e]:s},setMessages(e){const{em:t,config:s}=this;return s.messages=e,t&&t.trigger("i18n:update",e),this},addMessages(e){const{em:t}=this,{messages:s}=this.config;return t&&t.trigger("i18n:add",e),this.setMessages(n(s,e)),this},t(e,s={}){const{config:i}=this,n=s.params||{},r=s.l||this.getLocale(),o=s.lFlb||i.localeFallback;let a=this._getMsg(e,r,s);return a||(a=this._getMsg(e,o,s)),!a&&this._debug(`'${e}' i18n key not found in '${r}' lang`,s),a=a&&t.isString(a)?this._addParams(a,n):a},_localLang(){const e=window.navigator||{},t=e.language||e.userLanguage;return t?t.split("-")[0]:"en"},_addParams(e,t){const s=new RegExp("{([\\w\\d-]*)}","g");return e.replace(s,(e,s)=>t[s]||"").trim()},_getMsg(e,s,i={}){const n=this.getMessages(s,i);if(!n)return;let r=n[e];return!r&&e.indexOf(".")>0&&(r=e.split(".").reduce((e,s)=>{if(!t.isUndefined(e))return e[s]},n)),r},_debug(e,t={}){const{em:s,config:i}=this;(t.debug||i.debug)&&s&&s.logWarning(e)}})}),e("skylark-grapejs/keymaps/keymaster",[],function(){var e,t={},s={16:!1,18:!1,17:!1,91:!1},i="all",n={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},r={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},o=function(e){return r[e]||e.toUpperCase().charCodeAt(0)},a=[];for(e=1;e<20;e++)r["f"+e]=111+e;function l(e,t){for(var s=e.length;s--;)if(e[s]===t)return s;return-1}function c(e,t){if(e.length!=t.length)return!1;for(var s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}var d={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function h(t){for(e in s)s[e]=t[d[e]]}function p(e,s,i){var n,r;n=u(e),void 0===i&&(i=s,s="all");for(var a=0;a<n.length;a++)r=[],(e=n[a].split("+")).length>1&&(r=m(e),e=[e[e.length-1]]),e=e[0],(e=o(e))in t||(t[e]=[]),t[e].push({shortcut:n[a],scope:s,method:i,key:n[a],mods:r})}for(e in n)p[e]=!1;function g(){return i||"all"}function u(e){var t;return e=e.replace(/\s/g,""),""==(t=e.split(","))[t.length-1]&&(t[t.length-2]+=","),t}function m(e){for(var t=e.slice(0,e.length-1),s=0;s<t.length;s++)t[s]=n[t[s]];return t}function f(e,t,s){e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent&&e.attachEvent("on"+t,function(){s(window.event)})}return f(document,"keydown",function(e){!function(e){var i,r,o,c,d,u;i=e.keyCode,-1==l(a,i)&&a.push(i);93!=i&&224!=i||(i=91);if(i in s){for(o in s[i]=!0,n)n[o]==i&&(p[o]=!0);return}if(h(e),!p.filter.call(this,e))return;if(!(i in t))return;for(u=g(),c=0;c<t[i].length;c++)if((r=t[i][c]).scope==u||"all"==r.scope){for(o in d=r.mods.length>0,s)(!s[o]&&l(r.mods,+o)>-1||s[o]&&-1==l(r.mods,+o))&&(d=!1);(0!=r.mods.length||s[16]||s[18]||s[17]||s[91])&&!d||!1===r.method(e,r)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}(e)}),f(document,"keyup",function(e){var t,i=e.keyCode,r=l(a,i);r>=0&&a.splice(r,1);93!=i&&224!=i||(i=91);if(i in s)for(t in s[i]=!1,n)n[t]==i&&(p[t]=!1)}),f(window,"focus",function(){for(e in s)s[e]=!1;for(e in n)p[e]=!1}),p.setScope=function(e){i=e||"all"},p.getScope=g,p.deleteScope=function(e){var s,i,n;for(s in t)for(i=t[s],n=0;n<i.length;)i[n].scope===e?i.splice(n,1):n++},p.filter=function(e){var t=(e.target||e.srcElement).tagName;return!("INPUT"==t||"SELECT"==t||"TEXTAREA"==t)},p.isPressed=function(e){"string"==typeof e&&(e=o(e));return-1!=l(a,e)},p.getPressedKeyCodes=function(){return a.slice(0)},p.unbind=function(e,s){var i,n,r,a,l,d=[];for(i=u(e),a=0;a<i.length;a++){if((n=i[a].split("+")).length>1&&(d=m(n),e=n[n.length-1]),e=o(e),void 0===s&&(s=g()),!t[e])return;for(r=0;r<t[e].length;r++)(l=t[e][r]).scope===s&&c(l.mods,d)&&(t[e][r]={})}},p}),e("skylark-grapejs/keymaps/index",["skylark-langx/langx","skylark-underscore","./keymaster"],function(e,t,s){"use strict";return()=>{let i,n;const r={},o={defaults:{"core:undo":{keys:"⌘+z, ctrl+z",handler:"core:undo"},"core:redo":{keys:"⌘+shift+z, ctrl+shift+z",handler:"core:redo"},"core:copy":{keys:"⌘+c, ctrl+c",handler:"core:copy"},"core:paste":{keys:"⌘+v, ctrl+v",handler:"core:paste"},"core:component-next":{keys:"s",handler:"core:component-next"},"core:component-prev":{keys:"w",handler:"core:component-prev"},"core:component-enter":{keys:"d",handler:"core:component-enter"},"core:component-exit":{keys:"a",handler:"core:component-exit"},"core:component-delete":{keys:"backspace, delete",handler:"core:component-delete"}}};return{keymaster:s,name:"Keymaps",getConfig:()=>n,init(t={}){return n=e.mixin({},o,t),i=n.em,this.em=i,this},onLoad(){const e=n.defaults;for(let t in e){const s=e[t];this.add(t,s.keys,s.handler)}},add(e,i,n,o={}){const{em:a}=this,l=a.get("Commands"),c=a.getEditor(),d=a.get("Canvas"),h={id:e,keys:i,handler:n},p=r[e];return p&&this.remove(e),r[e]=h,s(i,(s,i)=>{const r={event:s,h:i};n=t.isString(n)?l.get(n):n,o.prevent&&d.getCanvasView().preventDefault(s);const h=!a.isEditing()&&!c.Canvas.isInputFocused();if(h||o.force){"object"==typeof n?n.run(c,0,r):n(c,0,r);const t=[e,i.shortcut,s];a.trigger("keymap:emit",...t),a.trigger(`keymap:emit:${e}`,...t)}}),a.trigger("keymap:add",h),h},get:e=>r[e],getAll:()=>r,remove(e){const t=this.em,i=this.get(e);if(i)return delete r[e],s.unbind(i.keys),t&&t.trigger("keymap:remove",i),i},removeAll(){return Object.keys(r).forEach(e=>this.remove(e)),this}}}}),e("skylark-grapejs/undo_manager/index",["skylark-langx/langx","skylark-backbone/UndoManager"],function(e,t){"use strict";return()=>{let s,i,n,r;const o={};return{name:"UndoManager",init(a={}){n=e.mixin({},a,o),s=n.em,this.em=s,(i=new t(e.mixin({track:!0,register:[]},n))).changeUndoType("change",{condition:!1}),i.changeUndoType("add",{on(t,s,i={}){if(!i.avoidStore)return{object:s,before:void 0,after:t,options:e.clone(i)}}}),i.changeUndoType("remove",{on(t,s,i={}){if(!i.avoidStore)return{object:s,before:t,after:void 0,options:e.clone(i)}}});const l={on(e,t,s={}){if(!r&&(r=e.previousAttributes()),!s.avoidStore){const t={object:e,before:r,after:e.toJSON()};return r=null,t}},undo(e,t,s,i){e.set(t)},redo(e,t,s,i){e.set(s)}};return["style","attributes","content","src"].forEach(e=>i.addUndoType(`change:${e}`,l)),i.on("undo redo",()=>s.trigger("component:toggled change:canvasOffset")),["undo","redo"].forEach(e=>i.on(e,()=>s.trigger(e))),this},getConfig:()=>n,add(e){return i.register(e),this},remove(e){return i.unregister(e),this},removeAll(){return i.unregisterAll(),this},start(){return i.startTracking(),this},stop(){return i.stopTracking(),this},undo(){return!s.isEditing()&&i.undo(1),this},undoAll(){return i.undoAll(),this},redo(){return!s.isEditing()&&i.redo(1),this},redoAll(){return i.redoAll(),this},hasUndo:()=>i.isAvailable("undo"),hasRedo:()=>i.isAvailable("redo"),getStack:()=>i.stack,clear(){return i.clear(),this},getInstance:()=>i}}}),e("skylark-grapejs/storage_manager/config/config",[],function(){"use strict";return{id:"gjs-",autosave:1,autoload:1,type:"local",stepsBeforeSave:1,storeComponents:1,storeStyles:1,storeHtml:1,storeCss:1,checkLocal:1,params:{},headers:{},urlStore:"",urlLoad:"",beforeSend(e,t){},onComplete(e,t){},contentTypeJson:!0,credentials:"include",fetchOptions:""}}),e("skylark-grapejs/storage_manager/model/LocalStorage",["skylark-backbone"],function(e){"use strict";return e.Model.extend({defaults:{checkLocal:!0},store(e,t){for(var s in this.checkStorageEnvironment(),e)localStorage.setItem(s,e[s]);"function"==typeof t&&t()},load(e,t){this.checkStorageEnvironment();for(var s={},i=0,n=e.length;i<n;i++){var r=localStorage.getItem(e[i]);r&&(s[e[i]]=r)}return"function"==typeof t&&t(s),s},remove(e){this.checkStorageEnvironment();for(var t=0,s=e.length;t<s;t++)localStorage.removeItem(e[t])},checkStorageEnvironment(){this.get("checkLocal")&&!localStorage&&console.warn("Your browser doesn't support localStorage")}})}),e("skylark-grapejs/utils/fetch",[],function(){"use strict";return"function"==typeof fetch?fetch.bind():(e,t)=>new Promise((s,i)=>{const n=new XMLHttpRequest;n.open(t.method||"get",e),n.withCredentials="include"==t.credentials;for(let e in t.headers||{})n.setRequestHeader(e,t.headers[e]);n.onload=(e=>s({status:n.status,statusText:n.statusText,text:()=>Promise.resolve(n.responseText)})),n.onerror=i,n.upload&&t.onProgress&&(n.upload.onprogress=t.onProgress),t.body?n.send(t.body):n.send()})}),e("skylark-grapejs/storage_manager/model/RemoteStorage",["skylark-langx/langx","skylark-backbone","../../utils/fetch","skylark-underscore"],function(e,t,s,i){"use strict";return t.Model.extend({fetch:s,defaults:{urlStore:"",urlLoad:"",params:{},beforeSend(){},onComplete(){},contentTypeJson:!1,credentials:"include",fetchOptions:""},onStart(){this.get("em");const e=this.get("beforeSend");e&&e()},onError(e,t){if(t)t(e);else{const t=this.get("em");console.error(e),t&&t.trigger("storage:error",e)}},onResponse(e,t){const s=this.get("em"),i=this.get("onComplete"),n=this.get("contentTypeJson"),r=e&&"string"==typeof e,o=n&&r?JSON.parse(e):e;i&&i(o),t&&t(o),s&&s.trigger("storage:response",o)},store(e,t,s){const i={};for(let t in e)i[t]=e[t];this.request(this.get("urlStore"),{body:i},t,s)},load(e,t,s){this.request(this.get("urlLoad"),{method:"get"},t,s)},request(t,s={},n=null,r=null){const o=this.get("contentTypeJson"),a=this.get("headers")||{},l=this.get("params"),c=s.body||{};let d,h;for(let e in l)c[e]=l[e];if(i.isUndefined(a["X-Requested-With"])&&(a["X-Requested-With"]="XMLHttpRequest"),i.isUndefined(a["Content-Type"])&&o&&(a["Content-Type"]="application/json; charset=utf-8"),o)h=JSON.stringify(c);else{h=new FormData;for(let e in c)h.append(e,c[e])}"post"===(d={method:s.method||"post",credentials:this.get("credentials"),headers:a}).method&&(d.body=h);const p=this.get("fetchOptions")||{},g=i.isFunction(p)?p(d):d;this.onStart(),this.fetch(t,e.mixin({},d,g)).then(e=>1==(e.status/200|0)?e.text():e.text().then(e=>Promise.reject(e))).then(e=>this.onResponse(e,n)).catch(e=>this.onError(e,r))}})}),e("skylark-grapejs/storage_manager/index",["skylark-langx/langx","./config/config","./model/LocalStorage","./model/RemoteStorage"],function(e,t,s,i){"use strict";return()=>{var n={};let r;var o={},a={};return{name:"StorageManager",init(o={}){return n=e.mixin({},t,o),r=n.em,n._disable&&(n.type=0),a.remote=new i(n),a.local=new s(n),n.currentStorage=n.type,this.loadDefaultProviders().setCurrent(n.type),this},getConfig:()=>n,isAutosave:()=>!!n.autosave,setAutosave(e){return n.autosave=!!e,this},getStepsBeforeSave:()=>n.stepsBeforeSave,setStepsBeforeSave(e){return n.stepsBeforeSave=e,this},add(e,t){return o[e]=t,this},get:e=>o[e]||null,getStorages:()=>o,getCurrent:()=>n.currentStorage,setCurrent(e){return n.currentStorage=e,this},store(e,t){const s=this.get(this.getCurrent()),i={};this.onStart("store",e);for(let t in e)i[n.id+t]=e[t];return s?s.store(i,e=>{t&&t(e),this.onEnd("store",e)},e=>{this.onError("store",e)}):null},load(e,t){var s=this.get(this.getCurrent()),i=[],r={};"string"==typeof e&&(e=[e]),this.onStart("load",e);for(var o=0,a=e.length;o<a;o++)i.push(n.id+e[o]);s?s.load(i,e=>{var s=new RegExp("^"+n.id);for(var i in e){var o=i.replace(s,"");r[o]=e[i]}t&&t(r),this.onEnd("load",r)},e=>{t&&t(r),this.onError("load",e)}):t&&t(r)},loadDefaultProviders(){for(var e in a)this.add(e,a[e]);return this},getCurrentStorage(){return this.get(this.getCurrent())},onStart(e,t){r&&(r.trigger("storage:start"),e&&r.trigger(`storage:start:${e}`,t))},onEnd(e,t){r&&(r.trigger("storage:end"),e&&r.trigger(`storage:end:${e}`,t))},onError(e,t){r&&(r.trigger("storage:error",t),e&&r.trigger(`storage:error:${e}`,t),this.onEnd(e,t))},canAutoload(){const e=this.getCurrentStorage();return e&&this.getConfig().autoload}}}}),e("skylark-grapejs/device_manager/config/config",[],function(){"use strict";return{devices:[]}}),e("skylark-grapejs/device_manager/model/Device",["skylark-backbone"],function(e){"use strict";return e.Model.extend({idAttribute:"name",defaults:{name:"",width:null,height:"",widthMedia:null,priority:null},initialize(){null===this.get("widthMedia")&&this.set("widthMedia",this.get("width")),null===this.get("width")&&this.set("width",this.get("widthMedia")),!this.get("priority")&&this.set("priority",parseFloat(this.get("widthMedia"))||0);["width","height","widthMedia"].forEach(e=>this.checkUnit(e))},checkUnit(e){const t=this.get(e)||"",s=(parseFloat(t)||0).toString()===t.toString();s&&this.set(e,`${t}px`)}})}),e("skylark-grapejs/device_manager/model/Devices",["skylark-backbone","./Device"],function(e,t){"use strict";return e.Collection.extend({model:t,comparator:(e,t)=>{const s=Number.MAX_VALUE;return(t.get("priority")||s)-(e.get("priority")||s)},getSorted(){return this.sort()}})}),e("skylark-grapejs/device_manager/view/DevicesView",["skylark-underscore","skylark-backbone"],function(e,t){"use strict";return t.View.extend({template:e.template('\n    <div class="<%= ppfx %>device-label"><%= deviceLabel %></div>\n    <div class="<%= ppfx %>field <%= ppfx %>select">\n      <span id="<%= ppfx %>input-holder">\n        <select class="<%= ppfx %>devices"></select>\n      </span>\n      <div class="<%= ppfx %>sel-arrow">\n        <div class="<%= ppfx %>d-s-arrow"></div>\n      </div>\n    </div>\n    <button style="display:none" class="<%= ppfx %>add-trasp">+</button>'),events:{change:"updateDevice"},initialize(e){this.config=e.config||{},this.em=this.config.em,this.ppfx=this.config.pStylePrefix||"",this.events["click ."+this.ppfx+"add-trasp"]=this.startAdd,this.listenTo(this.em,"change:device",this.updateSelect),this.delegateEvents()},startAdd(){},updateDevice(){var e=this.em;if(e){var t=this.devicesEl,s=t?t.val():"";e.set("device",s)}},updateSelect(){var e=this.em,t=this.devicesEl;if(e&&e.getDeviceModel&&t){var s=e.getDeviceModel(),i=s?s.get("name"):"";t.val(i)}},getOptions(){const{collection:e,em:t}=this;let s="";return e.each(e=>{const{name:i,id:n}=e.attributes,r=t&&t.t&&t.t(`deviceManager.devices.${n}`)||i;s+=`<option value="${i}">${r}</option>`}),s},render(){const{em:e,ppfx:t,$el:s,el:i}=this;return s.html(this.template({ppfx:t,deviceLabel:e&&e.t&&e.t("deviceManager.device")})),this.devicesEl=s.find(`.${t}devices`),this.devicesEl.append(this.getOptions()),i.className=`${t}devices-c`,this}})}),e("skylark-grapejs/device_manager/index",["skylark-langx/langx","./config/config","./model/Devices","./view/DevicesView"],function(e,t,s,i){"use strict";return()=>{var n,r,o={};return{name:"DeviceManager",init(e){for(var a in o=e||{},t)a in o||(o[a]=t[a]);return n=new s,(o.devices||[]).forEach(e=>this.add(e.id||e.name,e.width,e)),r=new i({collection:n,config:o}),this},add(t,s,i={}){const r=e.mixin({},i,{id:t,name:i.name||t,width:s});return n.add(r)},get:e=>n.get(e),getAll:()=>n,render:()=>r.render().el}}}),e("skylark-grapejs/parser/config/config",[],function(){"use strict";return{textTags:["br","b","i","u","a","ul","ol"],parserCss:null,parserHtml:null}}),e("skylark-grapejs/parser/model/BrowserParserCss",["skylark-underscore"],function(e){"use strict";const t={4:"media",5:"font-face",6:"page",7:"keyframes",11:"counter-style",12:"supports",13:"document",14:"font-feature-values",15:"viewport"},s=e.keys(t),i=["5","6","11","15"],n=["font-face","page","counter-style","viewport"],r=(e="")=>{const t=[],s=[],i=e.split(",");for(var n=0,r=i.length;n<r;n++){var o=i[n].trim();if(/^(\.{1}[\w\-]+)+(:{1,2}[\w\-()]+)?$/gi.test(o)||/^(#{1}[\w\-]+){1}(:{1,2}[\w\-()]+)?$/gi.test(o)){var a=o.split(".").filter(Boolean);s.push(a)}else t.push(o)}return{result:s,add:t}},o=e=>{const t=e.style,s={};for(var i=0,n=t.length;i<n;i++){const e=t[i],n=t.getPropertyValue(e),r=t.getPropertyPriority(e);s[e]=`${n}${r?` !${r}`:""}`}return s},a=e=>{const t=e.conditionText||e.media&&e.media.mediaText||e.name||e.selectorText||"";return t.trim()},l=(e,t={},s={})=>{const i={},r=e.length,o=e[r-1],a=o?o.split(/:(.+)/):[],l=a[1],{atRule:c,selectorsAdd:d,mediaText:h}=s,p=n.indexOf(c)>=0;return p&&(i.singleAtRule=1),c&&(i.atRuleType=c),d&&(i.selectorsAdd=d),h&&(i.mediaText=h),l&&(e[r-1]=a[0],i.state=l,a.splice(a.length-1,1)),i.selectors=e,i.style=t,i},c=e=>{for(var n=[],d=e.cssRules||[],h=0,p=d.length;h<p;h++){const e=d[h],p=e.type.toString();let k=0,w="",x="",C=e.selectorText||e.keyText;const S=i.indexOf(p)>=0;if(S)k=1,w=t[p],x=a(e);else if(s.indexOf(p)>=0){var g=c(e);x=a(e);for(var u=0,m=g.length;u<m;u++){var f=g[u];x&&(f.mediaText=x),f.atRuleType=t[p]}n=n.concat(g)}if(!C&&!S)continue;const T=o(e),$=r(C),E=$.add;let P;for(var v=0,y=(C=$.result).length;v<y;v++){const e=l(C[v],T,{atRule:t[p]});n.push(e),P=e}if(E.length){var b=E.join(", ");if(P)P.selectorsAdd=b;else{const e={selectors:[],selectorsAdd:b,style:T};k&&(e.singleAtRule=k),w&&(e.atRuleType=w),x&&(e.mediaText=x),n.push(e)}}}return n};var d=e=>{const t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t);const s=t.sheet;return document.head.removeChild(t),c(s)};return d.parseSelector=r,d.parseStyle=o,d.parseCondition=a,d.createNode=l,d.parseNode=c,d}),e("skylark-grapejs/parser/model/ParserCss",["skylark-underscore","./BrowserParserCss","./BrowserParserCss"],function(e,t,s){"use strict";return(i={})=>({parse(e){let s=[];const{parserCss:n,em:r={}}=i,o=r&&r.get&&r.get("Editor"),a=n?n(e,o):t(e);return a.forEach(e=>s=s.concat(this.checkNode(e))),s},checkNode(t){const{selectors:i,style:n}=t;if(e.isString(i)){const e=[],r=s.parseSelector(i),o=r.result,a=r.add.join(", "),l={atRule:t.atRule,mediaText:t.params};if(o.length?o.forEach(t=>{e.push(s.createNode(t,n,l))}):e.push(s.createNode([],n,l)),a){const t=e[e.length-1];t.selectorsAdd=a}t=e}return t}})}),e("skylark-grapejs/parser/model/ParserHtml",["skylark-underscore"],function(e){"use strict";return t=>{var s=t;return{compTypes:"",modelAttrStart:"data-gjs-",splitPropsFromAttr(t={}){const s={},i={};return e.each(t,(t,n)=>{if(0===n.indexOf(this.modelAttrStart)){const i=n.replace("data-gjs-",""),r=t.length,o=t&&e.isString(t),a=o&&t.substr(0,1),l=o&&t.substr(r-1);t="false"!==(t="true"===t||t)&&t;try{t="{"==a&&"}"==l||"["==a&&"]"==l?JSON.parse(t):t}catch(e){}s[i]=t}else i[n]=t}),{props:s,attrs:i}},parseStyle(e){for(var t={},s=e.split(";"),i=0,n=s.length;i<n;i++){var r=s[i].trim();if(r){var o=r.split(":");t[o[0].trim()]=o.slice(1).join(":").trim()}}return t},parseClass(e){const t=[],s=e.split(" ");for(let e=0,i=s.length;e<i;e++){const i=s[e].trim();i&&t.push(i)}return t},parseNode(e){const i=[],n=e.childNodes;for(var r=0,o=n.length;r<o;r++){const e=n[r],o=e.attributes||[],a=o.length,l=i[i.length-1],c=e.childNodes.length,d=this.compTypes;let h={};if(d){let t="",s=e.getAttribute&&e.getAttribute("data-gjs-type");if(s)h={type:s};else{for(let s=0;s<d.length;s++){const i=d[s];if(t=i.model.isComponent(e)){"object"!=typeof t&&(t={type:i.id});break}}h=t}}h.tagName||(h.tagName=e.tagName?e.tagName.toLowerCase():""),a&&(h.attributes={});for(let e=0;e<a;e++){const t=o[e].nodeName;let s=o[e].nodeValue;if("style"==t)h.style=this.parseStyle(s);else if("class"==t)h.classes=this.parseClass(s);else{if("contenteditable"==t)continue;if(0===t.indexOf("data-gjs-")){const e=t.replace("data-gjs-",""),i=s.length,n=s&&s.substr(0,1),r=s&&s.substr(i-1);s="false"!==(s="true"===s||s)&&s;try{s="{"==n&&"}"==r||"["==n&&"]"==r?JSON.parse(s):s}catch(e){}h[e]=s}else h.attributes[t]=s}}if(c&&!h.components){const t=e.childNodes[0];1===c&&3===t.nodeType?(!h.type&&(h.type="text"),h.content=t.nodeValue):h.components=this.parseNode(e)}if("textnode"==h.type){if(l&&"textnode"==l.type){l.content+=h.content;continue}if(!t.keepEmptyTextNodes){const t=e.nodeValue;if(" "!=t&&!t.trim())continue}}const p=h.components;if(!h.type&&p){let e=1,t=0;for(let i=0;i<p.length;i++){const n=p[i],r=n.type;if(["text","textnode"].indexOf(r)<0&&s.textTags.indexOf(n.tagName)<0){e=0;break}"textnode"==r&&(t=1)}e&&t&&(h.type="text")}(h.tagName||"textnode"==h.type)&&i.push(h)}return i},parse(e,t){var i=s.em&&s.em.get("Config")||{},n={html:"",css:""},r=document.createElement("div");r.innerHTML=e;var o=r.querySelectorAll("script"),a=o.length;if(!i.allowScripts)for(;a--;)o[a].parentNode.removeChild(o[a]);if(t){for(var l="",c=r.querySelectorAll("style"),d=c.length;d--;)l=c[d].innerHTML+l,c[d].parentNode.removeChild(c[d]);l&&(n.css=t.parse(l))}var h=this.parseNode(r);return 1==h.length&&(h=h[0]),n.html=h,n}}}}),e("skylark-grapejs/parser/index",["skylark-langx/langx","./config/config","./model/ParserCss","./model/ParserHtml"],function(e,t,s,i){"use strict";return()=>{let e,n,r={};return{compTypes:"",parserCss:null,parserHtml:null,name:"Parser",getConfig:()=>r,init(o={}){return(r={...t,...o}).Parser=this,e=i(r),n=s(r),this.em=r.em,this.parserCss=n,this.parserHtml=e,this},parseHtml(t){const{em:s,compTypes:i}=this;return e.compTypes=s?s.get("DomComponents").getTypes():i,e.parse(t,n)},parseCss:e=>n.parse(e)}}}),e("skylark-grapejs/selector_manager/config/config",[],function(){"use strict";return{stylePrefix:"clm-",appendTo:"",selectors:[],states:[{name:"hover"},{name:"active"},{name:"nth-of-type(2n)"}],escapeName:0,selectedName:0,iconAdd:'<svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg>',iconSync:'<svg viewBox="0 0 24 24"><path d="M12 18c-3.31 0-6-2.69-6-6 0-1 .25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 0 0 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4m0-11V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0 0 20 12c0-4.42-3.58-8-8-8z"></path></svg>',iconTagOn:'<svg viewBox="0 0 24 24"><path d="M19 19H5V5h10V3H5c-1.11 0-2 .89-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-8h-2m-11.09-.92L6.5 11.5 11 16 21 6l-1.41-1.42L11 13.17l-3.09-3.09z"></path></svg>',iconTagOff:'<svg viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14z"></path></svg>',iconTagRemove:'<svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>',render:0,componentFirst:0}}),e("skylark-grapejs/selector_manager/model/Selector",["skylark-backbone"],function(e){"use strict";const t=e.Model.extend({idAttribute:"name",defaults:{name:"",label:"",type:1,active:!0,private:!1,protected:!1},initialize(e,s={}){const{config:i={}}=s,n=this.get("name"),r=this.get("label");n?r||this.set("label",n):this.set("name",r);const o=this.get("name"),{escapeName:a}=i,l=a?a(o):t.escapeName(o);this.set("name",l)},getFullName(e={}){const{escape:t}=e,s=this.get("name");let i="";switch(this.get("type")){case 1:i=".";break;case 2:i="#"}return i+(t?t(s):s)}},{TYPE_CLASS:1,TYPE_ID:2,escapeName:e=>`${e}`.trim().replace(/([^a-z0-9\w-\:]+)/gi,"-")});return t}),e("skylark-grapejs/selector_manager/model/Selectors",["skylark-underscore","skylark-backbone","./Selector"],function(e,t,s){"use strict";return t.Collection.extend({model:s,modelId:e=>`${e.name}_${e.type||s.TYPE_CLASS}`,getStyleable(){return e.filter(this.models,e=>e.get("active")&&!e.get("private"))},getValid({noDisabled:t}={}){return e.filter(this.models,e=>!e.get("private")).filter(e=>t?e.get("active"):1)},getFullString(e,t={}){const s=[],i=e||this;return i.forEach(e=>s.push(e.getFullName(t))),s.join("").trim()}})}),e("skylark-grapejs/selector_manager/view/ClassTagView",["skylark-backbone"],function(e){"use strict";return e.View.extend({template(){const{pfx:e,model:t,config:s}=this,i=t.get("label")||"";return`\n      <span id="${e}checkbox" class="${e}tag-status" data-tag-status></span>\n      <span id="${e}tag-label" data-tag-name>${i}</span>\n      <span id="${e}close" class="${e}tag-close" data-tag-remove>\n        ${s.iconTagRemove}\n      </span>\n    `},events:{"click [data-tag-remove]":"removeTag","click [data-tag-status]":"changeStatus","dblclick [data-tag-name]":"startEditTag","focusout [data-tag-name]":"endEditTag"},initialize(e){const t=e.config||{};this.config=t,this.coll=e.coll||null,this.pfx=t.stylePrefix||"",this.ppfx=t.pStylePrefix||"",this.em=t.em,this.listenTo(this.model,"change:active",this.updateStatus)},getInputEl(){return this.inputEl||(this.inputEl=this.el.querySelector("[data-tag-name]")),this.inputEl},startEditTag(){const{em:e}=this,t=this.getInputEl();t.contentEditable=!0,t.focus(),e&&e.setEditing(1)},endEditTag(){const e=this.model,t=this.getInputEl(),s=t.textContent,i=this.em,n=i&&i.get("SelectorManager");if(t.contentEditable=!1,i&&i.setEditing(0),n){const i=n.escapeName(s);n.get(i)?t.innerText=e.get("label"):e.set({name:i,label:s})}},changeStatus(){const{model:e}=this;e.set("active",!e.get("active"))},removeTag(){const{em:e,model:t}=this,s=e&&e.getSelectedAll();s.forEach(e=>{!t.get("protected")&&e&&e.getSelectors().remove(t)})},updateStatus(){const{model:e,$el:t,config:s}=this,{iconTagOn:i,iconTagOff:n}=s,r=t.find("[data-tag-status]");e.get("active")?(r.html(i),t.removeClass("opac50")):(r.html(n),t.addClass("opac50"))},render(){const e=this.pfx,t=this.ppfx;return this.$el.html(this.template()),this.$el.attr("class",`${e}tag ${t}three-bg`),this.updateStatus(),this}})}),e("skylark-grapejs/selector_manager/view/ClassTagsView",["skylark-underscore","skylark-backbone","./ClassTagView"],function(e,t,s){"use strict";return t.View.extend({template:({labelInfo:e,labelStates:t,labelHead:s,iconSync:i,iconAdd:n,pfx:r,ppfx:o})=>`\n    <div id="${r}up" class="${r}header">\n      <div id="${r}label" class="${r}header-label">${s}</div>\n      <div id="${r}status-c" class="${r}header-status">\n        <span id="${r}input-c" data-states-c>\n          <div class="${o}field ${o}select">\n            <span id="${o}input-holder">\n              <select id="${r}states" data-states>\n                <option value="">${t}</option>\n              </select>\n            </span>\n            <div class="${o}sel-arrow">\n              <div class="${o}d-s-arrow"></div>\n            </div>\n          </div>\n        </span>\n      </div>\n    </div>\n    <div id="${r}tags-field" class="${o}field">\n      <div id="${r}tags-c" data-selectors></div>\n      <input id="${r}new" data-input/>\n      <span id="${r}add-tag" class="${r}tags-btn ${r}tags-btn__add" data-add>\n        ${n}\n      </span>\n      <span class="${r}tags-btn ${r}tags-btn__sync" style="display: none" data-sync-style>\n        ${i}\n      </span>\n    </div>\n    <div class="${r}sels-info">\n      <div class="${r}label-sel">${e}:</div>\n      <div class="${r}sels" data-selected></div>\n      <div style="clear:both"></div>\n    </div>`,events:{"change [data-states]":"stateChanged","click [data-add]":"startNewTag","focusout [data-input]":"endNewTag","keyup [data-input]":"onInputKeyUp","click [data-sync-style]":"syncStyle"},initialize(e={}){this.config=e.config||{},this.pfx=this.config.stylePrefix||"",this.ppfx=this.config.pStylePrefix||"",this.className=this.pfx+"tags",this.stateInputId=this.pfx+"states",this.stateInputC=this.pfx+"input-c",this.states=this.config.states||[];const{em:t}=this.config;this.em=t;this.getStyleEmitter();const s=this.collection;this.target=this.config.em;this.listenTo(t,"component:toggled component:update:classes",this.componentChanged),this.listenTo(t,"component:update:classes change:state",this.__handleStateChange),this.listenTo(t,"styleable:change change:device",this.checkSync),this.listenTo(s,"add",this.addNew),this.listenTo(s,"reset",this.renderClasses),this.listenTo(s,"remove",this.tagRemoved),this.delegateEvents()},syncStyle(){const{em:e}=this,t=this.getTarget(),s=e.get("CssComposer"),i=this.getCommonSelectors({opts:{noDisabled:1}}),n=e.get("state"),r=e.getCurrentMedia(),o=[],a=s.get(i,n,r)||s.add(i,n,r);let l;this.getTargets().forEach(e=>{const t=s.getIdRule(e.getId(),{state:n,mediaText:r});l=t.getStyle(),t.setStyle({}),o.push(t)}),l&&a.addStyle(l),e.trigger("component:toggled"),e.trigger("component:sync-style",{component:t,selectors:i,mediaText:r,rule:a,ruleComponents:o,state:n})},getStyleEmitter(){const{em:e}=this,t=e&&e.get("StyleManager"),s=t&&t.getEmitter();return s||{}},tagRemoved(e){this.updateStateVis()},getStateOptions(){const{states:e,em:t}=this;let s=[];return e.forEach(e=>s.push(`<option value="${e.name}">${t.t(`selectorManager.states.${e.name}`)||e.label||e.name}</option>`)),s.join("")},addNew(e){this.addToClasses(e)},startNewTag(){this.$addBtn.css({display:"none"}),this.$input.show().focus()},endNewTag(){this.$addBtn.css({display:""}),this.$input.hide().val("")},onInputKeyUp(e){13===e.keyCode?this.addNewTag(this.$input.val()):27===e.keyCode&&this.endNewTag()},checkStates(){const e=this.em.getState(),t=this.getStates();t&&t.val(e)},componentChanged:e.debounce(function({targets:e}={}){this.updateSelection(e)}),updateSelection(t){let s=t||this.getTargets(),i=[];return(s=e.isArray(s)?s:[s])&&s.length&&(i=this.getCommonSelectors({targets:s}),this.checkSync({validSelectors:i})),this.collection.reset(i),this.updateStateVis(s),i},getCommonSelectors({targets:e,opts:t={}}={}){const s=e||this.getTargets(),i=s.map(e=>e.getSelectors&&e.getSelectors().getValid(t)).filter(e=>e);return this._commonSelectors(...i)},_commonSelectors(...e){return e.length?1===e.length?e[0]:2===e.length?e[0].filter(t=>e[1].indexOf(t)>=0):e.slice(1).reduce((e,t)=>this._commonSelectors(e,t),e[0]):[]},checkSync:e.debounce(function(){const{$btnSyncEl:t,config:s,collection:i}=this,n=this.getTarget();let r;if(n&&s.componentFirst&&i.length){const t=n.getStyle();r=!e.isEmpty(t)}t&&t[r?"show":"hide"]()}),getTarget(){return this.target.getSelected()},getTargets(){return this.target.getSelectedAll()},updateStateVis(e){const t=this.em,s=t&&t.getConfig("avoidInlineStyle"),i=this.collection.length||s?"":"none";this.getStatesC().css("display",i),this.updateSelector(e)},__handleStateChange(){this.updateSelector(this.getTargets())},updateSelector(t){const s=this.el.querySelector("[data-selected]"),i=[];let n=t||this.getTargets();(n=e.isArray(n)?n:[n]).forEach(e=>i.push(this.__getName(e))),s&&(s.innerHTML=i.join(", ")),this.checkStates()},__getName(t){const{pfx:s,config:i,em:n}=this,{selectedName:r,componentFirst:o}=i;let a;if(e.isString(t))a=`<span class="${s}sel-gen">${t}</span>`;else{if(!t||!t.get)return;const e=t.getSelectors().getStyleable(),i=n.get("state"),l=t.getId?`<span class="${s}sel-cmp">${t.getName()}</span><span class="${s}sel-id">#${t.getId()}</span>`:"";a=(a=this.collection.getFullString(e))?`<span class="${s}sel-rule">${a}</span>`:t.get("selectorsAdd")||l,a=o&&l?l:a,a+=i?`<span class="${s}sel-state">:${i}</span>`:"",a=r?r({result:a,state:i,target:t}):a}return a&&`<span class="${s}sel">${a}</span>`},stateChanged(e){const{em:t}=this,{value:s}=e.target;t.set("state",s)},addNewTag(e){const{em:t}=this;if(e.trim()){if(t){const s=t.get("SelectorManager"),i=s.add({label:e});this.getTargets().forEach(e=>{e.getSelectors().add(i),this.collection.add(i),this.updateStateVis()})}this.endNewTag()}},addToClasses(e,t=null){const i=t,n=this.getClasses(),r=new s({model:e,config:this.config,coll:this.collection}).render().el;return i?i.appendChild(r):n.append(r),r},renderClasses(){const e=document.createDocumentFragment(),t=this.getClasses();t.empty(),this.collection.each(t=>this.addToClasses(t,e)),t.append(e)},getClasses(){return this.$el.find("[data-selectors]")},getStates(){if(!this.$states){const e=this.$el.find("[data-states]");this.$states=e[0]&&e}return this.$states},getStatesC(){return this.$statesC||(this.$statesC=this.$el.find("#"+this.stateInputC)),this.$statesC},render(){const{em:e,pfx:t,ppfx:s,config:i,$el:n,el:r}=this,{render:o,iconSync:a,iconAdd:l}=i,c={iconSync:a,iconAdd:l,labelHead:e.t("selectorManager.label"),labelStates:e.t("selectorManager.emptyState"),labelInfo:e.t("selectorManager.selected"),ppfx:s,pfx:t,el:r};n.html(this.template(c));const d=o&&o(c);d&&d!==r&&n.empty().append(d),this.$input=n.find("[data-input]"),this.$addBtn=n.find("[data-add]"),this.$classes=n.find("#"+t+"tags-c"),this.$btnSyncEl=n.find("[data-sync-style]"),this.$input.hide();const h=this.getStates();return h&&h.append(this.getStateOptions()),this.renderClasses(),n.attr("class",`${this.className} ${s}one-bg ${s}two-color`),this}})}),e("skylark-grapejs/selector_manager/index",["skylark-langx/langx","skylark-underscore","../utils/mixins","./config/config","./model/Selector","./model/Selectors","./view/ClassTagsView"],function(e,t,s,i,n,r,o){"use strict";const a=e=>t.isString(e)&&"#"==e[0],l=e=>t.isString(e)&&"."==e[0];return c=>{var d,h=c||{};return{Selector:n,Selectors:r,name:"SelectorManager",getConfig:()=>h,init(e={}){const t=(h={...i,...e}).em,s=h.pStylePrefix;return this.em=t,s&&(h.stylePrefix=s+h.stylePrefix),this.selectorTags=new o({collection:new r([],{em:t,config:h}),config:h}),(d=new r(h.selectors)).on("add",e=>t.trigger("selector:add",e)),d.on("remove",e=>t.trigger("selector:remove",e)),d.on("change",e=>t.trigger("selector:update",e,e.previousAttributes(),e.changedAttributes())),t.on("change:state",(e,s)=>t.trigger("selector:state",s)),this},postRender(){const e=this.getConfig().appendTo;if(e){const s=t.isElement(e)?e:document.querySelector(e);s.appendChild(this.render([]))}},select(e,t={}){const i=Array.isArray(e)?e:[e],n=this.em.get("StyleManager").setTarget(i,t),r=n.filter(e=>e).map(e=>s.isComponent(e)?e:s.isRule(e)&&!e.get("selectorsAdd")?e:e.getSelectorsString());return this.selectorTags.componentChanged({targets:r}),this},setState(e){return this.em.setState(e),this},getState(){return this.em.setState()},addSelector(s,i={}){let r=e.clone(i);t.isObject(s)?r=s:r.name=s,a(r.name)?(r.name=r.name.substr(1),r.type=n.TYPE_ID):l(r.name)&&(r.name=r.name.substr(1)),r.label&&!r.name&&(r.name=this.escapeName(r.label));const o=r.name,c=o?this.get(o,r.type):d.where(r)[0];return c||d.add(r,{config:h})},getSelector:(e,t=n.TYPE_CLASS)=>(a(e)?(e=e.substr(1),t=n.TYPE_ID):l(e)&&(e=e.substr(1)),d.where({name:e,type:t})[0]),add(e,s={}){return t.isArray(e)?e.map(e=>this.addSelector(e,s)):this.addSelector(e,s)},addClass(e){const s=[];return t.isString(e)&&(e=e.trim().split(" ")),e.forEach(e=>s.push(this.addSelector(e))),s},get(e,s){if(t.isArray(e)){const t=[],s=e.map(e=>this.getSelector(e)).filter(e=>e);return s.forEach(e=>t.indexOf(e)<0&&t.push(e)),t}return this.getSelector(e,s)},getAll:()=>d,escapeName(e){const{escapeName:t}=h;return t?t(e):n.escapeName(e)},render(e){return e?(this.selectorTags=new o({collection:new r(e),config:h}),this.selectorTags.render().el):this.selectorTags.render().el}}}}),e("skylark-grapejs/style_manager/config/config",[],function(){"use strict";return{stylePrefix:"sm-",sectors:[],appendTo:"",hideNotStylable:!0,highlightChanged:!0,highlightComputed:!0,showComputed:!0,clearProperties:0,avoidComputed:["width","height"]}}),e("skylark-grapejs/domain_abstract/model/TypeableCollection",["skylark-underscore","skylark-backbone"],function(e,t){"use strict";const s=t.Model,i=t.View;return{types:[],initialize(e,t){var s=this;this.model=function(e={},t={}){let i,n,r;if(e&&e.type){const t=s.getBaseType();r=s.getType(e.type),i=r?r.model:t.model,n=r?r.view:t.view}else{const t=s.recognizeType(e);r=t.type,i=r.model,n=r.view,e=t.attributes}const o=new i(e,t);return o.typeView=n,o};const i=s.init&&s.init.bind(s);i&&i()},recognizeType(e){const t=this.getTypes();for(let s=0;s<t.length;s++){const i=t[s];let n=i.isType(e);if(n="boolean"==typeof n&&n?{type:i.id}:n)return{type:i,attributes:n}}return{type:this.getBaseType(),attributes:e}},getBaseType(){const e=this.getTypes();return e[e.length-1]},getTypes(){return this.types},getType(e){const t=this.getTypes();for(let s=0;s<t.length;s++){const i=t[s];if(i.id===e)return i}},addType(t,n){const r=this.getType(t),o=this.getBaseType(),a=r?r.model:o.model,l=r?r.view:o.view;let{model:c,view:d,isType:h}=n;c=c instanceof s||e.isFunction(c)?c:a.extend(c||{}),d=d instanceof i||e.isFunction(d)?d:l.extend(d||{}),r?(r.model=c,r.view=d,r.isType=h||r.isType):(n.id=t,n.model=c,n.view=d,n.isType=h||function(e){if(e&&e.type==t)return!0},this.getTypes().unshift(n))}}}),e("skylark-grapejs/style_manager/model/Property",["skylark-langx/langx","skylark-backbone","skylark-underscore","../../utils/mixins"],function(e,t,s,i){"use strict";const n=t.Model.extend({defaults:{name:"",property:"",type:"",defaults:"",info:"",value:"",icon:"",functionName:"",status:"",visible:!0,fixedValues:["initial","inherit"],full:0,important:0,toRequire:0,requires:null,requiresParent:null},initialize(e={},t={}){const s=this.get("id")||"",r=this.get("name")||"";!this.get("property")&&this.set("property",(r||s).replace(/ /g,"-"));const o=this.get("property");!this.get("id")&&this.set("id",o),!r&&this.set("name",i.capitalize(o).replace(/-/g," ")),n.callInit(this,e,t)},init(){},clearValue(e={}){return this.set({value:void 0,status:""},e),this},setValue(t,s=1,i={}){const n=this.parseValue(t);this.set(n,e.mixin({},i,{avoidStore:!s}))},setValueFromInput(t,s,i={}){this.setValue(t,s,e.mixin({},i,{fromInput:1}))},parseValue(e,t={}){const i={value:e},n="!important";if(s.isString(e)&&-1!==e.indexOf(n)&&(i.value=e.replace(n,"").trim(),i.important=1),!this.get("functionName")&&!t.complete)return i;const r=[];let o=`${i.value}`,a=o.indexOf("(")+1,l=o.lastIndexOf(")");const c=o.substring(0,a-1);if(c&&(i.functionName=c),r.push(a),l>=0&&r.push(l),i.value=String.prototype.substring.apply(o,r),t.numeric){const e=parseFloat(i.value);i.unit=i.value.replace(e,""),i.value=e}return i},splitValues(e,t=","){const s=[];let i="",n=0;return(e||"").split("").forEach(e=>{"("==e?(n++,i+="("):")"==e&&n>0?(n--,i+=")"):e===t&&0==n?(s.push(i),i=""):i+=e}),""!==i&&s.push(i),s.map(e=>e.trim())},getDefaultValue(){return this.get("defaults")},getFullValue(e){const t=this.get("functionName"),i=this.getDefaultValue();let n=s.isUndefined(e)?this.get("value"):e;const r=!s.isUndefined(n)&&""!==n;return n&&i&&n===i?i:(t&&r&&(n=`${t}(${n})`),r&&this.get("important")&&(n=`${n} !important`),n||"")}},{callParentInit(t,s,i,n={}){t.prototype.initialize.apply(s,[i,e.mixin({},n,{skipInit:1})])},callInit(e,t,s={}){!s.skipInit&&e.init(t,s)}});return n}),e("skylark-grapejs/style_manager/model/PropertyComposite",["skylark-langx/langx","./Property"],function(e,t){"use strict";var s=t.extend({defaults:{...t.prototype.defaults,detached:0,properties:[],separator:" "},initialize(e={},i={}){t.callParentInit(t,this,e,i);const n=this.get("properties")||[];this.set("properties",new s.Properties(n)),this.listenTo(this,"change:value",this.updateValues),t.callInit(this,e,i)},clearValue(e={}){return this.get("properties").each(e=>e.clearValue()),t.prototype.clearValue.apply(this,arguments)},updateValues(){const e=this.getFullValue().split(this.getSplitSeparator());this.get("properties").each((t,s)=>{const i=e.length;e[s]||e[s%i+(1!=i&&i%2?1:0)]})},getSplitSeparator(){return new RegExp(`${this.get("separator")}(?![^\\(]*\\))`)},getDefaultValue(e){let t=this.get("defaults");if(t&&!e)return t;t="";const s=this.get("properties");return s.each((e,s)=>t+=`${e.getDefaultValue()} `),t.trim()},getFullValue(){return this.get("detached")?"":this.get("properties").getFullValue()},getPropertyAt(e){return this.get("properties").at(e)}});return s}),e("skylark-grapejs/style_manager/model/Layer",["skylark-backbone"],function(e){"use strict";var t=e.Model.extend({defaults:{index:"",value:"",values:{},active:!1,preview:!1,properties:[]},initialize(){const e=this.get("properties");var s=this.get("value");this.set("properties",e instanceof t.Properties?e:new t.Properties(e));const i=this.get("properties");if(i.forEach(this.onPropAdd,this),this.listenTo(i,"add",this.onPropAdd),!s){var n="",r=this.get("values");for(var o in r)n+=" "+r[o];this.set("value",n.trim())}},onPropAdd(e){const t=this.collection;e.parent=t&&t.property},getPropertyAt(e){return this.get("properties").at(e)},getPropertyValue(e){let t="";return this.get("properties").each(s=>{s.get("property")==e&&(t=s.getFullValue())}),t},getFullValue(){let e=[];return this.get("properties").each(t=>e.push(t.getFullValue())),e.join(" ").trim()}});return t}),e("skylark-grapejs/style_manager/model/Layers",["skylark-underscore","skylark-backbone","./Layer"],function(e,t,s){"use strict";return t.Collection.extend({model:s,initialize(){this.idx=1,this.on("add",this.onAdd),this.on("reset",this.onReset)},onAdd(e,t,s){s.noIncrement||e.set("index",this.idx++),s.active&&this.active(this.indexOf(e))},onReset(){this.idx=1},getSeparator(){const{property:e}=this;return e?e.get("layerSeparator"):", "},getLayersFromValue(e){const t=[];e.replace(/\(([\w\s,.]*)\)/g,t=>{var s=t.replace(/,\s*/g,",");e=e.replace(t,s)});const s=e?e.split(this.getSeparator()):[];return s.forEach(e=>{t.push({properties:this.properties.parseValue(e)})}),t},getLayersFromStyle(e){const t=[],s=this.properties;s.pluck("property");return s.each(s=>{const i=e[s.get("property")],n=i?i.split(", "):[];n.forEach((e,i)=>{e=s.parseValue(e.trim()).value;const n=t[i],r={...s.attributes,...{value:e}};n?n.properties.push(r):t[i]={properties:[r]}})}),t.forEach(e=>{const t=e.properties.map(e=>e.property);s.each(s=>{const i=s.get("property");t.indexOf(i)<0&&e.properties.push({...s.attributes})})}),t},active(e){this.each(e=>e.set("active",0));const t=this.at(e);t&&t.set("active",1)},getFullValue(){let e=[];return this.each(t=>e.push(t.getFullValue())),e.join(this.getSeparator())},getPropertyValues(t,s){const i=[];return this.each(n=>{const r=n.getPropertyValue(t);r?i.push(r):!e.isUndefined(s)&&i.push(s)}),i.join(", ")}})}),e("skylark-grapejs/style_manager/model/PropertyStack",["skylark-langx/langx","./PropertyComposite","./Layers"],function(e,t,s){"use strict";return t.extend({defaults:{...t.prototype.defaults,layers:[],layerSeparator:", ",prepend:0,preview:0},initialize(e={},i={}){t.callParentInit(t,this,e,i);const n=this.get("layers"),r=new s(n);r.property=this,r.properties=this.get("properties"),this.set("layers",r),t.callInit(this,e,i)},getLayers(){return this.get("layers")},getCurrentLayer(){return this.getLayers().filter(e=>e.get("active"))[0]},getFullValue(){return this.get("detached")?"":this.get("layers").getFullValue()},getValueFromStyle(e={}){const t=this.getLayers().getLayersFromStyle(e);return new s(t).getFullValue()},clearValue(){return this.getLayers().reset(),t.prototype.clearValue.apply(this,arguments)},getLayersFromTarget(e){}})}),e("skylark-grapejs/utils/dom",["skylark-underscore"],function(e){"use strict";const t=(t,s,i)=>{const{childNodes:n}=t,r=n.length,o=e.isUndefined(i)?r:i;e.isString(s)&&(t.insertAdjacentHTML("beforeEnd",s),s=t.lastChild,t.removeChild(s)),o>=r?t.appendChild(s):t.insertBefore(s,n[o])};return{motionsEv:"transitionend oTransitionEnd transitionend webkitTransitionEnd",empty:e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},replaceWith:(e,t)=>{e.parentNode.replaceChild(t,e)},appendAtIndex:t,append:(e,s)=>t(e,s),createEl:(t,s="",i)=>{const n=document.createElement(t);s&&e.each(s,(e,t)=>n.setAttribute(t,e)),i&&(e.isString(i)?n.innerHTML=i:n.appendChild(i));return n},createCustomEvent:(e,t)=>{let s;try{s=new window[t](e.type,e)}catch(e){(s=document.createEvent(t)).initEvent(e.type,!0,!0)}return s.keyCodeVal=e.keyCode,s._parentEvent=e,["keyCode","which"].forEach(e=>{Object.defineProperty(s,e,{get(){return this.keyCodeVal}})}),s},appendVNodes:(t,s=[])=>{(Array.isArray(s)?s:[s]).forEach(s=>{const i=s.tag||"div",n=s.attributes||{},r=document.createElement(i);e.each(n,(e,t)=>{r.setAttribute(t,e)}),t.appendChild(r)})}}}),e("skylark-grapejs/style_manager/view/PropertiesView",["skylark-backbone","../../utils/dom"],function(e,t){"use strict";return e.View.extend({initialize(e){this.config=e.config||{},this.pfx=this.config.stylePrefix||"",this.target=e.target||{},this.propTarget=e.propTarget||{},this.onChange=e.onChange,this.onInputRender=e.onInputRender||{},this.customValue=e.customValue||{},this.properties=[];const t=this.collection;this.listenTo(t,"add",this.addTo),this.listenTo(t,"reset",this.render)},addTo(e,t,s){this.add(e,null,s)},add(e,s,i={}){const n=s||this.el,r=new e.typeView({model:e,name:e.get("name"),id:this.pfx+e.get("property"),target:this.target,propTarget:this.propTarget,onChange:this.onChange,onInputRender:this.onInputRender,config:this.config});"composite"!=e.get("type")&&(r.customValue=this.customValue),r.render();const o=r.el;this.properties.push(r),r.updateVisibility(),t.appendAtIndex(n,o,i.at)},render(){const{$el:e}=this;this.properties=[];const t=document.createDocumentFragment();return this.collection.each(e=>this.add(e,t)),e.empty(),e.append(t),e.attr("class",`${this.pfx}properties`),this}})}),e("skylark-grapejs/style_manager/view/PropertyView",["skylark-backbone","skylark-underscore","../../utils/mixins"],function(e,t,s){"use strict";return e.View.extend({template(e){const t=this.pfx;return`\n      <div class="${t}label">\n        ${this.templateLabel(e)}\n      </div>\n      <div class="${this.ppfx}fields">\n        ${this.templateInput(e)}\n      </div>\n    `},templateLabel(e){const{pfx:t,em:s}=this,{parent:i}=e,{icon:n="",info:r="",id:o,name:a}=e.attributes,l=s&&s.t(`styleManager.properties.${o}`)||a;return`\n      <span class="${t}icon ${n}" title="${r}">\n        ${l}\n      </span>\n      ${i?"":`<b class="${t}clear" data-clear-style>&Cross;</b>`}\n    `},templateInput(e){return`\n      <div class="${this.ppfx}field">\n        <input placeholder="${e.getDefaultValue()}"/>\n      </div>\n    `},events:{change:"inputValueChanged","click [data-clear-style]":"clear"},initialize(e={}){t.bindAll(this,"targetUpdated"),this.config=e.config||{};const s=this.config.em;this.em=s,this.pfx=this.config.stylePrefix||"",this.ppfx=this.config.pStylePrefix||"",this.target=e.target||{},this.propTarget=e.propTarget||{},this.onChange=e.onChange,this.onInputRender=e.onInputRender||{},this.customValue=e.customValue||{};const i=this.model;this.property=i.get("property"),this.input=null;const n=this.pfx;this.inputHolderId="#"+n+"input-holder",this.sector=i.collection&&i.collection.sector,i.view=this,i.get("value")||i.set("value",i.getDefaultValue()),s&&s.on(`update:component:style:${this.property}`,this.targetUpdated);const r=i.get("requires");r&&Object.keys(r).forEach(e=>{s&&s.on(`component:styleUpdate:${e}`,this.targetUpdated)}),this.listenTo(this.propTarget,"update styleManager:update",this.targetUpdated),this.listenTo(i,"destroy remove",this.remove),this.listenTo(i,"change:value",this.modelValueChanged),this.listenTo(i,"targetUpdated",this.targetUpdated),this.listenTo(i,"change:visible",this.updateVisibility),this.listenTo(i,"change:status",this.updateStatus),this.listenTo(i,"change:name change:className change:full",this.render);const o=this.init&&this.init.bind(this);o&&o()},updateStatus(){const{model:e}=this,t=e.get("status"),s=e.parent,i=this.pfx,n=this.ppfx,r=this.config,o=`${n}four-color`,a=`${n}color-warn`,l=this.$el.children(`.${i}label`),c=this.getClearEl(),d=c?c.style:{};switch(l.removeClass(`${o} ${a}`),d.display="none",t){case"updated":!s&&l.addClass(o),r.clearProperties&&(d.display="inline");break;case"computed":l.addClass(a)}},clear(e){e&&e.stopPropagation(),this.model.clearValue(),setTimeout(()=>this.targetUpdated())},getClearEl(){return this.clearEl||(this.clearEl=this.el.querySelector("[data-clear-style]")),this.clearEl},getTarget(){return this.getTargetModel()},getTargets(){const{targets:e}=this.propTarget;return e||[this.getTarget()]},getTargetModel(){return this.propTarget&&this.propTarget.model},getHelperModel(){return this.propTarget&&this.propTarget.helper},inputValueChanged(e){e&&e.stopPropagation(),this.model.setValue(this.getInputValue(),1,{fromInput:1}),this.elementUpdated()},elementUpdated(){this.setStatus("updated")},setStatus(e){this.model.set("status",e);const t=this.model.parent;t&&"updated"==e&&t.set("status",e)},emitUpdateTarget:t.debounce(function(){const e=this.config.em;e&&e.trigger("styleManager:update:target",this.getTarget())}),_getTargetData(){const{model:e,config:t}=this,s=this.getTargetValue({ignoreDefault:1}),i=e.getDefaultValue(),n=this.getComputedValue();let r="",o="";return s?(r=s,t.highlightChanged&&(o="updated")):n&&t.showComputed&&n!=i?(r=n,t.highlightComputed&&(o="computed")):(r=i,o=""),{value:r,status:o,targetValue:s,defaultValue:i,computedValue:n}},targetUpdated(e,t,s={}){if(this.emitUpdateTarget(),!this.checkVisibility())return;const i=this.config,n=i.em,{model:r}=this,o=r.get("property"),a=this._getTargetData();if(this.setStatus(a.status),r.setValue(a.value,0,{fromTarget:1,...s}),n){const e={...a};n.trigger("styleManager:change",this,o,a.value,e),n.trigger(`styleManager:change:${o}`,this,a.value,e),this._emitUpdate(e)}},_emitUpdate(e={}){const{em:t,model:s}=this;if(!t)return;const i=s.get("property"),n={...this._getEventData(),...e},{id:r}=n;t.trigger("style:update",n),t.trigger(`style:update:${i}`,n),i!==r&&t.trigger(`style:update:${r}`,n)},_getEventData(){const{model:e}=this;return{propertyView:this,targets:this.getTargets(),value:e.getFullValue(),property:e,id:e.get("id"),name:e.get("property")}},checkVisibility(){var e=1;return this.config.hideNotStylable&&(this.isTargetStylable()&&this.isComponentStylable()?this.show():(this.hide(),e=0),this.sector&&this.sector.trigger("updateVisibility")),e},getTargetValue(e={}){let t;const{model:s}=this,i=this.getTargetModel(),n=this.customValue;if(!i)return t;if((t=i.getStyle()[s.get("property")])||e.ignoreDefault||(t=s.getDefaultValue()),"function"==typeof n&&!e.ignoreCustomValue){let e=s.collection.indexOf(s),i=n(this,e,t);i&&(t=i)}return t},getComputedValue(){const e=this.propTarget,t=e.computed||{},i=e.computedDefault||{},n=this.config.avoidComputed||[],r=this.model.get("property"),o=n.indexOf(r)<0,a=t[r],l=i[s.camelCase(r)];return t&&o&&l!==a&&a||""},getInputValue(){const e=this.getInputEl();return e?e.value:""},modelValueChanged(e,t,s={}){const i=this.model,n=i.getFullValue();s.fromInput||this.setValue(n),this.getTargets().forEach(e=>this.__updateTarget(e,s))},__updateTarget(e,t={}){const{model:s}=this,{em:i}=this.config,n=s.get("property"),r=s.getFullValue(),o=this.onChange;if(!e||!this.isTargetStylable(e)||!this.isComponentStylable())return;t.fromTarget||(o&&!t.fromParent?o(e,this,t):this.updateTargetStyle(r,null,{...t,target:e}));const a=i&&i.getSelected();i&&a&&(!t.noEmit&&i.trigger("component:update",a),i.trigger("component:styleUpdate",a,n),i.trigger(`component:styleUpdate:${n}`,a)),this._emitUpdate()},updateTargetStyle(e,t="",s={}){const i=t||this.model.get("property"),n=s.target||this.getTarget(),r=n.getStyle();e?r[i]=e:delete r[i],n.setStyle(r,s);const o=this.getHelperModel();o&&o.setStyle(r,s)},isTargetStylable(e){const s=e||this.getTarget(),i=this.model,n=i.get("id"),r=i.get("property"),o=i.get("toRequire"),a=s.get("unstylable"),l=s.get("stylable-require"),c=i.get("requires"),d=i.get("requiresParent"),h=this.sector?this.sector.collection:null,p=this.em?this.em.getSelected():null;let g=s.get("stylable");if(t.isArray(g)&&(g=g.indexOf(r)>=0),t.isArray(a)&&(g=a.indexOf(r)<0),o&&(g=!e||l&&(l.indexOf(n)>=0||l.indexOf(r)>=0)),h&&c){const e=Object.keys(c);h.each(s=>{s.get("properties").each(s=>{if(t.includes(e,s.id)){const e=c[s.id];g=g&&t.includes(e,s.get("value"))}})})}if(d){const e=p&&p.parent(),s=e&&e.getEl();if(s){const e=window.getComputedStyle(s);t.each(d,(s,i)=>{g=g&&e[i]&&t.includes(s,e[i])})}else g=!1}return g},isComponentStylable(){const e=this.em,t=e&&e.getSelected();return!t||this.isTargetStylable(t)},setRawValue(e){this.setValue(this.model.parseValue(e))},setValue(e){const s=this.model;let i=t.isUndefined(e)?s.getDefaultValue():e;const n=this.getInputEl();n&&(n.value=i)},getInputEl(){return this.input||(this.input=this.el.querySelector("input")),this.input},updateVisibility(){this.el.style.display=this.model.get("visible")?"block":"none"},show(){this.model.set("visible",1)},hide(){this.model.set("visible",0)},cleanValue(){this.setValue("")},clearCached(){this.clearEl=null,this.input=null,this.$input=null},render(){this.clearCached();const e=this.pfx,t=this.model,s=this.el,i=t.get("property"),n=t.get("full"),r=t.get("className")||"",o=`${e}property`;s.innerHTML=this.template(t),s.className=`${o} ${e}${t.get("type")} ${o}__${i} ${r}`.trim(),s.className+=n?` ${o}--full`:"",this.updateStatus();const a=this.onRender&&this.onRender.bind(this);a&&a(),this.setValue(t.get("value"),{targetUpdate:1})}})}),e("skylark-grapejs/style_manager/view/PropertyCompositeView",["skylark-backbone","./PropertyView","./PropertiesView"],function(e,t,s){"use strict";const i=e.$;return t.extend({templateInput(){const e=this.pfx;return`\n      <div class="${e}field ${e}composite">\n        <span id="${e}input-holder"></span>\n      </div>\n    `},inputValueChanged(...e){this.model.get("detached")||t.prototype.inputValueChanged.apply(this,e)},clear(e){const s=this.properties;s&&s.forEach(e=>e.clear()),t.prototype.clear.apply(this,arguments)},onRender(){var e=this.model,t=e.get("properties")||[];if(this.properties=[],t.length&&(this.$input||(this.$input=i('<input type="hidden" value="0">'),this.input=this.$input.get(0)),this.props||(this.props=e.get("properties")),!this.$props)){this.props.each(function(t,s){t&&"composite"==t.get("type")&&(this.props.remove(t),console.warn("Nested composite types not yet allowed.")),t.parent=e},this);var n=new s(this.getPropsConfig());this.$props=n.render().$el,this.properties=n.properties,this.$el.find(`#${this.pfx}input-holder`).append(this.$props)}},getPropsConfig(e){var t=this;const s=this.model;var i={config:{...this.config,highlightComputed:0},collection:this.props,target:this.target,propTarget:this.propTarget,onChange(e,t,i){s.set("value",s.getFullValue(),i)},customValue:(e,s)=>t.valueOnIndex(s,e)};return s.get("detached")&&delete i.onChange,i},valueOnIndex(e,t){let s;const i=this.getTargetValue({ignoreDefault:1});if(i){const t=i.split(this.model.getSplitSeparator());s=t[e]}else s=t&&t.getTargetValue({ignoreCustomValue:1,ignoreDefault:1});return s},clearCached(){t.prototype.clearCached.apply(this,arguments),this.$input=null,this.props=null,this.$props=null}})}),e("skylark-grapejs/style_manager/view/LayerView",["skylark-underscore","skylark-backbone","./PropertiesView"],function(e,t,s){"use strict";return t.View.extend({events:{click:"active","click [data-close-layer]":"remove","mousedown [data-move-layer]":"initSorter","touchstart [data-move-layer]":"initSorter"},template(e){const{pfx:t,ppfx:s,em:i}=this,n=`${i&&i.t("styleManager.layer")} ${e.get("index")}`;return`\n      <div id="${t}move" class="${s}no-touch-actions" data-move-layer>\n        <i class="fa fa-arrows"></i>\n      </div>\n      <div id="${t}label">${n}</div>\n      <div id="${t}preview-box">\n      \t<div id="${t}preview" data-preview></div>\n      </div>\n      <div id="${t}close-layer" class="${t}btn-close" data-close-layer>\n        &Cross;\n      </div>\n      <div id="${t}inputs" data-properties></div>\n      <div style="clear:both"></div>\n    `},initialize(e={}){let t=this.model;this.stackModel=e.stackModel,this.config=e.config||{},this.em=this.config.em,this.pfx=this.config.stylePrefix||"",this.ppfx=this.config.pStylePrefix||"",this.sorter=e.sorter||null,this.propsConfig=e.propsConfig||{},this.customPreview=e.onPreview,this.listenTo(t,"destroy remove",this.remove),this.listenTo(t,"change:active",this.updateVisibility),this.listenTo(t.get("properties"),"change",this.updatePreview),t.view=this,t.set({droppable:0,draggable:1}),this.$el.data("model",t)},initSorter(e){this.sorter&&this.sorter.startSort(this.el)},remove(e){e&&e.stopPropagation&&e.stopPropagation();const s=this.model,i=s.collection,n=this.stackModel;t.View.prototype.remove.apply(this,arguments),i.contains(s)&&i.remove(s),n&&n.set&&(n.set({stackIndex:null},{silent:!0}),n.trigger("updateValue"))},onPreview(e){const{stackModel:t}=this,s=t&&t.get("detached"),i=e.split(" "),n=[],r={};return this.model.get("properties").each((e,t)=>{const o=e.get("property");let a=s?e.getFullValue():i[t]||"";if(a&&"integer"==e.get("type")){let e=parseInt(a,10),t=a.replace(e,"");e=isNaN(e)?0:e,a=(e=(e=e>3?3:e)<-3?-3:e)+t}n.push(a),r[o]=a}),s?r:n.join(" ")},updatePreview(){const t=this.stackModel,s=this.customPreview,i=this.getPreviewEl(),n=this.model.getFullValue(),r=s?s(n):this.onPreview(n);if(r&&t&&i){const{style:s}=i;if(e.isString(r))s[t.get("property")]=r;else{let t=[];e.each(r,(e,s)=>t.push(`${s}:${e}`)),i.setAttribute("style",t.join(";"))}}},getPropertiesWrapper(){return this.propsWrapEl||(this.propsWrapEl=this.el.querySelector("[data-properties]")),this.propsWrapEl},getPreviewEl(){return this.previewEl||(this.previewEl=this.el.querySelector("[data-preview]")),this.previewEl},active(){const e=this.model,t=e.collection;t.active(t.indexOf(e))},updateVisibility(){const e=this.pfx,t=this.getPropertiesWrapper(),s=this.model.get("active");t.style.display=s?"":"none",this.$el[s?"addClass":"removeClass"](`${e}active`)},render(){const e=this.propsConfig,{model:t,el:i,pfx:n}=this,r=t.get("preview"),o=new s({collection:t.get("properties"),config:this.config,target:e.target,customValue:e.customValue,propTarget:e.propTarget,onChange:e.onChange}).render().el;return i.innerHTML=this.template(t),i.className=`${n}layer${r?"":` ${n}no-preview`}`,this.getPropertiesWrapper().appendChild(o),this.updateVisibility(),this.updatePreview(),this}})}),e("skylark-grapejs/style_manager/view/LayersView",["skylark-backbone","./LayerView"],function(e,t){"use strict";return e.View.extend({initialize(e){this.config=e.config||{},this.stackModel=e.stackModel,this.preview=e.preview,this.pfx=this.config.stylePrefix||"",this.ppfx=this.config.pStylePrefix||"",this.propsConfig=e.propsConfig;let t=this.pfx,s=this.ppfx,i=this.collection;this.className=`${t}layers ${s}field`,this.listenTo(i,"add",this.addTo),this.listenTo(i,"deselectAll",this.deselectAll),this.listenTo(i,"reset",this.render);var n=this.config.em||"",r=n?n.get("Utils"):"";this.sorter=r?new r.Sorter({container:this.el,ignoreViewChildren:1,containerSel:`.${t}layers`,itemSel:`.${t}layer`,pfx:this.config.pStylePrefix}):"",i.view=this,this.$el.data("model",i),this.$el.data("collection",i)},addTo(e){var t=this.collection.indexOf(e);this.addToCollection(e,null,t)},addToCollection(e,s,i){var n=s||null;const r=this.stackModel,o=this.config,a=this.sorter,l=this.propsConfig;void 0!==this.preview&&e.set("preview",this.preview);var c=new t({model:e,config:o,sorter:a,stackModel:r,propsConfig:l}),d=c.render().el;if(n)n.appendChild(d);else if(void 0!==i){var h="before";this.$el.children().length==i&&(i--,h="after"),i<0?this.$el.append(d):this.$el.children().eq(i)[h](d)}else this.$el.append(d);return d},deselectAll(){this.$el.find("."+this.pfx+"layer").removeClass(this.pfx+"active")},render(){var e=document.createDocumentFragment();return this.$el.empty(),this.collection.each(function(t){this.addToCollection(t,e)},this),this.$el.append(e),this.$el.attr("class",this.className),this.sorter&&(this.sorter.plh=null),this}})}),e("skylark-grapejs/code_manager/model/CssGenerator",["skylark-backbone","skylark-underscore"],function(e,t){"use strict";const s=Number.MAX_VALUE;return e.Model.extend({initialize(){this.compCls=[],this.ids=[]},buildFromModel(e,t={}){let s="";const i=this.em,n=i&&i.getConfig("avoidInlineStyle"),r=e.styleToString(),o=e.get("classes"),a=t.wrapperIsBody,l=e.get("wrapper");if(this.ids.push(`#${e.getId()}`),o.each(e=>this.compCls.push(e.getFullName())),!n&&r){let t=`#${e.getId()}`;s=`${t=a&&l?"body":t}{${r}}`}const c=e.components();return c.each(e=>s+=this.buildFromModel(e,t)),s},build(e,s={}){const i=s.cssc,n=s.em||"";this.em=n,this.compCls=[],this.ids=[];var r=this.buildFromModel(e,s);const o=t.isUndefined(s.clearStyles)&&n?n.getConfig("clearStyles"):s.clearStyles;if(i){const e=i.getAll(),t={},a=[];e.each(e=>{const i=e.getAtRule();if(i){const s=t[i];s?s.push(e):t[i]=[e]}else r+=this.buildFromRule(e,a,s)}),this.sortMediaObject(t).forEach(e=>{let t="";const i=e.key,n=e.value;n.forEach(e=>{const n=this.buildFromRule(e,a,s);e.get("singleAtRule")?r+=`${i}{${n}}`:t+=n}),t&&(r+=`${i}{${t}}`)}),n&&o&&e.remove(a)}return r},buildFromRule(e,t,s={}){let i="";const n=e.selectorsToString({skipAdd:1}),r=e.get("selectorsAdd"),o=e.get("singleAtRule");let a;if(e.get("selectors").each(e=>{const t=e.getFullName();(this.compCls.indexOf(t)>=0||this.ids.indexOf(t)>=0||s.keepUnusedStyles)&&(a=1)}),n&&a||r||o){const t=e.getDeclaration();t&&(i+=t)}else t.push(e);return i},getQueryLength(e){const t=/(-?\d*\.?\d+)\w{0,}/.exec(e);return t?parseFloat(t[1]):s},sortMediaObject(e={}){const s=[];return t.each(e,(e,t)=>s.push({key:t,value:e})),s.sort((e,t)=>{const s=[e.key,t.key].every(e=>-1!==e.indexOf("min-width")),i=s?e.key:t.key,n=s?t.key:e.key;return this.getQueryLength(i)-this.getQueryLength(n)})}})}),e("skylark-grapejs/style_manager/view/PropertyStackView",["skylark-underscore","./PropertiesView","./PropertyCompositeView","./LayersView","../../code_manager/model/CssGenerator"],function(e,t,s,i,n){"use strict";const r=new n;return s.extend({templateInput(){const e=this.pfx;this.ppfx;return`\n      <div class="${e}field ${e}stack">\n        <button type="button" id="${e}add" data-add-layer>+</button>\n        <div data-layers-wrapper></div>\n      </div>\n    `},init(){const e=this.model;this.pfx;e.set("stackIndex",null),this.events["click [data-add-layer]"]="addLayer",this.listenTo(e,"change:stackIndex",this.indexChanged),this.listenTo(e,"updateValue",this.inputValueChanged),this.delegateEvents()},targetUpdated(...e){if(this.model.get("detached")){const{status:e}=this._getTargetData();this.setStatus(e),this.checkVisibility()}else s.prototype.targetUpdated.apply(this,e);this.refreshLayers()},getLayers(){return this.model.get("layers")},indexChanged(e){const t=this.model;this.getLayers().active(t.get("stackIndex"))},addLayer(){const e=this.model,t=this.getLayers(),s=e.get("prepend"),i=e.get("properties").deepClone();i.each(e=>e.set("value",""));const n=t.add({properties:i},{active:1,...s&&{at:0}});this.inputValueChanged(),e.set("stackIndex",t.indexOf(n))},inputValueChanged(){const e=this.model;this.elementUpdated(),e.get("detached")?e.get("properties").each(e=>e.trigger("change:value")):e.set("value",this.getLayerValues())},setValue(){},getLayerValues(){return this.getLayers().getFullValue()},_getClassRule(e={}){const{em:t}=this,{skipAdd:s=1}=e,i=t.getSelected(),n=t.get("StyleManager").getModelToStyle(i,{skipAdd:s,useClasses:1});return n!==i&&n},_getParentTarget(e,t={}){const{em:s,model:i}=this,n=i.get("property"),o=t.isValid||(e=>e.getStyle()[n]),a=s.get("CssComposer").getAll().filter(t=>t.selectorsToString()===e.getSelectorsString()),l=a.reduce((e,t)=>(e[t.getAtRule()]=t,e),{}),c=r.sortMediaObject(l),d=c.map(e=>e.value),h=d.indexOf(e),p=d.splice(0,h);let g;for(let e=p.length-1;e>-1;e--){const t=p[e];if(o(t)){g=t;break}}return g},refreshLayers(){let t=[];const{model:s,em:i}=this,n=this.getLayers(),r=s.get("detached"),o=s.get("property"),a=this.getTarget(),l=this.getComputedValue(),c=i.getSelected();let d,h,p,g,u,m;if(r){h=a?a.getStyle():{};const i=t=>{const i=s.get("properties").at(0).get("property");return t&&!e.isUndefined(t.getStyle()[i])};if(!e.keys(h).length&&l&&c){const e={isValid:e=>i(e)};(g=this._getParentTarget(a,e))?h=g.getStyle():(p=this._getClassRule(),u=i(p)&&p.getStyle(),g=!u&&this._getParentTarget(this._getClassRule({skipAdd:0}),e),m=i(g)&&g.getStyle(),h=u||m||{})}d=h,t=n.getLayersFromStyle(h)}else{const e=this.getTargetValue({ignoreDefault:1});let i=e;!i&&l&&((g=this._getParentTarget(a))?i=g.getStyle()[o]:(p=this._getClassRule(),u=p&&p.getStyle()[o],g=!u&&this._getParentTarget(this._getClassRule({skipAdd:0})),m=g&&g.getStyle()[o],i=u||m||l)),i=i==s.getDefaultValue()?"":i,d=i,t=n.getLayersFromValue(i)}const f=s.getLayersFromTarget(a,{resultValue:d,layersObj:t})||t;n.reset(),n.add(f),s.set({stackIndex:null},{silent:!0})},getTargetValue(t={}){let i=s.prototype.getTargetValue.call(this,t);const{detached:n}=this.model.attributes;return e.isUndefined(i)&&!n&&(i=this.model.getValueFromStyle(this.getTarget().getStyle())),i},onRender(){const e=this,s=this.model,n=this.el.querySelector("[data-layers-wrapper]"),r={target:this.target,propTarget:this.propTarget,onChange(t,i,n){const r=i.model;if(s.get("detached")){const t=r.get("property"),s=r.getDefaultValue(),o=e.getLayers().getPropertyValues(t,s);i.updateTargetStyle(o,null,n)}else if("updated"==s.get("status")){const e=s.getFullValue();s.set("value",e,n),!e&&i.updateTargetStyle(e,null,n)}}},o=new i({collection:this.getLayers(),stackModel:s,preview:s.get("preview"),config:this.config,propsConfig:r}).render().el;new t({target:this.target,collection:this.model.get("properties"),stackModel:s,config:this.config,onChange:r.onChange,propTarget:r.propTarget}).render(),n.appendChild(o)}})}),e("skylark-grapejs/style_manager/view/PropertyFileView",["skylark-underscore","skylark-backbone","./PropertyView"],function(e,t,s){"use strict";const i=t.$;return s.extend({templateInput(){const{pfx:e,em:t}=this;return`\n    <div class="${e}field ${e}file">\n      <div id='${e}input-holder'>\n        <div class="${e}btn-c">\n          <button class="${e}btn" id="${e}images" type="button">\n            ${t.t("styleManager.fileButton")}\n          </button>\n        </div>\n        <div style="clear:both;"></div>\n      </div>\n      <div id="${e}preview-box">\n        <div id="${e}preview-file"></div>\n        <div id="${e}close">&Cross;</div>\n      </div>\n    </div>\n    `},init(){const e=this.em;this.modal=e.get("Modal"),this.am=e.get("AssetManager"),this.events["click #"+this.pfx+"close"]="removeFile",this.events["click #"+this.pfx+"images"]="openAssetManager",this.delegateEvents()},onRender(){if(!this.$input){const e=this.model.getDefaultValue();this.$input=i(`<input placeholder="${e}">`)}this.$preview||(this.$preview=this.$el.find("#"+this.pfx+"preview-file")),this.$previewBox||(this.$previewBox=this.$el.find("#"+this.pfx+"preview-box")),this.setValue(this.componentValue,0)},clearCached(){s.prototype.clearCached.apply(this,arguments),this.$preview=null,this.$previewBox=null},setValue(e,t){s.prototype.setValue.apply(this,arguments),this.setPreviewView(e&&e!=this.model.getDefaultValue()),this.setPreview(e)},setPreviewView(e){const t=this.$previewBox;t&&t[e?"addClass":"removeClass"](`${this.pfx}show`),t&&t.css({display:e?"block":"none"})},spreadUrl(e){this.model.set("value",e),this.setPreviewView(1)},setPreview(e){const t=this.$preview;e=e&&e.indexOf("url(")<0?`url(${e})`:e,t&&t.css("background-image",e)},cleanValue(){this.setPreviewView(0),this.model.set({value:""},{silent:!0})},removeFile(...e){this.model.set("value",this.model.getDefaultValue()),s.prototype.cleanValue.apply(this,e),this.setPreviewView(0)},openAssetManager(t){const{em:s,modal:i}=this,n=s?s.get("Editor"):"";n&&n.runCommand("open-assets",{types:["image"],accept:"image/*",target:this.getTargetModel(),onClick(){},onDblClick(){},onSelect:t=>{i.close();const s=e.isString(t)?t:t.get("src");this.spreadUrl(s)}})}})}),e("skylark-grapejs/style_manager/view/PropertyIntegerView",["skylark-backbone","./PropertyView"],function(e,t){"use strict";const s=e.$;return t.extend({templateInput:()=>"",init(){const e=this.model;this.listenTo(e,"change:unit",this.modelValueChanged),this.listenTo(e,"el:change",this.elementUpdated),this.listenTo(e,"change:units",this.render)},setValue(e){const t=this.model.parseValue(e);e=`${t.value}${t.unit}`,this.inputInst.setValue(e,{silent:1})},onRender(){const e=this.ppfx;if(!this.input){const t=this.model.input;t.ppfx=e,t.render();const i=this.el.querySelector(`.${e}fields`);i.appendChild(t.el),this.$input=t.inputEl,this.unit=t.unitEl,this.$unit=s(this.unit),this.input=this.$input.get(0),this.inputInst=t}},clearCached(){t.prototype.clearCached.apply(this,arguments),this.unit=null,this.$unit=null}})}),e("skylark-grapejs/utils/ColorPicker",[],function(){"use strict";return function(e,t){var s={beforeShow:d,move:d,change:d,show:d,hide:d,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},i=[],n=!!/msie/i.exec(window.navigator.userAgent),r=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),s=t.style;return s.cssText="background-color:rgba(0,0,0,.5)",e(s.backgroundColor,"rgba")||e(s.backgroundColor,"hsla")}(),o=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),a=function(){var e="";if(n)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function l(t,s,i,n){for(var o=[],a=0;a<t.length;a++){var l=t[a];if(l){var c=C(l),d=c.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";d+=C.equals(s,l)?" sp-thumb-active":"";var h=c.toString(n.preferredFormat||"rgb"),p=r?"background-color:"+c.toRgbString():"filter:"+c.toFilter();o.push('<span title="'+h+'" data-color="'+c.toRgbString()+'" class="'+d+'"><span class="sp-thumb-inner" style="'+p+';"></span></span>')}else{o.push(e("<div />").append(e('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",n.noColorSelectedText)).html())}}return"<div class='sp-cf "+i+"'>"+o.join("")+"</div>"}function c(c,d){var m,f,v,y,b=function(t,i){var n=e.extend({},s,t);return n.callbacks={move:p(n.move,i),change:p(n.change,i),show:p(n.show,i),hide:p(n.hide,i),beforeShow:p(n.beforeShow,i)},n}(d,c),k=b.flat,w=b.showSelectionPalette,x=b.localStorageKey,S=b.theme,T=b.callbacks,$=(m=Be,f=10,function(){var e=this,t=arguments;v&&clearTimeout(y),!v&&y||(y=setTimeout(function(){y=null,m.apply(e,t)},f))}),E=!1,P=!1,V=0,M=0,A=0,_=0,D=0,I=0,N=0,j=0,F=0,O=0,L=1,R=[],z=[],H={},U=b.selectionPalette.slice(0),B=b.maxSelectionSize,q="sp-dragging",W=null,G=c.ownerDocument,K=(G.body,e(c)),Y=!1,J=e(a,G).addClass(S),X=J.find(".sp-picker-container"),Z=J.find(".sp-color"),Q=J.find(".sp-dragger"),ee=J.find(".sp-hue"),te=J.find(".sp-slider"),se=J.find(".sp-alpha-inner"),ie=J.find(".sp-alpha"),ne=J.find(".sp-alpha-handle"),re=J.find(".sp-input"),oe=J.find(".sp-palette"),ae=J.find(".sp-initial"),le=J.find(".sp-cancel"),ce=J.find(".sp-clear"),de=J.find(".sp-choose"),he=J.find(".sp-palette-toggle"),pe=K.is("input"),ge=pe&&"color"===K.attr("type")&&u(),ue=pe&&!k,me=ue?e(o).addClass(S).addClass(b.className).addClass(b.replacerClassName):e([]),fe=ue?me:K,ve=me.find(".sp-preview-inner"),ye=b.color||pe&&K.val(),be=!1,ke=b.preferredFormat,we=!b.showButtons||b.clickoutFiresChange,xe=!ye,Ce=b.allowEmpty&&!ge;function Se(){if(b.showPaletteOnly&&(b.showPalette=!0),he.text(b.showPaletteOnly?b.togglePaletteMoreText:b.togglePaletteLessText),b.palette){R=b.palette.slice(0),z=e.isArray(R[0])?R:[R],H={};for(var t=0;t<z.length;t++)for(var s=0;s<z[t].length;s++){var i=C(z[t][s]).toRgbString();H[i]=!0}}J.toggleClass("sp-flat",k),J.toggleClass("sp-input-disabled",!b.showInput),J.toggleClass("sp-alpha-enabled",b.showAlpha),J.toggleClass("sp-clear-enabled",Ce),J.toggleClass("sp-buttons-disabled",!b.showButtons),J.toggleClass("sp-palette-buttons-disabled",!b.togglePaletteOnly),J.toggleClass("sp-palette-disabled",!b.showPalette),J.toggleClass("sp-palette-only",b.showPaletteOnly),J.toggleClass("sp-initial-disabled",!b.showInitial),J.addClass(b.className).addClass(b.containerClassName),Be()}function Te(){if(x&&window.localStorage){try{var t=window.localStorage[x].split(",#");t.length>1&&(delete window.localStorage[x],e.each(t,function(e,t){$e(t)}))}catch(e){}try{U=window.localStorage[x].split(";")}catch(e){}}}function $e(t){if(w){var s=C(t).toRgbString();if(!H[s]&&-1===e.inArray(s,U))for(U.push(s);U.length>B;)U.shift();if(x&&window.localStorage)try{window.localStorage[x]=U.join(";")}catch(e){}}}function Ee(){var t=Le(),s=e.map(z,function(e,s){return l(e,t,"sp-palette-row sp-palette-row-"+s,b)});Te(),U&&s.push(l(function(){var e=[];if(b.showPalette)for(var t=0;t<U.length;t++){var s=C(U[t]).toRgbString();H[s]||e.push(U[t])}return e.reverse().slice(0,b.maxSelectionSize)}(),t,"sp-palette-row sp-palette-row-selection",b)),oe.html(s.join(""))}function Pe(){if(b.showInitial){var e=be,t=Le();ae.html(l([e,t],t,"sp-palette-row-initial",b))}}function Ve(){(M<=0||V<=0||_<=0)&&Be(),P=!0,J.addClass(q),W=null,K.trigger("dragstart.spectrum",[Le()])}function Me(){P=!1,J.removeClass(q),K.trigger("dragstop.spectrum",[Le()])}function Ae(){var e=re.val();if(null!==e&&""!==e||!Ce){var t=C(e);t.isValid()?(Oe(t),Ue(!0)):re.addClass("sp-validation-error")}else Oe(null),Ue(!0)}function _e(){E?je():De()}function De(){var t=e.Event("beforeShow.spectrum");if(E)Be();else if(K.trigger("beforeShow.spectrum",[Le()]),!1!==T.beforeShow(Le())&&!t.isDefaultPrevented()){!function(){for(var e=0;e<i.length;e++)i[e]&&i[e].hide()}(),E=!0;var s=e(G);s.bind("keydown.spectrum",Ie),s.bind("click.spectrum",Ne),e(window).bind("resize.spectrum",$),me.addClass("sp-active"),J.removeClass("sp-hidden"),Be(),ze(),be=Le(),Pe(),T.show(be),K.trigger("show.spectrum",[be])}}function Ie(e){27===e.keyCode&&je()}function Ne(e){2!=e.button&&(P||(we?Ue(!0):Fe(),je()))}function je(){E&&!k&&(E=!1,e(G).unbind("keydown.spectrum",Ie),e(G).unbind("click.spectrum",Ne),e(window).unbind("resize.spectrum",$),me.removeClass("sp-active"),J.addClass("sp-hidden"),T.hide(Le()),K.trigger("hide.spectrum",[Le()]))}function Fe(){Oe(be,!0)}function Oe(e,t){var s,i;C.equals(e,Le())?ze():(!e&&Ce?xe=!0:(xe=!1,s=C(e),i=s.toHsv(),j=i.h%360/360,F=i.s,O=i.v,L=i.a),ze(),s&&s.isValid()&&!t&&(ke=b.preferredFormat||s.getFormat()))}function Le(e){return e=e||{},Ce&&xe?null:C.fromRatio({h:j,s:F,v:O,a:Math.round(100*L)/100},{format:e.format||ke})}function Re(){ze(),T.move(Le()),K.trigger("move.spectrum",[Le()])}function ze(){re.removeClass("sp-validation-error"),He();var e=C.fromRatio({h:j,s:1,v:1});Z.css("background-color",e.toHexString());var t=ke;L<1&&(0!==L||"name"!==t)&&("hex"!==t&&"hex3"!==t&&"hex6"!==t&&"name"!==t||(t="rgb"));var s=Le({format:t}),i="";if(ve.removeClass("sp-clear-display"),ve.css("background-color","transparent"),!s&&Ce)ve.addClass("sp-clear-display");else{var o=s.toHexString(),a=s.toRgbString();if(r||1===s.alpha?ve.css("background-color",a):(ve.css("background-color","transparent"),ve.css("filter",s.toFilter())),b.showAlpha){var l=s.toRgb();l.a=0;var c=C(l).toRgbString(),d="linear-gradient(left, "+c+", "+o+")";n?se.css("filter",C(c).toFilter({gradientType:1},o)):(se.css("background","-webkit-"+d),se.css("background","-moz-"+d),se.css("background","-ms-"+d),se.css("background","linear-gradient(to right, "+c+", "+o+")"))}i=s.toString(t)}b.showInput&&re.val(i),b.showPalette&&Ee(),Pe()}function He(){var e=F,t=O;if(Ce&&xe)ne.hide(),te.hide(),Q.hide();else{ne.show(),te.show(),Q.show();var s=e*V,i=M-t*M;s=Math.max(-A,Math.min(V-A,s-A)),i=Math.max(-A,Math.min(M-A,i-A)),Q.css({top:i+"px",left:s+"px"});var n=L*D;ne.css({left:n-I/2+"px"});var r=j*_;te.css({top:r-N+"px"})}}function Ue(e){var t=Le(),s="",i=!C.equals(t,be);t&&(s=t.toString(ke),$e(t)),pe&&K.val(s),e&&i&&(T.change(t),K.trigger("change",[t]))}function Be(){var t,s,i,n,r,o,a,l,c,d,h,p,g,u;E&&(V=Z.width(),M=Z.height(),A=Q.height(),ee.width(),_=ee.height(),N=te.height(),D=ie.width(),I=ne.width(),k||(J.css("position","absolute"),b.offset?J.offset(b.offset):J.offset((s=fe,i=(t=J).outerWidth(),n=t.outerHeight(),r=s.outerHeight(),o=t[0].ownerDocument,a=o.documentElement,l=a.clientWidth,c=a.clientHeight,d=e(o).scrollLeft(),h=e(o).scrollTop(),p=l+d,g=c+h,(u=s.offset()).top+=r,u.left-=Math.min(u.left,u.left+i>p&&p>i?Math.abs(u.left+i-p):0),u.top-=Math.min(u.top,u.top+n>g&&g>n?Math.abs(n+r-0):0),u))),He(),b.showPalette&&Ee(),K.trigger("reflow.spectrum"))}function qe(){je(),Y=!0,K.attr("disabled",!0),fe.addClass("sp-disabled")}!function(){n&&J.find("*:not(input)").attr("unselectable","on");Se(),ue&&K.after(me).hide();Ce||ce.hide();if(k)K.after(J).hide();else{var t="parent"===b.appendTo?K.parent():e(b.appendTo);1!==t.length&&(t=e("body")),t.append(J)}Te(),fe.bind("click.spectrum touchstart.spectrum",function(t){Y||_e(),t.stopPropagation(),e(t.target).is("input")||t.preventDefault()}),(K.is(":disabled")||!0===b.disabled)&&qe();J.click(h),re.change(Ae),re.bind("paste",function(){setTimeout(Ae,1)}),re.keydown(function(e){13==e.keyCode&&Ae()}),le.text(b.cancelText),le.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Fe(),je()}),ce.attr("title",b.clearText),ce.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),xe=!0,Re(),k&&Ue(!0)}),de.text(b.chooseText),de.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),n&&re.is(":focus")&&re.trigger("change"),re.hasClass("sp-validation-error")||(Ue(!0),je())}),he.text(b.showPaletteOnly?b.togglePaletteMoreText:b.togglePaletteLessText),he.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),b.showPaletteOnly=!b.showPaletteOnly,b.showPaletteOnly||k||J.css("left","-="+(X.outerWidth(!0)+5)),Se()}),g(ie,function(e,t,s){L=e/D,xe=!1,s.shiftKey&&(L=Math.round(10*L)/10),Re()},Ve,Me),g(ee,function(e,t){j=parseFloat(t/_),xe=!1,b.showAlpha||(L=1),Re()},Ve,Me),g(Z,function(e,t,s){if(s.shiftKey){if(!W){var i=F*V,n=M-O*M,r=Math.abs(e-i)>Math.abs(t-n);W=r?"x":"y"}}else W=null;var o=!W||"y"===W;(!W||"x"===W)&&(F=parseFloat(e/V)),o&&(O=parseFloat((M-t)/M)),xe=!1,b.showAlpha||(L=1),Re()},Ve,Me),ye?(Oe(ye),ze(),ke=b.preferredFormat||C(ye).format,$e(ye)):ze();k&&De();function s(t){return t.data&&t.data.ignore?(Oe(e(t.target).closest(".sp-thumb-el").data("color")),Re()):(Oe(e(t.target).closest(".sp-thumb-el").data("color")),Re(),Ue(!0),b.hideAfterPaletteSelect&&je()),!1}var i=n?"mousedown.spectrum":"click.spectrum touchstart.spectrum";oe.delegate(".sp-thumb-el",i,s),ae.delegate(".sp-thumb-el:nth-child(1)",i,{ignore:!0},s)}();var We={show:De,hide:je,toggle:_e,reflow:Be,option:function(s,i){if(s===t)return e.extend({},b);if(i===t)return b[s];b[s]=i,"preferredFormat"===s&&(ke=b.preferredFormat);Se()},enable:function(){Y=!1,K.attr("disabled",!1),fe.removeClass("sp-disabled")},disable:qe,offset:function(e){b.offset=e,Be()},set:function(e){Oe(e),Ue()},get:Le,destroy:function(){K.show(),fe.unbind("click.spectrum touchstart.spectrum"),J.remove(),me.remove(),i[We.id]=null},container:J};return We.id=i.push(We)-1,We}function d(){}function h(e){e.stopPropagation()}function p(e,t){var s=Array.prototype.slice,i=s.call(arguments,2);return function(){return e.apply(t,i.concat(s.call(arguments)))}}function g(t,s,i,r){s=s||function(){},i=i||function(){},r=r||function(){};var o=document,a=!1,l={},c=0,d=0,h="ontouchstart"in window,p={};function g(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function u(e){if(a){if(n&&o.documentMode<9&&!e.button)return m();var i=e&&e.touches&&e.touches[0],r=i&&i.pageX||e.pageX,p=i&&i.pageY||e.pageY,u=Math.max(0,Math.min(r-l.left,d)),f=Math.max(0,Math.min(p-l.top,c));h&&g(e),s.apply(t,[u,f,e])}}function m(){a&&(e(o).unbind(p),e(o.body).removeClass("sp-dragging"),setTimeout(function(){r.apply(t,arguments)},0)),a=!1}p.selectstart=g,p.dragstart=g,p["touchmove mousemove"]=u,p["touchend mouseup"]=m,e(t).bind("touchstart mousedown",function(s){(s.which?3==s.which:2==s.button)||a||!1!==i.apply(t,arguments)&&(a=!0,c=e(t).height(),d=e(t).width(),l=e(t).offset(),e(o).bind(p),e(o.body).addClass("sp-dragging"),u(s),g(s))})}function u(){return e.fn.spectrum.inputTypeColorSupport()}e.fn.spectrum=function(t,s){if("string"==typeof t){var n=this,r=Array.prototype.slice.call(arguments,1);return this.each(function(){var s=i[e(this).data("spectrum.id")];if(s){var o=s[t];if(!o)throw new Error("Spectrum: no such method: '"+t+"'");"get"==t?n=s.get():"container"==t?n=s.container:"option"==t?n=s.option.apply(s,r):"destroy"==t?(s.destroy(),e(this).removeData("spectrum.id")):o.apply(s,r)}}),n}return this.spectrum("destroy").each(function(){var s=e.extend({},t,e(this).data()),i=c(this,s);e(this).data("spectrum.id",i.id)})},e.fn.spectrum.load=!0,e.fn.spectrum.loadOpts={},e.fn.spectrum.draggable=g,e.fn.spectrum.defaults=s,e.fn.spectrum.inputTypeColorSupport=function t(){if(void 0===t._cachedResult){var s=e("<input type='color'/>")[0];t._cachedResult="color"===s.type&&""!==s.value}return t._cachedResult},e.spectrum={},e.spectrum.localization={},e.spectrum.palettes={},e.fn.spectrum.processNativeColorInputs=function(){var t=e("input[type=color]");t.length&&!u()&&t.spectrum({preferredFormat:"hex6"})};var m=/^[\s,#]+/,f=/\s+$/,v=0,y=Math,b=y.round,k=y.min,w=y.max,x=y.random,C=function(e,t){if(e=e||"",t=t||{},e instanceof C)return e;if(!(this instanceof C))return new C(e,t);var s=function(e){var t={r:0,g:0,b:0},s=1,i=!1,n=!1;"string"==typeof e&&(e=function(e){e=e.replace(m,"").replace(f,"").toLowerCase();var t,s=!1;if(z[e])e=z[e],s=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=Z.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=Z.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=Z.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=Z.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=Z.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=Z.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=Z.hex8.exec(e))return{a:(i=t[1],W(i)/255),r:W(t[2]),g:W(t[3]),b:W(t[4]),format:s?"name":"hex8"};var i;if(t=Z.hex6.exec(e))return{r:W(t[1]),g:W(t[2]),b:W(t[3]),format:s?"name":"hex"};if(t=Z.hex3.exec(e))return{r:W(t[1]+""+t[1]),g:W(t[2]+""+t[2]),b:W(t[3]+""+t[3]),format:s?"name":"hex"};return!1}(e));"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(r=e.r,o=e.g,a=e.b,t={r:255*B(r,255),g:255*B(o,255),b:255*B(a,255)},i=!0,n="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=K(e.s),e.v=K(e.v),t=function(e,t,s){e=6*B(e,360),t=B(t,100),s=B(s,100);var i=y.floor(e),n=e-i,r=s*(1-t),o=s*(1-n*t),a=s*(1-(1-n)*t),l=i%6;return{r:255*[s,o,r,r,a,s][l],g:255*[a,s,s,o,r,r][l],b:255*[r,r,a,s,s,o][l]}}(e.h,e.s,e.v),i=!0,n="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=K(e.s),e.l=K(e.l),t=function(e,t,s){var i,n,r;function o(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}if(e=B(e,360),t=B(t,100),s=B(s,100),0===t)i=n=r=s;else{var a=s<.5?s*(1+t):s+t-s*t,l=2*s-a;i=o(l,a,e+1/3),n=o(l,a,e),r=o(l,a,e-1/3)}return{r:255*i,g:255*n,b:255*r}}(e.h,e.s,e.l),i=!0,n="hsl"),e.hasOwnProperty("a")&&(s=e.a));var r,o,a;return s=U(s),{ok:i,format:e.format||n,r:k(255,w(t.r,0)),g:k(255,w(t.g,0)),b:k(255,w(t.b,0)),a:s}}(e);this._originalInput=e,this._r=s.r,this._g=s.g,this._b=s.b,this._a=s.a,this._roundA=b(100*this._a)/100,this._format=t.format||s.format,this._gradientType=t.gradientType,this._r<1&&(this._r=b(this._r)),this._g<1&&(this._g=b(this._g)),this._b<1&&(this._b=b(this._b)),this._ok=s.ok,this._tc_id=v++};function S(e,t,s){e=B(e,255),t=B(t,255),s=B(s,255);var i,n,r=w(e,t,s),o=k(e,t,s),a=(r+o)/2;if(r==o)i=n=0;else{var l=r-o;switch(n=a>.5?l/(2-r-o):l/(r+o),r){case e:i=(t-s)/l+(t<s?6:0);break;case t:i=(s-e)/l+2;break;case s:i=(e-t)/l+4}i/=6}return{h:i,s:n,l:a}}function T(e,t,s){e=B(e,255),t=B(t,255),s=B(s,255);var i,n,r=w(e,t,s),o=k(e,t,s),a=r,l=r-o;if(n=0===r?0:l/r,r==o)i=0;else{switch(r){case e:i=(t-s)/l+(t<s?6:0);break;case t:i=(s-e)/l+2;break;case s:i=(e-t)/l+4}i/=6}return{h:i,s:n,v:a}}function $(e,t,s,i){var n=[G(b(e).toString(16)),G(b(t).toString(16)),G(b(s).toString(16))];return i&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function E(e,t,s,i){var n,r=[G((n=i,Math.round(255*parseFloat(n)).toString(16))),G(b(e).toString(16)),G(b(t).toString(16)),G(b(s).toString(16))];return r.join("")}function P(e,t){t=0===t?0:t||10;var s=C(e).toHsl();return s.s-=t/100,s.s=q(s.s),C(s)}function V(e,t){t=0===t?0:t||10;var s=C(e).toHsl();return s.s+=t/100,s.s=q(s.s),C(s)}function M(e){return C(e).desaturate(100)}function A(e,t){t=0===t?0:t||10;var s=C(e).toHsl();return s.l+=t/100,s.l=q(s.l),C(s)}function _(e,t){t=0===t?0:t||10;var s=C(e).toRgb();return s.r=w(0,k(255,s.r-b(-t/100*255))),s.g=w(0,k(255,s.g-b(-t/100*255))),s.b=w(0,k(255,s.b-b(-t/100*255))),C(s)}function D(e,t){t=0===t?0:t||10;var s=C(e).toHsl();return s.l-=t/100,s.l=q(s.l),C(s)}function I(e,t){var s=C(e).toHsl(),i=(b(s.h)+t)%360;return s.h=i<0?360+i:i,C(s)}function N(e){var t=C(e).toHsl();return t.h=(t.h+180)%360,C(t)}function j(e){var t=C(e).toHsl(),s=t.h;return[C(e),C({h:(s+120)%360,s:t.s,l:t.l}),C({h:(s+240)%360,s:t.s,l:t.l})]}function F(e){var t=C(e).toHsl(),s=t.h;return[C(e),C({h:(s+90)%360,s:t.s,l:t.l}),C({h:(s+180)%360,s:t.s,l:t.l}),C({h:(s+270)%360,s:t.s,l:t.l})]}function O(e){var t=C(e).toHsl(),s=t.h;return[C(e),C({h:(s+72)%360,s:t.s,l:t.l}),C({h:(s+216)%360,s:t.s,l:t.l})]}function L(e,t,s){t=t||6,s=s||30;var i=C(e).toHsl(),n=360/s,r=[C(e)];for(i.h=(i.h-(n*t>>1)+720)%360;--t;)i.h=(i.h+n)%360,r.push(C(i));return r}function R(e,t){t=t||6;for(var s=C(e).toHsv(),i=s.h,n=s.s,r=s.v,o=[],a=1/t;t--;)o.push(C({h:i,s:n,v:r})),r=(r+a)%1;return o}C.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},setAlpha:function(e){return this._a=U(e),this._roundA=b(100*this._a)/100,this},toHsv:function(){var e=T(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=T(this._r,this._g,this._b),t=b(360*e.h),s=b(100*e.s),i=b(100*e.v);return 1==this._a?"hsv("+t+", "+s+"%, "+i+"%)":"hsva("+t+", "+s+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=S(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=S(this._r,this._g,this._b),t=b(360*e.h),s=b(100*e.s),i=b(100*e.l);return 1==this._a?"hsl("+t+", "+s+"%, "+i+"%)":"hsla("+t+", "+s+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return $(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return E(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:b(this._r),g:b(this._g),b:b(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+b(this._r)+", "+b(this._g)+", "+b(this._b)+")":"rgba("+b(this._r)+", "+b(this._g)+", "+b(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:b(100*B(this._r,255))+"%",g:b(100*B(this._g,255))+"%",b:b(100*B(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+b(100*B(this._r,255))+"%, "+b(100*B(this._g,255))+"%, "+b(100*B(this._b,255))+"%)":"rgba("+b(100*B(this._r,255))+"%, "+b(100*B(this._g,255))+"%, "+b(100*B(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(H[$(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+E(this._r,this._g,this._b,this._a),s=t,i=this._gradientType?"GradientType = 1, ":"";if(e){var n=C(e);s=n.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+t+",endColorstr="+s+")"},toString:function(e){var t=!!e;e=e||this._format;var s=!1,i=this._a<1&&this._a>=0,n=!t&&i&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return n?"name"===e&&0===this._a?this.toName():this.toRgbString():("rgb"===e&&(s=this.toRgbString()),"prgb"===e&&(s=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(s=this.toHexString()),"hex3"===e&&(s=this.toHexString(!0)),"hex8"===e&&(s=this.toHex8String()),"name"===e&&(s=this.toName()),"hsl"===e&&(s=this.toHslString()),"hsv"===e&&(s=this.toHsvString()),s||this.toHexString())},_applyModification:function(e,t){var s=e.apply(null,[this].concat([].slice.call(t)));return this._r=s._r,this._g=s._g,this._b=s._b,this.setAlpha(s._a),this},lighten:function(){return this._applyModification(A,arguments)},brighten:function(){return this._applyModification(_,arguments)},darken:function(){return this._applyModification(D,arguments)},desaturate:function(){return this._applyModification(P,arguments)},saturate:function(){return this._applyModification(V,arguments)},greyscale:function(){return this._applyModification(M,arguments)},spin:function(){return this._applyModification(I,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(L,arguments)},complement:function(){return this._applyCombination(N,arguments)},monochromatic:function(){return this._applyCombination(R,arguments)},splitcomplement:function(){return this._applyCombination(O,arguments)},triad:function(){return this._applyCombination(j,arguments)},tetrad:function(){return this._applyCombination(F,arguments)}},C.fromRatio=function(e,t){if("object"==typeof e){var s={};for(var i in e)e.hasOwnProperty(i)&&(s[i]="a"===i?e[i]:K(e[i]));e=s}return C(e,t)},C.equals=function(e,t){return!(!e||!t)&&C(e).toRgbString()==C(t).toRgbString()},C.random=function(){return C.fromRatio({r:x(),g:x(),b:x()})},C.mix=function(e,t,s){s=0===s?0:s||50;var i,n=C(e).toRgb(),r=C(t).toRgb(),o=s/100,a=2*o-1,l=r.a-n.a,c=1-(i=((i=a*l==-1?a:(a+l)/(1+a*l))+1)/2),d={r:r.r*i+n.r*c,g:r.g*i+n.g*c,b:r.b*i+n.b*c,a:r.a*o+n.a*(1-o)};return C(d)},C.readability=function(e,t){var s=C(e),i=C(t),n=s.toRgb(),r=i.toRgb(),o=s.getBrightness(),a=i.getBrightness(),l=Math.max(n.r,r.r)-Math.min(n.r,r.r)+Math.max(n.g,r.g)-Math.min(n.g,r.g)+Math.max(n.b,r.b)-Math.min(n.b,r.b);return{brightness:Math.abs(o-a),color:l}},C.isReadable=function(e,t){var s=C.readability(e,t);return s.brightness>125&&s.color>500},C.mostReadable=function(e,t){for(var s=null,i=0,n=!1,r=0;r<t.length;r++){var o=C.readability(e,t[r]),a=o.brightness>125&&o.color>500,l=o.brightness/125*3+o.color/500;(a&&!n||a&&n&&l>i||!a&&!n&&l>i)&&(n=a,i=l,s=C(t[r]))}return s};var z=C.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},H=C.hexNames=function(e){var t={};for(var s in e)e.hasOwnProperty(s)&&(t[e[s]]=s);return t}(z);function U(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function B(e,t){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var s=function(e){return"string"==typeof e&&-1!=e.indexOf("%")}(e);return e=k(t,w(0,parseFloat(e))),s&&(e=parseInt(e*t,10)/100),y.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function q(e){return k(1,w(0,e))}function W(e){return parseInt(e,16)}function G(e){return 1==e.length?"0"+e:""+e}function K(e){return e<=1&&(e=100*e+"%"),e}var Y,J,X,Z=(J="[\\s|\\(]+("+(Y="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+Y+")[,|\\s]+("+Y+")\\s*\\)?",X="[\\s|\\(]+("+Y+")[,|\\s]+("+Y+")[,|\\s]+("+Y+")[,|\\s]+("+Y+")\\s*\\)?",{rgb:new RegExp("rgb"+J),rgba:new RegExp("rgba"+X),hsl:new RegExp("hsl"+J),hsla:new RegExp("hsla"+X),hsv:new RegExp("hsv"+J),hsva:new RegExp("hsva"+X),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});window.tinycolor=C,e(function(){e.fn.spectrum.load&&e.fn.spectrum.processNativeColorInputs()})}}),e("skylark-grapejs/domain_abstract/ui/Input",["skylark-backbone"],function(e){"use strict";const t=e.$;return e.View.extend({events:{change:"handleChange"},template(){return`<span class="${this.holderClass()}"></span>`},inputClass(){return`${this.ppfx}field`},holderClass(){return`${this.ppfx}input-holder`},initialize(e={}){const t=e.ppfx||"";this.opts=e,this.ppfx=t,this.em=e.target||{},this.listenTo(this.model,"change:value",this.handleModelChange)},elementUpdated(){this.model.trigger("el:change")},setValue(e){const t=this.model;let s=e||t.get("defaults");const i=this.getInputEl();i&&(i.value=s)},handleModelChange(e,t,s){this.setValue(t,s)},handleChange(e){e.stopPropagation();const t=this.getInputEl().value;this.model.set({value:t},{fromInput:1}),this.elementUpdated()},getInputEl(){if(!this.inputEl){const{model:e}=this,s=e.get("placeholder")||e.get("defaults")||"";this.inputEl=t(`<input type="text" placeholder="${s}">`)}return this.inputEl.get(0)},render(){this.inputEl=null;const e=this.$el;return e.addClass(this.inputClass()),e.html(this.template()),e.find(`.${this.holderClass()}`).append(this.getInputEl()),this}})}),e("skylark-grapejs/domain_abstract/ui/InputColor",["skylark-backbone","skylark-underscore","../../utils/ColorPicker","./Input"],function(e,t,s,i){"use strict";const n=e.$;return s(n),i.extend({template(){const e=this.ppfx;return`\n      <div class="${this.holderClass()}"></div>\n      <div class="${e}field-colorp">\n        <div class="${e}field-colorp-c" data-colorp-c>\n          <div class="${e}checker-bg"></div>\n        </div>\n      </div>\n    `},inputClass(){const e=this.ppfx;return`${e}field ${e}field-color`},holderClass(){return`${this.ppfx}input-holder`},setValue(e,s={}){const i=this.model,n=i.get("defaults"),r=t.isUndefined(e)?t.isUndefined(n)?"":n:e,o=this.getInputEl(),a=this.getColorEl(),l="none"!=r?r:"";o.value=r,a.get(0).style.backgroundColor=l,s.fromTarget&&(a.spectrum("set",l),this.noneColor="none"==r)},getColorEl(){if(!this.colorEl){const o=this,a=this.ppfx;var e=this.model,t=n(`<div class="${this.ppfx}field-color-picker"></div>`),s=t.get(0).style,i=this.em&&this.em.config?this.em.config.el:"",r=this.em&&this.em.getConfig&&this.em.getConfig("colorPicker")||{};const l=e=>{let t=1==e.getAlpha()?e.toHexString():e.toRgbString();return t.replace(/ /g,"")};let c,d=0;this.$el.find("[data-colorp-c]").append(t),t.spectrum({containerClassName:`${a}one-bg ${a}two-color`,appendTo:i||"body",maxSelectionSize:8,showPalette:!0,showAlpha:!0,chooseText:"Ok",cancelText:"⨯",palette:[],...r,move(t){const i=l(t);s.backgroundColor=i,e.setValueFromInput(i,0)},change(t){d=1;const i=l(t);s.backgroundColor=i,e.setValueFromInput(0,0),e.setValueFromInput(i),o.noneColor=0},show(e){d=0,c=l(e)},hide(i){!d&&c&&(o.noneColor&&(c=""),s.backgroundColor=c,t.spectrum("set",c),e.setValueFromInput(c,0))}}),this.colorEl=t}return this.colorEl},render(){return i.prototype.render.call(this),this.getColorEl(),this}})}),e("skylark-grapejs/style_manager/view/PropertyColorView",["./PropertyIntegerView","../../domain_abstract/ui/InputColor"],function(e,t){"use strict";return e.extend({setValue(e,t={}){t={...t,silent:1},this.inputInst.setValue(e,t)},onRender(){if(!this.input){const e=this.ppfx,s=new t({target:this.target,model:this.model,ppfx:e}),i=s.render();this.el.querySelector(`.${e}fields`).appendChild(i.el),this.$input=i.inputEl,this.$color=i.colorEl,this.input=this.$input.get(0),this.inputInst=i}}})}),e("skylark-grapejs/style_manager/model/PropertyRadio",["skylark-langx/langx","./Property"],function(e,t){"use strict";return t.extend({defaults:()=>({...t.prototype.defaults,options:[],full:1}),initialize(...e){t.prototype.initialize.apply(this,e),this.listenTo(this,"change:options",this.onOptionChange)},onOptionChange(){this.set("list",this.get("options"))},getOptions(){const{options:e,list:t}=this.attributes;return e&&e.length?e:t},setOptions(e=[]){return this.set("options",e),this},addOption(e){if(e){const t=this.getOptions();this.setOptions([...t,e])}return this}})}),e("skylark-grapejs/style_manager/model/PropertySelect",["skylark-langx/langx","./PropertyRadio"],function(e,t){"use strict";return t.extend({defaults:()=>({...t.prototype.defaults(),full:0})})}),e("skylark-grapejs/style_manager/view/PropertySelectView",["skylark-backbone","./PropertyView"],function(e,t){"use strict";e.$;return t.extend({templateInput(){const e=this.pfx,t=this.ppfx;return`\n      <div class="${t}field ${t}select">\n        <span id="${e}input-holder"></span>\n        <div class="${t}sel-arrow">\n          <div class="${t}d-s-arrow"></div>\n        </div>\n      </div>\n    `},initialize(...e){t.prototype.initialize.apply(this,e),this.listenTo(this.model,"change:options",this.updateOptions)},updateOptions(){this.input=null,this.onRender()},onRender(){var e=this.pfx;const t=this.model.getOptions();if(!this.input){let s="";t.forEach(e=>{let t=e.name||e.value,i=e.style?e.style.replace(/"/g,"&quot;"):"",n=i?`style="${i}"`:"",r=e.value.replace(/"/g,"&quot;");s+=`<option value="${r}" ${n}>${t}</option>`});const i=this.el.querySelector(`#${e}input-holder`);i.innerHTML=`<select>${s}</select>`,this.input=i.firstChild}}})}),e("skylark-grapejs/style_manager/view/PropertyRadioView",["./PropertyView"],function(e){"use strict";return e.extend({templateInput(){this.pfx;const e=this.ppfx;return`\n      <div class="${e}field ${e}field-radio">\n      </div>\n    `},onRender(){const e=this.pfx,t=this.ppfx,s=`${t}radio-item-label`,i=this.model,n=i.get("property"),r=i.get("list")||i.get("options")||[],{cid:o}=i,a=`${e}radio ${e}radio-${n}`;if(!this.input&&r&&r.length){let i="";r.forEach(r=>{let l=r.className?`${r.className} ${e}icon ${s}`:"",c=`${n}-${r.value}-${o}`,d=r.name||r.value,h=r.title?`title="${r.title}"`:"";i+=`\n            <div class="${t}radio-item">\n              <input type="radio" class="${a}" id="${c}" name="${n}-${o}" value="${r.value}"/>\n              <label class="${l||s}" ${h} for="${c}">${l?"":d}</label>\n            </div>\n          `});const l=this.el.querySelector(`.${t}field`);l.innerHTML=`<div class="${t}radio-items">${i}</div>`,this.input=l.firstChild}},getInputValue(){const e=this.getCheckedEl();return e?e.value:""},getCheckedEl(){const e=this.getInputEl();return e?e.querySelector("input:checked"):""},setValue(e){const t=this.model;let s=e||t.get("value")||t.getDefaultValue();const i=this.getInputEl(),n=i?i.querySelector(`[value="${s}"]`):"";if(n)n.checked=!0;else{const e=this.getCheckedEl();e&&(e.checked=!1)}}})}),e("skylark-grapejs/domain_abstract/ui/InputNumber",["skylark-backbone","skylark-underscore","../../utils/mixins","./Input"],function(e,t,s,i){"use strict";e.$;return i.extend({events:{"change input":"handleChange","change select":"handleUnitChange","click [data-arrow-up]":"upArrowClick","click [data-arrow-down]":"downArrowClick","mousedown [data-arrows]":"downIncrement"},template(){const e=this.ppfx;return`\n      <span class="${e}input-holder"></span>\n      <span class="${e}field-units"></span>\n      <div class="${e}field-arrows" data-arrows>\n        <div class="${e}field-arrow-u" data-arrow-up></div>\n        <div class="${e}field-arrow-d" data-arrow-down></div>\n      </div>\n    `},inputClass(){const e=this.ppfx;return this.opts.contClass||`${e}field ${e}field-integer`},initialize(e={}){i.prototype.initialize.apply(this,arguments),t.bindAll(this,"moveIncrement","upIncrement"),this.doc=document,this.listenTo(this.model,"change:unit",this.handleModelChange)},setValue(e,t){var s=t||{},i=this.validateInputValue(e,{deepCheck:1}),n={value:i.value};(i.unit||i.force)&&(n.unit=i.unit),this.model.set(n,s),s.silent&&this.handleModelChange()},handleChange(e){e.stopPropagation(),this.setValue(this.getInputEl().value),this.elementUpdated()},handleUnitChange(e){e.stopPropagation();var t=this.getUnitEl().value;this.model.set("unit",t),this.elementUpdated()},elementUpdated(){this.model.trigger("el:change")},handleModelChange(){const e=this.model;this.getInputEl().value=e.get("value");const t=this.getUnitEl();t&&(t.value=e.get("unit")||"")},getUnitEl(){if(!this.unitEl){const e=this.model,t=e.get("units")||[];if(t.length){const s=[];t.forEach(t=>{const i=t==e.get("unit")?"selected":"";s.push(`<option ${i}>${t}</option>`)});const i=document.createElement("div");i.innerHTML=`<select class="${this.ppfx}input-unit">${s.join("")}</select>`,this.unitEl=i.firstChild}}return this.unitEl},upArrowClick(){const e=this.model,t=e.get("step");let s=parseInt(e.get("value"),10);s=this.normalizeValue(s+t);var i=this.validateInputValue(s);e.set("value",i.value),this.elementUpdated()},downArrowClick(){const e=this.model,t=e.get("step"),s=parseInt(e.get("value"),10),i=this.normalizeValue(s-t);var n=this.validateInputValue(i);e.set("value",n.value),this.elementUpdated()},downIncrement(e){e.preventDefault(),this.moved=0;var t=this.model.get("value");t=this.normalizeValue(t),this.current={y:e.pageY,val:t},s.on(this.doc,"mousemove",this.moveIncrement),s.on(this.doc,"mouseup",this.upIncrement)},moveIncrement(e){this.moved=1;const t=this.model,s=t.get("step"),i=this.current;var n=this.normalizeValue(i.val+(i.y-e.pageY)*s);return this.prValue=this.validateInputValue(n).value,t.set("value",this.prValue,{avoidStore:1}),!1},upIncrement(){const e=this.model,t=e.get("step");if(s.off(this.doc,"mouseup",this.upIncrement),s.off(this.doc,"mousemove",this.moveIncrement),this.prValue&&this.moved){var i=this.prValue-t;e.set("value",i,{avoidStore:1}).set("value",i+t),this.elementUpdated()}},normalizeValue(e,t=0){const s=this.model,i=s.get("step");let n=0;if(isNaN(e))return t;if(e=parseFloat(e),Math.floor(e)!==e){const e=i.toString().split(".")[1];n=e?e.length:0}return n?parseFloat(e.toFixed(n)):e},validateInputValue(e,s){var i=0,n=s||{},r=this.model;var o=t.isUndefined(e)?"":e,a=r.get("units")||[],l=r.get("unit")||a.length&&a[0]||"",c=r.get("max"),d=r.get("min");if(n.deepCheck){var h=r.get("fixedValues")||[];if(o){var p=new RegExp("^"+h.join("|"),"g");if(h.length&&p.test(o))o=o.match(p)[0],l="",i=1;else{var g=o+"";o+="",o=parseFloat(o.replace(",",".")),o=isNaN(o)?"":o;var u=g.replace(o,"");t.indexOf(a,u)>=0&&(l=u)}}}return t.isUndefined(c)||""===c||(o=o>c?c:o),t.isUndefined(d)||""===d||(o=o<d?d:o),{force:i,value:o,unit:l}},render(){i.prototype.render.call(this),this.unitEl=null;const e=this.getUnitEl();return e&&this.$el.find(`.${this.ppfx}field-units`).get(0).appendChild(e),this}})}),e("skylark-grapejs/style_manager/model/PropertyInteger",["skylark-langx/langx","skylark-underscore","./Property","../../domain_abstract/ui/InputNumber"],function(e,t,s,i){"use strict";return s.extend({defaults:{...s.prototype.defaults,units:[],unit:"",step:1,min:"",max:""},initialize(e={},t={}){s.callParentInit(s,this,e,t);const n=this.get("unit"),r=this.get("units");this.input=new i({model:this}),r.length&&!n&&this.set("unit",r[0]),s.callInit(this,e,t)},clearValue(e={}){return this.set({value:void 0,unit:void 0},e),this},parseValue(e){const t=s.prototype.parseValue.apply(this,arguments),{value:i,unit:n}=this.input.validateInputValue(t.value,{deepCheck:1});return t.value=i,t.unit=n,t},getFullValue(){let e=this.get("value"),i=this.get("unit");return e=t.isUndefined(e)?"":e,i=!t.isUndefined(i)&&e?i:"",e=`${e}${i}`,s.prototype.getFullValue.apply(this,[e])}})}),e("skylark-grapejs/style_manager/model/PropertySlider",["skylark-langx/langx","./PropertyInteger"],function(e,t){"use strict";return t.extend({defaults:{...t.prototype.defaults,showInput:1}})}),e("skylark-grapejs/style_manager/view/PropertySliderView",["./PropertyIntegerView"],function(e){"use strict";return e.extend({events:()=>({...e.prototype.events,"change [type=range]":"inputValueChanged","input [type=range]":"inputValueChangedSoft",change:""}),templateInput(e){const t=this.ppfx;return`\n      <div class="${t}field ${t}field-range">\n        <input type="range"\n          min="${e.get("min")}"\n          max="${e.get("max")}"\n          step="${e.get("step")}"/>\n      </div>\n    `},getSliderEl(){return this.slider||(this.slider=this.el.querySelector("input[type=range]")),this.slider},inputValueChanged(){const e=this.model,t=e.get("step");this.getInputEl().value=this.getSliderEl().value;const s=this.getInputValue()-t;e.set("value",s,{avoidStore:1}).set("value",s+t),this.elementUpdated()},inputValueChangedSoft(){this.getInputEl().value=this.getSliderEl().value,this.model.set("value",this.getInputValue(),{avoidStore:1}),this.elementUpdated()},setValue(t){const s=this.model.parseValue(t);this.getSliderEl().value=parseFloat(s.value),e.prototype.setValue.apply(this,arguments)},onRender(){e.prototype.onRender.apply(this,arguments),this.model.get("showInput")||(this.inputInst.el.style.display="none")},clearCached(){e.prototype.clearCached.apply(this,arguments),this.slider=null}})}),e("skylark-grapejs/style_manager/model/Properties",["skylark-langx/langx","skylark-backbone","../../domain_abstract/model/TypeableCollection","./Property","./PropertyStack","./../view/PropertyStackView","./PropertyComposite","./../view/PropertyCompositeView","./../view/PropertyFileView","./../view/PropertyColorView","./PropertySelect","./../view/PropertySelectView","./PropertyRadio","./../view/PropertyRadioView","./PropertySlider","./../view/PropertySliderView","./PropertyInteger","./../view/PropertyIntegerView","./../view/PropertyView","./Layer"],function(e,t,s,i,n,r,o,a,l,c,d,h,p,g,u,m,f,v,y,b){"use strict";var k=t.Collection.extend(s).extend({types:[{id:"stack",model:n,view:r,isType(e){if(e&&"stack"==e.type)return e}},{id:"composite",model:o,view:a,isType(e){if(e&&"composite"==e.type)return e}},{id:"file",model:i,view:l,isType(e){if(e&&"file"==e.type)return e}},{id:"color",model:i,view:c,isType(e){if(e&&"color"==e.type)return e}},{id:"select",model:d,view:h,isType(e){if(e&&"select"==e.type)return e}},{id:"radio",model:p,view:g,isType(e){if(e&&"radio"==e.type)return e}},{id:"slider",model:u,view:m,isType(e){if(e&&"slider"==e.type)return e}},{id:"integer",model:f,view:v,isType(e){if(e&&"integer"==e.type)return e}},{id:"base",model:i,view:y,isType:e=>(e.type="base",e)}],deepClone(){const e=this.clone();return e.reset(e.map(e=>{const t=e.clone();return t.typeView=e.typeView,t})),e},parseValue(t){const s=[],i=t.split(" ");return i.forEach((t,i)=>{const n=this.at(i);n&&s.push(e.mixin({},n.attributes,{value:t}))}),s},getFullValue(){let e="";return this.each(t=>e+=`${t.getFullValue()} `),e.trim()}});return o.Properties=k,b.Properties=k,k}),e("skylark-grapejs/style_manager/model/PropertyFactory",[],function(){"use strict";return()=>({build(e){var t=[];"string"==typeof e&&(e=[e]);for(var s=0,i=e.length;s<i;s++){var n={},r=e[s];switch(n.property=r,r){case"border-radius-c":n.property="border-radius"}switch(r){case"top":case"right":case"bottom":case"left":case"margin-top":case"margin-right":case"margin-bottom":case"margin-left":case"padding-top":case"padding-right":case"padding-bottom":case"padding-left":case"width":case"max-width":case"min-width":case"height":case"max-height":case"min-height":case"flex-basis":n.fixedValues=["initial","inherit","auto"];break;case"font-size":n.fixedValues=["medium","xx-small","x-small","small","large","x-large","xx-large","smaller","larger","length","initial","inherit"];break;case"letter-spacing":case"line-height":n.fixedValues=["normal","initial","inherit"]}switch(r){case"float":case"position":case"text-align":n.type="radio";break;case"display":case"flex-direction":case"flex-wrap":case"justify-content":case"align-items":case"align-content":case"align-self":case"font-family":case"font-weight":case"border-style":case"box-shadow-type":case"background-repeat":case"background-position":case"background-attachment":case"background-size":case"transition-property":case"transition-timing-function":case"cursor":case"overflow":case"overflow-x":case"overflow-y":n.type="select";break;case"top":case"right":case"bottom":case"left":case"margin-top":case"margin-right":case"margin-bottom":case"margin-left":case"padding-top":case"padding-right":case"padding-bottom":case"padding-left":case"min-height":case"min-width":case"max-height":case"max-width":case"width":case"height":case"font-size":case"letter-spacing":case"line-height":case"text-shadow-h":case"text-shadow-v":case"text-shadow-blur":case"border-radius-c":case"border-top-left-radius":case"border-top-right-radius":case"border-bottom-left-radius":case"border-bottom-right-radius":case"border-width":case"box-shadow-h":case"box-shadow-v":case"box-shadow-blur":case"box-shadow-spread":case"transition-duration":case"perspective":case"transform-rotate-x":case"transform-rotate-y":case"transform-rotate-z":case"transform-scale-x":case"transform-scale-y":case"transform-scale-z":case"order":case"flex-grow":case"flex-shrink":case"flex-basis":n.type="integer";break;case"margin":case"padding":case"border-radius":case"border":case"transform":n.type="composite";break;case"color":case"text-shadow-color":case"background-color":case"border-color":case"box-shadow-color":n.type="color";break;case"text-shadow":case"box-shadow":case"background":case"transition":n.type="stack";break;case"background-image":n.type="file"}switch(r){case"float":case"background-color":case"text-shadow":n.defaults="none";break;case"display":n.defaults="block";break;case"flex-direction":n.defaults="row";break;case"flex-wrap":n.defaults="nowrap";break;case"justify-content":n.defaults="flex-start";break;case"align-items":case"align-content":n.defaults="stretch";break;case"align-self":n.defaults="auto";break;case"position":n.defaults="static";break;case"margin-top":case"margin-right":case"margin-bottom":case"margin-left":case"padding-top":case"padding-right":case"padding-bottom":case"padding-left":case"text-shadow-h":case"text-shadow-v":case"text-shadow-blur":case"border-radius-c":case"box-shadow-h":case"box-shadow-v":case"box-shadow-spread":case"perspective":case"transform-rotate-x":case"transform-rotate-y":case"transform-rotate-z":case"order":case"flex-grow":n.defaults=0;break;case"border-top-left-radius":case"border-top-right-radius":case"border-bottom-left-radius":case"border-bottom-right-radius":n.defaults="0px";break;case"transform-scale-x":case"transform-scale-y":case"transform-scale-z":case"flex-shrink":n.defaults=1;break;case"box-shadow-blur":n.defaults="5px";break;case"top":case"right":case"bottom":case"left":case"min-height":case"min-width":case"max-height":case"max-width":case"width":case"height":case"background-size":case"cursor":case"flex-basis":n.defaults="auto";break;case"font-family":n.defaults="Arial, Helvetica, sans-serif";break;case"font-size":case"border-width":n.defaults="medium";break;case"font-weight":n.defaults="400";break;case"letter-spacing":case"line-height":n.defaults="normal";break;case"color":case"text-shadow-color":case"border-color":case"box-shadow-color":n.defaults="black";break;case"text-align":n.defaults="left";break;case"border-style":n.defaults="solid";break;case"box-shadow-type":n.defaults="";break;case"background-repeat":n.defaults="repeat";break;case"background-position":n.defaults="left top";break;case"background-attachment":n.defaults="scroll";break;case"transition-property":n.defaults="width";break;case"transition-duration":n.defaults="2";break;case"transition-timing-function":n.defaults="ease";break;case"overflow":case"overflow-x":case"overflow-y":n.defaults="visible"}switch(r){case"flex-direction":case"flex-wrap":case"justify-content":case"align-items":case"align-content":n.requires={display:["flex"]};break;case"order":case"flex-basis":case"flex-grow":case"flex-shrink":case"align-self":n.requiresParent={display:["flex"]}}switch(r){case"top":case"bottom":case"margin-top":case"margin-bottom":case"padding-top":case"padding-bottom":case"min-height":case"max-height":case"height":n.units=["px","%","vh"];break;case"right":case"left":case"margin-right":case"margin-left":case"padding-right":case"padding-left":case"min-width":case"max-width":case"width":n.units=["px","%","vw"];break;case"flex-basis":n.units=["px","%","vw","vh"];break;case"text-shadow-v":case"text-shadow-h":case"text-shadow-blur":case"border-radius-c":case"border-top-left-radius":case"border-top-right-radius":case"border-bottom-left-radius":case"border-bottom-right-radius":case"box-shadow-h":case"box-shadow-v":n.units=["px","%"];break;case"font-size":case"letter-spacing":case"line-height":n.units=["px","em","rem","%"];break;case"border-width":n.units=["px","em"];break;case"box-shadow-blur":case"box-shadow-spread":case"perspective":n.units=["px"];break;case"transition-duration":n.units=["s"];break;case"transform-rotate-x":case"transform-rotate-y":case"transform-rotate-z":n.units=["deg"]}switch(r){case"padding-top":case"padding-right":case"padding-bottom":case"padding-left":case"min-height":case"min-width":case"max-height":case"max-width":case"width":case"height":case"font-size":case"text-shadow-blur":case"border-radius-c":case"border-top-left-radius":case"border-top-right-radius":case"border-bottom-left-radius":case"border-bottom-right-radius":case"border-width":case"box-shadow-blur":case"transition-duration":case"perspective":case"flex-basis":n.min=0}switch(r){case"text-shadow":case"box-shadow":case"background":n.preview=!0}switch(r){case"background":n.detached=!0}switch(r){case"transform-rotate-x":n.functionName="rotateX";break;case"transform-rotate-y":n.functionName="rotateY";break;case"transform-rotate-z":n.functionName="rotateZ";break;case"transform-scale-x":n.functionName="scaleX";break;case"transform-scale-y":n.functionName="scaleY";break;case"transform-scale-z":n.functionName="scaleZ";break;case"background-image":n.functionName="url"}switch(r){case"float":n.list=[{value:"none"},{value:"left"},{value:"right"}];break;case"display":n.list=[{value:"block"},{value:"inline"},{value:"inline-block"},{value:"flex"},{value:"none"}];break;case"flex-direction":n.list=[{value:"row"},{value:"row-reverse"},{value:"column"},{value:"column-reverse"}];break;case"flex-wrap":n.list=[{value:"nowrap"},{value:"wrap"},{value:"wrap-reverse"}];break;case"justify-content":n.list=[{value:"flex-start"},{value:"flex-end"},{value:"center"},{value:"space-between"},{value:"space-around"},{value:"space-evenly"}];break;case"align-items":n.list=[{value:"flex-start"},{value:"flex-end"},{value:"center"},{value:"baseline"},{value:"stretch"}];break;case"align-content":n.list=[{value:"flex-start"},{value:"flex-end"},{value:"center"},{value:"space-between"},{value:"space-around"},{value:"stretch"}];break;case"align-self":n.list=[{value:"auto"},{value:"flex-start"},{value:"flex-end"},{value:"center"},{value:"baseline"},{value:"stretch"}];break;case"position":n.list=[{value:"static"},{value:"relative"},{value:"absolute"},{value:"fixed"}];break;case"font-family":var o=", sans-serif",a=["Arial, Helvetica"+o,"Arial Black, Gadget"+o,"Brush Script MT"+o,"Comic Sans MS, cursive"+o,"Courier New, Courier, monospace","Georgia, serif","Helvetica, serif","Impact, Charcoal"+o,"Lucida Sans Unicode, Lucida Grande"+o,"Tahoma, Geneva"+o,"Times New Roman, Times, serif","Trebuchet MS, Helvetica"+o,"Verdana, Geneva"+o];n.list=[];for(var l=0,c=a.length;l<c;l++){var d={};d.value=a[l],d.name=a[l].split(",")[0],n.list.push(d)}break;case"font-weight":n.list=[{value:"100",name:"Thin"},{value:"200",name:"Extra-Light"},{value:"300",name:"Light"},{value:"400",name:"Normal"},{value:"500",name:"Medium"},{value:"600",name:"Semi-Bold"},{value:"700",name:"Bold"},{value:"800",name:"Extra-Bold"},{value:"900",name:"Ultra-Bold"}];break;case"text-align":n.list=[{value:"left"},{value:"center"},{value:"right"},{value:"justify"}];break;case"border-style":n.list=[{value:"none"},{value:"solid"},{value:"dotted"},{value:"dashed"},{value:"double"},{value:"groove"},{value:"ridge"},{value:"inset"},{value:"outset"}];break;case"box-shadow-type":n.list=[{value:"",name:"Outside"},{value:"inset",name:"Inside"}];break;case"background-repeat":n.list=[{value:"repeat"},{value:"repeat-x"},{value:"repeat-y"},{value:"no-repeat"}];break;case"background-position":n.list=[{value:"left top"},{value:"left center"},{value:"left bottom"},{value:"right top"},{value:"right center"},{value:"right bottom"},{value:"center top"},{value:"center center"},{value:"center bottom"}];break;case"background-attachment":n.list=[{value:"scroll"},{value:"fixed"},{value:"local"}];break;case"background-size":n.list=[{value:"auto"},{value:"cover"},{value:"contain"}];break;case"transition-property":n.list=[{value:"all"},{value:"width"},{value:"height"},{value:"background-color"},{value:"transform"},{value:"box-shadow"},{value:"opacity"}];break;case"transition-timing-function":n.list=[{value:"linear"},{value:"ease"},{value:"ease-in"},{value:"ease-out"},{value:"ease-in-out"}];break;case"cursor":n.list=[{value:"auto"},{value:"pointer"},{value:"copy"},{value:"crosshair"},{value:"grab"},{value:"grabbing"},{value:"help"},{value:"move"},{value:"text"}];break;case"overflow":case"overflow-x":case"overflow-y":n.list=[{value:"visible"},{value:"hidden"},{value:"scroll"},{value:"auto"}]}switch(r){case"margin":n.properties=this.build(["margin-top","margin-right","margin-bottom","margin-left"]);break;case"padding":n.properties=this.build(["padding-top","padding-right","padding-bottom","padding-left"]);break;case"text-shadow":n.properties=this.build(["text-shadow-h","text-shadow-v","text-shadow-blur","text-shadow-color"]);break;case"border":n.properties=this.build(["border-width","border-style","border-color"]);break;case"border-radius":n.properties=this.build(["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius"]);break;case"box-shadow":n.properties=this.build(["box-shadow-h","box-shadow-v","box-shadow-blur","box-shadow-spread","box-shadow-color","box-shadow-type"]);break;case"background":n.properties=this.build(["background-image","background-repeat","background-position","background-attachment","background-size"]);break;case"transition":n.properties=this.build(["transition-property","transition-duration","transition-timing-function"]);break;case"transform":n.properties=this.build(["transform-rotate-x","transform-rotate-y","transform-rotate-z","transform-scale-x","transform-scale-y","transform-scale-z"])}t.push(n)}return t}})}),e("skylark-grapejs/style_manager/model/Sector",["skylark-backbone","skylark-underscore","./Properties","./PropertyFactory"],function(e,t,s,i){"use strict";return e.Model.extend({defaults:{id:"",name:"",open:!0,buildProps:"",extendBuilded:1,properties:[]},initialize(e){const t=e||{},i=this.buildProperties(t.buildProps),n=this.get("name")||"";let r=[];!this.get("id")&&this.set("id",n.replace(/ /g,"_").toLowerCase()),r=i?this.extendProperties(i):this.get("properties");const o=new s(r);o.sector=this,this.set("properties",o)},extendProperties(e,s,i){for(var n=e.length,r=s||this.get("properties"),o=this.get("extendBuilded"),a=[],l=0,c=r.length;l<c;l++){for(var d=r[l],h=0,p=0;p<n;p++){var g=e[p];if(d.property!=g.property&&d.id!=g.property);else{var u=d.properties;u&&u.length&&(d.properties=this.extendProperties(g.properties||[],u,1)),e[p]=o?t.extend(g,d):d,a[p]=e[p],h=1}}h||(e.push(d),a.push(d))}return i?a.filter(e=>e):e},buildProperties(e){var t=e||[];if(t.length)return this.propFactory||(this.propFactory=i()),this.propFactory.build(t)}})}),e("skylark-grapejs/style_manager/model/Sectors",["skylark-backbone","./Sector"],function(e,t){"use strict";return e.Collection.extend({model:t})}),e("skylark-grapejs/style_manager/view/SectorView",["skylark-backbone","skylark-underscore","./PropertiesView"],function(e,t,s){"use strict";return e.View.extend({template:t.template('\n  <div class="<%= pfx %>title" data-sector-title>\n    <i id="<%= pfx %>caret" class="fa"></i>\n    <%= label %>\n  </div>'),events:{"click [data-sector-title]":"toggle"},initialize(e){this.config=e.config||{},this.em=this.config.em,this.pfx=this.config.stylePrefix||"",this.target=e.target||{},this.propTarget=e.propTarget||{},this.caretR="fa-caret-right",this.caretD="fa-caret-down";const t=this.model;this.listenTo(t,"change:open",this.updateOpen),this.listenTo(t,"updateVisibility",this.updateVisibility),this.listenTo(t,"destroy remove",this.remove)},updateVisibility(){var e;this.model.get("properties").each(t=>{t.get("visible")&&(e=1)}),this.el.style.display=e?"block":"none"},updateOpen(){this.model.get("open")?this.show():this.hide()},show(){this.$el.addClass(this.pfx+"open"),this.getPropertiesEl().style.display="",this.$caret.removeClass(this.caretR).addClass(this.caretD)},hide(){this.$el.removeClass(this.pfx+"open"),this.getPropertiesEl().style.display="none",this.$caret.removeClass(this.caretD).addClass(this.caretR)},getPropertiesEl(){return this.$el.find(`.${this.pfx}properties`).get(0)},toggle(e){var t=this.model.get("open")?0:1;this.model.set("open",t)},render(){const{pfx:e,model:t,em:s,$el:i}=this,{id:n,name:r}=t.attributes,o=s&&s.t(`styleManager.sectors.${n}`)||r;return i.html(this.template({pfx:e,label:o})),this.$caret=i.find(`#${e}caret`),this.renderProperties(),i.attr("class",`${e}sector ${e}sector__${n} no-select`),this.updateOpen(),this},renderProperties(){var e=this.model.get("properties");if(e){var t=new s({collection:e,target:this.target,propTarget:this.propTarget,config:this.config});this.$el.append(t.render().el)}}})}),e("skylark-grapejs/style_manager/view/SectorsView",["skylark-langx","skylark-backbone","../../utils/mixins","../../utils/dom","./SectorView"],function(e,t,s,i,n){"use strict";return t.View.extend({initialize(s={}){const i=s.config||{};this.pfx=i.stylePrefix||"",this.ppfx=i.pStylePrefix||"",this.target=s.target||{},this.config=i;const n={};e.extend(n,t.Events);const r=document.body,o=document.createElement(`el-${(new Date).getTime()}`);r.appendChild(o),n.computedDefault={...window.getComputedStyle(o)},r.removeChild(o),this.propTarget=n;const a=this.collection;this.listenTo(a,"add",this.addTo),this.listenTo(a,"reset",this.render),this.listenTo(this.target,"component:toggled component:update:classes change:state change:device frame:resized",this.targetUpdated)},addTo(e,t,s={}){this.addToCollection(e,null,s)},toggleStateCls(e=[],t){e.forEach(e=>{const s=e.getEl();s&&s.classList[t?"add":"remove"]("hc-state")})},targetUpdated(e){const t=this.target,i=this.propTarget,n=t.getSelectedAll();let r=t.getSelected();const o=e&&e.toHTML?e:r;if(o&&this.toggleStateCls([o]),!r)return;const a=t.get("Config"),l=a.devicePreviewMode?"":t.get("state"),{componentFirst:c}=t.get("SelectorManager").getConfig(),d=r.getEl();if(i.helper=null,i.targets=null,d&&s.isTaggableNode(d)){const e=l?`:${l}`:null;i.computed=window.getComputedStyle(d,e)}r=t.get("StyleManager").getModelToStyle(r),l&&(((e={})=>{const s=t.get("CssComposer"),n=s.getAll();let r=s.getClassRule("hc-state");r?(n.remove(r),n.add(r)):r=s.setClassRule("hc-state");r.set("important",1),r.setStyle(e),i.helper=r})(r.getStyle()),this.toggleStateCls(n,1)),i.model=r,c&&(i.targets=n),i.trigger("update")},setTarget(t,s={}){const i=this.target,n=e.isArray(t)?t:[t],{targetIsClass:r,stylable:o}=s,a=[];n.forEach(t=>{let s=t;if(e.isString(t)){let e;const n=i.get("CssComposer").getAll();r&&(e=n.filter(e=>e.get("selectors").getFullString()===t)[0]),e||(e=n.filter(e=>e.get("selectorsAdd")===t)[0]),e||(e=n.add({selectors:[],selectorsAdd:t})),o&&e.set({stylable:o}),s=e}a.push(s)});const l=this.propTarget;return l.targets=a,l.trigger("update"),a},addToCollection(e,t,s={}){const{pfx:r,target:o,propTarget:a,config:l,el:c}=this,d=t||c,h=new n({model:e,id:`${r}${e.get("id")}`,name:e.get("name"),properties:e.get("properties"),target:o,propTarget:a,config:l}).render().el;return i.appendAtIndex(d,h,s.at),h},render(){const e=document.createDocumentFragment(),t=this.$el,s=this.pfx,i=this.ppfx;return t.empty(),this.collection.each(t=>this.addToCollection(t,e)),t.append(e),t.addClass(`${s}sectors ${i}one-bg ${i}two-color`),this}})}),e("skylark-grapejs/style_manager/index",["skylark-langx/langx","skylark-underscore","./config/config","./model/Sectors","./model/Properties","./view/SectorsView"],function(e,t,s,i,n,r){"use strict";return()=>{var o={};let a;var l,c;return{name:"StyleManager",getConfig:()=>o,init(e){const t=(o={...s,...e}).pStylePrefix;return this.em=o.em,t&&(o.stylePrefix=t+o.stylePrefix),a=new n,l=new i([],o),c=new r({collection:l,target:o.em,config:o}),this},onLoad(){l.add(o.sectors)},postRender(){const e=this.getConfig().appendTo;if(e){const s=t.isElement(e)?e:document.querySelector(e);s.appendChild(this.render())}},addSector(e,t,s={}){let i=this.getSector(e);return i||(t.id=e,i=l.add(t,s)),i},getSector(e,t={}){const s=l.where({id:e})[0];return!s&&t.warn&&this._logNoSector(e),s},removeSector(e){return this.getSectors().remove(this.getSector(e,{warn:1}))},getSectors:()=>l,addProperty(e,t,s={}){const i=this.getSector(e,{warn:1});let n=null;return i&&(n=i.get("properties").add(t,s)),n},getProperty(e,t){const s=this.getSector(e,{warn:1});let i=null;return s&&(i=1==(i=s.get("properties").where({property:t})).length?i[0]:i),i},removeProperty(e,t){const s=this.getProperties(e);return s&&s.remove(this.getProperty(e,t))},getProperties(e){let t=null;const s=this.getSector(e,{warn:1});return s&&(t=s.get("properties")),t},getModelToStyle(e,t={}){const s=o.em,{skipAdd:i}=t,n=e.get("classes"),r=e.getId();if(s){const o=s.getConfig(),a=s.get("UndoManager"),l=s.get("CssComposer"),c=s.get("SelectorManager"),d=c?c.getConfig():{},h=o.devicePreviewMode?"":s.get("state"),p=n.getStyleable(),g=p.length,u=!d.componentFirst||t.useClasses,m={state:h};let f;if(a.stop(),g&&u){const e=s.getCurrentMedia();(f=l.get(p,h,e))||i||(f=l.add(p,h,e))}else o.avoidInlineStyle&&(!(f=l.getIdRule(r,m))&&!i&&(f=l.setIdRule(r,{},m)),e.is("wrapper")&&f.set("wrapper",1));f&&(e=f),a.start()}return e},addType(e,t){a.addType(e,t)},getType:e=>a.getType(e),getTypes:()=>a.getTypes(),createType(t,{model:s={},view:i={}}={}){const n=this.getType(t);if(n)return new n.view(e.mixin({model:new n.model(s),config:o},i))},setTarget:(e,t)=>c.setTarget(e,t),getEmitter:()=>c.propTarget,render:()=>c.render().el,_logNoSector(e){const{em:t}=this;t&&t.logWarning(`'${e}' sector not found`)}}}}),e("skylark-grapejs/modal_dialog/config/config",[],function(){"use strict";return{stylePrefix:"mdl-",title:"",content:"",backdrop:!0}}),e("skylark-grapejs/modal_dialog/model/Modal",["skylark-backbone"],function(e){"use strict";return e.Model.extend({defaults:{title:"",content:"",open:!1}})}),e("skylark-grapejs/modal_dialog/view/ModalView",["skylark-backbone"],function(e){"use strict";return e.View.extend({template:({pfx:e,ppfx:t,content:s,title:i})=>`<div class="${e}dialog ${t}one-bg ${t}two-color">\n      <div class="${e}header">\n        <div class="${e}title">${i}</div>\n        <div class="${e}btn-close" data-close-modal>&Cross;</div>\n      </div>\n      <div class="${e}content">\n        <div id="${e}c">${s}</div>\n        <div style="clear:both"></div>\n      </div>\n    </div>\n    <div class="${e}collector" style="display: none"></div>`,events:{click:"onClick","click [data-close-modal]":"hide"},initialize(e){const t=this.model,s=e.config||{},i=s.stylePrefix||"";this.config=s,this.pfx=i,this.ppfx=s.pStylePrefix||"",this.listenTo(t,"change:open",this.updateOpen),this.listenTo(t,"change:title",this.updateTitle),this.listenTo(t,"change:content",this.updateContent)},onClick(e){const t=this.config.backdrop;t&&e.target===this.el&&this.hide()},getCollector(){return this.$collector||(this.$collector=this.$el.find("."+this.pfx+"collector")),this.$collector},getContent(){const e=this.pfx;return this.$content||(this.$content=this.$el.find(`.${e}content #${e}c`)),this.$content},getTitle(){return this.$title||(this.$title=this.$el.find("."+this.pfx+"title")),this.$title.get(0)},updateContent(){var e=this.getContent();const t=e.children(),s=this.getCollector(),i=this.model.get("content");t.length&&s.append(t),e.empty().append(i)},updateTitle(){var e=this.getTitle();e&&(e.innerHTML=this.model.get("title"))},updateOpen(){this.el.style.display=this.model.get("open")?"":"none"},hide(){this.model.set("open",0)},show(){this.model.set("open",1)},render(){const e=this.$el,t=this.pfx,s=(this.ppfx,this.model.toJSON());return s.pfx=this.pfx,s.ppfx=this.ppfx,e.html(this.template(s)),e.attr("class",`${t}container`),this.updateOpen(),this}})}),e("skylark-grapejs/modal_dialog/index",["./config/config","./model/Modal","./view/ModalView"],function(e,t,s){"use strict";return()=>{var i,n,r={};return{name:"Modal",getConfig:()=>r,init(o={}){const a=(r={...e,...o}).em;this.em=a;var l=r.pStylePrefix;return l&&(r.stylePrefix=l+r.stylePrefix),(i=new t(r)).on("change:open",(e,t)=>((e,t)=>{t&&t.trigger(`modal:${e?"open":"close"}`)})(t,a)),n=new s({model:i,config:r}),this},postRender(e){const t=e.model.getConfig().el||e.el;this.render().appendTo(t)},open(e={}){return e.title&&this.setTitle(e.title),e.content&&this.setContent(e.content),n.show(),this},close(){return n.hide(),this},onceClose(e){return this.em.once("modal:close",e),this},onceOpen(e){return this.em.once("modal:open",e),this},isOpen:()=>!!i.get("open"),setTitle(e){return i.set("title",e),this},getTitle:()=>i.get("title"),setContent(e){return i.set("content"," "),i.set("content",e),this},getContent:()=>i.get("content"),getContentEl:()=>n.getContent().get(0),getModel:()=>i,render:()=>n.render().$el}}}),e("skylark-grapejs/code_manager/config/config",[],function(){"use strict";return{stylePrefix:"cm-",inlineCss:!1}}),e("skylark-grapejs/code_manager/model/HtmlGenerator",["skylark-backbone"],function(e){"use strict";return e.Model.extend({build(e,t={}){const s=e.get("components");return t.exportWrapper?e.toHTML({...t.wrapperIsBody&&{tag:"body"}}):this.buildModels(s)},buildModels(e){let t="";return e.each(e=>{t+=e.toHTML()}),t}})}),e("skylark-grapejs/code_manager/model/JsonGenerator",["skylark-underscore","skylark-backbone"],function(e,t){"use strict";return t.Model.extend({build(s){var i=s.toJSON();return this.beforeEach(i),e.each(i,function(e,s){var n=i[s];if(n instanceof t.Model)i[s]=this.build(n);else if(n instanceof t.Collection){var r=n;i[s]=[],r.length&&r.each(function(e,t){i[s][t]=this.build(e)},this)}},this),i},beforeEach(e){delete e.status}})}),e("skylark-grapejs/code_manager/model/JsGenerator",["skylark-underscore","skylark-backbone"],function(e,t){"use strict";return t.Model.extend({mapModel(t){var s="",i=t.get("script-export")||t.get("script"),n=t.get("type"),r=t.get("components"),o=t.getId();if(i){var a=t.get("attributes");a=e.extend({},a,{id:o}),t.set("attributes",a,{silent:1});var l=t.getScriptString(i);if(t.get("scriptUpdated"))this.mapJs[n+"-"+o]={ids:[o],code:l};else{var c=this.mapJs[n];c?c.ids.push(o):this.mapJs[n]={ids:[o],code:l}}}return r.each(function(e){s+=this.mapModel(e)},this),s},build(e){this.mapJs={},this.mapModel(e);var t="";for(var s in this.mapJs){var i=this.mapJs[s],n="#"+i.ids.join(", #");t+=`\n        var items = document.querySelectorAll('${n}');\n        for (var i = 0, len = items.length; i < len; i++) {\n          (function(){${i.code}}.bind(items[i]))();\n        }`}return t}})}),e("skylark-codemirror/mode/xml/xml",["../../CodeMirror"],function(e){"use strict";var t={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},s={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,allowMissingTagName:!1,caseFold:!1};e.defineMode("xml",function(i,n){var r,o,a=i.indentUnit,l={},c=n.htmlMode?t:s;for(var d in c)l[d]=c[d];for(var d in n)l[d]=n[d];function h(e,t){function s(s){return t.tokenize=s,s(e,t)}var i=e.next();return"<"==i?e.eat("!")?e.eat("[")?e.match("CDATA[")?s(g("atom","]]>")):null:e.match("--")?s(g("comment","--\x3e")):e.match("DOCTYPE",!0,!0)?(e.eatWhile(/[\w\._\-]/),s(function e(t){return function(s,i){for(var n;null!=(n=s.next());){if("<"==n)return i.tokenize=e(t+1),i.tokenize(s,i);if(">"==n){if(1==t){i.tokenize=h;break}return i.tokenize=e(t-1),i.tokenize(s,i)}}return"meta"}}(1))):null:e.eat("?")?(e.eatWhile(/[\w\._\-]/),t.tokenize=g("meta","?>"),"meta"):(r=e.eat("/")?"closeTag":"openTag",t.tokenize=p,"tag bracket"):"&"==i?(e.eat("#")?e.eat("x")?e.eatWhile(/[a-fA-F\d]/)&&e.eat(";"):e.eatWhile(/[\d]/)&&e.eat(";"):e.eatWhile(/[\w\.\-:]/)&&e.eat(";"))?"atom":"error":(e.eatWhile(/[^&<]/),null)}function p(e,t){var s,i,n=e.next();if(">"==n||"/"==n&&e.eat(">"))return t.tokenize=h,r=">"==n?"endTag":"selfcloseTag","tag bracket";if("="==n)return r="equals",null;if("<"==n){t.tokenize=h,t.state=f,t.tagName=t.tagStart=null;var o=t.tokenize(e,t);return o?o+" tag error":"tag error"}return/[\'\"]/.test(n)?(t.tokenize=(s=n,(i=function(e,t){for(;!e.eol();)if(e.next()==s){t.tokenize=p;break}return"string"}).isInAttribute=!0,i),t.stringStartCol=e.column(),t.tokenize(e,t)):(e.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function g(e,t){return function(s,i){for(;!s.eol();){if(s.match(t)){i.tokenize=h;break}s.next()}return e}}function u(e){e.context&&(e.context=e.context.prev)}function m(e,t){for(var s;;){if(!e.context)return;if(s=e.context.tagName,!l.contextGrabbers.hasOwnProperty(s)||!l.contextGrabbers[s].hasOwnProperty(t))return;u(e)}}function f(e,t,s){return"openTag"==e?(s.tagStart=t.column(),v):"closeTag"==e?y:f}function v(e,t,s){return"word"==e?(s.tagName=t.current(),o="tag",w):l.allowMissingTagName&&"endTag"==e?(o="tag bracket",w(e,t,s)):(o="error",v)}function y(e,t,s){if("word"==e){var i=t.current();return s.context&&s.context.tagName!=i&&l.implicitlyClosed.hasOwnProperty(s.context.tagName)&&u(s),s.context&&s.context.tagName==i||!1===l.matchClosing?(o="tag",b):(o="tag error",k)}return l.allowMissingTagName&&"endTag"==e?(o="tag bracket",b(e,t,s)):(o="error",k)}function b(e,t,s){return"endTag"!=e?(o="error",b):(u(s),f)}function k(e,t,s){return o="error",b(e,t,s)}function w(e,t,s){if("word"==e)return o="attribute",x;if("endTag"==e||"selfcloseTag"==e){var i=s.tagName,n=s.tagStart;return s.tagName=s.tagStart=null,"selfcloseTag"==e||l.autoSelfClosers.hasOwnProperty(i)?m(s,i):(m(s,i),s.context=new function(e,t,s){this.prev=e.context,this.tagName=t,this.indent=e.indented,this.startOfLine=s,(l.doNotIndent.hasOwnProperty(t)||e.context&&e.context.noIndent)&&(this.noIndent=!0)}(s,i,n==s.indented)),f}return o="error",w}function x(e,t,s){return"equals"==e?C:(l.allowMissing||(o="error"),w(e,t,s))}function C(e,t,s){return"string"==e?S:"word"==e&&l.allowUnquoted?(o="string",w):(o="error",w(e,t,s))}function S(e,t,s){return"string"==e?S:w(e,t,s)}return h.isInText=!0,{startState:function(e){var t={tokenize:h,state:f,indented:e||0,tagName:null,tagStart:null,context:null};return null!=e&&(t.baseIndent=e),t},token:function(e,t){if(!t.tagName&&e.sol()&&(t.indented=e.indentation()),e.eatSpace())return null;r=null;var s=t.tokenize(e,t);return(s||r)&&"comment"!=s&&(o=null,t.state=t.state(r||s,e,t),o&&(s="error"==o?s+" error":o)),s},indent:function(t,s,i){var n=t.context;if(t.tokenize.isInAttribute)return t.tagStart==t.indented?t.stringStartCol+1:t.indented+a;if(n&&n.noIndent)return e.Pass;if(t.tokenize!=p&&t.tokenize!=h)return i?i.match(/^(\s*)/)[0].length:0;if(t.tagName)return!1!==l.multilineTagIndentPastTag?t.tagStart+t.tagName.length+2:t.tagStart+a*(l.multilineTagIndentFactor||1);if(l.alignCDATA&&/<!\[CDATA\[/.test(s))return 0;var r=s&&/^<(\/)?([\w_:\.-]*)/.exec(s);if(r&&r[1])for(;n;){if(n.tagName==r[2]){n=n.prev;break}if(!l.implicitlyClosed.hasOwnProperty(n.tagName))break;n=n.prev}else if(r)for(;n;){var o=l.contextGrabbers[n.tagName];if(!o||!o.hasOwnProperty(r[2]))break;n=n.prev}for(;n&&n.prev&&!n.startOfLine;)n=n.prev;return n?n.indent+a:t.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",configuration:l.htmlMode?"html":"xml",helperType:l.htmlMode?"html":"xml",skipAttribute:function(e){e.state==C&&(e.state=w)}}}),e.defineMIME("text/xml","xml"),e.defineMIME("application/xml","xml"),e.mimeModes.hasOwnProperty("text/html")||e.defineMIME("text/html",{name:"xml",htmlMode:!0})}),e("skylark-codemirror/mode/javascript/javascript",["../../CodeMirror"],function(e){"use strict";e.defineMode("javascript",function(t,s){var i,n,r=t.indentUnit,o=s.statementIndent,a=s.jsonld,l=s.json||a,c=s.typescript,d=s.wordCharacters||/[\w$\xa1-\uffff]/,h=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),s=e("keyword b"),i=e("keyword c"),n=e("keyword d"),r=e("operator"),o={type:"atom",style:"atom"};return{if:e("if"),while:t,with:t,else:s,do:s,try:s,finally:s,return:n,break:n,continue:n,new:e("new"),delete:i,void:i,throw:i,debugger:e("debugger"),var:e("var"),const:e("var"),let:e("var"),function:e("function"),catch:e("catch"),for:e("for"),switch:e("switch"),case:e("case"),default:e("default"),in:r,typeof:r,instanceof:r,true:o,false:o,null:o,undefined:o,NaN:o,Infinity:o,this:e("this"),class:e("class"),super:e("atom"),yield:i,export:e("export"),import:e("import"),extends:i,await:i}}(),p=/[+\-*&%=<>!?|~^@]/,g=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function u(e,t,s){return i=e,n=s,t}function m(e,t){var s,i=e.next();if('"'==i||"'"==i)return t.tokenize=(s=i,function(e,t){var i,n=!1;if(a&&"@"==e.peek()&&e.match(g))return t.tokenize=m,u("jsonld-keyword","meta");for(;null!=(i=e.next())&&(i!=s||n);)n=!n&&"\\"==i;return n||(t.tokenize=m),u("string","string")}),t.tokenize(e,t);if("."==i&&e.match(/^\d+(?:[eE][+\-]?\d+)?/))return u("number","number");if("."==i&&e.match(".."))return u("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(i))return u(i);if("="==i&&e.eat(">"))return u("=>","operator");if("0"==i&&e.match(/^(?:x[\da-f]+|o[0-7]+|b[01]+)n?/i))return u("number","number");if(/\d/.test(i))return e.match(/^\d*(?:n|(?:\.\d*)?(?:[eE][+\-]?\d+)?)?/),u("number","number");if("/"==i)return e.eat("*")?(t.tokenize=f,f(e,t)):e.eat("/")?(e.skipToEnd(),u("comment","comment")):Ge(e,t,1)?(function(e){var t,s=!1,i=!1;for(;null!=(t=e.next());){if(!s){if("/"==t&&!i)return;"["==t?i=!0:i&&"]"==t&&(i=!1)}s=!s&&"\\"==t}}(e),e.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),u("regexp","string-2")):(e.eat("="),u("operator","operator",e.current()));if("`"==i)return t.tokenize=v,v(e,t);if("#"==i)return e.skipToEnd(),u("error","error");if(p.test(i))return">"==i&&t.lexical&&">"==t.lexical.type||(e.eat("=")?"!"!=i&&"="!=i||e.eat("="):/[<>*+\-]/.test(i)&&(e.eat(i),">"==i&&e.eat(i))),u("operator","operator",e.current());if(d.test(i)){e.eatWhile(d);var n=e.current();if("."!=t.lastType){if(h.propertyIsEnumerable(n)){var r=h[n];return u(r.type,r.style,n)}if("async"==n&&e.match(/^(\s|\/\*.*?\*\/)*[\[\(\w]/,!1))return u("async","keyword",n)}return u("variable","variable",n)}}function f(e,t){for(var s,i=!1;s=e.next();){if("/"==s&&i){t.tokenize=m;break}i="*"==s}return u("comment","comment")}function v(e,t){for(var s,i=!1;null!=(s=e.next());){if(!i&&("`"==s||"$"==s&&e.eat("{"))){t.tokenize=m;break}i=!i&&"\\"==s}return u("quasi","string-2",e.current())}var y="([{}])";function b(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var s=e.string.indexOf("=>",e.start);if(!(s<0)){if(c){var i=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(e.string.slice(e.start,s));i&&(s=i.index)}for(var n=0,r=!1,o=s-1;o>=0;--o){var a=e.string.charAt(o),l=y.indexOf(a);if(l>=0&&l<3){if(!n){++o;break}if(0==--n){"("==a&&(r=!0);break}}else if(l>=3&&l<6)++n;else if(d.test(a))r=!0;else{if(/["'\/]/.test(a))return;if(r&&!n){++o;break}}}r&&!n&&(t.fatArrowAt=o)}}var k={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,"jsonld-keyword":!0};function w(e,t,s,i,n,r){this.indented=e,this.column=t,this.type=s,this.prev=n,this.info=r,null!=i&&(this.align=i)}function x(e,t){for(var s=e.localVars;s;s=s.next)if(s.name==t)return!0;for(var i=e.context;i;i=i.prev)for(var s=i.vars;s;s=s.next)if(s.name==t)return!0}var C={state:null,column:null,marked:null,cc:null};function S(){for(var e=arguments.length-1;e>=0;e--)C.cc.push(arguments[e])}function T(){return S.apply(null,arguments),!0}function $(e,t){for(var s=t;s;s=s.next)if(s.name==e)return!0;return!1}function E(e){var t=C.state;if(C.marked="def",t.context)if("var"==t.lexical.info&&t.context&&t.context.block){var i=function e(t,s){if(s){if(s.block){var i=e(t,s.prev);return i?i==s.prev?s:new V(i,s.vars,!0):null}return $(t,s.vars)?s:new V(s.prev,new M(t,s.vars),!1)}return null}(e,t.context);if(null!=i)return void(t.context=i)}else if(!$(e,t.localVars))return void(t.localVars=new M(e,t.localVars));s.globalVars&&!$(e,t.globalVars)&&(t.globalVars=new M(e,t.globalVars))}function P(e){return"public"==e||"private"==e||"protected"==e||"abstract"==e||"readonly"==e}function V(e,t,s){this.prev=e,this.vars=t,this.block=s}function M(e,t){this.name=e,this.next=t}var A=new M("this",new M("arguments",null));function _(){C.state.context=new V(C.state.context,C.state.localVars,!1),C.state.localVars=A}function D(){C.state.context=new V(C.state.context,C.state.localVars,!0),C.state.localVars=null}function I(){C.state.localVars=C.state.context.vars,C.state.context=C.state.context.prev}function N(e,t){var s=function(){var s=C.state,i=s.indented;if("stat"==s.lexical.type)i=s.lexical.indented;else for(var n=s.lexical;n&&")"==n.type&&n.align;n=n.prev)i=n.indented;s.lexical=new w(i,C.stream.column(),e,null,s.lexical,t)};return s.lex=!0,s}function j(){var e=C.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function F(e){return function t(s){return s==e?T():";"==e||"}"==s||")"==s||"]"==s?S():T(t)}}function O(e,t){return"var"==e?T(N("vardef",t),ye,F(";"),j):"keyword a"==e?T(N("form"),H,O,j):"keyword b"==e?T(N("form"),O,j):"keyword d"==e?C.stream.match(/^\s*$/,!1)?T():T(N("stat"),B,F(";"),j):"debugger"==e?T(F(";")):"{"==e?T(N("}"),D,oe,j,I):";"==e?T():"if"==e?("else"==C.state.lexical.info&&C.state.cc[C.state.cc.length-1]==j&&C.state.cc.pop()(),T(N("form"),H,O,j,Se)):"function"==e?T(Pe):"for"==e?T(N("form"),Te,O,j):"class"==e||c&&"interface"==t?(C.marked="keyword",T(N("form","class"==e?e:t),De,j)):"variable"==e?c&&"declare"==t?(C.marked="keyword",T(O)):c&&("module"==t||"enum"==t||"type"==t)&&C.stream.match(/^\s*\w/,!1)?(C.marked="keyword","enum"==t?T(qe):"type"==t?T(Me,F("operator"),de,F(";")):T(N("form"),be,F("{"),N("}"),oe,j,j)):c&&"namespace"==t?(C.marked="keyword",T(N("form"),R,O,j)):c&&"abstract"==t?(C.marked="keyword",T(O)):T(N("stat"),Q):"switch"==e?T(N("form"),H,F("{"),N("}","switch"),D,oe,j,j,I):"case"==e?T(R,F(":")):"default"==e?T(F(":")):"catch"==e?T(N("form"),_,L,O,j,I):"export"==e?T(N("stat"),Fe,j):"import"==e?T(N("stat"),Le,j):"async"==e?T(O):"@"==t?T(R,O):S(N("stat"),R,F(";"),j)}function L(e){if("("==e)return T(Ae,F(")"))}function R(e,t){return U(e,t,!1)}function z(e,t){return U(e,t,!0)}function H(e){return"("!=e?S():T(N(")"),R,F(")"),j)}function U(e,t,s){if(C.state.fatArrowAt==C.stream.start){var i=s?J:Y;if("("==e)return T(_,N(")"),ne(Ae,")"),j,F("=>"),i,I);if("variable"==e)return S(_,be,F("=>"),i,I)}var n=s?W:q;return k.hasOwnProperty(e)?T(n):"function"==e?T(Pe,n):"class"==e||c&&"interface"==t?(C.marked="keyword",T(N("form"),_e,j)):"keyword c"==e||"async"==e?T(s?z:R):"("==e?T(N(")"),B,F(")"),j,n):"operator"==e||"spread"==e?T(s?z:R):"["==e?T(N("]"),Be,j,n):"{"==e?re(te,"}",null,n):"quasi"==e?S(G,n):"new"==e?T(function(e){return function(t){return"."==t?T(e?Z:X):"variable"==t&&c?T(me,e?W:q):S(e?z:R)}}(s)):"import"==e?T(R):T()}function B(e){return e.match(/[;\}\)\],]/)?S():S(R)}function q(e,t){return","==e?T(R):W(e,t,!1)}function W(e,t,s){var i=0==s?q:W,n=0==s?R:z;return"=>"==e?T(_,s?J:Y,I):"operator"==e?/\+\+|--/.test(t)||c&&"!"==t?T(i):c&&"<"==t&&C.stream.match(/^([^>]|<.*?>)*>\s*\(/,!1)?T(N(">"),ne(de,">"),j,i):"?"==t?T(R,F(":"),n):T(n):"quasi"==e?S(G,i):";"!=e?"("==e?re(z,")","call",i):"."==e?T(ee,i):"["==e?T(N("]"),B,F("]"),j,i):c&&"as"==t?(C.marked="keyword",T(de,i)):"regexp"==e?(C.state.lastType=C.marked="operator",C.stream.backUp(C.stream.pos-C.stream.start-1),T(n)):void 0:void 0}function G(e,t){return"quasi"!=e?S():"${"!=t.slice(t.length-2)?T(G):T(R,K)}function K(e){if("}"==e)return C.marked="string-2",C.state.tokenize=v,T(G)}function Y(e){return b(C.stream,C.state),S("{"==e?O:R)}function J(e){return b(C.stream,C.state),S("{"==e?O:z)}function X(e,t){if("target"==t)return C.marked="keyword",T(q)}function Z(e,t){if("target"==t)return C.marked="keyword",T(W)}function Q(e){return":"==e?T(j,O):S(q,F(";"),j)}function ee(e){if("variable"==e)return C.marked="property",T()}function te(e,t){if("async"==e)return C.marked="property",T(te);if("variable"==e||"keyword"==C.style){return C.marked="property","get"==t||"set"==t?T(se):(c&&C.state.fatArrowAt==C.stream.start&&(s=C.stream.match(/^\s*:\s*/,!1))&&(C.state.fatArrowAt=C.stream.pos+s[0].length),T(ie));var s}else{if("number"==e||"string"==e)return C.marked=a?"property":C.style+" property",T(ie);if("jsonld-keyword"==e)return T(ie);if(c&&P(t))return C.marked="keyword",T(te);if("["==e)return T(R,ae,F("]"),ie);if("spread"==e)return T(z,ie);if("*"==t)return C.marked="keyword",T(te);if(":"==e)return S(ie)}}function se(e){return"variable"!=e?S(ie):(C.marked="property",T(Pe))}function ie(e){return":"==e?T(z):"("==e?S(Pe):void 0}function ne(e,t,s){function i(n,r){if(s?s.indexOf(n)>-1:","==n){var o=C.state.lexical;return"call"==o.info&&(o.pos=(o.pos||0)+1),T(function(s,i){return s==t||i==t?S():S(e)},i)}return n==t||r==t?T():s&&s.indexOf(";")>-1?S(e):T(F(t))}return function(s,n){return s==t||n==t?T():S(e,i)}}function re(e,t,s){for(var i=3;i<arguments.length;i++)C.cc.push(arguments[i]);return T(N(t,s),ne(e,t),j)}function oe(e){return"}"==e?T():S(O,oe)}function ae(e,t){if(c){if(":"==e||"in"==t)return T(de);if("?"==t)return T(ae)}}function le(e){if(c&&":"==e)return C.stream.match(/^\s*\w+\s+is\b/,!1)?T(R,ce,de):T(de)}function ce(e,t){if("is"==t)return C.marked="keyword",T()}function de(e,t){return"keyof"==t||"typeof"==t||"infer"==t?(C.marked="keyword",T("typeof"==t?z:de)):"variable"==e||"void"==t?(C.marked="type",T(ue)):"|"==t||"&"==t?T(de):"string"==e||"number"==e||"atom"==e?T(ue):"["==e?T(N("]"),ne(de,"]",","),j,ue):"{"==e?T(N("}"),ne(pe,"}",",;"),j,ue):"("==e?T(ne(ge,")"),he,ue):"<"==e?T(ne(de,">"),de):void 0}function he(e){if("=>"==e)return T(de)}function pe(e,t){return"variable"==e||"keyword"==C.style?(C.marked="property",T(pe)):"?"==t||"number"==e||"string"==e?T(pe):":"==e?T(de):"["==e?T(F("variable"),ae,F("]"),pe):"("==e?S(Ve,pe):void 0}function ge(e,t){return"variable"==e&&C.stream.match(/^\s*[?:]/,!1)||"?"==t?T(ge):":"==e?T(de):"spread"==e?T(ge):S(de)}function ue(e,t){return"<"==t?T(N(">"),ne(de,">"),j,ue):"|"==t||"."==e||"&"==t?T(de):"["==e?T(de,F("]"),ue):"extends"==t||"implements"==t?(C.marked="keyword",T(de)):"?"==t?T(de,F(":"),de):void 0}function me(e,t){if("<"==t)return T(N(">"),ne(de,">"),j,ue)}function fe(){return S(de,ve)}function ve(e,t){if("="==t)return T(de)}function ye(e,t){return"enum"==t?(C.marked="keyword",T(qe)):S(be,ae,xe,Ce)}function be(e,t){return c&&P(t)?(C.marked="keyword",T(be)):"variable"==e?(E(t),T()):"spread"==e?T(be):"["==e?re(we,"]"):"{"==e?re(ke,"}"):void 0}function ke(e,t){return"variable"!=e||C.stream.match(/^\s*:/,!1)?("variable"==e&&(C.marked="property"),"spread"==e?T(be):"}"==e?S():"["==e?T(R,F("]"),F(":"),ke):T(F(":"),be,xe)):(E(t),T(xe))}function we(){return S(be,xe)}function xe(e,t){if("="==t)return T(z)}function Ce(e){if(","==e)return T(ye)}function Se(e,t){if("keyword b"==e&&"else"==t)return T(N("form","else"),O,j)}function Te(e,t){return"await"==t?T(Te):"("==e?T(N(")"),$e,j):void 0}function $e(e){return"var"==e?T(ye,Ee):"variable"==e?T(Ee):S(Ee)}function Ee(e,t){return")"==e?T():";"==e?T(Ee):"in"==t||"of"==t?(C.marked="keyword",T(R,Ee)):S(R,Ee)}function Pe(e,t){return"*"==t?(C.marked="keyword",T(Pe)):"variable"==e?(E(t),T(Pe)):"("==e?T(_,N(")"),ne(Ae,")"),j,le,O,I):c&&"<"==t?T(N(">"),ne(fe,">"),j,Pe):void 0}function Ve(e,t){return"*"==t?(C.marked="keyword",T(Ve)):"variable"==e?(E(t),T(Ve)):"("==e?T(_,N(")"),ne(Ae,")"),j,le,I):c&&"<"==t?T(N(">"),ne(fe,">"),j,Ve):void 0}function Me(e,t){return"keyword"==e||"variable"==e?(C.marked="type",T(Me)):"<"==t?T(N(">"),ne(fe,">"),j):void 0}function Ae(e,t){return"@"==t&&T(R,Ae),"spread"==e?T(Ae):c&&P(t)?(C.marked="keyword",T(Ae)):c&&"this"==e?T(ae,xe):S(be,ae,xe)}function _e(e,t){return"variable"==e?De(e,t):Ie(e,t)}function De(e,t){if("variable"==e)return E(t),T(Ie)}function Ie(e,t){return"<"==t?T(N(">"),ne(fe,">"),j,Ie):"extends"==t||"implements"==t||c&&","==e?("implements"==t&&(C.marked="keyword"),T(c?de:R,Ie)):"{"==e?T(N("}"),Ne,j):void 0}function Ne(e,t){return"async"==e||"variable"==e&&("static"==t||"get"==t||"set"==t||c&&P(t))&&C.stream.match(/^\s+[\w$\xa1-\uffff]/,!1)?(C.marked="keyword",T(Ne)):"variable"==e||"keyword"==C.style?(C.marked="property",T(c?je:Pe,Ne)):"number"==e||"string"==e?T(c?je:Pe,Ne):"["==e?T(R,ae,F("]"),c?je:Pe,Ne):"*"==t?(C.marked="keyword",T(Ne)):c&&"("==e?S(Ve,Ne):";"==e||","==e?T(Ne):"}"==e?T():"@"==t?T(R,Ne):void 0}function je(e,t){if("?"==t)return T(je);if(":"==e)return T(de,xe);if("="==t)return T(z);var s=C.state.lexical.prev,i=s&&"interface"==s.info;return S(i?Ve:Pe)}function Fe(e,t){return"*"==t?(C.marked="keyword",T(Ue,F(";"))):"default"==t?(C.marked="keyword",T(R,F(";"))):"{"==e?T(ne(Oe,"}"),Ue,F(";")):S(O)}function Oe(e,t){return"as"==t?(C.marked="keyword",T(F("variable"))):"variable"==e?S(z,Oe):void 0}function Le(e){return"string"==e?T():"("==e?S(R):S(Re,ze,Ue)}function Re(e,t){return"{"==e?re(Re,"}"):("variable"==e&&E(t),"*"==t&&(C.marked="keyword"),T(He))}function ze(e){if(","==e)return T(Re,ze)}function He(e,t){if("as"==t)return C.marked="keyword",T(Re)}function Ue(e,t){if("from"==t)return C.marked="keyword",T(R)}function Be(e){return"]"==e?T():S(ne(z,"]"))}function qe(){return S(N("form"),be,F("{"),N("}"),ne(We,"}"),j,j)}function We(){return S(be,xe)}function Ge(e,t,s){return t.tokenize==m&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(t.lastType)||"quasi"==t.lastType&&/\{\s*$/.test(e.string.slice(0,e.pos-(s||0)))}return I.lex=!0,j.lex=!0,{startState:function(e){var t={tokenize:m,lastType:"sof",cc:[],lexical:new w((e||0)-r,0,"block",!1),localVars:s.localVars,context:s.localVars&&new V(null,null,!1),indented:e||0};return s.globalVars&&"object"==typeof s.globalVars&&(t.globalVars=s.globalVars),t},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),b(e,t)),t.tokenize!=f&&e.eatSpace())return null;var s=t.tokenize(e,t);return"comment"==i?s:(t.lastType="operator"!=i||"++"!=n&&"--"!=n?i:"incdec",function(e,t,s,i,n){var r=e.cc;C.state=e,C.stream=n,C.marked=null,C.cc=r,C.style=t,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);for(;;){var o=r.length?r.pop():l?R:O;if(o(s,i)){for(;r.length&&r[r.length-1].lex;)r.pop()();return C.marked?C.marked:"variable"==s&&x(e,i)?"variable-2":t}}}(t,s,i,n,e))},indent:function(t,i){if(t.tokenize==f)return e.Pass;if(t.tokenize!=m)return 0;var n,a=i&&i.charAt(0),l=t.lexical;if(!/^\s*else\b/.test(i))for(var c=t.cc.length-1;c>=0;--c){var d=t.cc[c];if(d==j)l=l.prev;else if(d!=Se)break}for(;("stat"==l.type||"form"==l.type)&&("}"==a||(n=t.cc[t.cc.length-1])&&(n==q||n==W)&&!/^[,\.=+\-*:?[\(]/.test(i));)l=l.prev;o&&")"==l.type&&"stat"==l.prev.type&&(l=l.prev);var h=l.type,g=a==h;return"vardef"==h?l.indented+("operator"==t.lastType||","==t.lastType?l.info.length+1:0):"form"==h&&"{"==a?l.indented:"form"==h?l.indented+r:"stat"==h?l.indented+(function(e,t){return"operator"==e.lastType||","==e.lastType||p.test(t.charAt(0))||/[,.]/.test(t.charAt(0))}(t,i)?o||r:0):"switch"!=l.info||g||0==s.doubleIndentSwitch?l.align?l.column+(g?0:1):l.indented+(g?0:r):l.indented+(/^(?:case|default)\b/.test(i)?r:2*r)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:l?null:"/*",blockCommentEnd:l?null:"*/",blockCommentContinue:l?null:" * ",lineComment:l?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:l?"json":"javascript",jsonldMode:a,jsonMode:l,expressionAllowed:Ge,skipExpression:function(e){var t=e.cc[e.cc.length-1];t!=R&&t!=z||e.cc.pop()}}}),e.registerHelper("wordChars","javascript",/[\w$]/),e.defineMIME("text/javascript","javascript"),e.defineMIME("text/ecmascript","javascript"),e.defineMIME("application/javascript","javascript"),e.defineMIME("application/x-javascript","javascript"),e.defineMIME("application/ecmascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMIME("application/x-json",{name:"javascript",json:!0}),e.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),e.defineMIME("text/typescript",{name:"javascript",typescript:!0}),e.defineMIME("application/typescript",{name:"javascript",typescript:!0})}),e("skylark-codemirror/mode/css/css",["../../CodeMirror"],function(e){"use strict";function t(e){for(var t={},s=0;s<e.length;++s)t[e[s].toLowerCase()]=!0;return t}e.defineMode("css",function(t,s){var i=s.inline;s.propertyKeywords||(s=e.resolveMode("text/css"));var n,r,o=t.indentUnit,a=s.tokenHooks,l=s.documentTypes||{},c=s.mediaTypes||{},d=s.mediaFeatures||{},h=s.mediaValueKeywords||{},p=s.propertyKeywords||{},g=s.nonStandardPropertyKeywords||{},u=s.fontProperties||{},m=s.counterDescriptors||{},f=s.colorKeywords||{},v=s.valueKeywords||{},y=s.allowNested,b=s.lineComment,k=!0===s.supportsAtComponent;function w(e,t){return n=t,e}function x(e){return function(t,s){for(var i,n=!1;null!=(i=t.next());){if(i==e&&!n){")"==e&&t.backUp(1);break}n=!n&&"\\"==i}return(i==e||!n&&")"!=e)&&(s.tokenize=null),w("string","string")}}function C(e,t){return e.next(),e.match(/\s*[\"\')]/,!1)?t.tokenize=null:t.tokenize=x(")"),w(null,"(")}function S(e,t,s){this.type=e,this.indent=t,this.prev=s}function T(e,t,s,i){return e.context=new S(s,t.indentation()+(!1===i?0:o),e.context),s}function $(e){return e.context.prev&&(e.context=e.context.prev),e.context.type}function E(e,t,s){return M[s.context.type](e,t,s)}function P(e,t,s,i){for(var n=i||1;n>0;n--)s.context=s.context.prev;return E(e,t,s)}function V(e){var t=e.current().toLowerCase();r=v.hasOwnProperty(t)?"atom":f.hasOwnProperty(t)?"keyword":"variable"}var M={top:function(e,t,s){if("{"==e)return T(s,t,"block");if("}"==e&&s.context.prev)return $(s);if(k&&/@component/i.test(e))return T(s,t,"atComponentBlock");if(/^@(-moz-)?document$/i.test(e))return T(s,t,"documentTypes");if(/^@(media|supports|(-moz-)?document|import)$/i.test(e))return T(s,t,"atBlock");if(/^@(font-face|counter-style)/i.test(e))return s.stateArg=e,"restricted_atBlock_before";if(/^@(-(moz|ms|o|webkit)-)?keyframes$/i.test(e))return"keyframes";if(e&&"@"==e.charAt(0))return T(s,t,"at");if("hash"==e)r="builtin";else if("word"==e)r="tag";else{if("variable-definition"==e)return"maybeprop";if("interpolation"==e)return T(s,t,"interpolation");if(":"==e)return"pseudo";if(y&&"("==e)return T(s,t,"parens")}return s.context.type},block:function(e,t,s){if("word"==e){var i=t.current().toLowerCase();return p.hasOwnProperty(i)?(r="property","maybeprop"):g.hasOwnProperty(i)?(r="string-2","maybeprop"):y?(r=t.match(/^\s*:(?:\s|$)/,!1)?"property":"tag","block"):(r+=" error","maybeprop")}return"meta"==e?"block":y||"hash"!=e&&"qualifier"!=e?M.top(e,t,s):(r="error","block")},maybeprop:function(e,t,s){return":"==e?T(s,t,"prop"):E(e,t,s)},prop:function(e,t,s){if(";"==e)return $(s);if("{"==e&&y)return T(s,t,"propBlock");if("}"==e||"{"==e)return P(e,t,s);if("("==e)return T(s,t,"parens");if("hash"!=e||/^#([0-9a-fA-f]{3,4}|[0-9a-fA-f]{6}|[0-9a-fA-f]{8})$/.test(t.current())){if("word"==e)V(t);else if("interpolation"==e)return T(s,t,"interpolation")}else r+=" error";return"prop"},propBlock:function(e,t,s){return"}"==e?$(s):"word"==e?(r="property","maybeprop"):s.context.type},parens:function(e,t,s){return"{"==e||"}"==e?P(e,t,s):")"==e?$(s):"("==e?T(s,t,"parens"):"interpolation"==e?T(s,t,"interpolation"):("word"==e&&V(t),"parens")},pseudo:function(e,t,s){return"meta"==e?"pseudo":"word"==e?(r="variable-3",s.context.type):E(e,t,s)},documentTypes:function(e,t,s){return"word"==e&&l.hasOwnProperty(t.current())?(r="tag",s.context.type):M.atBlock(e,t,s)},atBlock:function(e,t,s){if("("==e)return T(s,t,"atBlock_parens");if("}"==e||";"==e)return P(e,t,s);if("{"==e)return $(s)&&T(s,t,y?"block":"top");if("interpolation"==e)return T(s,t,"interpolation");if("word"==e){var i=t.current().toLowerCase();r="only"==i||"not"==i||"and"==i||"or"==i?"keyword":c.hasOwnProperty(i)?"attribute":d.hasOwnProperty(i)?"property":h.hasOwnProperty(i)?"keyword":p.hasOwnProperty(i)?"property":g.hasOwnProperty(i)?"string-2":v.hasOwnProperty(i)?"atom":f.hasOwnProperty(i)?"keyword":"error"}return s.context.type},atComponentBlock:function(e,t,s){return"}"==e?P(e,t,s):"{"==e?$(s)&&T(s,t,y?"block":"top",!1):("word"==e&&(r="error"),s.context.type)},atBlock_parens:function(e,t,s){return")"==e?$(s):"{"==e||"}"==e?P(e,t,s,2):M.atBlock(e,t,s)},restricted_atBlock_before:function(e,t,s){return"{"==e?T(s,t,"restricted_atBlock"):"word"==e&&"@counter-style"==s.stateArg?(r="variable","restricted_atBlock_before"):E(e,t,s)},restricted_atBlock:function(e,t,s){return"}"==e?(s.stateArg=null,$(s)):"word"==e?(r="@font-face"==s.stateArg&&!u.hasOwnProperty(t.current().toLowerCase())||"@counter-style"==s.stateArg&&!m.hasOwnProperty(t.current().toLowerCase())?"error":"property","maybeprop"):"restricted_atBlock"},keyframes:function(e,t,s){return"word"==e?(r="variable","keyframes"):"{"==e?T(s,t,"top"):E(e,t,s)},at:function(e,t,s){return";"==e?$(s):"{"==e||"}"==e?P(e,t,s):("word"==e?r="tag":"hash"==e&&(r="builtin"),"at")},interpolation:function(e,t,s){return"}"==e?$(s):"{"==e||";"==e?P(e,t,s):("word"==e?r="variable":"variable"!=e&&"("!=e&&")"!=e&&(r="error"),"interpolation")}};return{startState:function(e){return{tokenize:null,state:i?"block":"top",stateArg:null,context:new S(i?"block":"top",e||0,null)}},token:function(e,t){if(!t.tokenize&&e.eatSpace())return null;var s=(t.tokenize||function(e,t){var s=e.next();if(a[s]){var i=a[s](e,t);if(!1!==i)return i}if("@"==s)return e.eatWhile(/[\w\\\-]/),w("def",e.current());if("="==s||("~"==s||"|"==s)&&e.eat("="))return w(null,"compare");if('"'==s||"'"==s)return t.tokenize=x(s),t.tokenize(e,t);if("#"==s)return e.eatWhile(/[\w\\\-]/),w("atom","hash");if("!"==s)return e.match(/^\s*\w*/),w("keyword","important");if(/\d/.test(s)||"."==s&&e.eat(/\d/))return e.eatWhile(/[\w.%]/),w("number","unit");if("-"!==s)return/[,+>*\/]/.test(s)?w(null,"select-op"):"."==s&&e.match(/^-?[_a-z][_a-z0-9-]*/i)?w("qualifier","qualifier"):/[:;{}\[\]\(\)]/.test(s)?w(null,s):e.match(/[\w-.]+(?=\()/)?(/^(url(-prefix)?|domain|regexp)$/.test(e.current().toLowerCase())&&(t.tokenize=C),w("variable callee","variable")):/[\w\\\-]/.test(s)?(e.eatWhile(/[\w\\\-]/),w("property","word")):w(null,null);if(/[\d.]/.test(e.peek()))return e.eatWhile(/[\w.%]/),w("number","unit");if(e.match(/^-[\w\\\-]*/))return e.eatWhile(/[\w\\\-]/),e.match(/^\s*:/,!1)?w("variable-2","variable-definition"):w("variable-2","variable");if(e.match(/^\w+-/))return w("meta","meta")})(e,t);return s&&"object"==typeof s&&(n=s[1],s=s[0]),r=s,"comment"!=n&&(t.state=M[t.state](n,e,t)),r},indent:function(e,t){var s=e.context,i=t&&t.charAt(0),n=s.indent;return"prop"!=s.type||"}"!=i&&")"!=i||(s=s.prev),s.prev&&("}"!=i||"block"!=s.type&&"top"!=s.type&&"interpolation"!=s.type&&"restricted_atBlock"!=s.type?(")"!=i||"parens"!=s.type&&"atBlock_parens"!=s.type)&&("{"!=i||"at"!=s.type&&"atBlock"!=s.type)||(n=Math.max(0,s.indent-o)):(s=s.prev,n=s.indent)),n},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",lineComment:b,fold:"brace"}});var s=["domain","regexp","url","url-prefix"],i=t(s),n=["all","aural","braille","handheld","print","projection","screen","tty","tv","embossed"],r=t(n),o=["width","min-width","max-width","height","min-height","max-height","device-width","min-device-width","max-device-width","device-height","min-device-height","max-device-height","aspect-ratio","min-aspect-ratio","max-aspect-ratio","device-aspect-ratio","min-device-aspect-ratio","max-device-aspect-ratio","color","min-color","max-color","color-index","min-color-index","max-color-index","monochrome","min-monochrome","max-monochrome","resolution","min-resolution","max-resolution","scan","grid","orientation","device-pixel-ratio","min-device-pixel-ratio","max-device-pixel-ratio","pointer","any-pointer","hover","any-hover"],a=t(o),l=["landscape","portrait","none","coarse","fine","on-demand","hover","interlace","progressive"],c=t(l),d=["align-content","align-items","align-self","alignment-adjust","alignment-baseline","anchor-point","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","float-offset","flow-from","flow-into","font","font-feature-settings","font-family","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-weight","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-gap","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-gap","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","justify-content","justify-items","justify-self","left","letter-spacing","line-break","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","mix-blend-mode","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-wrap","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","pitch","pitch-range","place-content","place-items","place-self","play-during","position","presentation-level","punctuation-trim","quotes","region-break-after","region-break-before","region-break-inside","region-fragment","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","shape-image-threshold","shape-inside","shape-margin","shape-outside","size","speak","speak-as","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","tab-size","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-height","text-indent","text-justify","text-outline","text-overflow","text-shadow","text-size-adjust","text-space-collapse","text-transform","text-underline-position","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","user-select","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","z-index","clip-path","clip-rule","mask","enable-background","filter","flood-color","flood-opacity","lighting-color","stop-color","stop-opacity","pointer-events","color-interpolation","color-interpolation-filters","color-rendering","fill","fill-opacity","fill-rule","image-rendering","marker","marker-end","marker-mid","marker-start","shape-rendering","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-rendering","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","text-anchor","writing-mode"],h=t(d),p=["scrollbar-arrow-color","scrollbar-base-color","scrollbar-dark-shadow-color","scrollbar-face-color","scrollbar-highlight-color","scrollbar-shadow-color","scrollbar-3d-light-color","scrollbar-track-color","shape-inside","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","zoom"],g=t(p),u=t(["font-family","src","unicode-range","font-variant","font-feature-settings","font-stretch","font-weight","font-style"]),m=t(["additive-symbols","fallback","negative","pad","prefix","range","speak-as","suffix","symbols","system"]),f=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],v=t(f),y=["above","absolute","activeborder","additive","activecaption","afar","after-white-space","ahead","alias","all","all-scroll","alphabetic","alternate","always","amharic","amharic-abegede","antialiased","appworkspace","arabic-indic","armenian","asterisks","attr","auto","auto-flow","avoid","avoid-column","avoid-page","avoid-region","background","backwards","baseline","below","bidi-override","binary","bengali","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","bullets","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","calc","cambodian","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-decimal","cjk-earthly-branch","cjk-heavenly-stem","cjk-ideographic","clear","clip","close-quote","col-resize","collapse","color","color-burn","color-dodge","column","column-reverse","compact","condensed","contain","content","contents","content-box","context-menu","continuous","copy","counter","counters","cover","crop","cross","crosshair","currentcolor","cursive","cyclic","darken","dashed","decimal","decimal-leading-zero","default","default-button","dense","destination-atop","destination-in","destination-out","destination-over","devanagari","difference","disc","discard","disclosure-closed","disclosure-open","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic","ethiopic-abegede","ethiopic-abegede-am-et","ethiopic-abegede-gez","ethiopic-abegede-ti-er","ethiopic-abegede-ti-et","ethiopic-halehame-aa-er","ethiopic-halehame-aa-et","ethiopic-halehame-am-et","ethiopic-halehame-gez","ethiopic-halehame-om-et","ethiopic-halehame-sid-et","ethiopic-halehame-so-et","ethiopic-halehame-ti-er","ethiopic-halehame-ti-et","ethiopic-halehame-tig","ethiopic-numeric","ew-resize","exclusion","expanded","extends","extra-condensed","extra-expanded","fantasy","fast","fill","fixed","flat","flex","flex-end","flex-start","footnotes","forwards","from","geometricPrecision","georgian","graytext","grid","groove","gujarati","gurmukhi","hand","hangul","hangul-consonant","hard-light","hebrew","help","hidden","hide","higher","highlight","highlighttext","hiragana","hiragana-iroha","horizontal","hsl","hsla","hue","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-flex","inline-grid","inline-table","inset","inside","intrinsic","invert","italic","japanese-formal","japanese-informal","justify","kannada","katakana","katakana-iroha","keep-all","khmer","korean-hangul-formal","korean-hanja-formal","korean-hanja-informal","landscape","lao","large","larger","left","level","lighter","lighten","line-through","linear","linear-gradient","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-alpha","lower-armenian","lower-greek","lower-hexadecimal","lower-latin","lower-norwegian","lower-roman","lowercase","ltr","luminosity","malayalam","match","matrix","matrix3d","media-controls-background","media-current-time-display","media-fullscreen-button","media-mute-button","media-play-button","media-return-to-realtime-button","media-rewind-button","media-seek-back-button","media-seek-forward-button","media-slider","media-sliderthumb","media-time-remaining-display","media-volume-slider","media-volume-slider-container","media-volume-sliderthumb","medium","menu","menulist","menulist-button","menulist-text","menulist-textfield","menutext","message-box","middle","min-intrinsic","mix","mongolian","monospace","move","multiple","multiply","myanmar","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","numbers","numeric","nw-resize","nwse-resize","oblique","octal","opacity","open-quote","optimizeLegibility","optimizeSpeed","oriya","oromo","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","persian","perspective","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radial-gradient","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeating-linear-gradient","repeating-radial-gradient","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","rotate","rotate3d","rotateX","rotateY","rotateZ","round","row","row-resize","row-reverse","rtl","run-in","running","s-resize","sans-serif","saturation","scale","scale3d","scaleX","scaleY","scaleZ","screen","scroll","scrollbar","scroll-position","se-resize","searchfield","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","self-start","self-end","semi-condensed","semi-expanded","separate","serif","show","sidama","simp-chinese-formal","simp-chinese-informal","single","skew","skewX","skewY","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","soft-light","solid","somali","source-atop","source-in","source-out","source-over","space","space-around","space-between","space-evenly","spell-out","square","square-button","start","static","status-bar","stretch","stroke","sub","subpixel-antialiased","super","sw-resize","symbolic","symbols","system-ui","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","tamil","telugu","text","text-bottom","text-top","textarea","textfield","thai","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","tibetan","tigre","tigrinya-er","tigrinya-er-abegede","tigrinya-et","tigrinya-et-abegede","to","top","trad-chinese-formal","trad-chinese-informal","transform","translate","translate3d","translateX","translateY","translateZ","transparent","ultra-condensed","ultra-expanded","underline","unset","up","upper-alpha","upper-armenian","upper-greek","upper-hexadecimal","upper-latin","upper-norwegian","upper-roman","uppercase","urdu","url","var","vertical","vertical-text","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","words","wrap","wrap-reverse","x-large","x-small","xor","xx-large","xx-small"],b=t(y),k=s.concat(n).concat(o).concat(l).concat(d).concat(p).concat(f).concat(y);function w(e,t){for(var s,i=!1;null!=(s=e.next());){if(i&&"/"==s){t.tokenize=null;break}i="*"==s}return["comment","comment"]}e.registerHelper("hintWords","css",k),e.defineMIME("text/css",{documentTypes:i,mediaTypes:r,mediaFeatures:a,mediaValueKeywords:c,propertyKeywords:h,nonStandardPropertyKeywords:g,fontProperties:u,counterDescriptors:m,colorKeywords:v,valueKeywords:b,tokenHooks:{"/":function(e,t){return!!e.eat("*")&&(t.tokenize=w,w(e,t))}},name:"css"}),e.defineMIME("text/x-scss",{mediaTypes:r,mediaFeatures:a,mediaValueKeywords:c,propertyKeywords:h,nonStandardPropertyKeywords:g,colorKeywords:v,valueKeywords:b,fontProperties:u,allowNested:!0,lineComment:"//",tokenHooks:{"/":function(e,t){return e.eat("/")?(e.skipToEnd(),["comment","comment"]):e.eat("*")?(t.tokenize=w,w(e,t)):["operator","operator"]},":":function(e){return!!e.match(/\s*\{/,!1)&&[null,null]},$:function(e){return e.match(/^[\w-]+/),e.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"]},"#":function(e){return!!e.eat("{")&&[null,"interpolation"]}},name:"css",helperType:"scss"}),e.defineMIME("text/x-less",{mediaTypes:r,mediaFeatures:a,mediaValueKeywords:c,propertyKeywords:h,nonStandardPropertyKeywords:g,colorKeywords:v,valueKeywords:b,fontProperties:u,allowNested:!0,lineComment:"//",tokenHooks:{"/":function(e,t){return e.eat("/")?(e.skipToEnd(),["comment","comment"]):e.eat("*")?(t.tokenize=w,w(e,t)):["operator","operator"]},"@":function(e){return e.eat("{")?[null,"interpolation"]:!e.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\b/i,!1)&&(e.eatWhile(/[\w\\\-]/),e.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"])},"&":function(){return["atom","atom"]}},name:"css",helperType:"less"}),e.defineMIME("text/x-gss",{documentTypes:i,mediaTypes:r,mediaFeatures:a,propertyKeywords:h,nonStandardPropertyKeywords:g,fontProperties:u,counterDescriptors:m,colorKeywords:v,valueKeywords:b,supportsAtComponent:!0,tokenHooks:{"/":function(e,t){return!!e.eat("*")&&(t.tokenize=w,w(e,t))}},name:"css",helperType:"gss"})}),e("skylark-codemirror/mode/htmlmixed/htmlmixed",["../../CodeMirror","../xml/xml","../javascript/javascript","../css/css"],function(e){"use strict";var t={script:[["lang",/(javascript|babel)/i,"javascript"],["type",/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^module$|^$/i,"javascript"],["type",/./,"text/plain"],[null,null,"javascript"]],style:[["lang",/^css$/i,"css"],["type",/^(text\/)?(x-)?(stylesheet|css)$/i,"css"],["type",/./,"text/plain"],[null,null,"css"]]};var s={};function i(e,t){var i=e.match(function(e){var t=s[e];return t||(s[e]=new RegExp("\\s+"+e+"\\s*=\\s*('|\")?([^'\"]+)('|\")?\\s*"))}(t));return i?/^\s*(.*?)\s*$/.exec(i[2])[1]:""}function n(e,t){return new RegExp((t?"^":"")+"</s*"+e+"s*>","i")}function r(e,t){for(var s in e)for(var i=t[s]||(t[s]=[]),n=e[s],r=n.length-1;r>=0;r--)i.unshift(n[r])}e.defineMode("htmlmixed",function(s,o){var a=e.getMode(s,{name:"xml",htmlMode:!0,multilineTagIndentFactor:o.multilineTagIndentFactor,multilineTagIndentPastTag:o.multilineTagIndentPastTag}),l={},c=o&&o.tags,d=o&&o.scriptTypes;if(r(t,l),c&&r(c,l),d)for(var h=d.length-1;h>=0;h--)l.script.unshift(["type",d[h].matches,d[h].mode]);function p(t,r){var o,c=a.token(t,r.htmlState),d=/\btag\b/.test(c);if(d&&!/[<>\s\/]/.test(t.current())&&(o=r.htmlState.tagName&&r.htmlState.tagName.toLowerCase())&&l.hasOwnProperty(o))r.inTag=o+" ";else if(r.inTag&&d&&/>$/.test(t.current())){var h=/^([\S]+) (.*)/.exec(r.inTag);r.inTag=null;var g=">"==t.current()&&function(e,t){for(var s=0;s<e.length;s++){var n=e[s];if(!n[0]||n[1].test(i(t,n[0])))return n[2]}}(l[h[1]],h[2]),u=e.getMode(s,g),m=n(h[1],!0),f=n(h[1],!1);r.token=function(e,t){return e.match(m,!1)?(t.token=p,t.localState=t.localMode=null,null):function(e,t,s){var i=e.current(),n=i.search(t);n>-1?e.backUp(i.length-n):i.match(/<\/?$/)&&(e.backUp(i.length),e.match(t,!1)||e.match(i));return s}(e,f,t.localMode.token(e,t.localState))},r.localMode=u,r.localState=e.startState(u,a.indent(r.htmlState,"",""))}else r.inTag&&(r.inTag+=t.current(),t.eol()&&(r.inTag+=" "));return c}return{startState:function(){var t=e.startState(a);return{token:p,inTag:null,localMode:null,localState:null,htmlState:t}},copyState:function(t){var s;return t.localState&&(s=e.copyState(t.localMode,t.localState)),{token:t.token,inTag:t.inTag,localMode:t.localMode,localState:s,htmlState:e.copyState(a,t.htmlState)}},token:function(e,t){return t.token(e,t)},indent:function(t,s,i){return!t.localMode||/^\s*<\//.test(s)?a.indent(t.htmlState,s,i):t.localMode.indent?t.localMode.indent(t.localState,s,i):e.Pass},innerMode:function(e){return{state:e.localState||e.htmlState,mode:e.localMode||a}}}},"xml","javascript","css"),e.defineMIME("text/html","htmlmixed")}),e("skylark-grapejs/code_manager/model/formating",["skylark-codemirror/CodeMirror"],function(e){e.extendMode("css",{commentStart:"/*",commentEnd:"*/",newlineAfterToken:function(e,t){return/^[;{}]$/.test(t)}}),e.extendMode("javascript",{commentStart:"/*",commentEnd:"*/",newlineAfterToken:function(e,t,s,i){return this.jsonMode?/^[\[,{]$/.test(t)||/^}/.test(s):(";"!=t||!i.lexical||")"!=i.lexical.type)&&(/^[;{}]$/.test(t)&&!/^;/.test(s))}});var t=/^(a|abbr|acronym|area|base|bdo|big|br|button|caption|cite|code|col|colgroup|dd|del|dfn|em|frame|hr|iframe|img|input|ins|kbd|label|legend|link|map|object|optgroup|option|param|q|samp|script|select|small|span|strong|sub|sup|textarea|tt|var)$/;e.extendMode("xml",{commentStart:"\x3c!--",commentEnd:"--\x3e",newlineAfterToken:function(e,s,i,n){var r=!1;return"html"==this.configuration&&(r=!!n.context&&t.test(n.context.tagName)),!r&&("tag"==e&&/>$/.test(s)&&n.context||/^</.test(i))}}),e.defineExtension("commentRange",function(t,s,i){var n=this,r=e.innerMode(n.getMode(),n.getTokenAt(s).state).mode;n.operation(function(){if(t)n.replaceRange(r.commentEnd,i),n.replaceRange(r.commentStart,s),s.line==i.line&&s.ch==i.ch&&n.setCursor(s.line,s.ch+r.commentStart.length);else{var e=n.getRange(s,i),o=e.indexOf(r.commentStart),a=e.lastIndexOf(r.commentEnd);o>-1&&a>-1&&a>o&&(e=e.substr(0,o)+e.substring(o+r.commentStart.length,a)+e.substr(a+r.commentEnd.length)),n.replaceRange(e,s,i)}})}),e.defineExtension("autoIndentRange",function(e,t){var s=this;this.operation(function(){for(var i=e.line;i<=t.line;i++)s.indentLine(i,"smart")})}),e.defineExtension("autoFormatRange",function(t,s){var i=this,n=i.getMode(),r=i.getRange(t,s).split("\n"),o=e.copyState(n,i.getTokenAt(t).state),a=i.getOption("tabSize"),l="",c=0,d=0===t.ch;function h(){l+="\n",d=!0,++c}for(var p=0;p<r.length;++p){for(var g=new e.StringStream(r[p],a);!g.eol();){var u=e.innerMode(n,o),m=n.token(g,o),f=g.current();g.start=g.pos,d&&!/\S/.test(f)||(l+=f,d=!1),!d&&u.mode.newlineAfterToken&&u.mode.newlineAfterToken(m,f,g.string.slice(g.pos)||r[p+1]||"",u.state)&&h()}!g.pos&&n.blankLine&&n.blankLine(o),!d&&p<r.length-1&&h()}i.operation(function(){i.replaceRange(l,t,s);for(var e=t.line+1,n=t.line+c;e<=n;++e)i.indentLine(e,"smart");i.setSelection(t,i.getCursor(!1))})})}),e("skylark-grapejs/code_manager/model/CodeMirrorEditor",["skylark-underscore","skylark-backbone","skylark-codemirror/CodeMirror","skylark-codemirror/mode/htmlmixed/htmlmixed","skylark-codemirror/mode/css/css","./formating"],function(e,t,s){"use strict";return t.Model.extend({defaults:{input:"",label:"",codeName:"",theme:"hopscotch",readOnly:!0,lineNumbers:!0},init(t){return e.bindAll(this,"onChange"),this.editor=s.fromTextArea(t,{dragDrop:!1,lineWrapping:!0,mode:this.get("codeName"),...this.attributes}),this.element=t,this.editor.on("change",this.onChange),this},onChange(){this.trigger("update",this)},getEditor(){return this.editor},getElement(){return this.element},setElement(e){return this.element=e,this},refresh(){return this.getEditor().refresh(),this},focus(){return this.getEditor().focus(),this},getContent(){const e=this.getEditor();return e&&e.getValue()},setContent(e,t={}){const{editor:i}=this;i&&(i.setValue(e),i.autoFormatRange&&(s.commands.selectAll(i),i.autoFormatRange(i.getCursor(!0),i.getCursor(!1)),s.commands.goDocStart(i)),!t.noRefresh&&setTimeout(()=>this.refresh()))}})}),e("skylark-grapejs/code_manager/view/EditorView",["skylark-underscore","skylark-backbone"],function(e,t){"use strict";return t.View.extend({template:e.template('\n  <div class="<%= pfx %>editor" id="<%= pfx %><%= codeName %>">\n  \t<div id="<%= pfx %>title"><%= label %></div>\n  \t<div id="<%= pfx %>code"></div>\n  </div>'),initialize(e){this.config=e.config||{},this.pfx=this.config.stylePrefix},render(){var e=this.model.toJSON();return e.pfx=this.pfx,this.$el.html(this.template(e)),this.$el.attr("class",this.pfx+"editor-c"),this.$el.find("#"+this.pfx+"code").append(this.model.get("input")),this}})}),e("skylark-grapejs/code_manager/index",["skylark-underscore","./config/config","./model/HtmlGenerator","./model/CssGenerator","./model/JsonGenerator","./model/JsGenerator","./model/CodeMirrorEditor","./view/EditorView"],function(e,t,s,i,n,r,o,a){"use strict";return()=>{var l={},c={},d={},h={},p={};return{getConfig:()=>l,config:l,EditorView:a,name:"CodeManager",init(e){for(var a in l=e||{},t)a in l||(l[a]=t[a]);var c=l.pStylePrefix;return c&&(l.stylePrefix=c+l.stylePrefix),d.html=new s,d.css=new i,d.json=new n,d.js=new r,p.CodeMirror=new o,this.loadDefaultGenerators().loadDefaultViewers(),this},addGenerator(e,t){return c[e]=t,this},getGenerator:e=>c[e]||null,getGenerators:()=>c,addViewer(e,t){return h[e]=t,this},getViewer:e=>h[e]||null,getViewers:()=>h,createViewer(t={}){const s=e.isUndefined(t.type)?"CodeMirror":t.type,i=this.getViewer(s)&&this.getViewer(s).clone(),n=document.createElement("div"),r=document.createElement("textarea");return n.appendChild(r),i.set(t),i.init(r),i.setElement(n),i},updateViewer(e,t){e.setContent(t)},getCode(e,t,s={}){s.em=l.em;var i=this.getGenerator(t);return i?i.build(e,s):""},loadDefaultGenerators(){for(var e in d)this.addGenerator(e,d[e]);return this},loadDefaultViewers(){for(var e in p)this.addViewer(e,p[e]);return this}}}}),e("skylark-grapejs/panels/config/config",[],function(){"use strict";const e="sw-visibility",t="export-template",s="open-layers",i="open-blocks",n="fullscreen",r="preview";return{stylePrefix:"pn-",defaults:[{id:"commands",buttons:[{}]},{id:"options",buttons:[{active:!0,id:e,className:"fa fa-square-o",command:e,context:e,attributes:{title:"View components"}},{id:r,className:"fa fa-eye",command:r,context:r,attributes:{title:"Preview"}},{id:n,className:"fa fa-arrows-alt",command:n,context:n,attributes:{title:"Fullscreen"}},{id:t,className:"fa fa-code",command:t,attributes:{title:"View code"}}]},{id:"views",buttons:[{id:"open-sm",className:"fa fa-paint-brush",command:"open-sm",active:!0,togglable:0,attributes:{title:"Open Style Manager"}},{id:"open-tm",className:"fa fa-cog",command:"open-tm",togglable:0,attributes:{title:"Settings"}},{id:s,className:"fa fa-bars",command:s,togglable:0,attributes:{title:"Open Layer Manager"}},{id:i,className:"fa fa-th-large",command:i,togglable:0,attributes:{title:"Open Blocks"}}]}],em:null,delayBtnsShow:300}}),e("skylark-grapejs/panels/model/Button",["skylark-backbone"],function(e){"use strict";var t=e.Model.extend({defaults:{id:"",label:"",tagName:"span",className:"",command:"",context:"",buttons:[],attributes:{},options:{},active:!1,dragDrop:!1,togglable:!0,runDefaultCommand:!0,stopDefaultCommand:!1,disable:!1},initialize(e){if(this.get("buttons").length){var s=t.Buttons;this.set("buttons",new s(this.get("buttons")))}}});return t}),e("skylark-grapejs/panels/model/Buttons",["skylark-backbone","./Button"],function(e,t){"use strict";var s=e.Collection.extend({model:t,deactivateAllExceptOne(e,t){this.forEach((s,i)=>{s!==e&&(s.set("active",!1),t&&s.get("buttons").length&&s.get("buttons").deactivateAllExceptOne(e,t))})},deactivateAll(e,t){const s=e||"";this.forEach(e=>{e.get("context")==s&&e!==t&&(e.set("active",!1,{silent:1}),e.trigger("updateActive",{fromCollection:1}))})},disableAllButtons(e){var t=e||"";this.forEach((e,s)=>{e.get("context")==t&&e.set("disable",!0)})},disableAllButtonsExceptOne(e,t){this.forEach((s,i)=>{s!==e&&(s.set("disable",!0),t&&s.get("buttons").length&&s.get("buttons").disableAllButtonsExceptOne(e,t))})}});return t.Buttons=s,s}),e("skylark-grapejs/panels/model/Panel",["skylark-backbone","./Buttons"],function(e,t){"use strict";return e.Model.extend({defaults:{id:"",content:"",visible:!0,buttons:[],attributes:{}},initialize(e){this.btn=this.get("buttons")||[],this.buttons=new t(this.btn),this.set("buttons",this.buttons)}})}),e("skylark-grapejs/panels/model/Panels",["skylark-backbone","./Panel"],function(e,t){"use strict";return e.Collection.extend({model:t})}),e("skylark-grapejs/panels/view/ButtonView",["skylark-backbone","skylark-underscore"],function(e,t){"use strict";e.$;return e.View.extend({tagName(){return this.model.get("tagName")},events:{click:"clicked"},initialize(e){var t=this.model.get("className");this.config=e.config||{},this.em=this.config.em||{};const s=this.config.stylePrefix||"",i=this.config.pStylePrefix||"";this.pfx=s,this.ppfx=this.config.pStylePrefix||"",this.id=s+this.model.get("id"),this.activeCls=`${s}active ${i}four-color`,this.disableCls=`${i}disabled`,this.btnsVisCls=`${s}visible`,this.className=s+"btn"+(t?" "+t:""),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change:active updateActive",this.updateActive),this.listenTo(this.model,"checkActive",this.checkActive),this.listenTo(this.model,"change:bntsVis",this.updateBtnsVis),this.listenTo(this.model,"change:attributes",this.updateAttributes),this.listenTo(this.model,"change:className",this.updateClassName),this.listenTo(this.model,"change:disable",this.updateDisable),this.em&&this.em.get&&(this.commands=this.em.get("Commands"))},updateClassName(){const{model:e,pfx:t}=this,s=e.get("className"),i=e.get("attributes").class,n=`${i||""} ${t}btn ${s||""}`;this.$el.attr("class",n.trim())},updateAttributes(){const{em:e,model:t,$el:s}=this,i=t.get("attributes")||{},n=e&&e.t&&e.t(`panels.buttons.titles.${t.id}`);s.attr(i),n&&s.attr({title:n}),this.updateClassName()},updateBtnsVis(){this.$buttons&&(this.model.get("bntsVis")?this.$buttons.addClass(this.btnsVisCls):this.$buttons.removeClass(this.btnsVisCls))},updateActive(e={}){const{model:s,commands:i,$el:n,activeCls:r}=this,{fromCollection:o}=e,a=s.get("context"),l=s.get("options"),c=s.get("command");let d={};i&&t.isString(c)?d=i.get(c)||{}:t.isFunction(c)?d=i.create({run:c}):null!==c&&t.isObject(c)&&(d=i.create(c)),s.get("active")?(!o&&s.collection.deactivateAll(a,s),s.set("active",!0,{silent:!0}).trigger("checkActive"),i.runCommand(d,{...l,sender:s}),d.noStop&&s.set("active",!1)):(n.removeClass(r),i.stopCommand(d,{...l,sender:s,force:1}))},updateDisable(){const{disableCls:e,model:t}=this,s=t.get("disable");this.$el[s?"addClass":"removeClass"](e)},checkActive(){const{model:e,$el:t,activeCls:s}=this;e.get("active")?t.addClass(s):t.removeClass(s)},clicked(e){this.model.get("bntsVis")||this.model.get("disable")||this.toggleActive()},toggleActive(){const{model:e}=this,{active:t,togglable:s}=e.attributes;if(!t||s){e.set("active",!t);this.em.get("Commands").get("select-comp");t?e.get("runDefaultCommand")&&this.em.runDefault():e.get("stopDefaultCommand")&&this.em.stopDefault()}},render(){const e=this.model.get("label"),{$el:t}=this;return t.empty(),this.updateAttributes(),e&&t.append(e),this.checkActive(),this.updateDisable(),this}})}),e("skylark-grapejs/panels/view/ButtonsView",["skylark-backbone","./ButtonView","skylark-underscore"],function(e,t,s){"use strict";return e.View.extend({initialize(e){this.opt=e||{},this.config=this.opt.config||{},this.pfx=this.config.stylePrefix||"",this.parentM=this.opt.parentM||null,this.listenTo(this.collection,"add",this.addTo),this.listenTo(this.collection,"reset remove",this.render),this.className=this.pfx+"buttons"},addTo(e){this.addToCollection(e)},addToCollection(e,s){var i=s||null,n=t,r=new n({model:e,config:this.config,parentM:this.parentM}),o=r.render().el;return i?i.appendChild(o):this.$el.append(o),o},render(){var e=document.createDocumentFragment();return this.$el.empty(),this.collection.each(function(t){this.addToCollection(t,e)},this),this.$el.append(e),this.$el.attr("class",s.result(this,"className")),this}})}),e("skylark-grapejs/panels/view/PanelView",["skylark-backbone","./ButtonsView"],function(e,t){"use strict";return e.View.extend({initialize(e){const t=e.config||{},s=this.model;this.config=t,this.pfx=t.stylePrefix||"",this.ppfx=t.pStylePrefix||"",this.buttons=s.get("buttons"),this.className=this.pfx+"panel",this.id=this.pfx+s.get("id"),this.listenTo(s,"change:appendContent",this.appendContent),this.listenTo(s,"change:content",this.updateContent),this.listenTo(s,"change:visible",this.toggleVisible),s.view=this},appendContent(){this.$el.append(this.model.get("appendContent"))},updateContent(){this.$el.html(this.model.get("content"))},toggleVisible(){this.model.get("visible")?this.$el.removeClass(`${this.ppfx}hidden`):this.$el.addClass(`${this.ppfx}hidden`)},attributes(){return this.model.get("attributes")},initResize(){const e=this.config.em,t=e?e.get("Editor"):"",s=this.model.get("resizable");if(t&&s){var i,n,r,o=!0===s?[1,1,1,1]:s,a=o.length,l=0;2==a?(i=o[0],r=o[0],n=o[1],l=o[1]):4==a&&(i=o[0],n=o[1],r=o[2],l=o[3]);var c=t.Utils.Resizer.init({tc:i,cr:n,bc:r,cl:l,tl:0,tr:0,bl:0,br:0,appendTo:this.el,silentFrames:1,avoidContainerUpdate:1,prefix:t.getConfig().stylePrefix,onEnd(){e&&e.trigger("change:canvasOffset")},posFetcher:(e,{target:t})=>{const s=e.style,i=c.getConfig(),n=i.keyWidth,r=i.keyHeight,o=e.getBoundingClientRect(),a="container"==t,l=s[n],d=s[r],h=l&&!a?parseFloat(l):o.width,p=d&&!a?parseFloat(d):o.height;return{left:0,top:0,width:h,height:p}},...s});c.blur=(()=>{}),c.focus(this.el)}},render(){const e=this.$el,s=this.ppfx,i=`${this.className} ${this.id} ${s}one-bg ${s}two-color`;if(e.addClass(i),this.buttons.length){var n=new t({collection:this.buttons,config:this.config});e.append(n.render().el)}return e.append(this.model.get("content")),this}})}),e("skylark-grapejs/panels/view/PanelsView",["skylark-backbone","./PanelView"],function(e,t){"use strict";return e.View.extend({initialize(e){this.opt=e||{},this.config=this.opt.config||{},this.pfx=this.config.stylePrefix||"";const t=this.collection;this.listenTo(t,"add",this.addTo),this.listenTo(t,"reset",this.render),this.listenTo(t,"remove",this.onRemove),this.className=this.pfx+"panels"},onRemove(e){const t=e.view;t&&t.remove()},addTo(e){this.addToCollection(e)},addToCollection(e,s){const i=s||null,n=this.config,r=e.get("el"),o=new t({el:r,model:e,config:n}),a=o.render().el,l=e.get("appendTo");if(r);else if(l){var c=document.querySelector(l);c.appendChild(a)}else i?i.appendChild(a):this.$el.append(a);return o.initResize(),a},render(){const e=this.$el,t=document.createDocumentFragment();return e.empty(),this.collection.each(e=>this.addToCollection(e,t)),e.append(t),e.attr("class",this.className),this}})}),e("skylark-grapejs/panels/index",["./config/config","./model/Panel","./model/Panels","./view/PanelView","./view/PanelsView"],function(e,t,s,i,n){"use strict";return()=>{var i,r,o={};return{name:"Panels",init(t){for(var a in o=t||{},e)a in o||(o[a]=e[a]);var l=o.pStylePrefix;return l&&(o.stylePrefix=l+o.stylePrefix),i=new s(o.defaults),r=new n({collection:i,config:o}),this},getPanels:()=>i,getPanelsEl:()=>r.el,addPanel:e=>i.add(e),removePanel:e=>i.remove(e),getPanel(e){var t=i.where({id:e});return t.length?t[0]:null},addButton(e,t){var s=this.getPanel(e);return s?s.get("buttons").add(t):null},removeButton(e,t){var s=this.getPanel(e);return s&&s.get("buttons").remove(t)},getButton(e,t){var s=this.getPanel(e);if(s){var i=s.get("buttons").where({id:t});return i.length?i[0]:null}return null},render:()=>r.render().el,active(){this.getPanels().each(e=>{e.get("buttons").each(e=>{e.get("active")&&e.trigger("updateActive")})})},disableButtons(){this.getPanels().each(e=>{e.get("buttons").each(e=>{e.get("disable")&&e.trigger("change:disable")})})},Panel:t}}}),e("skylark-grapejs/rich_text_editor/model/RichTextEditor",["../../utils/mixins"],function(e){"use strict";const t={ACTIVE:1,INACTIVE:0,DISABLED:-1},s=e=>{const t=e.selection().anchorNode,s=t&&t.parentNode,i=t&&t.nextSibling;return s&&"A"==s.nodeName||i&&"A"==i.nodeName},i={bold:{name:"bold",icon:"<b>B</b>",attributes:{title:"Bold"},result:e=>e.exec("bold")},italic:{name:"italic",icon:"<i>I</i>",attributes:{title:"Italic"},result:e=>e.exec("italic")},underline:{name:"underline",icon:"<u>U</u>",attributes:{title:"Underline"},result:e=>e.exec("underline")},strikethrough:{name:"strikethrough",icon:"<strike>S</strike>",attributes:{title:"Strike-through"},result:e=>e.exec("strikeThrough")},link:{icon:'<span style="transform:rotate(45deg)">&supdsub;</span>',name:"link",attributes:{style:"font-size:1.4rem;padding:0 4px 2px;",title:"Link"},state:(e,i)=>e&&e.selection()&&s(e)?t.ACTIVE:t.INACTIVE,result:e=>{s(e)?e.exec("unlink"):e.insertHTML(`<a class="link" href="">${e.selection()}</a>`)}}};return class{constructor(e={}){const t=e.el;if(t._rte)return t._rte;t._rte=this,this.setEl(t),this.updateActiveActions=this.updateActiveActions.bind(this);const s=e.actions||[];s.forEach((e,t)=>{"string"==typeof e?e=i[e]:i[e.name]&&(e={...i[e.name],...e}),s[t]=e});const n=s.length?s:Object.keys(i).map(e=>i[e]);e.classes={...{actionbar:"actionbar",button:"action",active:"active",disabled:"disabled",inactive:"inactive"},...e.classes};const r=e.classes;let o=e.actionbar;if(this.actionbar=o,this.settings=e,this.classes=r,this.actions=n,!o){const t=e.actionbarContainer;(o=document.createElement("div")).className=r.actionbar,t.appendChild(o),this.actionbar=o,n.forEach(e=>this.addAction(e))}return e.styleWithCSS&&this.exec("styleWithCSS"),this.syncActions(),this}destroy(){this.el=0,this.doc=0,this.actionbar=0,this.settings={},this.classes={},this.actions=[]}setEl(e){this.el=e,this.doc=e.ownerDocument}updateActiveActions(){this.getActions().forEach(e=>{const s=e.btn,i=e.update,{active:n,inactive:r,disabled:o}={...this.classes},a=e.state,l=e.name,c=this.doc;if(s.className=s.className.replace(n,"").trim(),s.className=s.className.replace(r,"").trim(),s.className=s.className.replace(o,"").trim(),a)switch(a(this,c)){case t.ACTIVE:s.className+=` ${n}`;break;case t.INACTIVE:s.className+=` ${r}`;break;case t.DISABLED:s.className+=` ${o}`}else c.queryCommandSupported(l)&&c.queryCommandState(l)&&(s.className+=` ${n}`);i&&i(this,e)})}enable(){return this.enabled?this:(this.actionbarEl().style.display="",this.el.contentEditable=!0,e.on(this.el,"mouseup keyup",this.updateActiveActions),this.syncActions(),this.updateActiveActions(),this.el.focus(),this.enabled=1,this)}disable(){return this.actionbarEl().style.display="none",this.el.contentEditable=!1,e.off(this.el,"mouseup keyup",this.updateActiveActions),this.enabled=0,this}syncActions(){this.getActions().forEach(e=>{if(this.settings.actionbar&&(!e.state||e.state&&e.state(this,this.doc)>=0)){const t=e.event||"click";e.btn[`on${t}`]=(t=>{e.result(this,e),this.updateActiveActions()})}})}addAction(e,t={}){const s=t.sync,i=document.createElement("span"),n=e.icon,r=e.attributes||{};i.className=this.classes.button,e.btn=i;for(let e in r)i.setAttribute(e,r[e]);"string"==typeof n?i.innerHTML=n:i.appendChild(n),this.actionbarEl().appendChild(i),s&&(this.actions.push(e),this.syncActions())}getActions(){return this.actions}selection(){return this.doc.getSelection()}exec(e,t=null){this.doc.execCommand(e,!1,t)}actionbarEl(){return this.actionbar}insertHTML(e){let t;const s=this.doc,i=s.getSelection();if(i&&i.rangeCount){const n=s.createElement("div"),r=i.getRangeAt(0);r.deleteContents(),n.innerHTML=e,Array.prototype.slice.call(n.childNodes).forEach(e=>{r.insertNode(e),t=e}),i.removeAllRanges(),i.addRange(r),this.el.focus()}}}}),e("skylark-grapejs/rich_text_editor/config/config",[],function(){"use strict";return{stylePrefix:"rte-",adjustToolbar:1,actions:["bold","italic","underline","strikethrough","link"]}}),e("skylark-grapejs/rich_text_editor/index",["./model/RichTextEditor","../utils/mixins","./config/config"],function(e,t,s){"use strict";return()=>{let i,n,r,o,a,l={};const c=()=>{const e=i.style;e.top="-1000px",e.left="-1000px",e.display="none"};return{customRte:null,name:"RichTextEditor",getConfig:()=>l,init(e={}){const r=(l={...s,...e}).pStylePrefix;return r&&(l.stylePrefix=r+l.stylePrefix),this.pfx=l.stylePrefix,n=l.actions||[],(i=document.createElement("div")).className=`${r}rte-toolbar ${r}one-bg`,a=this.initRte(document.createElement("div")),t.on(i,"mousedown",e=>e.stopPropagation()),this},destroy(){const{customRte:e}=this;a&&a.destroy(),e&&e.destroy&&e.destroy(),i=0,a=0,this.actionbar=0,this.actions=0},postRender(e){const t=e.model.get("Canvas");i.style.pointerEvents="all",c(),t.getToolsEl().appendChild(i)},initRte(t){const s=this.pfx,n=i,r=this.actionbar,o=this.actions||[...l.actions],c={actionbar:`${s}actionbar`,button:`${s}action`,active:`${s}active`,inactive:`${s}inactive`,disabled:`${s}disabled`},d=new e({el:t,classes:c,actions:o,actionbar:r,actionbarContainer:n});return a&&a.setEl(t),d.actionbar&&(this.actionbar=d.actionbar),d.actions&&(this.actions=d.actions),d},add(e,t={}){t.name=e,a.addAction(t,{sync:1})},get(e){let t;return a.getActions().forEach(s=>{s.name==e&&(t=s)}),t},getAll:()=>a.getActions(),remove(e){const t=this.getAll(),s=this.get(e);if(s){const e=s.btn,i=t.indexOf(s);e.parentNode.removeChild(e),t.splice(i,1)}return s},getToolbarEl:()=>i,updatePosition(){const e=l.em.get("Canvas"),{style:t}=i,s=e.getTargetToElementFixed(r,i,{event:"rteToolbarPosUpdate"});t.top=s.top+"px",t.left="0px"},enable(e,t){r=e.el;const s=l.em.get("Canvas"),n=l.em,a=e.getChildrenContainer(),c=this.customRte;if(o=s.getElementPos(r),i.style.display="",t=c?c.enable(a,t):this.initRte(a).enable(),n){setTimeout(this.updatePosition.bind(this),0);const s="change:canvasOffset canvasScroll frame:scroll component:update";n.on(s,this.updatePosition,this),n.on(s,this.updatePosition,this),n.trigger("rte:enable",e,t)}return t},disable(e,t){const s=l.em,i=this.customRte;var n=e.getChildrenContainer();i?i.disable(n,t):t&&t.disable(),c(),s&&s.trigger("rte:disable",e,t)}}}}),e("skylark-grapejs/asset_manager/config/config",[],function(){"use strict";return{assets:[],noAssets:"",stylePrefix:"am-",upload:0,uploadName:"files",headers:{},params:{},credentials:"include",multiUpload:!0,autoAdd:1,customFetch:"",uploadFile:"",embedAsBase64:1,handleAdd:"",dropzone:0,openAssetsOnDrop:1,dropzoneContent:"",beforeUpload:null,showUrlInput:!0}}),e("skylark-grapejs/asset_manager/model/Asset",["skylark-backbone/Model"],function(e){"use strict";return e.extend({idAttribute:"src",defaults:{type:"",src:""},getFilename(){return this.get("src").split("/").pop()},getExtension(){return this.getFilename().split(".").pop()}})}),e("skylark-grapejs/asset_manager/model/AssetImage",["skylark-langx/langx","./Asset"],function(e,t){"use strict";return t.extend({defaults:e.mixin({},t.prototype.defaults,{type:"image",unitDim:"px",height:0,width:0})})}),e("skylark-grapejs/asset_manager/view/AssetView",["skylark-backbone","skylark-underscore"],function(e,t){"use strict";return e.View.extend({initialize(e={}){this.options=e,this.collection=e.collection;const t=e.config||{};this.config=t,this.pfx=t.stylePrefix||"",this.ppfx=t.pStylePrefix||"",this.em=t.em,this.className=this.pfx+"asset",this.listenTo(this.model,"destroy remove",this.remove),this.model.view=this;const s=this.init&&this.init.bind(this);s&&s(e)},template(){const e=this.pfx;return`\n      <div class="${e}preview-cont">\n        ${this.getPreview()}\n      </div>\n      <div class="${e}meta">\n        ${this.getInfo()}\n      </div>\n      <div class="${e}close" data-toggle="asset-remove">\n        &Cross;\n      </div>\n    `},updateTarget(e){e&&e.set&&(e.set("attributes",t.clone(e.get("attributes"))),e.set("src",this.model.get("src")))},getPreview:()=>"",getInfo:()=>"",render(){const e=this.el;return e.innerHTML=this.template(this,this.model),e.className=this.className,this}})}),e("skylark-grapejs/asset_manager/view/AssetImageView",["skylark-underscore","./AssetView"],function(e,t){"use strict";return t.extend({events:{"click [data-toggle=asset-remove]":"onRemove",click:"onClick",dblclick:"onDblClick"},getPreview(){const e=this.pfx,t=this.model.get("src");return`\n      <div class="${e}preview" style="background-image: url('${t}');"></div>\n      <div class="${e}preview-bg ${this.ppfx}checker-bg"></div>\n    `},getInfo(){const e=this.pfx,t=this.model;let s=t.get("name"),i=t.get("width"),n=t.get("height"),r=t.get("unitDim"),o=i&&n?`${i}x${n}${r}`:"";return s=s||t.getFilename(),`\n      <div class="${e}name">${s}</div>\n      <div class="${e}dimensions">${o}</div>\n    `},init(e){const t=this.pfx;this.className+=` ${t}asset-image`},onClick(){var t=this.config.onClick,s=this.model;this.collection.trigger("deselectAll"),this.$el.addClass(this.pfx+"highlight"),e.isFunction(t)?t(s):this.updateTarget(this.collection.target)},onDblClick(){const{em:t,model:s}=this,i=this.config.onDblClick;e.isFunction(i)?i(s):(this.updateTarget(this.collection.target),t&&t.get("Modal").close());var n=this.collection.onSelect;e.isFunction(n)&&n(s)},onRemove(e){e.stopImmediatePropagation(),this.model.collection.remove(this.model)}})}),e("skylark-grapejs/asset_manager/model/Assets",["skylark-backbone/Collection","./AssetImage","./../view/AssetImageView","../../domain_abstract/model/TypeableCollection"],function(e,t,s,i){"use strict";return e.extend(i).extend({types:[{id:"image",model:t,view:s,isType:e=>"string"==typeof e?{type:"image",src:e}:e}]})}),e("skylark-grapejs/asset_manager/view/AssetsView",["skylark-backbone"],function(e){"use strict";return e.View.extend({events:{submit:"handleSubmit"},template(){const{pfx:e,ppfx:t,em:s}=this;let i="";return this.config.showUrlInput&&(i=`\n          <form class="${e}add-asset">\n            <div class="${t}field ${e}add-field">\n              <input placeholder="${s&&s.t("assetManager.inputPlh")}"/>\n            </div>\n            <button class="${t}btn-prim">${s&&s.t("assetManager.addButton")}</button>\n            <div style="clear:both"></div>\n          </form>\n      `),`\n    <div class="${e}assets-cont">\n      <div class="${e}assets-header">\n        ${i}\n      </div>\n      <div class="${e}assets" data-el="assets"></div>\n      <div style="clear:both"></div>\n    </div>\n    `},initialize(e){this.options=e,this.config=e.config,this.pfx=this.config.stylePrefix||"",this.ppfx=this.config.pStylePrefix||"",this.em=this.config.em;const t=this.collection;this.listenTo(t,"reset",this.renderAssets),this.listenTo(t,"add",this.addToAsset),this.listenTo(t,"remove",this.removedAsset),this.listenTo(t,"deselectAll",this.deselectAll)},handleSubmit(e){e.preventDefault();const t=this.getAddInput(),s=t&&t.value.trim(),i=this.config.handleAdd;s&&(t.value="",this.getAssetsEl().scrollTop=0,i?i.bind(this)(s):this.options.globalCollection.add(s,{at:0}))},getAssetsEl(){return this.el.querySelector(`.${this.pfx}assets`)},getAddInput(){return this.inputUrl&&this.inputUrl.value||(this.inputUrl=this.el.querySelector(`.${this.pfx}add-asset input`)),this.inputUrl},removedAsset(e){this.collection.length||this.toggleNoAssets()},addToAsset(e){1==this.collection.length&&this.toggleNoAssets(1),this.addAsset(e)},addAsset(e,t=null){const s=t,i=this.collection,n=this.config,r=new e.typeView({model:e,collection:i,config:n}).render().el;if(s)s.appendChild(r);else{const e=this.getAssetsEl();e&&e.insertBefore(r,e.firstChild)}return r},toggleNoAssets(e){const t=this.$el.find(`.${this.pfx}assets`);if(e)t.empty();else{const e=this.config.noAssets;e&&t.append(e)}},deselectAll(){const e=this.pfx;this.$el.find(`.${e}highlight`).removeClass(`${e}highlight`)},renderAssets(){const e=document.createDocumentFragment(),t=this.$el.find(`.${this.pfx}assets`);t.empty(),this.toggleNoAssets(this.collection.length),this.collection.each(t=>this.addAsset(t,e)),t.append(e)},render(){const e=this.options.fu.render().el;return this.$el.empty(),this.$el.append(e).append(this.template(this)),this.el.className=`${this.ppfx}asset-manager`,this.renderAssets(),this.rendered=1,this}})}),e("skylark-grapejs/asset_manager/view/FileUploader",["skylark-underscore","skylark-backbone","../../utils/fetch"],function(e,t,s){"use strict";return t.View.extend({template:e.template('\n  <form>\n    <div id="<%= pfx %>title"><%= title %></div>\n    <input type="file" id="<%= uploadId %>" name="file" accept="*/*" <%= disabled ? \'disabled\' : \'\' %> <%= multiUpload ? \'multiple\' : \'\' %>/>\n    <div style="clear:both;"></div>\n  </form>\n  '),events:{},initialize(e={}){this.options=e;const t=e.config||{};this.config=t,this.em=this.config.em,this.pfx=t.stylePrefix||"",this.ppfx=t.pStylePrefix||"",this.target=this.options.globalCollection||{},this.uploadId=this.pfx+"uploadFile",this.disabled=void 0!==t.disableUpload?t.disableUpload:!t.upload&&!t.embedAsBase64,this.multiUpload=void 0===t.multiUpload||t.multiUpload,this.events["change #"+this.uploadId]="uploadFile";let s=t.uploadFile;s?this.uploadFile=s.bind(this):!t.upload&&t.embedAsBase64&&(this.uploadFile=this.constructor.embedAsBase64),this.delegateEvents()},onUploadStart(){const e=this.config.em;e&&e.trigger("asset:upload:start")},onUploadEnd(e){const{$el:t,config:s}=this,i=s.em;i&&i.trigger("asset:upload:end",e);const n=t.find("input");n&&n.val("")},onUploadError(e){const t=this.config.em;console.error(e),this.onUploadEnd(e),t&&t.trigger("asset:upload:error",e)},onUploadResponse(e,t){const s=this.config.em,i=this.config,n=this.target;let r;try{r="string"==typeof e?JSON.parse(e):e}catch(t){r=e}s&&s.trigger("asset:upload:response",r),i.autoAdd&&n&&n.add(r.data,{at:0}),this.onUploadEnd(e),t&&t(r)},uploadFile(e,t){const i=e.dataTransfer?e.dataTransfer.files:e.target.files,{config:n}=this,{beforeUpload:r}=n,o=r&&r(i);if(!1===o)return;const a=new FormData,{params:l,customFetch:c}=n;for(let e in l)a.append(e,l[e]);if(this.multiUpload)for(let e=0;e<i.length;e++)a.append(`${n.uploadName}[]`,i[e]);else i.length&&a.append(n.uploadName,i[0]);this.target;const d=n.upload,h=n.headers;if(void 0===h["X-Requested-With"]&&(h["X-Requested-With"]="XMLHttpRequest"),d){this.onUploadStart();const e={method:"post",credentials:n.credentials||"include",headers:h,body:a},i=c?c(d,e):s(d,e).then(e=>1==(e.status/200|0)?e.text():e.text().then(e=>Promise.reject(e)));return i.then(e=>this.onUploadResponse(e,t)).catch(e=>this.onUploadError(e))}},initDrop(){var e=this;if(!this.uploadForm&&(this.uploadForm=this.$el.find("form").get(0),"draggable"in this.uploadForm)){this.uploadFile;this.uploadForm.ondragover=function(){return this.className=e.pfx+"hover",!1},this.uploadForm.ondragleave=function(){return this.className="",!1},this.uploadForm.ondrop=function(t){this.className="",t.preventDefault(),e.uploadFile(t)}}},initDropzone(e){let t=0;const s=this.config,i=e.model,n=e.el,r=i.get("Editor"),o=(i.get("Config").el,i.get("Canvas").getBody()),a=this.ppfx,l=`${a}dropzone-active`,c=`${a}dropzone`,d=()=>{n.className=n.className.replace(l,"").trim(),t=0},h=()=>(t||(n.className+=` ${l}`,t=1),!1),p=()=>(d(),!1),g=e=>{if(d(),e.preventDefault(),e.stopPropagation(),this.uploadFile(e),s.openAssetsOnDrop&&r){const e=r.getSelected();r.runCommand("open-assets",{target:e,onSelect(){r.Modal.close(),r.AssetManager.setTarget(null)}})}return!1};e.$el.append(`<div class="${c}">${s.dropzoneContent}</div>`),d(),"draggable"in n&&[n,o].forEach(e=>{e.ondragover=h,e.ondragleave=p,e.ondrop=g})},render(){const{$el:e,pfx:t,em:s}=this;return e.html(this.template({title:s&&s.t("assetManager.uploadTitle"),uploadId:this.uploadId,disabled:this.disabled,multiUpload:this.multiUpload,pfx:t})),this.initDrop(),e.attr("class",t+"file-uploader"),this}},{embedAsBase64:function(e,t){const s=e.dataTransfer?e.dataTransfer.files:e.target.files,i={data:[]};if(!FileReader)return void this.onUploadError(new Error("Unsupported platform, FileReader is not defined"));const n=[],r=/^(.+)\/(.+)$/;for(const e of s){const t=new Promise((t,s)=>{const i=new FileReader;i.addEventListener("load",n=>{let o;const a=e.name,l=r.exec(e.type);if("image"===(o=l?l[1]:e.type)){const e={src:i.result,name:a,type:o,height:0,width:0},n=new Image;n.addEventListener("error",e=>{s(e)}),n.addEventListener("load",()=>{e.height=n.height,e.width=n.width,t(e)}),n.src=e.src}else t(o?{src:i.result,name:a,type:o}:i.result)}),i.addEventListener("error",e=>{s(e)}),i.addEventListener("abort",e=>{s("Aborted")}),i.readAsDataURL(e)});n.push(t)}Promise.all(n).then(e=>{i.data=e,this.onUploadResponse(i,t)},e=>{this.onUploadError(e)})}})}),e("skylark-grapejs/asset_manager/index",["./config/config","./model/Assets","./view/AssetsView","./view/FileUploader"],function(e,t,s,i){"use strict";return()=>{let n,r,o,a={};return{name:"AssetManager",storageKey:"assets",getConfig:()=>a,init(l){a=l||{};for(let t in e)t in a||(a[t]=e[t]);const c=a.pStylePrefix,d=a.em;c&&(a.stylePrefix=c+a.stylePrefix),n=new t([]);const h={collection:new t([]),globalCollection:n,config:a};return o=new i(h),h.fu=o,r=new s(h),n.listenTo(n,"add",e=>{this.getAllVisible().add(e),d&&d.trigger("asset:add",e)}),n.listenTo(n,"remove",e=>{this.getAllVisible().remove(e),d&&d.trigger("asset:remove",e)}),this},add:(e,t={})=>(void 0===t.at&&(t.at=0),n.add(e,t)),get:e=>n.where({src:e})[0],getAll:()=>n,getAllVisible:()=>r.collection,remove(e){var t=this.get(e);return this.getAll().remove(t),this},store(e){var t={},s=JSON.stringify(this.getAll().toJSON());return t[this.storageKey]=s,!e&&a.stm&&a.stm.store(t),t},load(e={}){const t=this.storageKey;let s=e[t]||[];if("string"==typeof s)try{s=JSON.parse(e[t])}catch(e){}return s&&s.length&&this.getAll().reset(s),s},getContainer:()=>r.el,getAssetsEl:()=>r.el.querySelector("[data-el=assets]"),render(e){const t=e||this.getAll().models;return r.rendered||r.render(),r.collection.reset(t),this.getContainer()},addType(e,t){this.getAll().addType(e,t)},getType(e){return this.getAll().getType(e)},getTypes(){return this.getAll().getTypes()},AssetsView:()=>r,FileUploader:()=>o,onLoad(){this.getAll().reset(a.assets)},postRender(e){a.dropzone&&o.initDropzone(e)},setTarget(e){r.collection.target=e},onSelect(e){r.collection.onSelect=e},onClick(e){a.onClick=e},onDblClick(e){a.onDblClick=e}}}}),e("skylark-grapejs/css_composer/config/config",[],function(){"use strict";return{stylePrefix:"css-",staticRules:"",rules:[]}}),e("skylark-grapejs/domain_abstract/model/Styleable",["skylark-underscore","../../utils/mixins","../../parser/model/ParserHtml"],function(e,t,s){"use strict";const i=s().parseStyle;return{parseStyle:i,extendStyle(e){return{...this.getStyle(),...e}},getStyle(){const e=this.get("style")||{};return{...e}},setStyle(s={},n={}){e.isString(s)&&(s=i(s));const r=this.getStyle(),o={...s};this.set("style",o,n);const a=t.shallowDiff(r,o);return e.keys(a).forEach(e=>{const t=this.em;this.trigger(`change:style:${e}`),t&&(t.trigger("styleable:change",this,e),t.trigger(`styleable:change:${e}`,this,e))}),o},addStyle(e,t="",s={}){"string"==typeof e?e={prop:t}:s=t||{},e=this.extendStyle(e),this.setStyle(e,s)},removeStyle(e){let t=this.getStyle();delete t[e],this.setStyle(t)},styleToString(t={}){const s=[],i=this.getStyle();for(let n in i){const r=t.important,o=e.isArray(r)?r.indexOf(n)>=0:r,a=`${i[n]}${o?" !important":""}`,l="__"==n.substr(0,2);a&&!l&&s.push(`${n}:${a};`)}return s.join("")},getSelectors(){return this.get("selectors")||this.get("classes")},getSelectorsString(){return this.selectorsToString?this.selectorsToString():this.getSelectors().getFullString()}}}),e("skylark-grapejs/css_composer/model/CssRule",["skylark-underscore","skylark-backbone","../../domain_abstract/model/Styleable","../../selector_manager/model/Selectors"],function(e,t,s,i){"use strict";const{CSS:n}=window;return t.Model.extend(s).extend({defaults:{selectors:{},selectorsAdd:"",style:{},mediaText:"",state:"",stylable:!0,atRuleType:"",singleAtRule:0,important:0},initialize(e,t={}){this.config=e||{};const s=t.em;let n=this.config.selectors||[];if(this.em=s,s){const e=s.get("SelectorManager"),t=[];n.forEach(s=>{t.push(e.add(s))}),n=t}this.set("selectors",new i(n))},getAtRule(){const e=this.get("atRuleType"),t=this.get("mediaText"),s=e?`@${e}`:t?"@media":"";return s+(t&&s?` ${t}`:"")},selectorsToString(e={}){const t=[],{em:s}=this,i=this.get("state"),r=this.get("wrapper"),o=this.get("selectorsAdd"),a=r&&s&&s.getConfig("wrapperIsBody"),l={escape:e=>n&&n.escape?n.escape(e):e},c=a?"body":this.get("selectors").getFullString(0,l),d=i&&!e.skipState?`:${i}`:"";return c&&t.push(`${c}${d}`),o&&!e.skipAdd&&t.push(o),t.join(", ")},getDeclaration(e={}){let t="";const s=this.selectorsToString(),i=this.styleToString(e),n=this.get("singleAtRule");return(s||n)&&i&&(t=n?i:`${s}{${i}}`),t},toCSS(e={}){let t="";const s=this.getAtRule(),i=this.getDeclaration(e);return i&&(t=i),s&&t&&(t=`${s}{${t}}`),t},toJSON(...s){const i=t.Model.prototype.toJSON.apply(this,s);if(this.em.getConfig("avoidDefaults")){const t=this.defaults;e.forEach(t,(e,t)=>{i[t]===e&&delete i[t]}),e.isEmpty(i.selectors)&&delete i.selectors,e.isEmpty(i.style)&&delete i.style}return i},compare(t,s,i,n={}){var r=s||"",o=i||"",a=n.selectorsAdd||"",l=n.atRuleType||"";t instanceof Array||t.models||(t=[t]);var c=e.map(t.models||t,e=>e.get("name")),d=e.map(this.get("selectors").models,e=>e.get("name"));if(c.length!==d.length)return!1;for(var h=0;h<c.length;h++){for(var p=0,g=0;g<d.length;g++)c[h]===d[g]&&(p=1);if(0===p)return!1}return this.get("state")===r&&this.get("mediaText")===o&&this.get("selectorsAdd")===a&&this.get("atRuleType")===l}})}),e("skylark-grapejs/css_composer/model/CssRules",["skylark-backbone","./CssRule"],function(e,t){"use strict";return e.Collection.extend({initialize(e,s){s&&s.em&&(this.editor=s.em),this.model=((e,i)=>{return!i.em&&s&&s.em&&(i.em=s.em),new t(e,i)})},add(t,s={}){return"string"==typeof t&&(t=this.editor.get("Parser").parseCss(t)),s.em=this.editor,e.Collection.prototype.add.apply(this,[t,s])}})}),e("skylark-grapejs/css_composer/view/CssRuleView",["skylark-backbone"],function(e){"use strict";return e.View.extend({tagName:"style",initialize(e={}){this.config=e.config||{};const t=this.model;this.listenTo(t,"change:style change:state change:mediaText",this.render),this.listenTo(t,"destroy remove",this.remove),this.listenTo(t.get("selectors"),"change",this.render)},render(){const e=this.model,t=e.get("important");return this.el.innerHTML=this.model.toCSS({important:t}),this}})}),e("skylark-grapejs/css_composer/view/CssGroupRuleView",["./CssRuleView"],function(e){"use strict";return e.extend({_createElement:function(e){return document.createTextNode("")},render(){const e=this.model,t=e.get("important");return this.el.textContent=e.getDeclaration({important:t}),this}})}),e("skylark-grapejs/css_composer/view/CssRulesView",["skylark-backbone","./CssRuleView","./CssGroupRuleView"],function(e,t,s){"use strict";const i=e.$,n=(e,t)=>`${e}${t?`-${parseFloat(t)}`:""}`;return e.View.extend({initialize(e){const t=e.config||{};this.atRules={},this.config=t,this.em=t.em,this.pfx=t.stylePrefix||"",this.className=this.pfx+"rules";const s=this.collection;this.listenTo(s,"add",this.addTo),this.listenTo(s,"reset",this.render)},addTo(e){this.addToCollection(e)},addToCollection(e,i){if(!this.renderStarted)return;const r=i||null,{config:o}=this,a={model:e,config:o};let l,c;if("keyframes"===e.get("atRuleType")){const t=e.getAtRule();let i=this.atRules[t];if(!i){const e=document.createElement("style");i=document.createTextNode(""),e.appendChild(document.createTextNode(`${t}{`)),e.appendChild(i),e.appendChild(document.createTextNode("}")),this.atRules[t]=i,l=e}c=new s(a),i.appendData(c.render().el.textContent)}else c=new t(a),l=c.render().el;const d=this.className,h=e.get("mediaText"),p=n(d);let g=p;if(h&&(g=n(d,this.getMediaWidth(h))),l){const e=r||this.el;let t;try{t=e.querySelector(`#${g}`)}catch(e){}t||(t=e.querySelector(`#${p}`)),t.appendChild(l)}return l},getMediaWidth(e){return e&&e.replace(`(${this.em.getConfig("mediaCondition")}: `,"").replace(")","")},render(){this.renderStarted=1,this.atRules={};const{em:e,$el:t,className:s,collection:r}=this,o=document.createDocumentFragment();t.empty();const a=e.get("DeviceManager").getAll().pluck("priority");return a.every(e=>e)&&a.unshift(0),a.forEach(e=>i(`<div id="${n(s,e)}"></div>`).appendTo(o)),r.each(e=>this.addToCollection(e,o)),t.append(o),t.attr("class",s),this}})}),e("skylark-grapejs/css_composer/index",["skylark-underscore","./config/config","./model/CssRule","./model/CssRules","./view/CssRulesView","../selector_manager/model/Selectors","../selector_manager/model/Selector"],function(e,t,s,i,n,r,o){"use strict";return()=>{let a;var l,c,d={};return{Selectors:r,name:"CssComposer",getConfig:()=>d,storageKey(){var e=[],t=d.stm&&d.stm.getConfig()||{};return t.storeCss&&e.push("css"),t.storeStyles&&e.push("styles"),e},init(e){for(var s in d=e||{},t)s in d||(d[s]=t[s]);var r=d.pStylePrefix;r&&(d.stylePrefix=r+d.stylePrefix);var o=d.em&&d.em.config.style||"";return d.rules=o||d.rules,a=d.em,l=new i([],d),c=new n({collection:l,config:d}),this},onLoad(){l.add(d.rules)},postLoad(e){const t="add remove",s=this.getAll(),i=e.get("UndoManager");i&&i.add(s),e.stopListening(s,t,this.handleChange),e.listenTo(s,t,this.handleChange),s.each(e=>this.handleChange(e,{avoidStore:1}))},handleChange(e,t={}){const s="change:style",i=a.get("UndoManager");i&&i.add(e);const n=a.handleUpdates.bind(a);a.stopListening(e,s,n),a.listenTo(e,s,n),!t.avoidStore&&n("","",t)},load(t){var s=t||"";!s&&d.stm&&(s=d.em.getCacheLoad());var i=s.styles||"";if(s.styles)try{i=JSON.parse(s.styles)}catch(e){}else s.css&&(i=d.em.get("Parser").parseCss(s.css));return e.isArray(i)?i.length&&l.reset(i):i&&l.reset(i),i},store(e){if(d.stm){var t={},s=this.storageKey();return s.indexOf("css")>=0&&(t.css=d.em.getCss()),s.indexOf("styles")>=0&&(t.styles=JSON.stringify(l)),e||d.stm.store(t),t}},add(e,t,i,n={}){var r=t||"",o=i||"",a={...n},c=this.get(e,r,o,a);return c&&c.config&&!c.config.singleAtRule?c:(a.state=r,a.mediaText=o,a.selectors="",(c=new s(a,d)).get("selectors").add(e),l.add(c),c)},get(e,t,s,i){var n=null;return l.each(r=>{n||r.compare(e,t,s,i)&&(n=r)}),n},getAll:()=>l,clear(){return this.getAll().reset(),this},addCollection(e,t={}){for(var s=[],i=e instanceof Array?e:[e],n=0,r=i.length;n<r;n++){var o=i[n]||{};if(!o.selectors)continue;var a=d.em&&d.em.get("SelectorManager");a||console.warn("Selector Manager not found");for(var l=o.selectors,c=l instanceof Array?l:[l],h=[],p=0,g=c.length;p<g;p++){var u=a.add(c[p]);h.push(u)}var m=this.get(h,o.state,o.mediaText,o),f=this.add(h,o.state,o.mediaText,o),v=!m||!t.avoidUpdateStyle;const e=o.style||{};if(v){let s=t.extend?{...f.get("style"),...e}:e;f.set("style",s)}s.push(f)}return s},setRule(e,t,s={}){const{atRuleType:i,atRuleParams:n}=s,r=a.get("Parser").parserCss.checkNode({selectors:e,style:t})[0],{state:o,selectorsAdd:l}=r,c=a.get("SelectorManager"),d=c.add(r.selectors),h=this.add(d,o,n,{selectorsAdd:l,atRule:i});return h.setStyle(t,s),h},getRule(e,t={}){const s=a.get("SelectorManager"),i=a.get("Parser").parserCss.checkNode({selectors:e})[0],n=s.get(i.selectors),{state:r,selectorsAdd:o}=i,{atRuleType:l,atRuleParams:c}=t;return n&&this.get(n,r,c,{selectorsAdd:o,atRule:l})},setIdRule(e,t={},s={}){const i=s.state||"",n=s.mediaText||a.getCurrentMedia(),r=a.get("SelectorManager"),l=r.add({name:e,type:o.TYPE_ID}),c=this.add(l,i,n);return c.setStyle(t,s),c},getIdRule(e,t={}){const s=t.state||"",i=t.mediaText||a.getCurrentMedia(),n=a.get("SelectorManager").get(e,o.TYPE_ID);return n&&this.get(n,s,i)},setClassRule(e,t={},s={}){const i=s.state||"",n=s.mediaText||a.getCurrentMedia(),r=a.get("SelectorManager"),l=r.add({name:e,type:o.TYPE_CLASS}),c=this.add(l,i,n);return c.setStyle(t,s),c},getClassRule(e,t={}){const s=t.state||"",i=t.mediaText||a.getCurrentMedia(),n=a.get("SelectorManager").get(e,o.TYPE_CLASS);return n&&this.get(n,s,i)},render:()=>c.render().el}}}),e("skylark-grapejs/trait_manager/config/config",[],function(){"use strict";return{stylePrefix:"trt-",appendTo:"",optionsTarget:[{value:!1},{value:"_blank"}]}}),e("skylark-grapejs/domain_abstract/view/DomainViews",["skylark-underscore","skylark-backbone"],function(e,t){"use strict";return t.View.extend({itemView:"",itemsView:"",itemType:"type",autoAdd:0,initialize(e={},t){this.config=t||e.config||{},this.autoAdd&&this.listenTo(this.collection,"add",this.addTo),this.init()},init(){},addTo(e){this.add(e)},itemViewNotFound(e){const{config:t,ns:s}=this,{em:i}=t,n=`${s?`[${s}]: `:""}'${e}' type not found`;i&&i.logWarning(n)},add(t,s){const{config:i,reuseView:n,itemsView:r={}}=this;var o=s||null,a=this.itemView,l=t.get(this.itemType);let c;r[l]?a=r[l]:!l||r[l]||e.includes(["button","checkbox","color","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"],l)||this.itemViewNotFound(l);var d=(c=t.view&&n?t.view:new a({model:t,config:i},i)).render().el;o?o.appendChild(d):this.$el.append(d)},render(){var e=document.createDocumentFragment();return this.$el.empty(),this.collection.length&&this.collection.each(function(t){this.add(t,e)},this),this.$el.append(e),this.onRender(),this},onRender(){}})}),e("skylark-grapejs/trait_manager/view/TraitView",["skylark-backbone","skylark-underscore","../../utils/mixins"],function(e,t,s){"use strict";const i=e.$;return e.View.extend({events:{},eventCapture:["change"],appendInput:1,attributes(){return this.model.get("attributes")},templateLabel(){const{ppfx:e}=this,t=this.getLabel();return`<div class="${e}label" title="${t}">${t}</div>`},templateInput(){const{clsField:e}=this;return`<div class="${e}" data-input></div>`},initialize(e={}){const{config:t={}}=e,{model:s,eventCapture:i}=this,{target:n}=s,{type:r}=s.attributes;this.config=t,this.em=t.em,this.pfx=t.stylePrefix||"",this.ppfx=t.pStylePrefix||"",this.target=n;const{ppfx:o}=this;this.clsField=`${o}field ${o}field-${r}`,[["change:value",this.onValueChange],["remove",this.removeView]].forEach(([e,t])=>{s.off(e,t),this.listenTo(s,e,t)}),s.view=this,this.listenTo(s,"change:label",this.render),this.listenTo(s,"change:placeholder",this.rerender),i.forEach(e=>this.events[e]="onChange"),this.delegateEvents(),this.init()},getClbOpts(){return{component:this.target,trait:this.model,elInput:this.getInputElem()}},removeView(){this.remove(),this.removed()},init(){},removed(){},onRender(){},onUpdate(){},onEvent(){},onChange(e){const s=this.getInputElem();s&&!t.isUndefined(s.value)&&this.model.set("value",s.value),this.onEvent({...this.getClbOpts(),event:e})},getValueForTarget(){return this.model.get("value")},setInputValue(e){const t=this.getInputElem();t&&(t.value=e)},onValueChange(e,t,s={}){if(s.fromTarget)this.setInputValue(e.get("value")),this.postUpdate();else{const t=this.getValueForTarget();e.setTargetValue(t,s)}},renderLabel(){const{$el:e,target:t}=this,s=this.getLabel();let i=this.templateLabel(t);this.createLabel&&(i=this.createLabel({label:s,component:t,trait:this})||""),e.find("[data-label]").append(i)},getLabel(){const{em:e}=this,{label:t,name:i}=this.model.attributes;return e.t(`traitManager.traits.labels.${i}`)||s.capitalize(t||i).replace(/-/g," ")},getComponent(){return this.target},getInputEl(){if(!this.$input){const{em:e,model:s}=this,n=s,{name:r}=s.attributes,o=n.get("placeholder")||n.get("default")||"",a=n.get("type")||"text",l=n.get("min"),c=n.get("max"),d=this.getModelValue(),h=i(`<input type="${a}" placeholder="${o}">`),p=e.t(`traitManager.traits.attributes.${r}`)||{};h.attr(p),t.isUndefined(d)||(n.set({value:d},{silent:!0}),h.prop("value",d)),l&&h.prop("min",l),c&&h.prop("max",c),this.$input=h}return this.$input.get(0)},getInputElem(){const{input:e,$input:t}=this;return e||t&&t.get&&t.get(0)||this.getElInput()},getModelValue(){let e;const s=this.model,i=this.target,n=s.get("name");if(s.get("changeProp"))e=i.get(n);else{const t=i.get("attributes");e=s.get("value")||t[n]}return t.isUndefined(e)?"":e},getElInput(){return this.elInput},renderField(){const{$el:e,appendInput:s,model:i}=this,n=e.find("[data-input]"),r=n[n.length-1];let o=i.el;o||(o=this.createInput?this.createInput(this.getClbOpts()):this.getInputEl()),t.isString(o)?(r.innerHTML=o,this.elInput=r.firstChild):(s?r.appendChild(o):r.insertBefore(o,r.firstChild),this.elInput=o),i.el=this.elInput},hasLabel(){const{label:e}=this.model.attributes;return!this.noLabel&&!1!==e},rerender(){this.model.el=null,this.render()},postUpdate(){this.onUpdate(this.getClbOpts())},render(){const{$el:e,pfx:s,ppfx:i,model:n}=this,{type:r}=n.attributes,o=this.hasLabel&&this.hasLabel(),a=`${s}trait`;this.$input=null;let l=`<div class="${a}">\n      ${o?`<div class="${i}label-wrp" data-label></div>`:""}\n      <div class="${i}field-wrp ${i}field-wrp--${r}" data-input>\n        ${this.templateInput?t.isFunction(this.templateInput)?this.templateInput(this.getClbOpts()):this.templateInput:""}\n      </div>\n    </div>`;return e.empty().append(l),o&&this.renderLabel(),this.renderField(),this.el.className=`${a}__wrp`,this.postUpdate(),this.onRender(this.getClbOpts()),this}})}),e("skylark-grapejs/trait_manager/view/TraitSelectView",["skylark-backbone","skylark-underscore","./TraitView"],function(e,t,s){"use strict";const i=e.$;return s.extend({init(){this.listenTo(this.model,"change:options",this.rerender)},templateInput(){const{ppfx:e,clsField:t}=this;return`<div class="${t}">\n      <div data-input></div>\n      <div class="${e}sel-arrow">\n        <div class="${e}d-s-arrow"></div>\n      </div>\n    </div>`},getInputEl(){if(!this.$input){const{model:e,em:s}=this,n=e.get("name"),r=e.get("options")||[];let o="<select>";r.forEach(e=>{let i,r,a,l="";t.isString(e)?(i=e,r=e):(i=e.name||e.label||e.value,r=`${t.isUndefined(e.value)?e.id:e.value}`.replace(/"/g,"&quot;"),a=e.style?e.style.replace(/"/g,"&quot;"):"",l+=a?` style="${a}"`:"");const c=s.t(`traitManager.traits.options.${n}.${r}`)||i;o+=`<option value="${r}"${l}>${c}</option>`}),o+="</select>",this.$input=i(o);const a=e.getTargetValue();!t.isUndefined(a)&&this.$input.val(a)}return this.$input.get(0)}})}),e("skylark-grapejs/trait_manager/view/TraitCheckboxView",["skylark-underscore","./TraitView"],function(e,t){"use strict";return t.extend({appendInput:0,templateInput(){const{ppfx:e,clsField:t}=this;return`<label class="${t}" data-input>\n    <i class="${e}chk-icon"></i>\n  </label>`},onChange(){const e=this.getInputElem().checked;this.model.set("value",this.getCheckedValue(e))},getCheckedValue(t){let s=t;const{valueTrue:i,valueFalse:n}=this.model.attributes;return s&&!e.isUndefined(i)&&(s=i),s||e.isUndefined(n)||(s=n),s},getInputEl(...s){const i=!this.$input,n=t.prototype.getInputEl.apply(this,s);if(i){let t,s;const{model:i,target:r}=this,{valueTrue:o,valueFalse:a}=i.attributes,l=i.get("name");i.get("changeProp")?(t=r.get(l),s=t):(s=r.get("attributes")[l],t=!(!s&&""!==s)),e.isUndefined(a)||s!==a||(t=!1),n.checked=t}return n}})}),e("skylark-grapejs/trait_manager/view/TraitNumberView",["./TraitView","../../domain_abstract/ui/InputNumber"],function(e,t){"use strict";return e.extend({getValueForTarget(){const{model:e}=this,{value:t,unit:s}=e.attributes;return t?t+s:""},getInputEl(){if(!this.input){var e=this.getModelValue(),s=new t({contClass:this.ppfx+"field-int",model:this.model,ppfx:this.ppfx});this.input=s.render(),this.$input=this.input.inputEl,this.$unit=this.input.unitEl,this.model.set("value",e),this.$input.val(e),this.input=s.el}return this.input}})}),e("skylark-grapejs/trait_manager/view/TraitColorView",["./TraitView","../../domain_abstract/ui/InputColor"],function(e,t){"use strict";return e.extend({templateInput:"",getInputEl(){if(!this.input){const e=this.model,s=this.getModelValue(),i=new t({model:e,target:this.config.em,contClass:this.ppfx+"field-color",ppfx:this.ppfx}),n=i.render();n.setValue(s,{fromTarget:1}),this.input=n.el}return this.input}})}),e("skylark-grapejs/trait_manager/view/TraitButtonView",["skylark-underscore","./TraitView"],function(e,t){"use strict";return t.extend({events:{"click button":"handleClick"},templateInput:"",handleClick(){const{model:t,em:s}=this,i=t.get("command");i&&(e.isString(i)?s.get("Commands").run(i):i(s.get("Editor"),t))},renderLabel(){this.model.get("label")&&t.prototype.renderLabel.apply(this,arguments)},getInputEl(){const{model:e,ppfx:t}=this,{labelButton:s,text:i,full:n}=e.props(),r=s||i,o=`${t}btn`,a=`<button type="button" class="${o}-prim${n?` ${o}--full`:""}">${r}</button>`;return a}})}),e("skylark-grapejs/trait_manager/view/TraitsView",["../../domain_abstract/view/DomainViews","./TraitView","./TraitSelectView","./TraitCheckboxView","./TraitNumberView","./TraitColorView","./TraitButtonView"],function(e,t,s,i,n,r,o){"use strict";return e.extend({ns:"Traits",itemView:t,reuseView:1,itemsView:{text:t,number:n,select:s,checkbox:i,color:r,button:o},initialize(e={}){const t=e.config||{};this.config=t,this.em=e.editor,this.pfx=t.stylePrefix||"",this.ppfx=t.pStylePrefix||"",this.className=this.pfx+"traits";this.listenTo(this.em,"component:toggled",this.updatedCollection),this.updatedCollection()},updatedCollection(){const e=this.ppfx,t=this.em.getSelected();this.el.className=`${this.className} ${e}one-bg ${e}two-color`,this.collection=t?t.get("traits"):[],this.render()}})}),e("skylark-grapejs/trait_manager/index",["skylark-underscore","./config/config","./view/TraitsView"],function(e,t,s){"use strict";return()=>{let i,n={};return{TraitsView:s,name:"TraitManager",getConfig:()=>n,init(r={}){n=r,e.defaults(n,t);const o=n.pStylePrefix;return o&&(n.stylePrefix=`${o}${n.stylePrefix}`),i=new s({collection:[],editor:n.em,config:n}),this},postRender(){const t=this.getConfig().appendTo;if(t){const s=e.isElement(t)?t:document.querySelector(t);s.appendChild(this.render())}},getTraitsViewer:()=>i,addType(e,t){var s=i.itemView;i.itemsView[e]=s.extend(t)},getType:e=>i.itemsView[e],render:()=>i.render().el}}}),e("skylark-grapejs/dom_components/config/config",[],function(){"use strict";return{stylePrefix:"comp-",wrapperId:"wrapper",wrapperName:"Body",wrapper:{removable:!1,copyable:!1,draggable:!1,components:[],traits:[],stylable:["background","background-color","background-image","background-repeat","background-attachment","background-position","background-size"]},components:[],draggableComponents:1,storeWrapper:0,processor:0,voidElements:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]}}),e("skylark-grapejs/dom_components/model/Components",["skylark-langx/langx","skylark-backbone","skylark-underscore"],function(e,t,s){"use strict";let i;var n=t.Collection.extend({initialize(e,t={}){this.opt=t,this.listenTo(this,"add",this.onAdd),this.config=t.config,this.em=t.em;const{em:s}=this;this.model=function(e,i){var n;const r=t.em.get("DomComponents").componentTypes;i.em=t.em,i.config=t.config,i.componentTypes=r,i.domc=t.domc;for(var o=0;o<r.length;o++){var a=r[o].id;if(a==e.type){n=r[o].model;break}}return n||(n=r[r.length-1].model,s&&e.type&&s.logWarning(`Component type '${e.type}' not found`,{attrs:e,options:i})),new n(e,i)}},parseString(t,s={}){const{em:r}=this,{domc:o}=this.opt,a=r.get("CssComposer"),l=r.get("Parser").parseHtml(t);return i||(i=n.Component),i.checkId(l.html,l.css,o.componentsById),l.css&&a&&!s.temporary&&a.addCollection(l.css,e.mixin({},s,{extend:1})),l.html},add(e,i={}){s.isString(e)?e=this.parseString(e,i):s.isArray(e)&&e.forEach((t,n)=>{s.isString(t)&&(e[n]=this.parseString(t,i))});const n=s.isArray(e);return e=(n?e:[e]).filter(e=>e).map(e=>this.processDef(e)),e=n?e:e[0],t.Collection.prototype.add.apply(this,[e,i])},processDef(e){if(e.cid&&e.ccid)return e;const{em:t,config:i={}}=this,{processor:n}=i;let r=e;if(n){r={...r};const e=n(r);e&&(s.each(r,(e,t)=>delete r[t]),s.extend(r,e))}if(r.$$typeof&&"object"==typeof r.props){(r={...r}).props={...r.props};const e=t.get("DomComponents"),i=t.get("Parser"),{parserHtml:n}=i;s.each(r,(e,t)=>{s.includes(["props","type"],t)||delete r[t]});const{props:o}=r,a=o.children;delete o.children,delete r.props;const l=n.splitPropsFromAttr(o);r.attributes=l.attrs,a&&(r.components=a),r.type?e.getType(r.type)||(r.tagName=r.type,delete r.type):r.type="textnode",s.extend(r,l.props)}return r},onAdd(e,t,i={}){const n=this.em,r=e.getStyle(),o=n&&n.getConfig("avoidInlineStyle");if(!s.isEmpty(r)&&!o&&n&&n.get&&n.getConfig("forceClass")&&!i.temporary){const t=e.cid;n.get("CssComposer").setClassRule(t,r);e.setStyle({}),e.addClass(t)}}});return n}),e("skylark-grapejs/trait_manager/model/Trait",["skylark-backbone","skylark-underscore"],function(e,t){"use strict";return e.Model.extend({defaults:{type:"text",label:"",name:"",min:"",max:"",unit:"",step:1,value:"",target:"",default:"",placeholder:"",changeProp:0,options:[]},initialize(){const e=this.get("target"),t=this.get("name"),s=this.get("changeProp");if(e){this.target=e,this.unset("target");const i=s?`change:${t}`:`change:attributes:${t}`;this.listenTo(e,i,this.targetUpdated)}},props(){return this.attributes},targetUpdated(){const e=this.getTargetValue();this.set({value:e},{fromTarget:1})},getTargetValue(){const e=this.get("name"),s=this.target;let i;return i=this.get("changeProp")?s.get(e):s.getAttributes()[e],t.isUndefined(i)?"":i},setTargetValue(e,s={}){const i=this.target,n=this.get("name");if(t.isUndefined(e))return;let r=e;if("false"===e?r=!1:"true"===e&&(r=!0),this.get("changeProp"))i.set(n,r,s);else{const e={...i.get("attributes")};e[n]=r,i.set("attributes",e,s)}},setValueFromInput(e,t=1,s={}){const i={value:e};this.set(i,{...s,avoidStore:1}),t&&(this.set("value","",s),this.set(i,s))},getInitValue(){const e=this.target,t=this.get("name");let s;if(e){const i=e.get("attributes");s=this.get("changeProp")?e.get(t):i[t]}return s||this.get("value")||this.get("default")}})}),e("skylark-grapejs/trait_manager/model/TraitFactory",[],function(){"use strict";return(e={})=>({build(t){var s=[];"string"==typeof t&&(t=[t]);for(var i=0;i<t.length;i++){var n={},r=t[i];switch(n.name=r,r){case"target":n.type="select"}switch(r){case"target":n.options=e.optionsTarget}s.push(n)}return s}})}),e("skylark-grapejs/trait_manager/model/Traits",["skylark-backbone","skylark-underscore","./Trait","./TraitFactory"],function(e,t,s,i){"use strict";return e.Collection.extend({model:s,initialize(e,t={}){this.em=t.em||"",this.listenTo(this,"add",this.handleAdd),this.listenTo(this,"reset",this.handleReset)},handleReset(e,{previousModels:t=[]}={}){t.forEach(e=>e.trigger("remove"))},handleAdd(e){const t=this.target;t&&(e.target=t)},setTarget(e){this.target=e},add(s,n){const r=this.em;if(t.isString(s)||t.isArray(s)){const e=r&&r.get&&r.get("TraitManager"),n=e&&e.getConfig(),l=i(n);t.isString(s)&&(s=[s]);for(var o=0,a=s.length;o<a;o++){const e=s[o],i=t.isString(e)?l.build(e)[0]:e;i.target=this.target,s[o]=i}}return e.Collection.prototype.add.apply(this,[s,n])}})}),e("skylark-grapejs/dom_components/model/Component",["skylark-langx/langx","skylark-underscore","../../utils/mixins","../../domain_abstract/model/Styleable","skylark-backbone","./Components","../../selector_manager/model/Selector","../../selector_manager/model/Selectors","../../trait_manager/model/Traits"],function(e,t,s,i,n,r,o,a,l){"use strict";const c=e=>e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),d=n.Model.extend(i).extend({defaults:{tagName:"div",type:"",name:"",removable:!0,draggable:!0,droppable:!0,badgable:!0,stylable:!0,"stylable-require":"","style-signature":"",unstylable:"",highlightable:!0,copyable:!0,resizable:!1,editable:!1,layerable:!0,selectable:!0,hoverable:!0,void:!1,state:"",status:"",content:"",icon:"",style:"",classes:"",script:"","script-export":"",attributes:"",traits:["id","title"],propagate:"",dmode:"",toolbar:null},init(){},updated(e,t,s){},removed(){},initialize(s={},i={}){const n=i.em,r=this.parent(),o=r&&r.attributes;if(o&&o.propagate){let t={};const i=o.propagate;i.forEach(e=>t[e]=r.get(e)),t.propagate=i,t=e.mixin({},t,s),this.set(t)}const a=this.get("propagate");a&&this.set("propagate",t.isArray(a)?a:[a]),i&&i.config&&i.config.voidElements.indexOf(this.get("tagName"))>=0&&this.set("void",!0),i.em=n,this.opt=i,this.em=n,this.frame=i.frame,this.config=i.config||{},this.set("attributes",e.mixin({},this.defaults.attributes,this.get("attributes"))),this.ccid=d.createId(this),this.initClasses(),this.initTraits(),this.initComponents(),this.initToolbar(),this.listenTo(this,"change:script",this.scriptUpdated),this.listenTo(this,"change:tagName",this.tagUpdated),this.listenTo(this,"change:attributes",this.attrUpdated),this.listenTo(this,"change:attributes:id",this._idUpdated),this.set("status",""),this.views=[],["classes","traits","components"].forEach(e=>{const t=`add remove ${"components"!==e?"change":""}`;this.listenTo(this.get(e),t.trim(),(...t)=>this.emitUpdate(e,...t))}),i.temporary||(this.init(),n&&n.trigger("component:create",this))},is(e){return!(this.get("type")!=e)},props(){return this.attributes},index(){const{collection:e}=this;return e&&e.indexOf(this)},setDragMode(e){return this.set("dmode",e)},find(e){const t=[],s=this.view.$el.find(e);return s.each(e=>{const i=s.eq(e),n=i.data("model");n&&t.push(n)}),t},findType(e){const t=[],s=i=>i.forEach(i=>{i.is(e)&&t.push(i),s(i.components())});return s(this.components()),t},closest(e){const t=this.view.$el.closest(e);return t.length&&t.data("model")},tagUpdated(){const e=this.collection,t=e.indexOf(this);e.remove(this),e.add(this,{at:t})},replaceWith(e){const t=this.collection,s=t.indexOf(this);return t.remove(this),t.add(e,{at:s})},attrUpdated(e,i,n={}){const r=this.get("attributes"),o=r.class;o&&this.setClass(o),delete r.class;const a=r.style;a&&this.setStyle(a),delete r.style;const l={...this.previous("attributes")},c=s.shallowDiff(l,this.get("attributes"));t.keys(c).forEach(e=>this.trigger(`change:attributes:${e}`,this,c[e],n))},setAttributes(e,t={}){return this.set("attributes",{...e},t),this},addAttributes(e){const t={...this.getAttributes(),...e};return this.setAttributes(t),this},getStyle(){const e=this.em;if(e&&e.getConfig("avoidInlineStyle")){const t=e.get("state"),s=e.get("CssComposer"),i=s.getIdRule(this.getId(),{state:t});if(this.rule=i,i)return i.getStyle()}return i.getStyle.call(this)},setStyle(e={},n={}){const r=this.em,{opt:o}=this;if(r&&r.getConfig("avoidInlineStyle")&&!o.temporary){const i=this.get("style")||{};e={...e=t.isString(e)?this.parseStyle(e):e,...i};const o=r.get("state"),a=r.get("CssComposer"),l=this.getStyle();this.rule=a.setIdRule(this.getId(),e,{...n,state:o});const c=s.shallowDiff(l,e);this.set("style",{},{silent:1}),t.keys(c).forEach(e=>this.trigger(`change:style:${e}`))}else e=i.setStyle.apply(this,arguments);return e},getAttributes(){const{em:e}=this,s=[],i={...this.get("attributes")},n=e&&e.get("SelectorManager"),r=this.getId();if(this.get("classes").forEach(e=>s.push(t.isString(e)?e:e.get("name"))),s.length&&(i.class=s.join(" ")),!t.has(i,"id")){let s;(e=>e&&e.getConfig("avoidInlineStyle"))(e)?s=n&&n.get(r,n.Selector.TYPE_ID):t.isEmpty(this.getStyle())||(s=1),s&&(i.id=this.getId())}return i},addClass(e){const t=this.em.get("SelectorManager").addClass(e);return this.get("classes").add(t)},setClass(e){return this.get("classes").reset(),this.addClass(e)},removeClass(e){const s=[];e=t.isArray(e)?e:[e];const i=this.get("classes"),n=o.TYPE_CLASS;return e.forEach(e=>{const t=e.split(" ");t.forEach(e=>{const t=i.where({name:e,type:n})[0];t&&s.push(i.remove(t))})}),s},getClasses(){const e=this.getAttributes(),t=e.class;return t?t.split(" "):[]},initClasses(){const e=[this,"change:classes",this.initClasses],s=this.get("classes")||[],i=t.isString(s)?s.split(" "):s;this.stopListening(...e);const n=this.normalizeClasses(i),r=new a([]);return this.set("classes",r),r.add(n),this.listenTo(...e),this},initComponents(){const e=[this,"change:components",this.initComponents];this.stopListening(...e);const s=new r(null,this.opt);s.parent=this;const i=this.get("components"),n=!this.opt.avoidChildren;return this.set("components",s),n&&s.add(t.isFunction(i)?i(this):i),this.listenTo(...e),this},initTraits(e){const{em:t}=this,s=[this,"change:traits",this.initTraits];this.stopListening(...s),this.loadTraits();const i={...this.get("attributes")},n=this.get("traits");return n.each(e=>{if(!e.get("changeProp")){const t=e.get("name"),s=e.getInitValue();t&&s&&(i[t]=s)}}),n.length&&this.set("attributes",i),this.listenTo(...s),e&&t&&t.trigger("component:toggled"),this},append(e,s={}){const i=this.components().add(e,s);return t.isArray(i)?i:[i]},components(e){const s=this.get("components");return t.isUndefined(e)?s:(s.reset(),e&&this.append(e))},parent(){const e=this.collection;return e&&e.parent},scriptUpdated(){this.set("scriptUpdated",1)},initToolbar(){const{em:e}=this,t=this,s=e&&e.getConfig("stylePrefix")||"";if(!t.get("toolbar")){var i=[];t.collection&&i.push({attributes:{class:"fa fa-arrow-up"},command:e=>e.runCommand("core:component-exit",{force:1})}),t.get("draggable")&&i.push({attributes:{class:`fa fa-arrows ${s}no-touch-actions`,draggable:!0},command:"tlb-move"}),t.get("copyable")&&i.push({attributes:{class:"fa fa-clone"},command:"tlb-clone"}),t.get("removable")&&i.push({attributes:{class:"fa fa-trash-o"},command:"tlb-delete"}),t.set("toolbar",i)}},loadTraits(e,s={}){if(e=e||this.get("traits"),!((e=t.isFunction(e)?e(this):e)instanceof l)){const t=new l([],this.opt);t.setTarget(this),e.length&&(e.forEach(e=>e.attributes&&delete e.attributes.value),t.add(e)),this.set("traits",t,s)}return this},getTrait(e){return this.get("traits").filter(t=>t.get("id")===e||t.get("name")===e)[0]},updateTrait(e,t){const{em:s}=this,i=this.getTrait(e);return i&&i.set(t),s&&s.trigger("component:toggled"),this},getTraitIndex(e){const t=this.getTrait(e);return t?this.get("traits").indexOf(t):t},removeTrait(e){const{em:s}=this,i=t.isArray(e)?e:[e],n=i.map(e=>this.getTrait(e)),r=this.get("traits").remove(n);return s&&s.trigger("component:toggled"),r},addTrait(e,t={}){const{em:s}=this,i=this.get("traits").add(e,t);return s&&s.trigger("component:toggled"),i},normalizeClasses(e){var t=[];const s=this.em;if(s){var i=s.get("SelectorManager");if(i)return e.forEach(e=>{var s="";s="string"==typeof e?e:e.name;var n=i.add(s);t.push(n)}),t}},clone(){const e=this.em,s=this.getStyle(),i={...this.attributes},n={...this.opt};i.attributes={...i.attributes},delete i.attributes.id,i.components=[],i.classes=[],i.traits=[],this.get("components").each((e,t)=>{i.components[t]=e.clone()}),this.get("traits").each((e,t)=>{i.traits[t]=e.clone()}),this.get("classes").each((e,t)=>{i.classes[t]=e.get("name")}),i.status="",i.view="",n.collection=null,e&&e.getConfig("avoidInlineStyle")&&!t.isEmpty(s)&&(i.style=s);const r=new this.constructor(i,n);return e&&e.trigger("component:clone",r),this.trigger("component:clone",r),r},getName(){const{em:e}=this,{type:t,tagName:i}=this.attributes,n=this.get("name"),r="div"==i,o=r?"box":i,a=t||o,l=!t&&i&&!r&&i,c="domComponents.names.",d=n&&e&&e.t(`${c}${n}`),h=l&&e&&e.t(`${c}${l}`),p=e&&(e.t(`${c}${t}`)||e.t(`${c}${i}`));return this.get("custom-name")||d||n||h||s.capitalize(l)||p||s.capitalize(a)},getIcon(){let e=this.get("icon");return e?e+" ":""},toHTML(e={}){const s=this,i=[],n=e.tag,r=n||s.get("tagName"),o=s.get("void"),a=e.attributes;let l=this.getAttrToHTML();delete e.tag,a&&(t.isFunction(a)?l=a(s,l)||{}:t.isObject(a)&&(l=a));for(let e in l){const s=l[e],n=t.isString(s)?s.replace(/"/g,"&quot;"):s;t.isUndefined(n)||(t.isBoolean(n)?n&&i.push(e):i.push(`${e}="${n}"`))}let c=i.length?` ${i.join(" ")}`:"",d=`<${r}${c}${o?"/":""}>${s.get("content")}`;return s.get("components").each(t=>d+=t.toHTML(e)),!o&&(d+=`</${r}>`),d},getAttrToHTML(){var e=this.getAttributes();return delete e.style,e},toJSON(...e){const s=n.Model.prototype.toJSON.apply(this,e);if(s.attributes=this.getAttributes(),delete s.attributes.class,delete s.toolbar,delete s.traits,this.em.getConfig("avoidDefaults")){const e=t.result(this,"defaults");t.forEach(e,(e,t)=>{-1===["type","content"].indexOf(t)&&s[t]===e&&delete s[t]}),t.isEmpty(s.type)&&delete s.type,t.forEach(["attributes","style"],i=>{t.isEmpty(e[i])&&t.isEmpty(s[i])&&delete s[i]}),t.forEach(["classes","components"],i=>{t.isEmpty(e[i])&&!s[i].length&&delete s[i]})}return s},getId(){let e=this.get("attributes")||{};return e.id||this.ccid||this.cid},setId(e,t){const s={...this.get("attributes")};return s.id=e,this.set("attributes",s,t),this},getEl(e){const t=this.getView(e);return t&&t.el},getView(e){let{view:t,views:s}=this;return e&&(t=s.filter(t=>t._getFrame()===e.view)[0]),t},getCurrentView(){const e=(this.em.get("currentFrame")||{}).model;return this.getView(e)},getScriptString(e){var s=e||this.get("script");if(!s)return s;if("function"==typeof s){var i=s.toString().trim();i=i.replace(/^function[\s\w]*\(\)\s?\{/,"").replace(/\}$/,""),s=i.trim()}var n=this.em.getConfig(),r=c(n.tagVarStart||"{[ "),o=c(n.tagVarEnd||" ]}"),a=new RegExp(`${r}([\\w\\d-]*)${o}`,"g");return s=s.replace(a,(e,s)=>{this.scriptUpdated();const i=this.attributes[s]||"";return t.isArray(i)||"object"==typeof i?JSON.stringify(i):i})},emitUpdate(e,...t){const s=this.em,i="component:update"+(e?`:${e}`:"");e&&this.updated(e,e&&this.get(e),e&&this.previous(e),...t),this.trigger(i,...t),s&&s.trigger(i,this,...t)},onAll(e){return t.isFunction(e)&&(e(this),this.components().forEach(t=>t.onAll(e))),this},remove(){const e=this.collection;return e&&e.remove(this)},resetId(e={}){const{em:t}=this,s=this.getId();if(!s)return;const i=d.createId(this);this.setId(i);const n=t&&t.get("CssComposer").getIdRule(s),r=n&&n.get("selectors").at(0);return r&&r.set("name",i),this},_getStyleRule({id:e}={}){const{em:t}=this,s=e||this.getId();return t&&t.get("CssComposer").getIdRule(s)},_getStyleSelector(e){const t=this._getStyleRule(e);return t&&t.get("selectors").at(0)},_idUpdated(e,t,s={}){if(s.idUpdate)return;const{ccid:i}=this,{id:n}=this.get("attributes")||{},r=(this.previous("attributes")||{}).id||i,o=d.getList(this);if(o[n])return this.setId(r,{idUpdate:1});delete o[r],o[n]=this,this.ccid=n;const a=this._getStyleSelector({id:r});a&&a.set({name:n,label:n})}},{isComponent:e=>({tagName:e.tagName?e.tagName.toLowerCase():""}),createId(e){const t=d.getList(e);let s,{id:i}=e.get("attributes");return i?(s=d.getIncrementId(i,t),e.setId(s)):s=d.getNewId(t),t[s]=e,s},getNewId(e){const t=Object.keys(e).length,s=t.toString().length+2,i=(Math.random()+1.1).toString(36).slice(-s);let n=`i${i}`;for(;e[n];)n=d.getNewId(e);return n},getIncrementId(e,t){let s=1,i=e;for(;t[i];)i=`${e}-${++s}`;return i},getList(e){const t=e.opt&&e.opt.domc;return t?t.componentsById:{}},checkId(e,s=[],i={}){const n=t.isArray(e)?e:[e];n.forEach(e=>{const{attributes:n={},components:r}=e,{id:o}=n;if(o&&i[o]){const e=d.getIncrementId(o,i);n.id=e,t.isArray(s)&&s.forEach(t=>{const{selectors:s}=t;s.forEach((t,i)=>{t===`#${o}`&&(s[i]=`#${e}`)})})}r&&d.checkId(r,s,i)})}});return d.eventDrag="component:drag",r.Component=d,d}),e("skylark-grapejs/dom_components/view/ComponentsView",["skylark-backbone","skylark-underscore"],function(e,t){"use strict";var s=e.View.extend({initialize(e){this.opts=e||{},this.config=e.config||{},this.em=this.config.em;const t=this.collection;this.listenTo(t,"add",this.addTo),this.listenTo(t,"reset",this.resetChildren),this.listenTo(t,"remove",this.removeChildren)},removeChildren(e,t,s={}){const{em:i}=this.config,n=s.temporary;if(e.views.forEach(e=>{if(!e)return;e.remove.apply(e);const{childrenView:t,scriptContainer:s}=e;t&&t.stopListening(),s&&s.remove()}),e.components().forEach(e=>this.removeChildren(e,t,s)),i&&!n){const t=e.getId(),s=i.get("DomComponents");delete s.componentsById[t];const n=i.get("CssComposer").getAll();if(n.remove(n.filter(e=>e.getSelectors().getFullString()===`#${t}`)),!e.opt.temporary){const t=i.get("Commands"),s=e.get("style-signature"),n={target:e};s&&t.run("core:component-style-clear",n),e.removed(),i.trigger("component:remove",e)}}},addTo(e,t={},s={}){const i=this.config.em,n=this.collection.indexOf(e);if(this.addToCollection(e,null,n),i&&!s.temporary){const t=e=>{i.trigger("component:add",e),e.components().forEach(e=>t(e))};t(e)}},addToCollection(e,i,n){this.compView||(this.compView=s.ComponentView);const{config:r,opts:o,em:a}=this,l=i||null,c=o.componentTypes||a&&a.get("DomComponents").getTypes(),d=e.get("type");let h=this.compView;for(let e=0;e<c.length;e++)if(c[e].id==d){h=c[e].view;break}const p=new h({model:e,config:r,componentTypes:c});let g=p.render().el;if(l)l.appendChild(g);else{const e=this.parentEl,s=e.childNodes;if(t.isUndefined(n))e.appendChild(g);else{const t=s.length==n;t&&n--,t||!s.length?e.appendChild(g):e.insertBefore(g,s[n])}}return g},resetChildren(){this.parentEl.innerHTML="",this.collection.each(e=>this.addToCollection(e))},render(e){const t=this.el,s=document.createDocumentFragment();return this.parentEl=e||this.el,this.collection.each(e=>this.addToCollection(e,s)),t.innerHTML="",t.appendChild(s),this}});return s}),e("skylark-grapejs/dom_components/view/ComponentView",["skylark-backbone","skylark-underscore","../model/Components","./ComponentsView","../../selector_manager/model/Selectors","../../utils/dom","../../utils/mixins"],function(e,t,s,i,n,r,o){"use strict";var a=e.View.extend({className(){return this.getClasses()},tagName(){return this.model.get("tagName")},initialize(e={}){const t=this.model,s=e.config||{},i=s.em,n=t.opt||{},{$el:r,el:a}=this,{draggableComponents:l}=s;this.opts=e,this.modelOpt=n,this.config=s,this.em=i||"",this.pfx=s.stylePrefix||"",this.ppfx=s.pStylePrefix||"",this.attr=t.get("attributes"),this.classe=this.attr.class||[],this.listenTo(t,"change:style",this.updateStyle),this.listenTo(t,"change:attributes change:_innertext",this.renderAttributes),this.listenTo(t,"change:highlightable",this.updateHighlight),this.listenTo(t,"change:status",this.updateStatus),this.listenTo(t,"change:script",this.reset),this.listenTo(t,"change:content",this.updateContent),this.listenTo(t,"change",this.handleChange),this.listenTo(t,"active",this.onActive),this.listenTo(t,"disable",this.onDisable),r.data("model",t),o.setViewEl(a,this),t.view=this,this._getFrame()&&t.views.push(this),this.initClasses(),this.initComponents({avoidRender:1}),this.events={...this.events,...l&&{dragstart:"handleDragStart"}},this.delegateEvents(),!n.temporary&&this.init(this._clbObj())},_clbObj(){const{em:e,model:t,el:s}=this;return{editor:e&&e.getEditor(),model:t,el:s}},init(){},removed(){},onActive(){},onDisable(){},remove(){e.View.prototype.remove.apply(this,arguments);const{model:t}=this,s=this._getFrame()||{},i=s.model;t.components().forEach(e=>{const t=e.getView(i);t&&t.remove()});const{views:n}=t;return n.splice(n.indexOf(this),1),this.removed(this._clbObj()),this},handleDragStart(e){e.preventDefault(),e.stopPropagation(),this.em.get("Commands").run("tlb-move",{target:this.model,event:e})},initClasses(){const{model:e}=this,t=e.get("classes");t instanceof n&&(this.stopListening(e,"change:classes",this.initClasses),this.listenTo(e,"change:classes",this.initClasses),this.listenTo(t,"add remove change",this.updateClasses),t.length&&this.importClasses())},initComponents(e={}){const{model:t,$el:i,childrenView:n}=this,r=t.get("components"),o=[t,"change:components",this.initComponents];r instanceof s&&(i.data("collection",r),n&&n.remove(),this.stopListening(...o),!e.avoidRender&&this.renderChildren(),this.listenTo(...o))},handleChange(){const{model:e}=this,s=t.keys(e.changed);if(1!==s.length||"status"!==s[0]){e.emitUpdate();for(let t in e.changed)e.emitUpdate(t)}},importClasses(){var e=this.config.em.get("SelectorManager");e&&this.model.get("classes").each(t=>{e.add(t.get("name"))})},updateStatus(e={}){this.em;const t=this.el,s=this.model.get("status"),i=(this.pfx,this.ppfx),n=`${i}selected`,r=`${n}-parent`,o=`${i}freezed`,a=`${i}hovered`,l=[n,r,o,a];this.$el.removeClass(l.join(" "));var c=t.getAttribute("class")||"",d="";switch(s){case"selected":d=`${c} ${n}`;break;case"selected-parent":d=`${c} ${r}`;break;case"freezed":d=`${c} ${o}`;break;case"freezed-selected":d=`${c} ${o} ${n}`;break;case"hovered":d=e.avoidHover?"":`${c} ${a}`}(d=d.trim())&&t.setAttribute("class",d)},updateHighlight(){const e=this.model.get("highlightable");this.setAttribute("data-highlightable",e?1:"")},updateStyle(){const{model:e,em:s,el:i}=this;if(s&&s.getConfig("avoidInlineStyle")){e.get("_innertext")?i.removeAttribute("id"):i.id=e.getId();const s=e.getStyle();!t.isEmpty(s)&&e.setStyle(s)}else this.setAttribute("style",e.styleToString())},updateClasses(){const e=this.model.get("classes").pluck("name").join(" ");this.setAttribute("class",e),this.updateStatus()},setAttribute(e,t){const s=this.$el;t?s.attr(e,t):s.removeAttr(e)},getClasses(){return this.model.getClasses().join(" ")},updateAttributes(){const e=[],{model:s,$el:i,el:n,config:r}=this,{highlightable:o,textable:a,type:l,_innertext:c}=s.attributes,{draggableComponents:d}=r,h={"data-gjs-type":l||"default",...d&&!c?{draggable:!0}:{},...o?{"data-highlightable":1}:{},...a?{contenteditable:"false","data-gjs-textable":"true"}:{}};t.each(n.attributes,t=>e.push(t.nodeName)),e.forEach(e=>i.removeAttr(e));const p={...h,...s.getAttributes()};t.keys(p).forEach(e=>!1===p[e]&&delete p[e]),i.attr(p),this.updateStyle()},updateContent(){this.getChildrenContainer().innerHTML=this.model.get("content")},prevDef(e){e.preventDefault()},updateScript(){const{model:e,em:t}=this;e.get("script")&&t&&t.get("Canvas").getCanvasView().updateScript(this)},getChildrenContainer(){var e=this.el;return"function"==typeof this.getChildrenSelector?e=this.el.querySelector(this.getChildrenSelector()):this.getTemplate,e},getOffsetRect(){const e={},t=this.el;let s=0,i=0;const n=r=>{const{offsetParent:o}=r;o?(s+=o.offsetTop,i+=o.offsetLeft,n(o)):(e.top=t.offsetTop+s,e.left=t.offsetLeft+i,e.bottom=e.top+t.offsetHeight,e.right=e.left+t.offsetWidth)};return n(t),e},isInViewport({rect:e}={}){const{el:t}=this,s=t.ownerDocument,{body:i}=s,{frameElement:n}=s.defaultView,{top:r,left:o}=e||this.getOffsetRect(),a=this._getFrame().getOffsetRect();return r>=a.scrollTop&&o>=a.scrollLeft&&r<=a.scrollBottom&&o<=n.offsetWidth+i.scrollLeft},scrollIntoView(e={}){const t=this.getOffsetRect(),s=this.isInViewport({rect:t});if(!s||e.force){const{el:s}=this;"smooth"!==e.behavior?s.ownerDocument.defaultView.scrollTo(0,t.top):s.scrollIntoView({behavior:"smooth",block:"nearest",...e})}},reset(){const{el:e}=this;this.el="",this._ensureElement(),this._setData(),r.replaceWith(e,this.el),this.render()},_setData(){const{model:e}=this,t=e.components();this.$el.data({model:e,collection:t,view:this})},_getFrame(){return this.config.frameView},renderChildren(){this.updateContent();const e=this.getChildrenContainer(),t=new i({collection:this.model.get("components"),config:this.config,componentTypes:this.opts.componentTypes});t.render(e),this.childrenView=t;const s=Array.prototype.slice.call(t.el.childNodes);for(var n=0,r=s.length;n<r;n++)e.appendChild(s.shift())},renderAttributes(){this.updateAttributes(),this.updateClasses()},render(){return this.renderAttributes(),this.modelOpt.temporary?this:(this.renderChildren(),this.updateScript(),this.postRender(),this)},postRender(){const{em:e,model:t,modelOpt:s}=this;s.temporary||(this.onRender(this._clbObj()),e&&e.trigger("component:mount",t))},onRender(){}});return i.ComponentView=a,a}),e("skylark-grapejs/dom_components/model/ComponentTableCell",["./Component"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,type:"cell",tagName:"td",draggable:["tr"]}},{isComponent(e){let t="";const s=e.tagName;return"TD"!=s&&"TH"!=s||(t={type:"cell",tagName:s.toLowerCase()}),t}})}),e("skylark-grapejs/dom_components/view/ComponentTableCellView",["./ComponentView"],function(e){"use strict";return e.extend({})}),e("skylark-grapejs/dom_components/model/ComponentTableRow",["./Component"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,type:"row",tagName:"tr",draggable:["thead","tbody","tfoot"],droppable:["th","td"]},initialize(t,s){e.prototype.initialize.apply(this,arguments);const i=[],n=this.get("components");n.each(e=>e.is("cell")&&i.push(e)),n.reset(i)}},{isComponent(e){let t="";return"TR"==e.tagName&&(t={type:"row"}),t}})}),e("skylark-grapejs/dom_components/view/ComponentTableRowView",["./ComponentView"],function(e){"use strict";return e.extend({})}),e("skylark-grapejs/dom_components/model/ComponentTable",["./Component"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,type:"table",tagName:"table",droppable:["tbody","thead","tfoot"]},initialize(t,s){e.prototype.initialize.apply(this,arguments);const i=this.get("components");!i.length&&i.add({type:"tbody"})}},{isComponent(e){let t="";return"TABLE"==e.tagName&&(t={type:"table"}),t}})}),e("skylark-grapejs/dom_components/view/ComponentTableView",["./ComponentView"],function(e){"use strict";return e.extend({events:{}})}),e("skylark-grapejs/dom_components/model/ComponentTableBody",["./Component"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,type:"tbody",tagName:"tbody",draggable:["table"],droppable:["tr"],columns:1,rows:1},initialize(t,s){e.prototype.initialize.apply(this,arguments);const i=this.get("components");let n=this.get("columns"),r=this.get("rows");if(!i.length){const e=[];for(;r--;){const t=[];let s=n;for(;s--;)t.push({type:"cell",classes:["cell"]});e.push({type:"row",classes:["row"],components:t})}i.add(e)}}},{isComponent(e){let t="";return"TBODY"==e.tagName&&(t={type:"tbody"}),t}})}),e("skylark-grapejs/dom_components/model/ComponentTableHead",["./ComponentTableBody"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,type:"thead",tagName:"thead"}},{isComponent(e){let t="";return"THEAD"==e.tagName&&(t={type:"thead"}),t}})}),e("skylark-grapejs/dom_components/view/ComponentTableHeadView",["./ComponentView"],function(e){"use strict";return e.extend({})}),e("skylark-grapejs/dom_components/view/ComponentTableBodyView",["./ComponentView"],function(e){"use strict";return e.extend({})}),e("skylark-grapejs/dom_components/model/ComponentTableFoot",["./ComponentTableBody"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,type:"tfoot",tagName:"tfoot"}},{isComponent(e){let t="";return"TFOOT"==e.tagName&&(t={type:"tfoot"}),t}})}),e("skylark-grapejs/dom_components/view/ComponentTableFootView",["./ComponentView"],function(e){"use strict";return e.extend({})}),e("skylark-grapejs/dom_components/model/ComponentImage",["skylark-langx/langx","skylark-underscore","./Component"],function(e,t,s){"use strict";const i='xmlns="http://www.w3.org/2000/svg" width="100" viewBox="0 0 24 24" style="fill: rgba(0,0,0,0.15); transform: scale(0.75)"';return s.extend({defaults:e.mixin({},s.prototype.defaults,{type:"image",tagName:"img",void:1,droppable:0,editable:1,highlightable:0,resizable:{ratioDefault:1},traits:["alt"],src:`<svg ${i}>\n        <path d="M8.5 13.5l2.5 3 3.5-4.5 4.5 6H5m16 1V5a2 2 0 0 0-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2z"></path>\n      </svg>`,fallback:`<svg ${i}>\n        <path d="M2.28 3L1 4.27l2 2V19c0 1.1.9 2 2 2h12.73l2 2L21 21.72 2.28 3m2.55 0L21 19.17V5a2 2 0 0 0-2-2H4.83M8.5 13.5l2.5 3 1-1.25L14.73 18H5l3.5-4.5z"></path>\n      </svg>`,file:""}),initialize(e,t){s.prototype.initialize.apply(this,arguments);var i=this.get("attributes");i.src&&this.set("src",i.src)},initToolbar(...e){s.prototype.initToolbar.apply(this,e);const t=this.em;if(t){var i=t.get("Commands");if(i.has("image-editor")){let e=!1;var n=this.get("toolbar");for(let t=0;t<n.length;t++)if("image-editor"===n[t].command){e=!0;break}e||(n.push({attributes:{class:"fa fa-pencil"},command:"image-editor"}),this.set("toolbar",n))}}},getAttrToHTML(...e){const t=s.prototype.getAttrToHTML.apply(this,e),i=this.getSrcResult();return i&&(t.src=i),t},getSrcResult(e={}){const t=this.get(e.fallback?"fallback":"src")||"";let s=t;return t&&"<svg"===t.substr(0,4)&&(s=`data:image/svg+xml;base64,${window.btoa(t)}`),s},isDefaultSrc(){return this.get("src")===t.result(this,"defaults").src},parseUri(e){var t=document.createElement("a");t.href=e;for(var s={},i=t.search.substring(1).split("&"),n=0;n<i.length;n++){var r=i[n].split("="),o=decodeURIComponent(r[0]);o&&(s[o]=decodeURIComponent(r[1]))}return{hostname:t.hostname,pathname:t.pathname,protocol:t.protocol,search:t.search,hash:t.hash,port:t.port,query:s}}},{isComponent(e){var t="";return"IMG"==e.tagName&&(t={type:"image"}),t}})}),e("skylark-grapejs/dom_components/model/ComponentMap",["./ComponentImage","./Component"],function(e,t){"use strict";return e.extend({defaults:{...e.prototype.defaults,type:"map",src:"",void:0,mapUrl:"https://maps.google.com/maps",tagName:"iframe",mapType:"q",address:"",zoom:"1",attributes:{frameborder:0},toolbar:t.prototype.defaults.toolbar,traits:[{label:"Address",name:"address",placeholder:"eg. London, UK",changeProp:1},{type:"select",label:"Map type",name:"mapType",changeProp:1,options:[{value:"q",name:"Roadmap"},{value:"w",name:"Satellite"}]},{label:"Zoom",name:"zoom",type:"range",min:"1",max:"20",changeProp:1}]},initialize(t,s){this.get("src")?this.parseFromSrc():this.updateSrc(),e.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:address change:zoom change:mapType",this.updateSrc)},updateSrc(){this.set("src",this.getMapUrl())},getMapUrl(){var e=this.get("address"),t=this.get("zoom"),s=this.get("mapType");e=e?"&q="+e:"",t=t?"&z="+t:"",s=s?"&t="+s:"";var i=this.get("mapUrl")+"?"+e+t+s;return i+="&output=embed"},parseFromSrc(){var e=this.parseUri(this.get("src")),t=e.query;t.q&&this.set("address",t.q),t.z&&this.set("zoom",t.z),t.t&&this.set("mapType",t.t)}},{isComponent(e){var t="";return"IFRAME"==e.tagName&&/maps\.google\.com/.test(e.src)&&(t={type:"map",src:e.src}),t}})}),e("skylark-grapejs/dom_components/view/ComponentImageView",["skylark-underscore","./ComponentView"],function(e,t){"use strict";return t.extend({tagName:"img",events:{dblclick:"onActive",click:"initResize",error:"onError",dragstart:"noDrag"},initialize(e){const s=this.model;t.prototype.initialize.apply(this,arguments),this.listenTo(s,"change:src",this.updateSrc),this.classEmpty=`${this.ppfx}plh-image`;const i=this.config;i.modal&&(this.modal=i.modal),i.am&&(this.am=i.am),this.fetchFile()},fetchFile(){if(this.modelOpt.temporary)return;const t=this.model,s=t.get("file");if(s){const i=this.em.get("AssetManager").FileUploader();i.uploadFile({dataTransfer:{files:[s]}},s=>{const i=s&&s.data&&s.data[0],n=i&&(e.isString(i)?i:i.src);n&&t.set({src:n})}),t.set("file","")}},updateSrc(){const{model:e,classEmpty:t,$el:s}=this,i=e.getSrcResult(),n=i&&!e.isDefaultSrc();e.addAttributes({src:i}),s[n?"removeClass":"addClass"](t)},onActive(e){e&&e.stopPropagation();var t=this.opts.config.em,s=t?t.get("Editor"):"";s&&this.model.get("editable")&&s.runCommand("open-assets",{target:this.model,types:["image"],accept:"image/*",onSelect(){s.Modal.close(),s.AssetManager.setTarget(null)}})},onError(){const e=this.model.getSrcResult({fallback:1});e&&(this.el.src=e)},noDrag:e=>(e.preventDefault(),!1),render(){this.renderAttributes(),this.updateSrc();const{$el:e,model:t}=this,s=e.attr("class")||"";return!t.get("src")&&e.attr("class",`${s} ${this.classEmpty}`.trim()),this.postRender(),this}})}),e("skylark-grapejs/dom_components/view/ComponentMapView",["skylark-backbone","./ComponentImageView"],function(e,t){"use strict";return t.extend({tagName:"div",events:{},initialize(e){t.prototype.initialize.apply(this,arguments),this.classEmpty=this.ppfx+"plh-map"},updateSrc(){this.getIframe().src=this.model.get("src")},getIframe(){if(!this.iframe){var e=document.createElement("iframe");e.src=this.model.get("src"),e.frameBorder=0,e.style.height="100%",e.style.width="100%",e.className=this.ppfx+"no-pointer",this.iframe=e}return this.iframe},render(...e){return t.prototype.render.apply(this,e),this.updateClasses(),this.el.appendChild(this.getIframe()),this}})}),e("skylark-grapejs/dom_components/model/ComponentText",["./Component"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,type:"text",droppable:!1,editable:!0},toHTML(){return this.trigger("sync:content",{silent:1}),e.prototype.toHTML.apply(this,arguments)}})}),e("skylark-grapejs/dom_components/model/ComponentLink",["skylark-langx/langx","./ComponentText"],function(e,t){"use strict";return t.extend({defaults:{...t.prototype.defaults,type:"link",tagName:"a",traits:["title","href","target"]},getAttrToHTML(...e){const s=t.prototype.getAttrToHTML.apply(this,e);return delete s.onmousedown,s}},{isComponent(e){let t;if("A"==e.tagName){t={type:"link",editable:0};const s=e.childNodes,i=s.length;i||delete t.editable;for(let e=0;e<i;e++){const i=s[e];if(3==i.nodeType&&""!=i.textContent.trim()){delete t.editable;break}}}return t}})}),e("skylark-grapejs/dom_components/view/ComponentTextView",["../../utils/mixins","./ComponentView"],function(e,t){"use strict";const s=t.prototype;return t.extend({events:{dblclick:"onActive",input:"onInput"},initialize(e){s.initialize.apply(this,arguments),this.disableEditing=this.disableEditing.bind(this);const t=this.model,i=this.em;this.listenTo(t,"focus",this.onActive),this.listenTo(t,"change:content",this.updateContentText),this.listenTo(t,"sync:content",this.syncContent),this.rte=i&&i.get("RichTextEditor")},updateContentText(e,t,s={}){!s.fromDisable&&this.disableEditing()},onActive(e){if(this.rteEnabled||!this.model.get("editable"))return;e&&e.stopPropagation&&e.stopPropagation();const{rte:t,em:s}=this;if(t)try{this.activeRte=t.enable(this,this.activeRte)}catch(e){s.logError(e)}this.toggleEvents(1)},onDisable(){this.disableEditing()},disableEditing(){const{model:e,rte:t,activeRte:s,em:i}=this,n=e.get("editable");if(t&&n){try{t.disable(this,s)}catch(e){i.logError(e)}this.syncContent()}this.toggleEvents()},getContent(){const{rte:e}=this,{activeRte:t}=e||{};let s="";return s=t&&"function"==typeof t.getContent?t.getContent():this.getChildrenContainer().innerHTML},syncContent(e={}){const{model:t,rte:s,rteEnabled:i}=this;if(!i&&!e.force)return;const n=this.getContent(),r=t.components(),o={fromDisable:1,...e};if(r.length&&r.reset(null,e),t.set("content","",o),s.customRte)t.set("content",n,o);else{const s=t=>{const i=!!t.get("textable"),n=!["text","default",""].some(e=>t.is(e))||i;t.set({_innertext:!n,editable:n&&t.get("editable"),selectable:n,hoverable:n,removable:i,draggable:i,highlightable:0,copyable:i,...!i&&{toolbar:""}},e),t.get("components").each(e=>s(e))};!e.silent&&t.trigger("change:content",t,"",o),r.add(n,e),r.each(e=>s(e)),r.trigger("resetNavigator")}},onInput(){const{em:e}=this;e&&e.trigger("component:update",this.model)},disablePropagation(e){e.stopPropagation()},toggleEvents(t){const{em:s}=this,i=t?"on":"off";s.setEditing(t),this.rteEnabled=!!t;var n=[this.el.ownerDocument,document];if(e.off(n,"mousedown",this.disableEditing),e[i](n,"mousedown",this.disableEditing),s[i]("toolbar:run:before",this.disableEditing),this.$el.off("mousedown",this.disablePropagation),this.$el[i]("mousedown",this.disablePropagation),this.config.draggableComponents){let{el:e}=this;for(;e;)e.draggable=!t,(e=e.parentNode)&&"BODY"==e.tagName&&(e=0)}}})}),e("skylark-grapejs/dom_components/view/ComponentLinkView",["./ComponentTextView"],function(e){"use strict";return e.extend({render(...t){return e.prototype.render.apply(this,t),this.el.addEventListener("click",this.prevDef,!0),this}})}),e("skylark-grapejs/dom_components/model/ComponentLabel",["skylark-langx/langx","./ComponentText"],function(e,t){"use strict";return t.extend({defaults:{...t.prototype.defaults,tagName:"label",traits:["id","title","for"]}},{isComponent(e){if("LABEL"==e.tagName)return{type:"label"}}})}),e("skylark-grapejs/dom_components/view/ComponentLabelView",["./ComponentLinkView"],function(e){"use strict";return e.extend({tagName:"span"})}),e("skylark-grapejs/dom_components/model/ComponentVideo",["./ComponentImage","./Component"],function(e,t){"use strict";const s="yt",i="vi",n="ytnc";return e.extend({defaults:{...e.prototype.defaults,type:"video",tagName:"video",videoId:"",void:0,provider:"so",ytUrl:"https://www.youtube.com/embed/",ytncUrl:"https://www.youtube-nocookie.com/embed/",viUrl:"https://player.vimeo.com/video/",loop:0,poster:"",muted:0,autoplay:0,controls:1,color:"",rel:1,modestbranding:0,sources:[],attributes:{allowfullscreen:"allowfullscreen"},toolbar:t.prototype.defaults.toolbar},initialize(t,r){var o=[],a=this.get("provider");switch(a){case s:case n:o=this.getYoutubeTraits();break;case i:o=this.getVimeoTraits();break;default:o=this.getSourceTraits()}this.get("src")&&this.parseFromSrc(),this.set("traits",o),e.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:provider",this.updateTraits),this.listenTo(this,"change:videoId change:provider",this.updateSrc)},initToolbar(...e){t.prototype.initToolbar.apply(this,e)},parseFromSrc(){var e=this.get("provider"),t=this.parseUri(this.get("src")),r=t.query;switch(e){case s:case n:case i:var o=t.pathname.split("/").pop();this.set("videoId",o),r.autoplay&&this.set("autoplay",1),r.loop&&this.set("loop",1),0===parseInt(r.controls)&&this.set("controls",0),r.color&&this.set("color",r.color),"0"===r.rel&&this.set("rel",0),"1"===r.modestbranding&&this.set("modestbranding",1)}},updateSrc(){var e=this.get("provider");switch(e){case s:this.set("src",this.getYoutubeSrc());break;case n:this.set("src",this.getYoutubeNoCookieSrc());break;case i:this.set("src",this.getVimeoSrc())}},getAttrToHTML(...t){var r=e.prototype.getAttrToHTML.apply(this,t),o=this.get("provider");switch(o){case s:case n:case i:break;default:this.get("loop")&&(r.loop="loop"),this.get("autoplay")&&(r.autoplay="autoplay"),this.get("controls")&&(r.controls="controls")}return r},updateTraits(){var e=this.get("provider"),t=this.getSourceTraits();switch(e){case s:case n:this.set("tagName","iframe"),t=this.getYoutubeTraits();break;case i:this.set("tagName","iframe"),t=this.getVimeoTraits();break;default:this.set("tagName","video")}this.loadTraits(t),this.em.trigger("component:toggled")},getProviderTrait:()=>({type:"select",label:"Provider",name:"provider",changeProp:1,options:[{value:"so",name:"HTML5 Source"},{value:s,name:"Youtube"},{value:n,name:"Youtube (no cookie)"},{value:i,name:"Vimeo"}]}),getSourceTraits(){return[this.getProviderTrait(),{label:"Source",name:"src",placeholder:"eg. ./media/video.mp4",changeProp:1},{label:"Poster",name:"poster",placeholder:"eg. ./media/image.jpg"},this.getAutoplayTrait(),this.getLoopTrait(),this.getControlsTrait()]},getYoutubeTraits(){return[this.getProviderTrait(),{label:"Video ID",name:"videoId",placeholder:"eg. jNQXAC9IVRw",changeProp:1},this.getAutoplayTrait(),this.getLoopTrait(),this.getControlsTrait(),{type:"checkbox",label:"Related",name:"rel",changeProp:1},{type:"checkbox",label:"Modest",name:"modestbranding",changeProp:1}]},getVimeoTraits(){return[this.getProviderTrait(),{label:"Video ID",name:"videoId",placeholder:"eg. 123456789",changeProp:1},{label:"Color",name:"color",placeholder:"eg. FF0000",changeProp:1},this.getAutoplayTrait(),this.getLoopTrait()]},getAutoplayTrait:()=>({type:"checkbox",label:"Autoplay",name:"autoplay",changeProp:1}),getLoopTrait:()=>({type:"checkbox",label:"Loop",name:"loop",changeProp:1}),getControlsTrait:()=>({type:"checkbox",label:"Controls",name:"controls",changeProp:1}),getYoutubeSrc(){const e=this.get("videoId");let t=this.get("ytUrl");return t+=e+"?",t+=this.get("autoplay")?"&autoplay=1":"",t+=this.get("controls")?"":"&controls=0&showinfo=0",t+=this.get("loop")?`&loop=1&playlist=${e}`:"",t+=this.get("rel")?"":"&rel=0",t+=this.get("modestbranding")?"&modestbranding=1":""},getYoutubeNoCookieSrc(){let e=this.getYoutubeSrc();return e=e.replace(this.get("ytUrl"),this.get("ytncUrl"))},getVimeoSrc(){var e=this.get("viUrl");return e+=this.get("videoId")+"?",e+=this.get("autoplay")?"&autoplay=1":"",e+=this.get("loop")?"&loop=1":"",e+=this.get("controls")?"":"&title=0&portrait=0&badge=0",e+=this.get("color")?"&color="+this.get("color"):""}},{isComponent(e){var t="",r=/youtube\.com\/embed/.test(e.src),o=/youtube-nocookie\.com\/embed/.test(e.src),a=/player\.vimeo\.com\/video/.test(e.src),l=r||o||a;return("VIDEO"==e.tagName||"IFRAME"==e.tagName&&l)&&(t={type:"video"},e.src&&(t.src=e.src),l&&(r?t.provider=s:o?t.provider=n:a&&(t.provider=i))),t}})}),e("skylark-grapejs/dom_components/view/ComponentVideoView",["./ComponentImageView","./ComponentView"],function(e,t){"use strict";return e.extend({tagName:"div",events:{},initialize(e){t.prototype.initialize.apply(this,arguments);const{model:s}=this,i=["loop","autoplay","controls","color","rel","modestbranding","poster"].map(e=>`change:${e}`).join(" ");this.listenTo(s,"change:provider",this.updateProvider),this.listenTo(s,"change:src",this.updateSrc),this.listenTo(s,i,this.updateVideo)},updateProvider(){var e=this.model.get("provider");this.el.innerHTML="",this.el.appendChild(this.renderByProvider(e))},updateSrc(){const{model:e,videoEl:t}=this;if(!t)return;const s=e.get("provider");let i=e.get("src");switch(s){case"yt":i=e.getYoutubeSrc();break;case"ytnc":i=e.getYoutubeNoCookieSrc();break;case"vi":i=e.getVimeoSrc()}t.src=i},updateVideo(){var e=this.model.get("provider"),t=this.videoEl,s=this.model;switch(e){case"yt":case"ytnc":case"vi":this.model.trigger("change:videoId");break;default:t.loop=s.get("loop"),t.autoplay=s.get("autoplay"),t.controls=s.get("controls"),t.poster=s.get("poster")}},renderByProvider(e){var t;switch(e){case"yt":t=this.renderYoutube();break;case"ytnc":t=this.renderYoutubeNoCookie();break;case"vi":t=this.renderVimeo();break;default:t=this.renderSource()}return this.videoEl=t,t},renderSource(){var e=document.createElement("video");return e.src=this.model.get("src"),this.initVideoEl(e),e},renderYoutube(){var e=document.createElement("iframe");return e.src=this.model.getYoutubeSrc(),e.frameBorder=0,e.setAttribute("allowfullscreen",!0),this.initVideoEl(e),e},renderYoutubeNoCookie(){var e=document.createElement("iframe");return e.src=this.model.getYoutubeNoCookieSrc(),e.frameBorder=0,e.setAttribute("allowfullscreen",!0),this.initVideoEl(e),e},renderVimeo(){var e=document.createElement("iframe");return e.src=this.model.getVimeoSrc(),e.frameBorder=0,e.setAttribute("allowfullscreen",!0),this.initVideoEl(e),e},initVideoEl(e){e.className=this.ppfx+"no-pointer",e.style.height="100%",e.style.width="100%"},render(...t){e.prototype.render.apply(this,t),this.updateClasses();var s=this.model.get("provider");return this.el.appendChild(this.renderByProvider(s)),this.updateVideo(),this}})}),e("skylark-grapejs/dom_components/model/ComponentScript",["./Component"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,type:"script",droppable:!1,draggable:!1,layerable:!1}},{isComponent(e){if("SCRIPT"==e.tagName){var t={type:"script"};return e.src&&(t.src=e.src,t.onload=e.onload),t}}})}),e("skylark-grapejs/dom_components/view/ComponentScriptView",["skylark-backbone","./ComponentImageView"],function(e,t){"use strict";return t.extend({tagName:"script",events:{},render(){var e=this.model,t=e.get("src"),s=this.em,i=s&&s.get("scriptCount")?s.get("scriptCount"):0,n="";if(t){var r=e.get("onload"),o="script"+i,a="script"+(i+1);n="var "+o+" = document.createElement('script');\n"+o+".onload = function(){\n"+(r?r+"();\n":"")+"typeof "+a+"Start == 'function' && "+a+"Start();\n};\n"+o+".src = '"+t+"';\nfunction "+o+"Start() { document.body.appendChild("+o+"); };\n"+(i?"":o+"Start();"),s&&s.set("scriptCount",i+1)}else n=e.get("content");return this.el.innerHTML=n,this}})}),e("skylark-grapejs/dom_components/model/ComponentSvg",["./Component"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,resizable:{ratioDefault:1},highlightable:0},getName(){let e=this.get("tagName"),t=this.get("custom-name");return e=e.charAt(0).toUpperCase()+e.slice(1),t||e}},{isComponent(e){if(SVGElement&&e instanceof SVGElement)return{tagName:e.tagName,type:"svg"}}})}),e("skylark-grapejs/dom_components/model/ComponentSvgIn",["./ComponentSvg"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,selectable:!1,hoverable:!1,layerable:!1}},{isComponent(t){if(e.isComponent(t)&&"svg"!==t.tagName.toLowerCase())return{tagName:t.tagName,type:"svg-in"}}})}),e("skylark-grapejs/dom_components/view/ComponentSvgView",["./ComponentView"],function(e){"use strict";return e.extend({_createElement:function(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}})}),e("skylark-grapejs/dom_components/model/ComponentTextNode",["./Component"],function(e){"use strict";return e.extend({defaults:{...e.prototype.defaults,droppable:!1,layerable:!1,editable:!0},toHTML(){return this.get("content").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},{isComponent(e){var t="";return 3===e.nodeType&&(t={type:"textnode",content:e.textContent}),t}})}),e("skylark-grapejs/dom_components/model/ComponentComment",["skylark-langx/langx","./ComponentTextNode"],function(e,t){"use strict";return t.extend({defaults:{...t.prototype.defaults},toHTML(){return`\x3c!--${this.get("content")}--\x3e`}},{isComponent(e){if(8==e.nodeType)return{tagName:"NULL",type:"comment",content:e.textContent}}})}),e("skylark-grapejs/dom_components/view/ComponentTextNodeView",["skylark-backbone"],function(e){"use strict";return e.View.extend({initialize(){const{$el:e,model:t}=this;e.data("model",t),t.view=this},_createElement(){return document.createTextNode(this.model.get("content"))}})}),e("skylark-grapejs/dom_components/view/ComponentCommentView",["./ComponentTextNodeView"],function(e){"use strict";return e.extend({_createElement(){return document.createComment(this.model.get("content"))}})}),e("skylark-grapejs/dom_components/model/ComponentWrapper",["./Component"],function(e){"use strict";return e.extend({},{isComponent:()=>!1})}),e("skylark-grapejs/dom_components/index",["skylark-backbone","skylark-underscore","./config/config","./model/Component","./model/Components","./view/ComponentView","./view/ComponentsView","./model/ComponentTableCell","./view/ComponentTableCellView","./model/ComponentTableRow","./view/ComponentTableRowView","./model/ComponentTable","./view/ComponentTableView","./model/ComponentTableHead","./view/ComponentTableHeadView","./model/ComponentTableBody","./view/ComponentTableBodyView","./model/ComponentTableFoot","./view/ComponentTableFootView","./model/ComponentMap","./view/ComponentMapView","./model/ComponentLink","./view/ComponentLinkView","./model/ComponentLabel","./view/ComponentLabelView","./model/ComponentVideo","./view/ComponentVideoView","./model/ComponentImage","./view/ComponentImageView","./model/ComponentScript","./view/ComponentScriptView","./model/ComponentSvg","./model/ComponentSvgIn","./view/ComponentSvgView","./model/ComponentComment","./view/ComponentCommentView","./model/ComponentTextNode","./view/ComponentTextNodeView","./model/ComponentText","./view/ComponentTextView","./model/ComponentWrapper"],function(e,t,s,i,n,r,o,a,l,c,d,h,p,g,u,m,f,v,y,b,k,w,x,C,S,T,$,E,P,V,M,A,_,D,I,N,j,F,O,L,R){"use strict";return()=>{var z={};let H;var U,B,q=[{id:"cell",model:a,view:l},{id:"row",model:c,view:d},{id:"table",model:h,view:p},{id:"thead",model:g,view:u},{id:"tbody",model:m,view:f},{id:"tfoot",model:v,view:y},{id:"map",model:b,view:k},{id:"link",model:w,view:x},{id:"label",model:C,view:S},{id:"video",model:T,view:$},{id:"image",model:E,view:P},{id:"script",model:V,view:M},{id:"svg-in",model:_,view:D},{id:"svg",model:A,view:D},{id:"comment",model:I,view:N},{id:"textnode",model:j,view:F},{id:"text",model:O,view:L},{id:"wrapper",model:R,view:r},{id:"default",model:i,view:r}];return{Component:i,Components:n,ComponentsView:o,componentTypes:q,componentsById:{},name:"DomComponents",getConfig:()=>z,storageKey(){var e=[],t=z.stm&&z.stm.getConfig()||{};return t.storeHtml&&e.push("html"),t.storeComponents&&e.push("components"),e},init(e){for(var t in H=(z=e||{}).em,this.em=H,H&&(z.components=H.config.components||z.components),s)t in z||(z[t]=s[t]);var n=z.pStylePrefix;if(n&&(z.stylePrefix=n+z.stylePrefix),H){z.modal=H.get("Modal")||"",z.am=H.get("AssetManager")||"",H.get("Parser").compTypes=q,H.on("change:componentHovered",this.componentHovered,this);const e=H.get("selected");H.listenTo(e,"add",(e,t,s)=>this.selectAdd(e,s)),H.listenTo(e,"remove",(e,t,s)=>this.selectRemove(e,s))}let o=z.components,a={...z.wrapper};return a["custom-name"]=z.wrapperName,a.wrapper=1,a.type="wrapper",o&&o.constructor===Object&&o.wrapper&&(a={...o},o=o.components||[],a.components=[],H&&(H.config.components=o,z.components=o)),(U=new i(a,{em:H,config:z,componentTypes:q,domc:this})).set({attributes:{id:"wrapper"}}),B=new r({model:U,config:z,componentTypes:q}),this},onLoad(){this.setComponents(z.components)},postLoad(e){this.handleChanges(this.getWrapper(),null,{avoidStore:1})},handleChanges(e,t,s={}){const i=e.components(),n=H.get("UndoManager"),r=H.handleUpdates.bind(H),o=this.handleChanges.bind(this),a=this.handleChangesColl.bind(this),l=this.handleRemoves.bind(this);n&&n.add(e),n&&i&&n.add(i);[[e,"change:style change:content change:attributes change:src",r],[e,"change:components",a],[i,"add",o],[i,"remove",l],[e.get("classes"),"add remove",r]].forEach(e=>{H.stopListening(e[0],e[1],e[2]),H.listenTo(e[0],e[1],e[2])}),!s.avoidStore&&r("","",s),i.each(e=>this.handleChanges(e,t,s))},handleChangesColl(t,s){const i=H.get("UndoManager");if(i&&s instanceof e.Collection){const e=this.handleChanges.bind(this),t=this.handleRemoves.bind(this);i.add(s),[[s,"add",e],[s,"remove",t]].forEach(e=>{H.stopListening(e[0],e[1],e[2]),H.listenTo(e[0],e[1],e[2])})}},handleRemoves(e,t,s={}){!s.avoidStore&&H.handleUpdates(e,t,s)},load(e=""){const{em:s}=this;let i="";!e&&z.stm&&(e=z.em.getCacheLoad());const{components:n,html:r}=e;if(n)if(t.isObject(n)||t.isArray(n))i=n;else try{i=JSON.parse(n)}catch(e){s&&s.logError(e)}else r&&(i=r);const o=i&&i.constructor===Object;return(i&&i.length||o)&&(this.clear(),o?this.getWrapper().set(i):this.getComponents().add(i)),i},store(e){if(z.stm){var t={},s=this.storageKey();if(s.indexOf("html")>=0&&(t.html=z.em.getHtml()),s.indexOf("components")>=0){const{em:e}=this,s=z.storeWrapper,i=s?this.getWrapper():this.getComponents();t.components=JSON.stringify(i)}return e||z.stm.store(t),t}},getComponent:()=>U,getWrapper(){return this.getComponent()},getComponents(){return this.getWrapper().get("components")},addComponent(e){return this.getComponents().add(e)},render:()=>B.render().el,clear(){return this.getComponents().map(e=>e).forEach(e=>e.remove()),this},setComponents(e){this.clear().addComponent(e)},addType(e,s){const{em:i}=this,{model:n={},view:r={},isComponent:o,extend:a,extendView:l,extendFn:c=[],extendFnView:d=[]}=s,h=this.getType(e),p=this.getType(a),g=this.getType(l),u=p||(h||this.getType("default")),m=u.model,f=g?g.view:u.view,v=(e,t,s)=>e.reduce((e,i)=>{const n=t[i],r=s.prototype[i];return n&&r&&(e[i]=function(...e){r.bind(this)(...e),n.bind(this)(...e)}),e},{});"object"==typeof n&&(s.model=m.extend({...n,...v(c,n,m),defaults:langx.mixin({},m.prototype.defaults,t.result(n,"defaults"))},{isComponent:!h||p||o?o||(()=>0):m.isComponent})),"object"==typeof r&&(s.view=f.extend(langx.mixin({},r,v(d,r,f)))),h?(h.model=s.model,h.view=s.view):(s.id=e,q.unshift(s));const y=`component:type:${h?"update":"add"}`;return i&&i.trigger(y,h||s),this},getType(e){for(var t=q,s=0;s<t.length;s++){var i=t[s].id;if(i==e)return t[s]}},removeType(e){const t=q,s=this.getType(e);if(!s)return;const i=t.indexOf(s);return t.splice(i,1),s},getTypes:()=>q,selectAdd(e,t={}){e&&(e.set({status:"selected"}),["component:selected","component:toggled"].forEach(s=>this.em.trigger(s,e,t)))},selectRemove(e,t={}){if(e){const{em:s}=this;e.set({status:"",state:""}),["component:deselected","component:toggled"].forEach(s=>this.em.trigger(s,e,t))}},componentHovered(){const e=z.em,s=e.get("componentHovered"),i=e.previous("componentHovered");i&&"hovered"==i.get("status")&&i.set({status:"",state:""}),s&&t.isEmpty(s.get("status"))&&s.set("status","hovered")}}}}),e("skylark-grapejs/navigator/config/config",[],function(){"use strict";return{stylePrefix:"",appendTo:"",sortable:1,hidable:1,hideTextnode:1,root:"",showWrapper:1,showHover:1,scrollCanvas:{behavior:"smooth",block:"nearest"},scrollLayers:{behavior:"auto",block:"nearest"},highlightHover:1}}),e("skylark-grapejs/navigator/view/ItemsView",["skylark-backbone","../../dom_components/model/Component"],function(e,t){"use strict";var s=e.View.extend({initialize(e={}){this.opt=e;const s=e.config||{};this.level=e.level,this.config=s,this.preview=e.preview,this.ppfx=s.pStylePrefix||"",this.pfx=s.stylePrefix||"",this.parent=e.parent,this.parentView=e.parentView;const i=this.pfx,n=this.ppfx,r=this.parent,o=this.collection;this.listenTo(o,"add",this.addTo),this.listenTo(o,"reset resetNavigator",this.render),this.listenTo(o,"remove",this.removeChildren),this.className=`${i}layers`;const a=s.em;if(s.sortable&&!this.opt.sorter){const e=a.get("Utils");this.opt.sorter=new e.Sorter({container:s.sortContainer||this.el,containerSel:`.${this.className}`,itemSel:`.${i}layer`,ignoreViewChildren:1,onEndMove(e,s,i){const n=s.getSourceModel();a.setSelected(n,{forceChange:1}),a.trigger(`${t.eventDrag}:end`,i)},avoidSelectOnEnd:1,nested:1,ppfx:n,pfx:i})}this.sorter=this.opt.sorter||"",this.$el.data("collection",o),r&&this.$el.data("model",r)},removeChildren(e){const t=e.viewLayer;t&&t.remove.apply(t)},addTo(e){var t=this.collection.indexOf(e);this.addToCollection(e,null,t)},addToCollection(e,t,i){const{level:n,parentView:r}=this;var o=t||null,a=s.ItemView,l=new a({level:n,model:e,parentView:r,config:this.config,sorter:this.sorter,isCountable:this.isCountable,opened:this.opt.opened}),c=l.render().el;if(o)o.appendChild(c);else if(void 0!==i){var d="before";this.$el.children().length==i&&(i--,d="after"),i<0?this.$el.append(c):this.$el.children().eq(i)[d](c)}else this.$el.append(c);return c},isCountable(e,t){var s=e.get("type"),i=e.get("tagName");return!(("textnode"==s||"br"==i)&&t||!e.get("layerable"))},render(){const e=document.createDocumentFragment(),t=this.el;return t.innerHTML="",this.collection.each(t=>this.addToCollection(t,e)),t.appendChild(e),t.className=this.className,this}});return s}),e("skylark-grapejs/navigator/view/ItemView",["skylark-underscore","../../utils/mixins","skylark-backbone","../../dom_components/view/ComponentView","../../dom_components/model/Component","./ItemsView"],function(e,t,s,i,n,r){"use strict";const o=s.$;var a=s.View.extend({events:{"mousedown [data-toggle-move]":"startSort","touchstart [data-toggle-move]":"startSort","click [data-toggle-visible]":"toggleVisibility","click [data-toggle-select]":"handleSelect","mouseover [data-toggle-select]":"handleHover","click [data-toggle-open]":"toggleOpening","dblclick [data-name]":"handleEdit","focusout [data-name]":"handleEditEnd"},template(e){const{pfx:t,ppfx:s,config:i,clsNoEdit:n}=this,{hidable:r}=i,o=this.countChildren(e),a=o?"":this.clsNoChild,l=`${this.clsTitle} ${a}`,c=`${this.clsTitleC} ${s}one-bg`,d=`${this.clsCaret} fa fa-chevron-right`,h=`${this.inputNameCls} ${n} ${s}no-app`,p=this.level+1,g=`${30+10*p}px`,u=e.getName(),m=e.getIcon(),f=`${t}layer`;return`\n      ${r?`<i class="${t}layer-vis fa fa-eye ${this.isVisible()?"":"fa-eye-slash"}" data-toggle-visible></i>`:""}\n      <div class="${c}">\n        <div class="${l}" style="padding-left: ${g}" data-toggle-select>\n          <div class="${t}layer-title-inn">\n            <i class="${d}" data-toggle-open></i>\n            ${m?`<span class="${f}__icon">${m}</span>`:""}\n            <span class="${h}" data-name>${u}</span>\n          </div>\n        </div>\n      </div>\n      <div class="${this.clsCount}" data-count>${o||""}</div>\n      <div class="${this.clsMove}" data-toggle-move>\n        <i class="fa fa-arrows"></i>\n      </div>\n      <div class="${this.clsChildren}"></div>`},initialize(e={}){this.opt=e,this.level=e.level,this.config=e.config,this.em=e.config.em,this.ppfx=this.em.get("Config").stylePrefix,this.sorter=e.sorter||"",this.pfx=this.config.stylePrefix,this.parentView=e.parentView;const t=this.pfx,s=this.ppfx,i=this.model,n=i.get("components"),r=i.get("type")||"default";i.set("open",!1),this.listenTo(n,"remove add reset",this.checkChildren),this.listenTo(i,"change:status",this.updateStatus),this.listenTo(i,"change:open",this.updateOpening),this.listenTo(i,"change:layerable",this.updateLayerable),this.listenTo(i,"change:style:display",this.updateVisibility),this.className=`${t}layer ${t}layer__t-${r} no-select ${s}two-color`,this.inputNameCls=`${s}layer-name`,this.clsTitleC=`${t}layer-title-c`,this.clsTitle=`${t}layer-title`,this.clsCaret=`${t}layer-caret`,this.clsCount=`${t}layer-count`,this.clsMove=`${t}layer-move`,this.clsChildren=`${t}layer-children`,this.clsNoChild=`${t}layer-no-chld`,this.clsEdit=`${this.inputNameCls}--edit`,this.clsNoEdit=`${this.inputNameCls}--no-edit`,this.$el.data("model",i),this.$el.data("collection",n),i.viewLayer=this},getVisibilityEl(){return this.eyeEl||(this.eyeEl=this.$el.children(`.${this.pfx}layer-vis`)),this.eyeEl},updateVisibility(){const e=this.pfx,t=this.model,s=`${e}layer-hidden`,i="none"==t.getStyle().display,n=i?"addClass":"removeClass";this.$el[n](s),this.getVisibilityEl()[n]("fa-eye-slash")},toggleVisibility(e){e&&e.stopPropagation();const{model:t}=this,s=t.get("__prev-display"),i=t.getStyle(),{display:n}=i,r="none"==n;r?(delete i.display,s&&(i.display=s,t.unset("__prev-display"))):(n&&t.set("__prev-display",n),i.display="none"),t.setStyle(i)},handleEdit(e){e&&e.stopPropagation();const{em:t,$el:s,clsNoEdit:i,clsEdit:n}=this,r=this.getInputName();r.contentEditable=!0,r.focus(),t&&t.setEditing(1),s.find(`.${this.inputNameCls}`).removeClass(i).addClass(n)},handleEditEnd(e){e&&e.stopPropagation();const{em:t,$el:s,clsNoEdit:i,clsEdit:n}=this,r=this.getInputName(),o=r.textContent;r.scrollLeft=0,r.contentEditable=!1,this.model.set({"custom-name":o}),t&&t.setEditing(0),s.find(`.${this.inputNameCls}`).addClass(i).removeClass(n)},getInputName(){return this.inputName||(this.inputName=this.el.querySelector(`.${this.inputNameCls}`)),this.inputName},updateOpening(){var e=this.opt.opened||{},t=this.model;t.get("open")?(this.$el.addClass("open"),this.getCaret().addClass("fa-chevron-down"),e[t.cid]=t):(this.$el.removeClass("open"),this.getCaret().removeClass("fa-chevron-down"),delete e[t.cid])},toggleOpening(e){e.stopPropagation(),this.model.get("components").length&&this.model.set("open",!this.model.get("open"))},handleSelect(e){e.stopPropagation();const{em:t,config:s}=this;if(t){const e=this.model;t.setSelected(e,{fromLayers:1});const i=s.scrollCanvas;i&&e.views.forEach(e=>e.scrollIntoView(i))}},handleHover(e){e.stopPropagation();const{em:t,config:s,model:i}=this;t&&s.showHover&&t.setHovered(i,{fromLayers:1})},startSort(e){e.stopPropagation();const{em:t,sorter:s}=this;e.button&&0!==e.button||s&&(s.onStart=(e=>t.trigger(`${n.eventDrag}:start`,e)),s.onMoveClb=(e=>t.trigger(n.eventDrag,e)),s.startSort(e.target))},freeze(){this.$el.addClass(this.pfx+"opac50"),this.model.set("open",0)},unfreeze(){this.$el.removeClass(this.pfx+"opac50")},updateStatus(e){i.prototype.updateStatus.apply(this,[{avoidHover:!this.config.highlightHover}])},isVisible(){var e=this.model.get("style"),t=e.display;if(!t||"none"!=t)return 1},checkChildren(){const{model:e,clsNoChild:t}=this,s=this.countChildren(e),i=this.$el.children(`.${this.clsTitleC}`).children(`.${this.clsTitle}`);let{cnt:n}=this;n||(n=this.$el.children("[data-count]").get(0),this.cnt=n),i[s?"removeClass":"addClass"](t),n&&(n.innerHTML=s||""),!s&&e.set("open",0)},countChildren(e){var t=0;return e.get("components").each(function(e){var s=this.opt.isCountable,i=this.config.hideTextnode;s&&!s(e,i)||t++},this),t},getCaret(){if(!this.caret||!this.caret.length){this.pfx;this.caret=this.$el.children(`.${this.clsTitleC}`).find(`.${this.clsCaret}`)}return this.caret},setRoot(s){s=e.isString(s)?this.em.getWrapper().find(s)[0]:s;const i=t.getModel(s,o);i&&(this.stopListening(),this.model=i,this.initialize(this.opt),this.render())},updateLayerable(){const{parentView:e}=this,t=e||this;t.render()},render(){const{model:e,config:t,pfx:s,ppfx:i,opt:n}=this,{isCountable:o}=n,a=o&&!o(e,t.hideTextnode),l=this.isVisible(),c=this.$el.empty(),d=this.level+1,h=new r({collection:e.get("components"),config:this.config,sorter:this.sorter,opened:this.opt.opened,parentView:this,parent:e,level:d}).render().$el;return this.config.showWrapper||1!==d?(c.html(this.template(e)),c.find(`.${this.clsChildren}`).append(h)):c.append(h),e.get("draggable")&&this.config.sortable||c.children(`.${this.clsMove}`).remove(),!l&&(this.className+=` ${s}hide`),a&&(this.className+=` ${i}hidden`),c.attr("class",this.className),this.updateOpening(),this.updateStatus(),this.updateVisibility(),this}});return r.ItemView=a,a}),e("skylark-grapejs/navigator/index",["./config/config","./view/ItemView","skylark-underscore"],function(e,t,s){"use strict";return()=>{let i,n,r={};return{name:"LayerManager",init(t={}){return(r={...e,...t}).stylePrefix=t.pStylePrefix,i=r.em,this},getConfig:()=>r,onLoad(){n=new t({level:0,config:r,opened:r.opened||{},model:i.get("DomComponents").getWrapper()}),i&&i.on("component:selected",this.componentChanged),this.componentChanged()},postRender(){const e=r.appendTo,t=r.root;if(t&&this.setRoot(t),e){const t=s.isElement(e)?e:document.querySelector(e);t.appendChild(this.render())}},setRoot(e){return n.setRoot(e),this},getRoot:()=>n.model,getAll:()=>n,componentChanged(e,t={}){if(t.fromLayers)return;const s=i.get("opened"),n=i.getSelected(),o=r.scrollLayers;let a=n&&n.collection?n.collection.parent:null;for(let e in s)s[e].set("open",0);for(;a;)a.set("open",1),s[a.cid]=a,a=a.collection?a.collection.parent:null;if(n&&o){const e=n.viewLayer&&n.viewLayer.el;e&&e.scrollIntoView(o)}},render:()=>n.render().el}}}),e("skylark-grapejs/utils/Droppable",["./mixins","skylark-underscore"],function(e,t){"use strict";return class{constructor(e,s){this.em=e;const i=s||e.get("Canvas").getFrames().map(e=>e.get("root").getEl()),n=Array.isArray(i)?i:[i];return this.el=i,this.counter=0,t.bindAll(this,"handleDragEnter","handleDragOver","handleDrop","handleDragLeave"),n.forEach(e=>this.toggleEffects(e,1)),this}toggleEffects(t,s){const i=s?"on":"off";e[i](t,"dragenter",this.handleDragEnter),e[i](t,"dragover",this.handleDragOver),e[i](t,"drop",this.handleDrop),e[i](t,"dragleave",this.handleDragLeave)}endDrop(e,t){const{em:s,dragStop:i}=this;this.counter=0,this.over=0,i&&i(e),s.runDefault({preserveSelected:1}),s.trigger("canvas:dragend",t)}handleDragLeave(e){this.updateCounter(-1,e)}updateCounter(e,t){this.counter+=e,0===this.counter&&this.endDrop(1,t)}handleDragEnter(e){const{em:t}=this,s=e.dataTransfer;if(this.updateCounter(1,e),this.over)return;this.over=1;const i=t.get("Utils"),n=t.get("Canvas"),r=n.getBody();let o,a,l=t.get("dragContent")||"<br>";if(t.stopDefault(),t.inAbsoluteMode()){const i=t.get("DomComponents").getWrapper(),n=i.append({})[0],r=t.get("Commands").run("core:component-drag",{event:e,guidesInfo:1,center:1,target:n,onEnd:(e,t,{cancelled:r})=>{if(!r){const e=i.append(l)[0],{left:t,top:r,position:o}=n.getStyle();e.addStyle({left:t,top:r,position:o}),this.handleDragEnd(e,s)}n.remove()}});o=(t=>r.stop(e,{cancel:t})),a=(e=>l=e)}else{const e=new i.Sorter({em:t,wmargin:1,nested:1,canvasRelative:1,direction:"a",container:r,placer:n.getPlacerEl(),containerSel:"*",itemSel:"*",pfx:"gjs-",onEndMove:e=>this.handleDragEnd(e,s),document:n.getFrameEl().contentDocument});e.setDropContent(l),e.startSort(),this.sorter=e,o=(t=>{t&&(e.moved=0),e.endMove()}),a=(t=>e.setDropContent(t))}this.dragStop=o,this.dragContent=a,t.trigger("canvas:dragenter",s,l)}handleDragEnd(e,t){if(!e)return;const{em:s}=this;s.set("dragResult",e),s.trigger("canvas:drop",t,e)}handleDragOver(e){e.preventDefault(),this.em.trigger("canvas:dragover",e)}handleDrop(e){e.preventDefault();const{dragContent:t}=this,s=e.dataTransfer,i=this.getContentByData(s).content;e.target.style.border="",i&&t&&t(i),this.endDrop(!i,e)}getContentByData(e){const s=this.em,i=e.types,n=e.files||[],r=s.get("dragContent");let o=e.getData("text");if(n.length){o=[];for(let e=0;e<n.length;e++){const t=n[e],s=t.type.split("/")[0];"image"==s&&o.push({type:s,file:t,attributes:{alt:t.name}})}}else if(r)o=r;else if(t.indexOf(i,"text/html")>=0)o=e.getData("text/html").replace(/<\/?meta[^>]*>/g,"");else if(t.indexOf(i,"text/uri-list")>=0)o={type:"link",attributes:{href:o},content:o};else if(t.indexOf(i,"text/json")>=0){const t=e.getData("text/json");t&&(o=JSON.parse(t))}const a={content:o};return s.trigger("canvas:dragdata",e,a),a}}}),e("skylark-grapejs/canvas/config/config",[],function(){"use strict";return{stylePrefix:"cv-",scripts:[],styles:[],customBadgeLabel:"",autoscrollLimit:50,notTextable:["button","a","input[type=checkbox]","input[type=radio]"]}}),e("skylark-grapejs/canvas/model/Frame",["skylark-backbone","../../dom_components/model/Component","../../css_composer/model/CssRules","skylark-underscore"],function(e,t,s,i){"use strict";return e.Model.extend({defaults:{wrapper:"",width:null,height:null,head:"",x:0,y:0,root:0,components:0,styles:0,attributes:{}},initialize(e,n={}){const{root:r,styles:o,components:a}=this.attributes;this.set("head",[]),this.em=n.em;const l={em:n.em,config:n.em.get("DomComponents").getConfig(),frame:this};!r&&this.set("root",new t({type:"wrapper",components:a||[]},l)),(!o||i.isString(o))&&this.set("styles",new s(o,l))},remove(){this.view=0;const e=this.collection;return e&&e.remove(this)},getHead(){return[...this.get("head")]},setHead(e){return this.set("head",[...e])},addHeadItem(e){const t=this.getHead();t.push(e),this.setHead(t)},getHeadByAttr(e,t,s){const i=this.getHead();return i.filter(i=>i.attributes&&i.attributes[e]==t&&(!s||s===i.tag))[0]},removeHeadByAttr(e,t,s){const i=this.getHead(),n=this.getHeadByAttr(e,t,s),r=i.indexOf(n);r>=0&&(i.splice(r,1),this.setHead(i))},addLink(e){!this.getHeadByAttr("href",e,"link")&&this.addHeadItem({tag:"link",attributes:{href:e,rel:"stylesheet"}})},removeLink(e){this.removeHeadByAttr("href",e,"link")},addScript(e){!this.getHeadByAttr("src",e,"script")&&this.addHeadItem({tag:"script",attributes:{src:e}})},removeScript(e){this.removeHeadByAttr("src",e,"script")},_emitUpdated(e={}){this.em.trigger("frame:updated",{frame:this,...e})}})}),e("skylark-grapejs/canvas/model/Frames",["skylark-underscore","skylark-backbone","./Frame"],function(e,t,s){"use strict";return t.Collection.extend({model:s,initialize(){e.bindAll(this,"itemLoaded")},itemLoaded(){this.loadedItems++,this.loadedItems>=this.itemsToLoad&&(this.trigger("loaded:all"),this.listenToLoadItems(0))},listenToLoad(){this.loadedItems=0,this.itemsToLoad=this.length,this.listenToLoadItems(1)},listenToLoadItems(e){this.forEach(t=>t[e?"on":"off"]("loaded",this.itemLoaded))}})}),e("skylark-grapejs/canvas/model/Canvas",["skylark-backbone","./Frame","./Frames"],function(e,t,s){"use strict";return e.Model.extend({defaults:{frame:"",frames:"",wrapper:"",rulers:!1,zoom:100,x:0,y:0},initialize(e={}){const{em:i}=e,{styles:n=[],scripts:r=[]}=e,o=new t({},e);n.forEach(e=>o.addLink(e)),r.forEach(e=>o.addScript(e)),this.em=i,this.set("frame",o),this.set("frames",new s([o],e)),this.listenTo(this,"change:zoom",this.onZoomChange),this.listenTo(i,"change:device",this.updateDevice)},updateDevice(){const{em:e}=this,t=e.getDeviceModel(),s=e.getCurrentFrameModel();if(s&&t){const{width:e,height:i}=t.attributes;s.set({width:e,height:i})}},onZoomChange(){const e=this.get("zoom");e<1&&this.set("zoom",1)}})}),e("skylark-grapejs/canvas/view/FrameView",["skylark-langx/langx","skylark-backbone","skylark-underscore","../../css_composer/view/CssRulesView","../../dom_components/view/ComponentView","../../utils/dom","../../utils/mixins"],function(e,t,s,i,n,r,o){"use strict";return t.View.extend({tagName:"iframe",attributes:{allowfullscreen:"allowfullscreen","data-frame-el":!0},initialize(e){s.bindAll(this,"updateClientY","stopAutoscroll","autoscroll","_emitUpdate");const{model:t,el:i}=this;this.config={...e.config,frameView:this},this.ppfx=this.config.pStylePrefix||"",this.em=this.config.em,this.listenTo(t,"change:head",this.updateHead),t.view=this,o.setViewEl(i,this)},updateHead(){const e=this.getHead();r.empty(e),r.appendVNodes(e,this.model.getHead())},getEl(){return this.el},getWindow(){return this.getEl().contentWindow},getDoc(){return this.getEl().contentDocument},getHead(){return this.getDoc().querySelector("head")},getBody(){return this.getDoc().querySelector("body")},getWrapper(){return this.getBody().querySelector("[data-gjs-type=wrapper]")},getJsContainer(){return this.jsContainer||(this.jsContainer=r.createEl("div",{class:`${this.ppfx}js-cont`})),this.jsContainer},getToolsEl(){const{frameWrapView:e}=this.config;return e&&e.elTools},getGlobalToolsEl(){return this.em.get("Canvas").getGlobalToolsEl()},getHighlighter(){return this._getTool("[data-hl]")},getBadgeEl(){return this._getTool("[data-badge]")},getOffsetViewerEl(){return this._getTool("[data-offset]")},getRect(){return this.rect||(this.rect=this.el.getBoundingClientRect()),this.rect},getOffsetRect(){const{el:e}=this,{scrollTop:t,scrollLeft:s}=this.getBody(),i=e.offsetHeight,n=e.offsetWidth;return{top:e.offsetTop,left:e.offsetLeft,height:i,width:n,scrollTop:t,scrollLeft:s,scrollBottom:t+i,scrollRight:s+n}},_getTool(e){const t=this.getToolsEl();return this[e]||(this[e]=t.querySelector(e)),this[e]},remove(){const{root:e,model:s}=this;this._toggleEffects(),t.View.prototype.remove.apply(this,arguments),e.remove(),s.remove()},startAutoscroll(){this.lastMaxHeight=this.getWrapper().offsetHeight-this.el.offsetHeight,setTimeout(()=>{this._toggleAutoscrollFx(1),requestAnimationFrame(this.autoscroll)},0)},autoscroll(){if(this.dragging){const e=this.em.get("Canvas"),t=this.getWindow(),s=this.getBody(),i=s.scrollTop,n=this.lastClientY||0,r=e.getConfig().autoscrollLimit,o=this.getRect().height-r;let a=i;if(n<r&&(a-=r-n),n>o&&(a+=n-o),a!==i&&a>0&&a<this.lastMaxHeight){const e=this.getGlobalToolsEl();e.style.opacity=0,this.showGlobalTools(),t.scrollTo(0,a)}requestAnimationFrame(this.autoscroll)}},updateClientY(e){e.preventDefault(),this.lastClientY=o.getPointerEvent(e).clientY*this.em.getZoomDecimal()},showGlobalTools:s.debounce(function(){this.getGlobalToolsEl().style.opacity=""},50),stopAutoscroll(){this.dragging&&this._toggleAutoscrollFx()},_toggleAutoscrollFx(e){this.dragging=e;const t=this.getWindow(),s=e?"on":"off";o[s](t,"mousemove dragover",this.updateClientY),o[s](t,"mouseup",this.stopAutoscroll)},render(){const{el:e,$el:t,ppfx:s,config:i}=this;return t.attr({class:s+"frame"}),i.scripts.length?this.renderScripts():i.renderContent&&(e.onload=this.renderBody.bind(this)),this},renderScripts(){const{el:t,config:i}=this,n=i=>{if(i.length>0){const o=i.shift(),a=r.createEl("script",e.mixin({type:"text/javascript"},s.isString(o)?{src:o}:o));a.onerror=a.onload=n.bind(null,i),t.contentDocument.head.appendChild(a)}else this.renderBody()};t.onload=(()=>n([...i.scripts]))},renderBody(){const{config:e,model:t,ppfx:a}=this,l=t.get("root"),c=t.get("styles"),{em:d}=e,h=this.getDoc(),p=this.getHead(),g=this.getBody(),u=(this.getWindow(),d.get("Config")),m=[];e.styles.forEach(e=>m.push(s.isString(e)?{tag:"link",attributes:{href:e,rel:"stylesheet"}}:{tag:"link",attributes:{rel:"stylesheet",...e}})),m.length&&r.appendVNodes(p,m);r.append(g,`<style>\n      ${u.baseCss||""}\n\n      .${a}dashed *[data-highlightable] {\n        outline: 1px dashed rgba(170,170,170,0.7);\n        outline-offset: -2px;\n      }\n\n      .${a}selected {\n        outline: 3px solid #3b97e3 !important;\n        outline-offset: -3px;\n      }\n\n      .${a}selected-parent {\n        outline: 2px solid #ffca6f !important\n      }\n\n      .${a}no-select {\n        user-select: none;\n        -webkit-user-select:none;\n        -moz-user-select: none;\n      }\n\n      .${a}freezed {\n        opacity: 0.5;\n        pointer-events: none;\n      }\n\n      .${a}no-pointer {\n        pointer-events: none;\n      }\n\n      .${a}plh-image {\n        background: #f5f5f5;\n        border: none;\n        height: 100px;\n        width: 100px;\n        display: block;\n        outline: 3px solid #ffca6f;\n        cursor: pointer;\n        outline-offset: -2px\n      }\n\n      .${a}grabbing {\n        cursor: grabbing;\n        cursor: -webkit-grabbing;\n      }\n\n      .${a}is__grabbing {\n        overflow-x: hidden;\n      }\n\n      .${a}is__grabbing,\n      .${a}is__grabbing * {\n        cursor: grabbing !important;\n      }\n\n      ${u.canvasCss||""}\n      ${u.protectedCss||""}\n    </style>`),this.root=new n({model:l,config:{...l.config,frameView:this}}).render(),r.append(g,this.root.el),r.append(g,new i({collection:c,config:{...d.get("CssComposer").getConfig(),frameView:this}}).render().el),r.append(g,this.getJsContainer()),o.on(g,"click",e=>e&&"A"==e.target.tagName&&e.preventDefault()),o.on(g,"submit",e=>e&&e.preventDefault()),[{event:"keydown keyup keypress",class:"KeyboardEvent"},{event:"wheel",class:"WheelEvent"}].forEach(e=>e.event.split(" ").forEach(t=>{h.addEventListener(t,t=>this.el.dispatchEvent(r.createCustomEvent(t,e.class)))})),this._toggleEffects(1),t.trigger("loaded")},_toggleEffects(e){const t=e?o.on:o.off,s=this.getWindow();t(s,`${r.motionsEv} resize`,this._emitUpdate)},_emitUpdate(){this.model._emitUpdated()}})}),e("skylark-grapejs/canvas/view/FrameWrapView",["skylark-backbone","./FrameView","skylark-underscore","../../utils/dom","../../utils/Dragger"],function(e,t,s,i,n){"use strict";return e.View.extend({events:{"click [data-action-remove]":"remove","mousedown [data-action-move]":"startDrag"},initialize(e={},i={}){s.bindAll(this,"onScroll","frameLoaded","updateOffset","remove","startDrag");const{model:n}=this,r={...e.config||i,frameWrapView:this},{canvasView:o,em:a}=r;this.cv=o,this.config=r,this.em=a,this.canvas=a&&a.get("Canvas"),this.ppfx=r.pStylePrefix||"",this.frame=new t({model:n,config:r}),this.classAnim=`${this.ppfx}frame-wrapper--anim`,this.listenTo(n,"loaded",this.frameLoaded),this.listenTo(n,"change:x change:y",this.updatePos),this.listenTo(n,"change:width change:height",this.updateSize),this.updatePos(),this.setupDragger()},setupDragger(){const{canvas:e,model:t}=this;let s,i,r;const o=t=>{e.toggleFramesEvents(t)};this.dragger=new n({onStart:()=>{const{x:e,y:n}=t.attributes;r=this.em.getZoomMultiplier(),s=e,i=n,o()},onEnd:()=>o(1),setPosition:e=>{t.set({x:s+e.x*r,y:i+e.y*r})}})},startDrag(e){e&&this.dragger.start(e)},remove(){return e.View.prototype.remove.apply(this,arguments),this.frame.remove(),this},updateOffset:s.debounce(function(){const{em:e,$el:t,frame:s}=this;e.runDefault({preserveSelected:1}),t.removeClass(this.classAnim),s.model._emitUpdated()}),updatePos(e){const{model:t,el:s}=this,{x:i,y:n}=t.attributes,{style:r}=s;this.frame.rect=0,r.left=isNaN(i)?i:`${i}px`,r.top=isNaN(n)?n:`${n}px`,e&&this.updateOffset()},updateSize:s.debounce(function(){this.updateDim()}),updateDim(){const{em:e,el:t,$el:n,model:r,classAnim:o}=this,{width:a,height:l}=r.attributes,{style:c}=t,d=c.width||"",h=c.height||"",p=a||"",g=l||"",u=d==p&&h==g;if(this.frame.rect=0,n.addClass(o),c.width=s.isNumber(p)?`${p}px`:p,c.height=s.isNumber(g)?`${g}px`:g,s.isNull(a)||s.isNull(l)){const e={...a?{}:{width:t.offsetWidth},...l?{}:{height:t.offsetHeight}};r.set(e,{silent:1})}e.stopDefault({preserveSelected:1}),u?this.updateOffset():n.one(i.motionsEv,this.updateOffset)},onScroll(){const{frame:e,em:t}=this;t.trigger("frame:scroll",{frame:e,body:e.getBody(),target:e.getWindow()})},frameLoaded(){const{frame:e}=this;e.getWindow().onscroll=this.onScroll,this.updateDim()},render(){const{frame:e,$el:t,ppfx:s,cv:n,model:r,el:o}=this,{onRender:a}=r.attributes;e.render(),t.empty().attr({class:`${s}frame-wrapper`}).append(`\n      <div class="${s}frame-wrapper__top gjs-two-color" data-frame-top>\n        <div class="${s}frame-wrapper__name" data-action-move>\n          ${r.get("name")||""}\n        </div>\n        <div class="${s}frame-wrapper__top-r">\n          <div class="${s}frame-wrapper__icon" data-action-remove style="display: none">\n            <svg viewBox="0 0 24 24"><path d="M19 4h-3.5l-1-1h-5l-1 1H5v2h14M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12z"></path></svg>\n          </div>\n        </div>\n      </div>\n      <div class="${s}frame-wrapper__right" data-frame-right></div>\n      <div class="${s}frame-wrapper__left" data-frame-left></div>\n      <div class="${s}frame-wrapper__bottom" data-frame-bottom></div>\n      `).append(e.el);const l=i.createEl("div",{class:`${s}tools`,style:"pointer-events:none; opacity: 0"},`\n      <div class="${s}highlighter" data-hl></div>\n      <div class="${s}badge" data-badge></div>\n      <div class="${s}placeholder">\n        <div class="${s}placeholder-int"></div>\n      </div>\n      <div class="${s}ghost"></div>\n      <div class="${s}toolbar" style="pointer-events:all"></div>\n      <div class="${s}resizer"></div>\n      <div class="${s}offset-v" data-offset>\n        <div class="gjs-marginName" data-offset-m>\n          <div class="gjs-margin-v-el gjs-margin-v-top" data-offset-m-t></div>\n          <div class="gjs-margin-v-el gjs-margin-v-bottom" data-offset-m-b></div>\n          <div class="gjs-margin-v-el gjs-margin-v-left" data-offset-m-l></div>\n          <div class="gjs-margin-v-el gjs-margin-v-right" data-offset-m-r></div>\n        </div>\n        <div class="gjs-paddingName" data-offset-m>\n          <div class="gjs-padding-v-el gjs-padding-v-top" data-offset-p-t></div>\n          <div class="gjs-padding-v-el gjs-padding-v-bottom" data-offset-p-b></div>\n          <div class="gjs-padding-v-el gjs-padding-v-left" data-offset-p-l></div>\n          <div class="gjs-padding-v-el gjs-padding-v-right" data-offset-p-r></div>\n        </div>\n      </div>\n      <div class="${s}offset-fixed-v"></div>\n    `);return this.elTools=l,n.toolsWrapper.appendChild(l),a&&a({el:o,elTop:o.querySelector("[data-frame-top]"),elRight:o.querySelector("[data-frame-right]"),elBottom:o.querySelector("[data-frame-bottom]"),elLeft:o.querySelector("[data-frame-left]"),frame:r,frameWrapperView:this,remove:this.remove,startDrag:this.startDrag}),this}})}),e("skylark-grapejs/canvas/view/FramesView",["../../domain_abstract/view/DomainViews","./FrameWrapView"],function(e,t){"use strict";return e.extend({itemView:t,autoAdd:1,init(){this.listenTo(this.collection,"reset",this.render)},onRender(){const{config:e,$el:t}=this,{em:s}=e;s&&t.attr({class:`${s.getConfig("stylePrefix")}frames`})}})}),e("skylark-grapejs/canvas/view/CanvasView",["skylark-langx/langx","skylark-jquery","skylark-backbone","skylark-underscore","../../utils/mixins","./FramesView"],function(e,t,s,i,n,r){"use strict";let o;return s.View.extend({events:{wheel:"onWheel"},template(){const{pfx:e}=this;return`\n      <div class="${e}canvas__frames" data-frames></div>\n      <div id="${e}tools" class="${e}canvas__tools" data-tools></div>\n    `},initialize(t){i.bindAll(this,"clearOff","onKeyPress"),n.on(window,"scroll resize",this.clearOff);const{model:s}=this,o=s.get("frames");this.config=t.config||{},this.em=this.config.em||{},this.pfx=this.config.stylePrefix||"",this.ppfx=this.config.pStylePrefix||"",this.className=this.config.stylePrefix+"canvas";const{em:a,config:l}=this;this.frames=new r({collection:o,config:e.mixin({},l,{canvasView:this,renderContent:1})}),this.listenTo(a,"change:canvasOffset",this.clearOff),this.listenTo(a,"component:selected",this.checkSelected),this.listenTo(s,"change:zoom change:x change:y",this.updateFrames),this.listenTo(o,"loaded:all",()=>a.trigger("loaded")),this.toggleListeners(1)},checkSelected(e,t={}){const{scroll:s}=t,i=this.em.get("currentFrame");s&&e.views.forEach(e=>{e._getFrame()!==i&&e.scrollIntoView(s)})},remove(){s.View.prototype.remove.apply(this,arguments),this.toggleListeners()},preventDefault(e){e&&(e.preventDefault(),e._parentEvent&&e._parentEvent.preventDefault())},toggleListeners(e){const t=e?"on":"off";n[t](document,"keypress",this.onKeyPress)},onKeyPress(e){const{em:t}=this,s=n.getKeyChar(e);" "===s&&1!==t.getZoomDecimal()&&(this.preventDefault(e),t.get("Editor").runCommand("core:canvas-move"))},onWheel(e){if((e.ctrlKey||e.metaKey)&&this.em.getConfig("multiFrames")){this.preventDefault(e);const{model:t}=this,s=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),i=t.get("zoom");t.set("zoom",i+2*s)}},updateFrames(e){const{em:t,model:s}=this,{x:i,y:n}=s.attributes,r=this.getZoom(),a={preserveSelected:1},l=r?1/r:1;this.framesArea.style.transform=`scale(${r}) translate(${i*l}px, ${n*l}px)`,this.clearOff(),t.stopDefault(a),t.trigger("canvas:update",e),o&&clearTimeout(o),o=setTimeout(()=>t.runDefault(a),300)},getZoom(){return this.em.getZoomDecimal()},isElInViewport(e){const t=n.getElement(e),s=n.getElRect(t),i=this.getFrameOffset(t),r=s.top,o=s.left;return r>=0&&o>=0&&r<=i.height&&o<=i.width},offset(e,t={}){const s=n.getElRect(e),i=e.ownerDocument.body,{noScroll:r}=t;return{top:s.top+(r?0:i.scrollTop),left:s.left+(r?0:i.scrollLeft),width:s.width,height:s.height}},clearOff(){this.frmOff=null,this.cvsOff=null},getFrameOffset(e){if(!this.frmOff||e){const t=e?e.ownerDocument.defaultView.frameElement:this.frame.el;this.frmOff=this.offset(t)}return this.frmOff},getCanvasOffset(){return this.cvsOff||(this.cvsOff=this.offset(this.el)),this.cvsOff},getElementPos(e,t){const s=this.getZoom();var i=t||{},n=this.getFrameOffset(e),r=this.getCanvasOffset(),o=this.offset(e,t),a=i.avoidFrameOffset?0:n.top,l=i.avoidFrameOffset?0:n.left;const c=o.top*s+a-r.top,d=o.left*s+l-r.left,h=o.height*s,p=o.width*s;return{top:c,left:d,height:h,width:p,zoom:s,rect:o}},getElementOffsets(e){if(!e||n.isTextNode(e))return{};const t={},s=window.getComputedStyle(e);return["marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft"].forEach(e=>{t[e]=parseFloat(s[e])*this.getZoom()}),t},getPosition(e={}){const t=this.frame.el.contentDocument;if(!t)return;const s=t.body,i=this.getZoom(),n=this.getFrameOffset(),r=this.getCanvasOffset(),{noScroll:o}=e;return{top:n.top+(o?0:s.scrollTop)*i-r.top,left:n.left+(o?0:s.scrollLeft)*i-r.left,width:r.width,height:r.height}},updateScript(e){const s=e.model,i=s.getId();e.scriptContainer||(e.scriptContainer=t(`<div data-id="${i}">`),this.getJsContainer().appendChild(e.scriptContainer.get(0))),e.el.id=i,e.scriptContainer.html("");const n=document.createElement("script");n.innerHTML=`\n        setTimeout(function() {\n          var item = document.getElementById('${i}');\n          if (!item) return;\n          (function(){\n            ${s.getScriptString()};\n          }.bind(item))()\n        }, 1);`,setTimeout(()=>e.scriptContainer.get(0).appendChild(n),0)},getJsContainer(e){const t=this.getFrameView(e);return t&&t.getJsContainer()},getFrameView(e){return e&&e._getFrame()||this.em.get("currentFrame")},render(){const{el:e,$el:t,ppfx:s,model:i,em:n,frames:r}=this,o=n.get("CssComposer"),a=i.get("wrapper");t.html(this.template());const l=t.find("[data-frames]");this.framesArea=l.get(0),this.wrapper=a,a&&"function"==typeof a.render&&i.get("frame").set({wrapper:a,root:a.getWrapper(),styles:o.getAll()});const c=t.find("[data-tools]");this.toolsWrapper=c.get(0),c.append(`\n      <div class="${s}tools ${s}tools-gl" style="pointer-events:none">\n        <div class="${s}placeholder">\n          <div class="${s}placeholder-int"></div>\n        </div>\n      </div>\n      <div id="${s}tools" style="pointer-events:none">\n        <div class="${s}badge"></div>\n        <div class="${s}ghost"></div>\n        <div class="${s}toolbar" style="pointer-events:all"></div>\n        <div class="${s}resizer"></div>\n        <div class="${s}offset-v"></div>\n        <div class="${s}offset-fixed-v"></div>\n      </div>\n    `);const d=e.querySelector(`#${s}tools`);this.hlEl=e.querySelector(`.${s}highlighter`),this.badgeEl=e.querySelector(`.${s}badge`),this.placerEl=e.querySelector(`.${s}placeholder`),this.ghostEl=e.querySelector(`.${s}ghost`),this.toolbarEl=e.querySelector(`.${s}toolbar`),this.resizerEl=e.querySelector(`.${s}resizer`),this.offsetEl=e.querySelector(`.${s}offset-v`),this.fixedOffsetEl=e.querySelector(`.${s}offset-fixed-v`),this.toolsGlobEl=e.querySelector(`.${s}tools-gl`),this.toolsEl=d,this.el.className=this.className;const h=i.get("frames");return h.listenToLoad(),r.render(),n.setCurrentFrame(h.at(0).view),l.append(r.el),this.frame=h.at(0).view,this}})}),e("skylark-grapejs/canvas/index",["skylark-langx/langx","../utils/mixins","skylark-underscore","../utils/Droppable","./config/config","./model/Canvas","./view/CanvasView"],function(e,t,s,i,n,r,o){"use strict";const{requestAnimationFrame:a}=window;return()=>{let s,a,l={};return{getCanvasView:()=>a,name:"Canvas",init(t={}){l=e.mixin({},n,t,{module:this}),this.em=l.em;const i=l.pStylePrefix;i&&(l.stylePrefix=i+l.stylePrefix),s=new r(t),a=new o({model:s,config:l});var c=l.em.get("DomComponents");return c&&this.setWrapper(c),this.model=s,this.startAutoscroll=this.startAutoscroll.bind(this),this.stopAutoscroll=this.stopAutoscroll.bind(this),this},getConfig:()=>l,setWrapper(e){s.set("wrapper",e)},getElement:()=>a.el,getFrame:()=>s.get("frame"),getFrameEl(){const{frame:e}=a;return e&&e.el},getFramesEl:()=>a.framesArea,getWindow(){return this.getFrameEl().contentWindow},getDocument(){const e=this.getFrameEl();return e&&e.contentDocument},getBody(){const e=this.getDocument();return e&&e.body},getWrapperEl(){const e=this.getBody();return e&&e.querySelector("#wrapper")},_getCompFrame:e=>e&&e._getFrame(),_getLocalEl(e,t,s){let i=e;const n=this._getCompFrame(t);return i=n?n[s]():i},getGlobalToolsEl:()=>a.toolsGlobEl,getToolsEl(e){return this._getLocalEl(a.toolsEl,e,"getToolsEl")},getHighlighter(e){return this._getLocalEl(a.hlEl,e,"getHighlighter")},getBadgeEl(e){return this._getLocalEl(a.badgeEl,e,"getBadgeEl")},getPlacerEl:()=>a.placerEl,getGhostEl:()=>a.ghostEl,getToolbarEl:()=>a.toolbarEl,getResizerEl:()=>a.resizerEl,getOffsetViewerEl(e){return this._getLocalEl(a.offsetEl,e,"getOffsetViewerEl")},getFixedOffsetViewerEl:()=>a.fixedOffsetEl,render:()=>a.render().el,getOffset(){var e=this.offset(this.getFrameEl()),t=this.offset(this.getElement());return{top:e.top-t.top,left:e.left-t.left}},offset:e=>a.offset(e),setCustomBadgeLabel(e){l.customBadgeLabel=e},getElementPos:(e,t)=>a.getElementPos(e,t),getElementOffsets:e=>a.getElementOffsets(e),getRect(){const{top:e,left:t}=a.getPosition();return{...a.getCanvasOffset(),topScroll:e,leftScroll:t}},getTargetToElementDim(e,t,s={}){var i=s||{},n=a.getPosition();if(n){var r=i.elPos||a.getElementPos(t),o=s.toRight||0,c=i.targetHeight||e.offsetHeight,d=i.targetWidth||e.offsetWidth,h=i.event||null,p=r.top-c,g=r.left;g+=o?r.width:0;var u=(g=o?g-d:g)<n.left?n.left:g,m=p<n.top?n.top:p,f={top:m=m>r.top+r.height?r.top+r.height:m,left:u,elementTop:r.top,elementLeft:r.left,elementWidth:r.width,elementHeight:r.height,targetWidth:e.offsetWidth,targetHeight:e.offsetHeight,canvasTop:n.top,canvasLeft:n.left,canvasWidth:n.width,canvasHeight:n.height};return h&&l.em&&l.em.trigger(h,f),f}},canvasRectOffset(e,t,s={}){const i=(e,t=1,i)=>{const n=this.em.getZoomDecimal(),r=t?"top":"left",o=e.ownerDocument,{offsetTop:a=0,offsetLeft:l=0}=s.offset?(e=>{const{defaultView:t}=e;return t&&t.frameElement})(o):{},{scrollTop:c=0,scrollLeft:d=0}=o.body||{},h=t?c:d,p=t?a:l;return i[r]-(h-p)*n};return{top:i(e,1,t),left:i(e,0,t)}},getTargetToElementFixed(e,t,s={}){const i=s.pos||this.getElementPos(e),n=s.canvasOff||this.canvasRectOffset(e,i),r=t.offsetHeight||0,o=t.offsetWidth||0,a=i.left+i.width,l=this.getCanvasView(),c=l.getPosition(),d=l.getFrameOffset(e),{event:h}=s;let p=-r,g=i.width-o;g=i.left<-g?-i.left:g,g=a>c.width?g-(a-c.width):g;const u=i.height+r,m=u<d.height;n.top<r&&(m?p+=u:p=-n.top<i.height?-n.top:i.height);const f={top:p,left:g,canvasOffsetTop:n.top,canvasOffsetLeft:n.left};return h&&this.em.trigger(h,f),f},getMouseRelativePos(e,t){var s=t||{},i=0,n=0,r=s.subWinOffset,o=e.target.ownerDocument,a=o.defaultView||o.parentWindow,l=a.frameElement,c=r?a.pageYOffset:0,d=r?a.pageXOffset:0;if(l){var h=l.getBoundingClientRect();i=h.top||0,n=h.left||0}return{y:e.clientY+i-c,x:e.clientX+n-d}},getMouseRelativeCanvas(e,t){const s=this.getZoomDecimal(),{top:i,left:n}=a.getPosition(t);return{y:e.clientY*s+i,x:e.clientX*s+n}},hasFocus(){return this.getDocument().hasFocus()},isInputFocused(){const e=this.getDocument(),t=["body",...this.getConfig().notTextable],s=e&&e.activeElement;return s&&!t.some(e=>s.matches(e))},scrollTo(e,s={}){const i=t.getElement(e),n=i&&t.getViewEl(i);n&&n.scrollIntoView(s)},startAutoscroll(e){const t=e&&e.view||this.em.getCurrentFrame();t&&t.startAutoscroll()},stopAutoscroll(e){const t=e&&e.view||this.em.getCurrentFrame();t&&t.stopAutoscroll()},postRender(){t.hasDnd(l.em)&&(this.droppable=new i(l.em))},setZoom(e){return s.set("zoom",parseFloat(e)),this},getZoom:()=>parseFloat(s.get("zoom")),getZoomDecimal(){return this.getZoom()/100},getZoomMultiplier(){const e=this.getZoomDecimal();return e?1/e:1},toggleFramesEvents(e){const{style:t}=this.getFramesEl();t.pointerEvents=e?"":"none"},getFrameWrapperEl:()=>a.frame.getWrapper(),getFrames:()=>s.get("frames").map(e=>e),addFrame(e={},t={}){return s.get("frames").add({...e},{...t,em:this.em})}}}}),e("skylark-grapejs/commands/view/CommandAbstract",["skylark-backbone"],function(e){"use strict";e.$;return e.View.extend({initialize(e){this.config=e||{},this.editorModel=this.em=this.config.em||{},this.pfx=this.config.stylePrefix,this.ppfx=this.config.pStylePrefix,this.hoverClass=this.pfx+"hover",this.badgeClass=this.pfx+"badge",this.plhClass=this.pfx+"placeholder",this.freezClass=this.ppfx+"freezed",this.canvas=this.em.get&&this.em.get("Canvas"),this.em.get&&this.setElement(this.getCanvas()),this.canvas&&(this.$canvas=this.$el,this.canvasTool=this.getCanvasTools()),this.init(this.config)},onFrameScroll(e){},getCanvas(){return this.canvas.getElement()},getCanvasBody(){return this.canvas.getBody()},getCanvasWrapper(){return this.canvas.getWrapperEl()},getCanvasTools(){return this.canvas.getToolsEl()},offset(e){var t=e.getBoundingClientRect();return{top:t.top+e.ownerDocument.body.scrollTop,left:t.left+e.ownerDocument.body.scrollLeft}},init(e){},callRun(e,t={}){const s=this.id;if(e.trigger(`run:${s}:before`,t),t&&t.abort)return void e.trigger(`abort:${s}`,t);const i=t.sender||e,n=this.run(e,i,t);return e.trigger(`run:${s}`,n,t),e.trigger("run",s,n,t),n},callStop(e,t={}){const s=this.id,i=t.sender||e;e.trigger(`stop:${s}:before`,t);const n=this.stop(e,i,t);return e.trigger(`stop:${s}`,n,t),e.trigger("stop",s,n,t),n},stopCommand(){this.em.get("Commands").stop(this.id)},run(e,t){},stop(e,t){}})}),e("skylark-grapejs/commands/config/config",[],function(){"use strict";return{stylePrefix:"com-",defaults:[],strict:1}}),e("skylark-grapejs/commands/view/CanvasClear",[],function(){"use strict";return{run(e){e.DomComponents.clear(),e.CssComposer.clear()}}}),e("skylark-grapejs/commands/view/CanvasMove",["skylark-underscore","../../utils/mixins","../../utils/Dragger"],function(e,t,s){"use strict";return{run(t){e.bindAll(this,"onKeyUp","enableDragger","disableDragger"),this.editor=t,this.canvasModel=this.canvas.getCanvasView().model,this.toggleMove(1)},stop(e){this.toggleMove(),this.disableDragger()},onKeyUp(e){" "===t.getKeyChar(e)&&this.editor.stopCommand(this.id)},enableDragger(e){this.toggleDragger(1,e)},disableDragger(e){this.toggleDragger(0,e)},toggleDragger(e,t){const{canvasModel:i,em:n}=this;let{dragger:r}=this;const o=e?"add":"remove";this.getCanvas().classList[o](`${this.ppfx}is__grabbing`),r||(r=new s({getPosition:()=>({x:i.get("x"),y:i.get("y")}),setPosition({x:e,y:t}){i.set({x:e,y:t})},onStart(e,t){n.trigger("canvas:move:start",t)},onDrag(e,t){n.trigger("canvas:move",t)},onEnd(e,t){n.trigger("canvas:move:end",t)}}),this.dragger=r),e?r.start(t):r.stop()},toggleMove(e){const{ppfx:s}=this,i=e?"add":"remove",n=e?"on":"off",r=this.getCanvas(),o=[`${s}is__grab`];!e&&o.push(`${s}is__grabbing`),o.forEach(e=>r.classList[i](e)),t[n](document,"keyup",this.onKeyUp),t[n](r,"mousedown",this.enableDragger),t[n](document,"mouseup",this.disableDragger)}}}),e("skylark-grapejs/commands/view/ComponentDelete",["skylark-underscore"],function(e){"use strict";return{run(t,s,i={}){let n=i.component||t.getSelectedAll();return n=e.isArray(n)?[...n]:[n],t.select(null),n.forEach(e=>{if(!e||!e.get("removable"))return this.em.logWarning("The element is not removable",{component:e});e.remove()}),n}}}),e("skylark-grapejs/commands/view/ComponentDrag",["skylark-underscore","../../utils/Dragger"],function(e,t){"use strict";return{run(s,i,n={}){e.bindAll(this,"setPosition","onStart","onDrag","onEnd","getPosition","getGuidesStatic","renderGuide","getGuidesTarget");const{target:r,event:o,mode:a,dragger:l={}}=n,c=r.getEl(),d={doc:c.ownerDocument,onStart:this.onStart,onEnd:this.onEnd,onDrag:this.onDrag,getPosition:this.getPosition,setPosition:this.setPosition,guidesStatic:()=>this.guidesStatic,guidesTarget:()=>this.guidesTarget,...l};this.setupGuides(),this.opts=n,this.editor=s,this.em=s.getModel(),this.target=r,this.isTran="translate"==a,this.guidesContainer=this.getGuidesContainer(),this.guidesTarget=this.getGuidesTarget(),this.guidesStatic=this.getGuidesStatic();let h=this.dragger;return h?h.setOptions(d):(h=new t(d),this.dragger=h),o&&h.start(o),this.toggleDrag(1),this.em.trigger("dmode:start",this.getEventOpts()),h},getEventOpts(){return{mode:this.opts.mode,target:this.target,guidesTarget:this.guidesTarget,guidesStatic:this.guidesStatic}},stop(){this.toggleDrag()},setupGuides(){(this.guides||[]).forEach(e=>{const{guide:t}=e;t&&t.parentNode.removeChild(t)}),this.guides=[]},getGuidesContainer(){let{guidesEl:t}=this;if(!t){const{editor:s,em:i,opts:n}=this,r=s.getConfig("stylePrefix"),o=document.createElement("div"),a=document.createElement("div"),l=`<div class="${r}guide-info__line ${r}danger-bg">\n        <div class="${r}guide-info__content ${r}danger-color"></div>\n      </div>`;(t=document.createElement("div")).className=`${r}guides`,o.className=`${r}guide-info ${r}guide-info__x`,a.className=`${r}guide-info ${r}guide-info__y`,o.innerHTML=l,a.innerHTML=l,t.appendChild(o),t.appendChild(a),s.Canvas.getGlobalToolsEl().appendChild(t),this.guidesEl=t,this.elGuideInfoX=o,this.elGuideInfoY=a,this.elGuideInfoContentX=o.querySelector(`.${r}guide-info__content`),this.elGuideInfoContentY=a.querySelector(`.${r}guide-info__content`),i.on("canvas:update frame:scroll",e.debounce(()=>{this.updateGuides(),n.debug&&this.guides.forEach(e=>this.renderGuide(e))},200))}return t},getGuidesStatic(){let t=[];const s=this.target.getEl(),{parentNode:i={}}=s;return e.each(i.children,e=>t=t.concat(s!==e?this.getElementGuides(e):[])),t.concat(this.getElementGuides(i))},getGuidesTarget(){return this.getElementGuides(this.target.getEl())},updateGuides(t){let s,i;(t||this.guides).forEach(t=>{const{origin:n}=t,r=s===n?i:this.getElementPos(n);s=n,i=r,e.each(this.getGuidePosUpdate(t,r),(e,s)=>t[s]=e),t.originRect=r})},getGuidePosUpdate(e,t){const s={},{top:i,height:n,left:r,width:o}=t;switch(e.type){case"t":s.y=i;break;case"b":s.y=i+n;break;case"l":s.x=r;break;case"r":s.x=r+o;break;case"x":s.x=r+o/2;break;case"y":s.y=i+n/2}return s},renderGuide(e={}){const t=e.guide||document.createElement("div"),s=e.active?2:1;let i=t.children[0];return t.style=`position: absolute; background-color: ${e.active?"green":"red"};`,t.children.length||((i=document.createElement("div")).style="position: absolute; color: red; padding: 5px; top: 0; left: 0;",t.appendChild(i)),e.y?(t.style.width="100%",t.style.height=`${s}px`,t.style.top=`${e.y}px`,t.style.left=0):(t.style.width=`${s}px`,t.style.height="100%",t.style.left=`${e.x}px`,t.style.top="0px"),!e.guide&&this.guidesContainer.appendChild(t),t},getElementPos(e){return this.editor.Canvas.getElementPos(e,{noScroll:1})},getElementGuides(e){const{opts:t}=this,s=this.getElementPos(e),{top:i,height:n,left:r,width:o}=s,a=[{type:"t",y:i},{type:"b",y:i+n},{type:"l",x:r},{type:"r",x:r+o},{type:"x",x:r+o/2},{type:"y",y:i+n/2}].map(i=>({...i,origin:e,originRect:s,guide:t.debug&&this.renderGuide(i)}));return a.forEach(e=>this.guides.push(e)),a},getTranslate(e,t="x"){let s=0;return(e||"").split(" ").forEach(e=>{const i=e.trim(),n=`translate${t.toUpperCase()}(`;0===i.indexOf(n)&&(s=parseFloat(i.replace(n,"")))}),s},setTranslate(e,t,s){const i=`translate${t.toUpperCase()}(`,n=`${i}${s})`;let r=(e||"").split(" ").map(e=>{const t=e.trim();return 0===t.indexOf(i)&&(e=n),e}).join(" ");return r.indexOf(i)<0&&(r+=` ${n}`),r},getPosition(){const{target:e,isTran:t}=this,{left:s,top:i,transform:n}=e.getStyle();let r=0,o=0;return t?(r=this.getTranslate(n),o=this.getTranslate(n,"y")):(r=parseFloat(s),o=parseFloat(i)),{x:r,y:o}},setPosition({x:t,y:s,end:i,position:n,width:r,height:o}){const{target:a,isTran:l}=this,c=i?"":1,d=`${t}px`,h=`${s}px`;if(l){let e=a.getStyle().transform||"";return e=this.setTranslate(e,"x",d),e=this.setTranslate(e,"y",h),a.addStyle({transform:e,en:c},{avoidStore:!i})}const p={position:n,width:r,height:o},g={left:d,top:h,en:c};e.keys(p).forEach(e=>{const t=p[e];t&&(g[e]=t)}),a.addStyle(g,{avoidStore:!i})},_getDragData(){const{target:e}=this;return{target:e,parent:e.parent(),index:e.index()}},onStart(){const{target:e,editor:t,isTran:s,opts:i}=this,{center:n,onStart:r}=i,{Canvas:o}=t,a=e.getStyle();if(r&&r(this._getDragData()),!s&&"absolute"!==a.position){let{left:t,top:s,width:i,height:r}=o.offset(e.getEl());if(n){const{x:e,y:i}=o.getMouseRelativeCanvas(event);t=e,s=i}this.setPosition({x:t,y:s,width:`${i}px`,height:`${r}px`,position:"absolute"})}},onDrag(...e){const{guidesTarget:t,opts:s}=this,{onDrag:i}=s;this.updateGuides(t),s.debug&&t.forEach(e=>this.renderGuide(e)),s.guidesInfo&&this.renderGuideInfo(t.filter(e=>e.active)),i&&i(this._getDragData())},onEnd(e,t,s={}){const{editor:i,opts:n,id:r}=this,{onEnd:o}=n;o&&o(e,s,{event:e,...s,...this._getDragData()}),i.stopCommand(r),this.hideGuidesInfo(),this.em.trigger("dmode:end",this.getEventOpts())},hideGuidesInfo(){["X","Y"].forEach(e=>{const t=this[`elGuideInfo${e}`];t&&(t.style.display="none")})},renderGuideInfo(t=[]){const{guidesStatic:s}=this;this.hideGuidesInfo(),t.forEach(t=>{const{origin:i,x:n}=t,r=this.getElementPos(i),o=e.isUndefined(n)?"y":"x",a="y"===o,l=r[a?"left":"top"],c=r.rect[a?"left":"top"],d=a?l+r.width:l+r.height,h=a?c+r.rect.width:c+r.rect.height,p=this[`elGuideInfo${o.toUpperCase()}`],g=this[`elGuideInfoContent${o.toUpperCase()}`],u=p.style,m=s.filter(e=>e.type===t.type).map(e=>{const{left:t,width:s,top:i,height:n}=e.originRect,r=a?t:i,o=a?t+s:i+n;return{gap:o<l?l-o:r-d,guide:e}}).filter(e=>e.gap>0).sort((e,t)=>e.gap-t.gap).map(e=>e.guide)[0];if(m){const{left:e,width:i,top:n,height:o,rect:f}=m.originRect,v=a?e<r.left:n<r.top,y=a?e:n,b=a?f.left:f.top,k=a?e+i:n+o,w=a?f.left+f.width:f.top+f.height,x=a?t.y:t.x,C=v?k:d,S=`${x}px`,T=v?l-k:y-d,$=v?c-w:b-h;u.display="",u[a?"top":"left"]=S,u[a?"left":"top"]=`${C}px`,u[a?"width":"height"]=`${T}px`,g.innerHTML=`${Math.round($)}px`,this.em.trigger("dmode:active",{...this.getEventOpts(),guide:t,guidesStatic:s,matched:m,posFirst:x,posSecond:C,size:T,sizeRaw:$,elGuideInfo:p,elGuideInfoCnt:g})}})},toggleDrag(e){const{ppfx:t,editor:s}=this,i=e?"add":"remove",n=[`${t}is__grabbing`],{Canvas:r}=s,o=r.getBody();n.forEach(e=>o.classList[i](e)),r[e?"startAutoscroll":"stopAutoscroll"]()}}}),e("skylark-grapejs/commands/view/ComponentEnter",[],function(){"use strict";return{run(e){if(!e.Canvas.hasFocus())return;const t=[];e.getSelectedAll().forEach(e=>{const s=e.components(),i=s&&s.at(0);i&&t.push(i)}),t.length&&e.select(t)}}}),e("skylark-grapejs/commands/view/ComponentExit",[],function(){"use strict";return{run(e,t,s={}){if(!e.Canvas.hasFocus()&&!s.force)return;const i=[];e.getSelectedAll().forEach(e=>{let t=e.parent();for(;t&&!t.get("selectable");)t=t.parent();t&&i.push(t)}),i.length&&e.select(i)}}}),e("skylark-grapejs/commands/view/ComponentNext",[],function(){"use strict";return{run(e){if(!e.Canvas.hasFocus())return;const t=[];e.getSelectedAll().forEach(e=>{const s=e.collection,i=s.indexOf(e),n=s.at(i+1);t.push(n||e)}),t.length&&e.select(t)}}}),e("skylark-grapejs/commands/view/ComponentPrev",[],function(){"use strict";return{run(e){if(!e.Canvas.hasFocus())return;const t=[];e.getSelectedAll().forEach(e=>{const s=e.collection,i=s.indexOf(e),n=s.at(i-1);t.push(n&&i-1>=0?n:e)}),t.length&&e.select(t)}}}),e("skylark-grapejs/commands/view/ComponentStyleClear",["skylark-underscore"],function(e){"use strict";return{run(t,s,i={}){const{target:n}=i,r=t.DomComponents,o=n.get("type"),a=r.getWrapper().find(`[data-gjs-type="${o}"]`).length,l=[];if(!a){const s=t.CssComposer.getAll();let i=n.get("style-signature");i=e.isArray(i)?i:[i],s.forEach(e=>{const t=e.selectorsToString();i.forEach(s=>{s&&t.indexOf(s)>=0&&l.push(e)})}),s.remove(l)}return l}}}),e("skylark-grapejs/commands/view/CopyComponent",[],function(){"use strict";return{run(e){const t=e.getModel(),s=[...e.getSelectedAll()];s.length&&t.set("clipboard",s)}}}),e("skylark-grapejs/dom_components/view/ToolbarButtonView",["skylark-backbone"],function(e){"use strict";return e.View.extend({events(){return this.model.get("events")||{mousedown:"handleClick"}},attributes(){return this.model.get("attributes")},initialize(e={}){const{config:t={}}=e;this.em=t.em,this.editor=t.editor},handleClick(e){e.preventDefault(),e.stopPropagation();const{editor:t,em:s}=this,{left:i,top:n}=t.Canvas.getFrameEl().getBoundingClientRect(),r={...e,clientX:e.clientX-i,clientY:e.clientY-n};s.trigger("toolbar:run:before"),this.execCommand(r)},execCommand(e){const t={event:e},s=this.model.get("command"),i=this.editor;"function"==typeof s&&s(i,null,t),"string"==typeof s&&i.runCommand(s,t)},render(){const{editor:e,$el:t,model:s}=this,i=s.get("id"),n=s.get("label"),r=e.getConfig("stylePrefix");return t.addClass(`${r}toolbar-item`),i&&t.addClass(`${r}toolbar-item__${i}`),n&&t.append(n),this}})}),e("skylark-grapejs/dom_components/view/ToolbarView",["../../domain_abstract/view/DomainViews","./ToolbarButtonView"],function(e,t){"use strict";return e.extend({itemView:t,initialize(e={}){this.config={editor:e.editor||"",em:e.em},this.listenTo(this.collection,"reset",this.render)}})}),e("skylark-grapejs/dom_components/model/ToolbarButton",["skylark-backbone"],function(e){"use strict";return e.Model.extend({defaults:{command:"",attributes:{}}})}),e("skylark-grapejs/dom_components/model/Toolbar",["skylark-backbone","./ToolbarButton"],function(e,t){"use strict";return e.Collection.extend({model:t})}),e("skylark-grapejs/commands/view/SelectComponent",["skylark-backbone","skylark-underscore","../../utils/mixins","../../dom_components/view/ToolbarView","../../dom_components/model/Toolbar"],function(e,t,s,i,n){"use strict";const r=e.$;let o;return{init(e){t.bindAll(this,"onHover","onOut","onClick","onFrameScroll","onFrameUpdated")},enable(){this.frameOff=this.canvasOff=this.adjScroll=null,this.startSelectComponent(),o=1},startSelectComponent(){this.toggleSelectComponent(1),this.em.getSelected()&&this.onSelect()},stopSelectComponent(){this.toggleSelectComponent()},toggleSelectComponent(e){const{em:t}=this,i=e?"on":"off",n=(e,t)=>{s[i](t,"mouseover",this.onHover),s[i](t,"mouseleave",this.onOut),s[i](t,"click touchend",this.onClick),s[i](e,"scroll",this.onFrameScroll)};s[i](window,"resize",this.onFrameUpdated),t[i]("component:toggled",this.onSelect,this),t[i]("change:componentHovered",this.onHovered,this),t[i]("component:resize component:styleUpdate",this.updateGlobalPos,this),t[i]("change:canvasOffset",this.updateAttached,this),t[i]("frame:updated",this.onFrameUpdated,this),t.get("Canvas").getFrames().forEach(e=>{const{view:t}=e;n(t.getWindow(),t.getBody())})},onHover(e){e.stopPropagation();const t=e.target,i=s.getViewEl(t),n=i&&i._getFrame(),o=r(t);let a=o.data("model");if(!a){let e=o.parent();for(;!a&&e.length>0;)a=e.data("model"),e=e.parent()}if(a&&!a.get("hoverable")){let e=a&&a.parent();for(;e&&!e.get("hoverable");)e=e.parent();a=e}this.currentDoc=t.ownerDocument,this.em.setHovered(a),n&&this.em.set("currentFrame",n)},onFrameUpdated(){this.updateLocalPos(),this.updateGlobalPos()},onHovered(e,t){let i={};t&&t.views.forEach(e=>{const n=e.el,r=this.getElementPos(n);i={el:n,pos:r,component:t,view:s.getViewEl(n)},this.updateToolsLocal(i),n.ownerDocument===this.currentDoc&&(this.elHovered=i)})},onSelect:t.debounce(function(){const{em:e}=this,t=e.getSelected(),i=e.get("currentFrame")||{},n=t&&t.getView(i.model);let r=n&&n.el,o={};if(r){const e=this.getElementPos(r);o={el:r,pos:e,component:t,view:s.getViewEl(r)}}this.elSelected=o,this.updateToolsGlobal(),this.updateToolsLocal(o)}),updateGlobalPos(){const e=this.getElSelected();e.el&&(e.pos=this.getElementPos(e.el),this.updateToolsGlobal())},updateLocalPos(){const e=this.getElHovered();e.el&&(e.pos=this.getElementPos(e.el),this.updateToolsLocal())},getElHovered(){return this.elHovered||{}},getElSelected(){return this.elSelected||{}},onOut(){this.currentDoc=null,this.em.setHovered(0),this.canvas.getFrames().forEach(e=>{const t=e.view.getToolsEl();this.toggleToolsEl(0,0,{el:t})})},toggleToolsEl(e,t,s={}){const i=s.el||this.canvas.getToolsEl(t);return i.style.opacity=e?1:0,i},showElementOffset(e,t,s={}){o&&this.editor.runCommand("show-offset",{el:e,elPos:t,view:s.view,force:1,top:0,left:0})},hideElementOffset(e){this.editor.stopCommand("show-offset",{view:e})},showFixedElementOffset(e,t){this.editor.runCommand("show-offset",{el:e,elPos:t,state:"Fixed"})},hideFixedElementOffset(e,t){this.editor&&this.editor.stopCommand("show-offset",{state:"Fixed"})},hideHighlighter(e){this.canvas.getHighlighter(e).style.opacity=0},onClick(e){e.stopPropagation(),e.preventDefault();const{em:t}=this;if(t.get("_cmpDrag"))return t.set("_cmpDrag");const s=r(e.target);let i=s.data("model");if(!i){let e=s.parent();for(;!i&&e.length>0;)i=e.data("model"),e=e.parent()}if(i)if(i.get("selectable"))this.select(i,e);else{let t=i.parent();for(;t&&!t.get("selectable");)t=t.parent();this.select(t,e)}},select(e,s={}){if(!e)return;const i=s.ctrlKey||s.metaKey,{shiftKey:n}=s,{editor:r,em:o}=this,a=r.getConfig("multipleSelection");if(i&&a)r.selectToggle(e);else if(n&&a){o.clearSelection(r.Canvas.getWindow());const s=e.collection,i=s.indexOf(e);r.getSelectedAll();let n,a;if(r.getSelectedAll().forEach(e=>{const r=e.collection,o=r.indexOf(e);r===s&&(o<i?n=t.isUndefined(n)?o:Math.max(n,o):o>i&&(a=t.isUndefined(a)?o:Math.min(a,o)))}),!t.isUndefined(n))for(;n!==i;)r.selectAdd(s.at(n)),n++;if(!t.isUndefined(a))for(;a!==i;)r.selectAdd(s.at(a)),a--;r.selectAdd(e)}else r.select(e,{scroll:{}});this.initResize(e)},updateBadge(e,t,s={}){const i=r(e).data("model");if(!i||!i.get("badgable"))return;const n=this.getBadge(s);if(!s.posOnly){const e=this.canvas.getConfig(),t=i.getIcon(),s=e.pStylePrefix||"",r=`${s}badge`,o=e.customBadgeLabel,a=`${t?`<div class="${r}__icon">${t}</div>`:""}\n        <div class="${r}__name">${i.getName()}</div>`;n.innerHTML=o?o(i):a}const o=n.style;o.display="block";const a=n?n.offsetHeight:0,l=0-a,c=s.topOff-a<0?-s.topOff:l,d=s.leftOff<0?-s.leftOff:0;o.top=c+"px",o.left=d+"px"},showHighlighter(e){this.canvas.getHighlighter(e).style.opacity=""},initResize(e){const{em:i,canvas:n}=this,r=i?i.get("Editor"):"",a=i?i.get("Config"):"",l=a.stylePrefix||"",c=`${l}resizing`,d=!t.isElement(e)&&s.isTaggableNode(e)?e:i.getSelected(),h=d.get("resizable"),p=t.isElement(e)?e:d.getEl();let g,u={};var m=(e,t,s)=>{const i=s.docs;i&&i.forEach(t=>{const s=t.body,i=s.className||"";s.className=("add"==e?`${i} ${c}`:i.replace(c,"")).trim()})};r&&h?(u={onStart(e,t={}){const{el:r,config:a,resizer:l}=t,{keyHeight:c,keyWidth:h,currentUnit:p,keepAutoHeight:u,keepAutoWidth:f}=a;m("add",e,t),g=i.get("StyleManager").getModelToStyle(d),n.toggleFramesEvents();const v=getComputedStyle(r),y=g.getStyle();let b=y[h];a.autoWidth=f&&"auto"===b,isNaN(parseFloat(b))&&(b=v[h]);let k=y[c];a.autoHeight=u&&"auto"===k,isNaN(parseFloat(k))&&(k=v[c]),l.startDim.w=parseFloat(b),l.startDim.h=parseFloat(k),o=0,p&&(a.unitHeight=s.getUnitFromValue(k),a.unitWidth=s.getUnitFromValue(b))},onMove(){r.trigger("component:resize")},onEnd(e,t){m("remove",e,t),r.trigger("component:resize"),n.toggleFramesEvents(1),o=1},updateTarget(e,t,s={}){if(!g)return;const{store:r,selectedHandler:o,config:a}=s,{keyHeight:l,keyWidth:c,autoHeight:d,autoWidth:h,unitWidth:p,unitHeight:u}=a,m=["tc","bc"].indexOf(o)>=0,f=["cl","cr"].indexOf(o)>=0,v={},y=r?"":1;if(!m){const e=n.getBody().offsetWidth,s=t.w<e?t.w:e;v[c]=h?"auto":`${s}${p}`}f||(v[l]=d?"auto":`${t.h}${u}`),g.addStyle({...v,en:y},{avoidStore:!r});const b=`update:component:style:${l} update:component:style:${c}`;i&&i.trigger(b,null,null,{noEmit:1})}},"object"==typeof h&&(u={...u,...h}),this.resizer=r.runCommand("resize",{el:p,options:u,force:1})):(r.stopCommand("resize"),this.resizer=null)},updateToolbar(e){var t=this.config.em,s=e==t?t.getSelected():e,r=this.canvas.getToolbarEl(),o=r.style;if(s){var a=s.get("toolbar"),l=t.get("Config").showToolbar;if(l&&a&&a.length){if(o.opacity="",o.display="",!this.toolbar){r.innerHTML="",this.toolbar=new n(a);var c=new i({collection:this.toolbar,editor:this.editor,em:t});r.appendChild(c.render().el)}this.toolbar.reset(a),o.top="-100px",o.left=0}else o.display="none"}else o.opacity=0},updateToolbarPos(e){const{style:t}=this.canvas.getToolbarEl();t.top=`${e.top}px`,t.left=`${e.left}px`,t.opacity=""},getCanvasPosition(){return this.canvas.getCanvasView().getPosition()},getBadge(e={}){return this.canvas.getBadgeEl(e.view)},onFrameScroll(){this.updateTools()},updateTools(){this.updateToolsLocal(),this.updateGlobalPos()},isCompSelected:e=>e&&"selected"===e.get("status"),updateToolsLocal(e){const{el:t,pos:s,view:i,component:n}=e||this.getElHovered();if(!t)return void(this.lastHovered=0);const r=n.get("hoverable"),o=this.lastHovered!==t,a=o?{}:{posOnly:1};o&&r&&(this.lastHovered=t,this.showHighlighter(i),this.showElementOffset(t,s,{view:i})),this.isCompSelected(n)&&(this.hideHighlighter(i),this.hideElementOffset(i));const{style:l}=this.toggleToolsEl(1,i),c=this.canvas.canvasRectOffset(t,s),d=c.top,h=c.left;this.updateBadge(t,s,{...a,view:i,topOff:d,leftOff:h}),l.top=d+"px",l.left=h+"px",l.width=s.width+"px",l.height=s.height+"px"},updateToolsGlobal(){const{el:e,pos:t,component:s}=this.getElSelected();if(!e)return this.toggleToolsEl(),void(this.lastSelected=0);const{canvas:i}=this,n=this.lastSelected!==e;n&&(this.lastSelected=e,this.updateToolbar(s));const{style:r}=this.toggleToolsEl(1),o=i.getTargetToElementFixed(e,i.getToolbarEl(),{pos:t}),a=o.canvasOffsetTop,l=o.canvasOffsetLeft;r.top=a+"px",r.left=l+"px",r.width=t.width+"px",r.height=t.height+"px",this.updateToolbarPos({top:o.top,left:o.left})},updateAttached:t.debounce(function(){this.updateToolsGlobal()}),getElementPos(e){return this.canvas.getCanvasView().getElementPos(e)},hideBadge(){this.getBadge().style.display="none"},cleanPrevious(e){e&&e.set({status:"",state:""})},getContentWindow(){return this.canvas.getWindow()},run(e){this.editor=e&&e.get("Editor"),this.enable()},stop(e,t,s={}){const{em:i,editor:n}=this;this.stopSelectComponent(),!s.preserveSelected&&i.setSelected(null),this.onOut(),this.toggleToolsEl(),n&&n.stopCommand("resize")}}}),e("skylark-grapejs/commands/view/DeleteComponent",["skylark-underscore","skylark-backbone","./SelectComponent"],function(e,t,s){"use strict";const i=t.$;return e.extend({},s,{init(t){e.bindAll(this,"startDelete","stopDelete","onDelete"),this.hoverClass=this.pfx+"hover-delete",this.badgeClass=this.pfx+"badge-red"},enable(){this.$el.find("*").mouseover(this.startDelete).mouseout(this.stopDelete).click(this.onDelete)},startDelete(e){e.stopPropagation();var t=i(e.target);t.data("model").get("removable")&&(t.addClass(this.hoverClass),this.attachBadge(t.get(0)))},stopDelete(e){e.stopPropagation();var t=i(e.target);t.removeClass(this.hoverClass),this.badge&&this.badge.css({left:-1e3,top:-1e3})},onDelete(e){e.stopPropagation();var t=i(e.target);t.data("model").get("removable")&&(t.data("model").destroy(),this.removeBadge(),this.clean())},updateBadgeLabel(e){this.badge.html("Remove "+e.getName())}})}),e("skylark-grapejs/commands/view/ExportTemplate",["skylark-backbone"],function(e){"use strict";const t=e.$;return{run(e,s,i={}){s&&s.set&&s.set("active",0);const n=e.getConfig(),r=e.Modal,o=n.stylePrefix;if(this.cm=e.CodeManager||null,!this.$editors){const e=this.buildEditor("htmlmixed","hopscotch","HTML"),s=this.buildEditor("css","hopscotch","CSS");this.htmlEditor=e.el,this.cssEditor=s.el;const i=t(`<div class="${o}export-dl"></div>`);i.append(e.$el).append(s.$el),this.$editors=i}r.open({title:n.textViewCode,content:this.$editors}).getModel().once("change:open",()=>e.stopCommand(this.id)),this.htmlEditor.setContent(e.getHtml()),this.cssEditor.setContent(e.getCss())},stop(e){const t=e.Modal;t&&t.close()},buildEditor(e,t,s){const i=document.createElement("textarea");!this.codeMirror&&(this.codeMirror=this.cm.getViewer("CodeMirror"));const n=this.codeMirror.clone().set({label:s,codeName:e,theme:t,input:i}),r=new this.cm.EditorView({model:n,config:this.cm.getConfig()}).render().$el;return n.init(i),{el:n,$el:r}}}}),e("skylark-grapejs/commands/view/Fullscreen",["skylark-underscore"],function(e){"use strict";return{isEnabled(){var e=document;return e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement?1:0},enable(e){var t="";return e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?(t="webkit",e.webkitRequestFullscreen()):e.mozRequestFullScreen?(t="moz",e.mozRequestFullScreen()):e.msRequestFullscreen?e.msRequestFullscreen():console.warn("Fullscreen not supported"),t},disable(){const e=document;this.isEnabled()&&(e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen())},fsChanged(e,t){document;var s=(e||"")+"fullscreenchange";this.isEnabled()||(this.stop(null,this.sender),document.removeEventListener(s,this.fsChanged))},run(t,s,i={}){this.sender=s;const{target:n}=i,r=e.isElement(n)?n:document.querySelector(n),o=this.enable(r||t.getContainer());this.fsChanged=this.fsChanged.bind(this,o),document.addEventListener(o+"fullscreenchange",this.fsChanged),t.trigger("change:canvasOffset")},stop(e,t){t&&t.set&&t.set("active",!1),this.disable(),e&&e.trigger("change:canvasOffset")}}}),e("skylark-grapejs/commands/view/SelectPosition",["skylark-backbone"],function(e){"use strict";const t=e.$;return{startSelectPosition(e,t,s={}){this.isPointed=!1;var i=this.editorModel.get("Utils");const n=e.ownerDocument.body;i&&!this.sorter&&(this.sorter=new i.Sorter({container:n,placer:this.canvas.getPlacerEl(),containerSel:"*",itemSel:"*",pfx:this.ppfx,direction:"a",document:t,wmargin:1,nested:1,em:this.editorModel,canvasRelative:1,scale:()=>this.em.getZoomDecimal()})),s.onStart&&(this.sorter.onStart=s.onStart),e&&this.sorter.startSort(e,{container:n})},getOffsetDim(){var e=this.offset(this.canvas.getFrameEl()),t=this.offset(this.canvas.getElement()),s=e.top-t.top,i=e.left-t.left;return{top:s,left:i}},stopSelectPosition(){this.posTargetCollection=null,this.posIndex="after"==this.posMethod&&0!==this.cDim.length?this.posIndex+1:this.posIndex,this.sorter&&(this.sorter.moved=0,this.sorter.endMove()),this.cDim&&(this.posIsLastEl=0!==this.cDim.length&&"after"==this.posMethod&&this.posIndex==this.cDim.length,this.posTargetEl=0===this.cDim.length?t(this.outsideElem):!this.posIsLastEl&&this.cDim[this.posIndex]?t(this.cDim[this.posIndex][5]).parent():t(this.outsideElem),this.posTargetModel=this.posTargetEl.data("model"),this.posTargetCollection=this.posTargetEl.data("model-comp"))},enable(){this.startSelectPosition()},nearFloat(e,t,s){var i=e||0,n=t||"before",r=s.length,o=0!==r&&"after"==n&&i==r;return 0!==r&&(!o&&!s[i][4]||s[i-1]&&!s[i-1][4]||o&&!s[i-1][4])?1:0},run(){this.enable()},stop(){this.stopSelectPosition(),this.$wrapper.css("cursor",""),this.$wrapper.unbind()}}}),e("skylark-grapejs/commands/view/MoveComponent",["skylark-underscore","skylark-backbone","../../utils/mixins","./SelectComponent","./SelectPosition"],function(e,t,s,i,n){"use strict";const r=t.$;return e.extend({},n,i,{init(t){i.init.apply(this,arguments),e.bindAll(this,"initSorter","rollback","onEndMove"),this.opt=t,this.hoverClass=this.ppfx+"highlighter-warning",this.badgeClass=this.ppfx+"badge-warning",this.noSelClass=this.ppfx+"no-select"},enable(...e){i.enable.apply(this,e),this.getBadgeEl().addClass(this.badgeClass),this.getHighlighterEl().addClass(this.hoverClass);var t=this.$wrapper;t.css("cursor","move"),t.on("mousedown",this.initSorter),t.addClass(this.noSelClass)},toggleClipboard(){},initSorter(e){var t=r(e.target).data("model"),i=t.get("draggable");i&&(this.cacheEl=null,this.startSelectPosition(e.target,this.frameEl.contentDocument),this.sorter.draggable=i,this.sorter.onEndMove=this.onEndMove.bind(this),this.stopSelectComponent(),this.$wrapper.on("mousedown",this.initSorter),s.on(this.getContentWindow(),"keydown",this.rollback))},initSorterFromModel(e){var t=e.get("draggable");if(t){this.cacheEl=null;var i=e.view.el;this.startSelectPosition(i,this.frameEl.contentDocument),this.sorter.draggable=t,this.sorter.onEndMove=this.onEndMoveFromModel.bind(this),this.stopSelectComponent(),s.on(this.getContentWindow(),"keydown",this.rollback)}},initSorterFromModels(e){this.cacheEl=null;const t=e[e.length-1],i=(this.em.get("currentFrame")||{}).model,n=t.getEl(i),r=n.ownerDocument;this.startSelectPosition(n,r,{onStart:this.onStart}),this.sorter.draggable=t.get("draggable"),this.sorter.toMove=e,this.sorter.onMoveClb=this.onDrag,this.sorter.onEndMove=this.onEndMoveFromModel.bind(this),this.stopSelectComponent(),s.on(this.getContentWindow(),"keydown",this.rollback)},onEndMoveFromModel(){s.off(this.getContentWindow(),"keydown",this.rollback)},onEndMove(){this.enable(),s.off(this.getContentWindow(),"keydown",this.rollback)},onSelect(e,t){},rollback(e,t){var s=e.which||e.keyCode;(27==s||t)&&(this.sorter.moved=!1,this.sorter.endMove())},getBadgeEl(){return this.$badge||(this.$badge=r(this.getBadge())),this.$badge},getHighlighterEl(){return this.$hl||(this.$hl=r(this.canvas.getHighlighter())),this.$hl},stop(...e){i.stop.apply(this,e),this.getBadgeEl().removeClass(this.badgeClass),this.getHighlighterEl().removeClass(this.hoverClass);var t=this.$wrapper;t.css("cursor","").unbind().removeClass(this.noSelClass)}})}),e("skylark-grapejs/commands/view/OpenLayers",["skylark-backbone","../../navigator/index"],function(e,t){"use strict";e.$;return{run(e){const t=e.LayerManager,s=e.Panels;if(!this.layers){const e="views-container",i=document.createElement("div"),n=s.getPanel(e)||s.addPanel({id:e});i.appendChild(t.render()),n.set("appendContent",i).trigger("change:appendContent"),this.layers=i}this.layers.style.display="block"},stop(){const e=this.layers;e&&(e.style.display="none")}}}),e("skylark-grapejs/commands/view/OpenStyleManager",["skylark-backbone","../../style_manager/index"],function(e,t){"use strict";const s=e.$;return{run(e,t){if(this.sender=t,!this.$cn){var i=e.getConfig(),n=e.Panels;this.$cn=s("<div></div>"),this.$cn2=s("<div></div>"),this.$cn.append(this.$cn2);var r=e.DeviceManager;if(r&&i.showDevices){var o=n.addPanel({id:"devices-c"});o.set("appendContent",r.render()).trigger("change:appendContent")}var a=e.SelectorManager;a&&this.$cn2.append(a.render([])),this.$cn2.append(e.StyleManager.render());var l=e.StyleManager.getConfig();const t=l.stylePrefix;this.$header=s(`<div class="${t}header">${e.t("styleManager.empty")}</div>`),this.$cn.append(this.$header),n.getPanel("views-container")?this.panel=n.getPanel("views-container"):this.panel=n.addPanel({id:"views-container"}),this.panel.set("appendContent",this.$cn).trigger("change:appendContent"),this.target=e.editor,this.listenTo(this.target,"component:toggled",this.toggleSm)}this.toggleSm()},toggleSm(){const{target:e,sender:t}=this;if(t&&t.get&&!t.get("active"))return;const{componentFirst:s}=e.get("SelectorManager").getConfig(),i=e.getSelectedAll().length;1===i||i>1&&s?(this.$cn2.show(),this.$header.hide()):(this.$cn2.hide(),this.$header.show())},stop(){this.$cn2&&this.$cn2.hide(),this.$header&&this.$header.hide()}}}),e("skylark-grapejs/commands/view/OpenTraitManager",["skylark-backbone"],function(e){"use strict";const t=e.$;return{run(e,s){this.sender=s;const i=e.getModel();var n=e.Config,r=n.stylePrefix,o=e.TraitManager;if(!this.$cn){var a=o.getTraitsViewer(),l=o.getConfig();this.$cn=t("<div></div>"),this.$cn2=t("<div></div>"),this.$cn.append(this.$cn2),this.$header=t("<div>").append(`<div class="${l.stylePrefix}header">${i.t("traitManager.empty")}</div>`),this.$cn.append(this.$header),this.$cn2.append(`<div class="${r}traits-label">${i.t("traitManager.label")}</div>`),this.$cn2.append(a.render().el);var c=e.Panels;(c.getPanel("views-container")?c.getPanel("views-container"):c.addPanel({id:"views-container"})).set("appendContent",this.$cn.get(0)).trigger("change:appendContent"),this.target=e.getModel(),this.listenTo(this.target,"component:toggled",this.toggleTm)}this.toggleTm()},toggleTm(){const e=this.sender;e&&e.get&&!e.get("active")||(1===this.target.getSelectedAll().length?(this.$cn2.show(),this.$header.hide()):(this.$cn2.hide(),this.$header.show()))},stop(){this.$cn2&&this.$cn2.hide(),this.$header&&this.$header.hide()}}}),e("skylark-grapejs/commands/view/OpenBlocks",[],function(){"use strict";return{run(e,t){const s=e.BlockManager,i=e.Panels;if(!this.blocks){s.render();const e="views-container",t=document.createElement("div"),n=i.getPanel(e)||i.addPanel({id:e});t.appendChild(s.getContainer()),n.set("appendContent",t).trigger("change:appendContent"),this.blocks=t}this.blocks.style.display="block"},stop(){const e=this.blocks;e&&(e.style.display="none")}}}),e("skylark-grapejs/commands/view/OpenAssets",[],function(){"use strict";return{run(e,t,s={}){const i=e.Modal,n=e.AssetManager,r=n.getConfig(),o=n.getContainer(),a=s.modalTitle||e.t("assetManager.modalTitle")||"",l=s.types,c=s.accept;if(n.setTarget(s.target),n.onClick(s.onClick),n.onDblClick(s.onDblClick),n.onSelect(s.onSelect),!this.rendered||l){let e=n.getAll().filter(e=>1);l&&l.length&&(e=e.filter(e=>-1!==l.indexOf(e.get("type")))),n.render(e),this.rendered=1}if(c){const e=o.querySelector(`input#${r.stylePrefix}uploadFile`);e&&e.setAttribute("accept",c)}return i.open({title:a,content:o}).getModel().once("change:open",()=>e.stopCommand(this.id)),this},stop(e){return e.Modal.close(),this}}}),e("skylark-grapejs/commands/view/PasteComponent",["skylark-underscore"],function(e){"use strict";return{run(t){const s=t.getModel(),i=s.get("clipboard"),n=t.getSelected();i&&n&&(t.getSelectedAll().forEach(s=>{if(!s)return;const n=s.collection,r=n.indexOf(s)+1,o=i.filter(e=>e.get("copyable"));let a;a=e.contains(i,s)&&s.get("copyable")?n.add(s.clone(),{at:r}):n.add(o.map(e=>e.clone()),{at:r}),(a=e.isArray(a)?a:[a]).forEach(e=>t.trigger("component:paste",e))}),n.emitUpdate())}}}),e("skylark-grapejs/commands/view/Preview",["skylark-underscore"],function(e){"use strict";return{getPanels(e){return this.panels||(this.panels=e.Panels.getPanels()),this.panels},tglPointers(t,s){const i=t.Canvas.getBody(),n=i.querySelectorAll(`.${this.ppfx}no-pointer`);e.each(n,e=>e.style.pointerEvents=s?"":"all")},run(e,t){this.sender=t,e.stopCommand("sw-visibility"),e.getModel().stopDefault();const s=this.getPanels(e),i=e.Canvas.getElement(),n=e.getEl(),r=e.Config.stylePrefix;if(!this.helper){const e=document.createElement("span");e.className=`${r}off-prv fa fa-eye-slash`,n.appendChild(e),e.onclick=(()=>this.stopCommand()),this.helper=e}this.helper.style.display="inline-block",this.tglPointers(e),s.forEach(e=>e.set("visible",!1));const o=i.style;o.width="100%",o.height="100%",o.top="0",o.left="0",o.padding="0",o.margin="0",e.refresh()},stop(e){const{sender:t={}}=this;t.set&&t.set("active",0);const s=this.getPanels(e),i=e.Panels.getButton("options","sw-visibility");i&&i.get("active")&&e.runCommand("sw-visibility"),e.getModel().runDefault(),s.forEach(e=>e.set("visible",!0));const n=e.Canvas.getElement();n.setAttribute("style",""),this.helper&&(this.helper.style.display="none"),e.refresh(),this.tglPointers(e,1)}}}),e("skylark-grapejs/commands/view/Resize",[],function(){"use strict";return{run(e,t,s){var i=s||{},n=i.el||"",r=e.Canvas,o=this.canvasResizer,a=i.options||{},l=r.getCanvasView();return a.appendTo=r.getResizerEl(),a.prefix=e.getConfig().stylePrefix,a.posFetcher=l.getElementPos.bind(l),a.mousePosFetcher=r.getMouseRelativePos,o&&!i.forceNew||(this.canvasResizer=e.Utils.Resizer.init(a),o=this.canvasResizer),o.setOptions(a),o.blur(),o.focus(n),o},stop(){const e=this.canvasResizer;e&&e.blur()}}}),e("skylark-grapejs/commands/view/ShowOffset",["skylark-backbone","skylark-underscore","../../utils/mixins"],function(e,t,s){"use strict";const i=e.$;return{getOffsetMethod(e){var t=e||"";return"get"+t+"OffsetViewerEl"},run(e,n,r){var o=r||{},a=o.state||"",l=e.getConfig();const c=this.em.getZoomDecimal(),d=o.el||"";if(!l.showOffsets||s.isTextNode(d)||!l.showOffsetsSelected&&"Fixed"==a)return void e.stopCommand(this.id,r);var h=e.Canvas,p={...o.elPos||h.getElementPos(d)};t.isUndefined(o.top)||(p.top=o.top),t.isUndefined(o.left)||(p.left=o.left);var g=window.getComputedStyle(d),u=this.ppfx,m=a+"State",f=this.getOffsetMethod(a),v=h[f](r.view);v.style.opacity="";let y=this["marginT"+a],b=this["marginB"+a],k=this["marginL"+a],w=this["marginR"+a],x=this["padT"+a],C=this["padB"+a],S=this["padL"+a],T=this["padR"+a];if(v.childNodes.length&&(this[m]="1",y=v.querySelector("[data-offset-m-t]"),b=v.querySelector("[data-offset-m-b]"),k=v.querySelector("[data-offset-m-l]"),w=v.querySelector("[data-offset-m-r]"),x=v.querySelector("[data-offset-p-t]"),C=v.querySelector("[data-offset-p-b]"),S=v.querySelector("[data-offset-p-l]"),T=v.querySelector("[data-offset-p-r]")),!this[m]){var $=a.toLowerCase(),E=$+"margin-v",P=$+"padding-v",V=i(`<div class="${u}marginName">`).get(0),M=i(`<div class="${u}paddingName">`).get(0),A=u+E+"-el",_=u+P+"-el";const e=`${A} ${u+E}`,t=`${_} ${u+P}`;y=i(`<div class="${e}-top"></div>`).get(0),b=i(`<div class="${e}-bottom"></div>`).get(0),k=i(`<div class="${e}-left"></div>`).get(0),w=i(`<div class="${e}-right"></div>`).get(0),x=i(`<div class="${t}-top"></div>`).get(0),C=i(`<div class="${t}-bottom"></div>`).get(0),S=i(`<div class="${t}-left"></div>`).get(0),T=i(`<div class="${t}-right"></div>`).get(0),this["marginT"+a]=y,this["marginB"+a]=b,this["marginL"+a]=k,this["marginR"+a]=w,this["padT"+a]=x,this["padB"+a]=C,this["padL"+a]=S,this["padR"+a]=T,V.appendChild(y),V.appendChild(b),V.appendChild(k),V.appendChild(w),M.appendChild(x),M.appendChild(C),M.appendChild(S),M.appendChild(T),v.appendChild(V),v.appendChild(M),this[m]="1"}var D=parseFloat(g.marginLeft.replace("px",""))*c,I=parseFloat(g.marginRight.replace("px",""))*c,N=parseFloat(g.marginTop.replace("px",""))*c,j=parseFloat(g.marginBottom.replace("px",""))*c,F=y.style,O=b.style,L=k.style,R=w.style,z=x.style,H=C.style,U=S.style,B=T.style,q=parseFloat(p.left),W=parseFloat(g.width)*c+"px";F.height=N+"px",F.width=W,F.top=p.top-N+"px",F.left=q+"px",O.height=j+"px",O.width=W,O.top=p.top+p.height+"px",O.left=q+"px";var G=p.height+N+j+"px",K=p.top-N+"px";L.height=G,L.width=D+"px",L.top=K,L.left=q-D+"px",R.height=G,R.width=I+"px",R.top=K,R.left=q+p.width+"px";var Y=parseFloat(g.paddingTop)*c;z.height=Y+"px";var J=parseFloat(g.paddingBottom)*c;H.height=J+"px";var X=p.height-J-Y+"px",Z=p.top+Y+"px";U.height=X,U.width=parseFloat(g.paddingLeft)*c+"px",U.top=Z;var Q=parseFloat(g.paddingRight)*c;B.height=X,B.width=Q+"px",B.top=Z},stop(e,t,s={}){var i=s||{},n=i.state||"",r=this.getOffsetMethod(n),o=e.Canvas,a=o[r](s.view);a.style.opacity=0}}}),e("skylark-grapejs/commands/view/SwitchVisibility",[],function(){"use strict";return{run(e){this.toggleVis(e)},stop(e){this.toggleVis(e,0)},toggleVis(e,t=1){const s=t?"add":"remove";e.Canvas.getFrames().forEach(e=>{e.view.getBody().classList[s](`${this.ppfx}dashed`)})}}}),e("skylark-grapejs/commands/index",["skylark-underscore","./view/CommandAbstract","./config/config","../dom_components/model/Component","./view/CanvasClear","./view/CanvasMove","./view/ComponentDelete","./view/ComponentDrag","./view/ComponentEnter","./view/ComponentExit","./view/ComponentNext","./view/ComponentPrev","./view/ComponentStyleClear","./view/CopyComponent","./view/DeleteComponent","./view/ExportTemplate","./view/Fullscreen","./view/MoveComponent","./view/OpenLayers","./view/OpenStyleManager","./view/OpenTraitManager","./view/OpenBlocks","./view/OpenAssets","./view/PasteComponent","./view/Preview","./view/Resize","./view/SelectComponent","./view/SelectPosition","./view/ShowOffset","./view/SwitchVisibility"],function(e,t,s,i,n,r,o,a,l,c,d,h,p,g,u,m,f,v,y,b,k,w,x,C,S,T,$,E,P,V){"use strict";return()=>{let u,E={};const M={},A={},_={},D=[["preview","Preview","preview",S],["resize","Resize","resize",T],["fullscreen","Fullscreen","fullscreen",f],["copy","CopyComponent","",g],["paste","PasteComponent","",C],["canvas-move","CanvasMove","",r],["canvas-clear","CanvasClear","",n],["open-code","ExportTemplate","export-template",m],["open-layers","OpenLayers","open-layers",y],["open-styles","OpenStyleManager","open-sm",b],["open-traits","OpenTraitManager","open-tm",k],["open-blocks","OpenBlocks","open-blocks",w],["open-assets","OpenAssets","open-assets",x],["component-select","SelectComponent","select-comp",$],["component-outline","SwitchVisibility","sw-visibility",V],["component-offset","ShowOffset","show-offset",P],["component-move","MoveComponent","move-comp",v],["component-next","ComponentNext","",d],["component-prev","ComponentPrev","",h],["component-enter","ComponentEnter","",l],["component-exit","ComponentExit","select-parent",c],["component-delete","ComponentDelete","",o],["component-style-clear","ComponentStyleClear","",p],["component-drag","ComponentDrag","",a]];return{CommandAbstract:t,name:"Commands",init(t={}){E={...s,...t},u=E.em;const n=E.pStylePrefix;n&&(E.stylePrefix=n+E.stylePrefix);for(let e in E.defaults){const t=E.defaults[e];t.id&&this.add(t.id,t)}return A["tlb-delete"]={run:e=>e.runCommand("core:component-delete")},A["tlb-clone"]={run(e){e.runCommand("core:copy"),e.runCommand("core:paste")}},A["tlb-move"]={run(t,s,n={}){let r;const o=t.getModel(),a=n&&n.event,{target:l}=n,c=l||t.getSelected(),d=l?[l]:[...t.getSelectedAll()],h=a&&"dragstart"==a.type,p={preserveSelected:1},g=c.get("dmode")||o.get("dmode"),u=()=>o.stopDefault(p),m=e.includes(["absolute","translate"],g);if(d.forEach(e=>e.trigger("disable")),!c||!c.get("draggable"))return o.logWarning("The element is not draggable");h?setTimeout(u,0):u();const f=e=>{o.trigger(`${i.eventDrag}:start`,e)},v=e=>{o.trigger(i.eventDrag,e)},y=(e,s,n)=>{o.runDefault(p),d.forEach(e=>e.set("status","selected")),t.select(d),c.emitUpdate(),o.trigger(`${i.eventDrag}:end`,n),(m||n.cancelled)&&o.set("_cmpDrag",1)};if(m)r=t.runCommand("core:component-drag",{guidesInfo:1,mode:g,target:c,onStart:f,onDrag:v,onEnd:y,event:a});else{h&&a.dataTransfer.setDragImage(c.view.el,0,0);const e=t.Commands.get("move-comp");e.onStart=f,e.onDrag=v,e.onEndMoveFromModel=y,e.initSorterFromModels(d)}d.forEach(e=>e.set("status","freezed-selected"))}},A["core:undo"]=(e=>e.UndoManager.undo()),A["core:redo"]=(e=>e.UndoManager.redo()),D.forEach(e=>{const t=e[2],s=e[3],i=`core:${e[0]}`;A[i]=s,t&&(A[t]=s,["run","stop"].forEach(e=>{u.on(`${e}:${t}`,(...t)=>u.trigger(`${e}:${i}`,...t))}))}),E.em&&(E.model=E.em.get("Canvas")),this.loadDefaultCommands(),this},add:function(s,i){e.isFunction(i)&&(i={run:i});i.stop||(i.noStop=1);return delete i.initialize,i.id=s,M[s]=t.extend(i),this},get(t){let s=M[t];return e.isFunction(s)?(s=new s(E),M[t]=s):s||u.logWarning(`'${t}' command not found`),s},extend(e,t={}){const s=this.get(e);if(s){const i={...s.constructor.prototype,...t};this.add(e,i);const n=D.filter(t=>`core:${t[0]}`===e&&t[2])[0];n&&this.add(n[2],i)}return this},has:e=>!!M[e],getAll:()=>M,run(e,t={}){return this.runCommand(this.get(e),t)},stop(e,t={}){return this.stopCommand(this.get(e),t)},isActive(e){return this.getActive().hasOwnProperty(e)},getActive:()=>_,loadDefaultCommands(){for(var e in A)this.add(e,A[e]);return this},runCommand(e,t={}){let s;if(e&&e.run){const i=e.id,n=u.get("Editor");this.isActive(i)&&!t.force&&E.strict||(s=e.callRun(n,t),i&&e.stop&&!e.noStop&&!t.abort&&(_[i]=s))}return s},stopCommand(e,t={}){let s;if(e&&e.run){const i=e.id,n=u.get("Editor");(this.isActive(i)||t.force||!E.strict)&&(i&&delete _[i],s=e.callStop(n,t))}return s},create(e){e.stop||(e.noStop=1);const s=t.extend(e);return new s(E)}}}}),e("skylark-grapejs/block_manager/config/config",[],function(){"use strict";return{appendTo:"",appendOnClick:0,blocks:[]}}),e("skylark-grapejs/block_manager/model/Category",["skylark-backbone"],function(e){"use strict";return e.Model.extend({defaults:{id:"",label:"",open:!0,attributes:{}}})}),e("skylark-grapejs/block_manager/model/Block",["skylark-backbone","./Category"],function(e,t){"use strict";return e.Model.extend({defaults:{activate:0,select:0,resetId:0,label:"",media:"",content:"",category:"",attributes:{}},initialize(e={}){let s=this.get("category");if(s&&"string"==typeof s)new t({id:s,label:s})}})}),e("skylark-grapejs/block_manager/model/Blocks",["skylark-backbone","./Block"],function(e,t){"use strict";return e.Collection.extend({model:t})}),e("skylark-grapejs/block_manager/model/Categories",["skylark-backbone","./Category"],function(e,t){"use strict";return e.Collection.extend({model:t})}),e("skylark-grapejs/block_manager/view/BlockView",["skylark-backbone","skylark-underscore","../../utils/mixins"],function(e,t,s){"use strict";return e.View.extend({events:{click:"handleClick",mousedown:"startDrag",dragstart:"handleDragStart",drag:"handleDrag",dragend:"handleDragEnd"},initialize(e,t={}){const{model:s}=this;this.em=t.em,this.config=t,this.endDrag=this.endDrag.bind(this),this.ppfx=t.pStylePrefix||"",this.listenTo(s,"destroy remove",this.remove),this.listenTo(s,"change",this.render)},handleClick(){const{config:e,model:t,em:s}=this;if(!e.appendOnClick)return;const i=e.getSorter(),n=t.get("content"),r=s.getSelected();let o,a;if(i.setDropContent(n),r)if((a=i.validTarget(r.getEl(),n)).valid)o=r;else{const e=r.parent();(a=i.validTarget(e.getEl(),n)).valid&&(o=e)}if(!o){const e=s.getWrapper();(a=i.validTarget(e.getEl(),n)).valid&&(o=e)}const l=o&&o.append(n)[0];l&&s.setSelected(l,{scroll:1})},startDrag(e){const{config:t,em:i}=this;if(0!==e.button||!t.getSorter||this.el.draggable)return;i.refreshCanvas();const n=t.getSorter();n.setDragHelper(this.el,e),n.setDropContent(this.model.get("content")),n.startSort(this.el),s.on(document,"mouseup",this.endDrag)},handleDragStart(e){const{em:s,model:i}=this,n=i.get("content"),r=t.isObject(n),o=r?JSON.stringify(n):n;s.set("dragResult"),e.dataTransfer.setData("text",o),s.set("dragContent",n),s.trigger("block:drag:start",i,e)},handleDrag(e){this.em.trigger("block:drag",this.model,e)},handleDragEnd(){const{em:e,model:t}=this,s=e.get("dragResult");if(s){const i="activeOnRender",n=s.get&&s.get(i);(t.get("activate")||n)&&(s.trigger("active"),s.set(i,0)),t.get("select")&&e.setSelected(s),t.get("resetId")&&s.onAll(e=>e.resetId())}e.set({dragResult:null,dragContent:null}),e.trigger("block:drag:stop",s,t)},endDrag(e){s.off(document,"mouseup",this.endDrag);const t=this.config.getSorter();t.moved=0,t.endMove()},render(){const{em:e,el:t,ppfx:i,model:n}=this,r=`${i}block`,o=e&&e.t(`blockManager.labels.${n.id}`)||n.get("label"),a=n.get("render"),l=n.get("media");t.className+=` ${r} ${i}one-bg ${i}four-color-h`,t.innerHTML=`\n      ${l?`<div class="${r}__media">${l}</div>`:""}\n      <div class="${r}-label">${o}</div>\n    `,t.title=t.textContent.trim(),s.hasDnd(e)&&t.setAttribute("draggable",!0);const c=a&&a({el:t,model:n,className:r,prefix:i});return c&&(t.innerHTML=c),this}})}),e("skylark-grapejs/block_manager/view/CategoryView",["skylark-underscore","skylark-backbone"],function(e,t){"use strict";return t.View.extend({template:e.template('\n  <div class="<%= pfx %>title">\n    <i class="<%= pfx %>caret-icon"></i>\n    <%= label %>\n  </div>\n  <div class="<%= pfx %>blocks-c"></div>\n  '),events:{},initialize(e={},t={}){this.config=t;const s=t.pStylePrefix||"";this.em=t.em,this.pfx=s,this.caretR="fa fa-caret-right",this.caretD="fa fa-caret-down",this.iconClass=`${s}caret-icon`,this.activeClass=`${s}open`,this.className=`${s}block-category`,this.events[`click .${s}title`]="toggle",this.listenTo(this.model,"change:open",this.updateVisibility),this.delegateEvents()},updateVisibility(){this.model.get("open")?this.open():this.close()},open(){this.el.className=`${this.className} ${this.activeClass}`,this.getIconEl().className=`${this.iconClass} ${this.caretD}`,this.getBlocksEl().style.display=""},close(){this.el.className=this.className,this.getIconEl().className=`${this.iconClass} ${this.caretR}`,this.getBlocksEl().style.display="none"},toggle(){var e=this.model;e.set("open",!e.get("open"))},getIconEl(){return this.iconEl||(this.iconEl=this.el.querySelector("."+this.iconClass)),this.iconEl},getBlocksEl(){return this.blocksEl||(this.blocksEl=this.el.querySelector("."+this.pfx+"blocks-c")),this.blocksEl},append(e){this.getBlocksEl().appendChild(e)},render(){const{em:e,el:t,$el:s,model:i}=this,n=e.t(`blockManager.categories.${i.id}`)||i.get("label");return t.innerHTML=this.template({pfx:this.pfx,label:n}),t.className=this.className,s.css({order:i.get("order")}),this.updateVisibility(),this}})}),e("skylark-grapejs/block_manager/view/BlocksView",["skylark-backbone","skylark-underscore","./BlockView","./CategoryView"],function(e,t,s,i){"use strict";return e.View.extend({initialize(e,s){t.bindAll(this,"getSorter","onDrag","onDrop"),this.config=s||{},this.categories=e.categories||"",this.renderedCategories=[];var i=this.config.pStylePrefix||"";this.ppfx=i,this.noCatClass=`${i}blocks-no-cat`,this.blockContClass=`${i}blocks-c`,this.catsClass=`${i}block-categories`;const n=this.collection;this.listenTo(n,"add",this.addTo),this.listenTo(n,"reset",this.render),this.em=this.config.em,this.tac="test-tac",this.grabbingCls=this.ppfx+"grabbing",this.em&&(this.config.getSorter=this.getSorter,this.canvas=this.em.get("Canvas"))},updateConfig(e={}){this.config={...this.config,...e}},getSorter(){if(this.em){if(!this.sorter){var e=this.em.get("Utils"),t=this.canvas;this.sorter=new e.Sorter({container:t.getBody(),placer:t.getPlacerEl(),containerSel:"*",itemSel:"*",pfx:this.ppfx,onStart:this.onDrag,onEndMove:this.onDrop,onMove:this.onMove,document:t.getFrameEl().contentDocument,direction:"a",wmargin:1,nested:1,em:this.em,canvasRelative:1})}return this.sorter}},onDrag(e){this.em.stopDefault(),this.em.trigger("block:drag:start",e)},onMove(e){this.em.trigger("block:drag:move",e)},onDrop(e){const t=this.em;t.runDefault(),e&&e.get&&(e.get("activeOnRender")&&(e.trigger("active"),e.set("activeOnRender",0)),t.trigger("block:drag:stop",e))},addTo(e){this.add(e)},add(e,n){const{config:r}=this;var o=n||null,a=new s({model:e,attributes:e.get("attributes")},r),l=a.render().el,c=e.get("category");if(c&&this.categories&&!r.ignoreCategories){t.isString(c)?c={id:c,label:c}:t.isObject(c)&&!c.id&&(c.id=c.label);var d=this.categories.add(c),h=d.get("id"),p=this.renderedCategories[h],g=this.getCategoriesEl();return e.set("category",d),!p&&g&&(p=new i({model:d},this.config).render(),this.renderedCategories[h]=p,g.appendChild(p.el)),void(p&&p.append(l))}o?o.appendChild(l):this.append(l)},getCategoriesEl(){return this.catsEl||(this.catsEl=this.el.querySelector(`.${this.catsClass}`)),this.catsEl},getBlocksEl(){return this.blocksEl||(this.blocksEl=this.el.querySelector(`.${this.noCatClass} .${this.blockContClass}`)),this.blocksEl},append(e){let t=this.getBlocksEl();t&&t.appendChild(e)},render(){const e=this.ppfx,t=document.createDocumentFragment();this.catsEl=null,this.blocksEl=null,this.renderedCategories=[],this.el.innerHTML=`\n      <div class="${this.catsClass}"></div>\n      <div class="${this.noCatClass}">\n        <div class="${this.blockContClass}"></div>\n      </div>\n    `,this.collection.each(e=>this.add(e,t)),this.append(t);const s=`${this.blockContClass}s ${e}one-bg ${e}two-color`;return this.$el.addClass(s),this}})}),e("skylark-grapejs/block_manager/index",["skylark-underscore","./config/config","./model/Blocks","./model/Categories","./view/BlocksView"],function(e,t,s,i,n){"use strict";return()=>{var r,o,a,l={},c=[];return{name:"BlockManager",init(e){const d=(l=e||{}).em;for(let e in t)e in l||(l[e]=t[e]);return r=new s([]),o=new s([]),c=new i,a=new n({collection:o,categories:c},l),r.listenTo(r,"add",e=>{o.add(e),d&&d.trigger("block:add",e)}),r.listenTo(r,"remove",e=>{o.remove(e),d&&d.trigger("block:remove",e)}),r.listenTo(r,"reset",e=>{o.reset(e.models)}),this},getConfig:()=>l,onLoad(){const e=this.getAll();!e.length&&e.reset(l.blocks)},postRender(){const t=this.getConfig().appendTo;if(t){const s=e.isElement(t)?t:document.querySelector(t);s.appendChild(this.render())}},add(e,t){var s=t||{};return s.id=e,r.add(s)},get:e=>r.get(e),getAll:()=>r,getAllVisible:()=>o,remove:e=>r.remove(e),getCategories:()=>c,getContainer:()=>a.el,render(e,t={}){const i=e||this.getAll().models;return t.external?new n({collection:new s(i),categories:c},{...l,...t}).render().el:(a.rendered||(a.render(),a.rendered=1),a.updateConfig(t),a.collection.reset(i),this.getContainer())}}}}),e("skylark-grapejs/editor/model/Editor",["skylark-langx/langx","skylark-underscore","skylark-jquery","skylark-backbone","../../utils/extender","../../utils/mixins","../../utils/index","../../i18n/index","../../keymaps/index","../../undo_manager/index","../../storage_manager/index","../../device_manager/index","../../parser/index","../../selector_manager/index","../../style_manager/index","../../modal_dialog/index","../../code_manager/index","../../panels/index","../../rich_text_editor/index","../../asset_manager/index","../../css_composer/index","../../trait_manager/index","../../dom_components/index","../../navigator/index","../../canvas/index","../../commands/index","../../block_manager/index"],function(e,t,s,i,n,r,o,a,l,c,d,h,p,g,u,m,f,v,y,b,k,w,x,C,S,T,$){"use strict";i.$=s;const E=[o,a,l,c,d,h,p,g,u,m,f,v,y,b,k,w,x,C,S,T,$],{Collection:P}=i;let V,M;n({Backbone:i,$:i.$});const A={debug:console.log,info:console.info,warning:console.warn,error:console.error};return i.Model.extend({defaults:()=>({editing:0,selected:new P,clipboard:null,dmode:0,componentHovered:null,previousModel:null,changesCount:0,storables:[],modules:[],toLoad:[],opened:{},device:""}),initialize(e={}){this.config=e,this.set("Config",e),this.set("modules",[]),this.set("toLoad",[]),this.set("storables",[]),this.set("dmode",e.dragMode);const s=e.el,i=e.log,n=!0===i?t.keys(A):t.isArray(i)?i:[];t.bindAll(this,"initBaseColorPicker"),s&&e.fromElement&&(this.config.components=s.innerHTML),this.attrsOrig=s?t.toArray(s.attributes).reduce((e,t)=>(e[t.nodeName]=t.nodeValue,e),{}):"",E.forEach(e=>this.loadModule(e)),this.on("change:componentHovered",this.componentHovered,this),this.on("change:changesCount",this.updateChanges,this),n.forEach(e=>this.listenLog(e)),[{from:"change:selectedComponent",to:"component:toggled"}].forEach(e=>{const t=e.from,s=e.to;this.listenTo(this,t,(...e)=>{this.trigger(s,...e),this.logWarning(`The event '${t}' is deprecated, replace it with '${s}'`)})})},getContainer(){return this.config.el},listenLog(e){this.listenTo(this,`log:${e}`,A[e])},getConfig(e){const s=this.config;return t.isUndefined(e)?s:s[e]},loadOnStart(e=null){const t=this.get("StorageManager");this.get("toLoad").forEach(module=>{module.onLoad()});const s=()=>{const t=this.get("modules");t.forEach(module=>module.postLoad&&module.postLoad(this)),e&&e()};t&&t.canAutoload()?this.load(s):s()},updateChanges(){const e=this.get("StorageManager"),t=this.get("changesCount");M&&clearTimeout(M),M=setTimeout(()=>this.trigger("update")),this.config.noticeOnUnload&&(window.onbeforeunload=t?e=>1:null),e.isAutosave()&&t>=e.getStepsBeforeSave()&&this.store()},loadModule(e){const{config:s}=this,i=e.default||e,n=i(),r=n.name.charAt(0).toLowerCase()+n.name.slice(1),o=t.isUndefined(s[r])?s[n.name]:s[r],a=o||{},l=this.get("StorageManager");if(a.pStylePrefix=s.pStylePrefix||"",t.isUndefined(o)||o||(a._disable=1),n.storageKey&&n.store&&n.load&&l){a.stm=l;const e="domComponents"==r?"unshift":"push";this.get("storables")[e](n)}return a.em=this,n.init(a),!n.private&&this.set(n.name,n),n.onLoad&&this.get("toLoad").push(n),this.get("modules").push(n),this},init(e){this.set("Editor",e)},getEditor(){return this.get("Editor")},handleUpdates(e,t,s={}){s.temporary||(V&&clearInterval(V),V=setTimeout(()=>{s.avoidStore||this.set("changesCount",this.get("changesCount")+1,s)},0))},componentHovered(e,t,s){const i=this.previous("componentHovered");i&&this.trigger("component:unhovered",i,s),t&&this.trigger("component:hovered",t,s)},getSelected(){return this.get("selected").last()},getSelectedAll(){return this.get("selected").models},setSelected(e,i={}){const n=t.isArray(e),o=n?e:[e],a=this.get("selected");let l;n&&this.removeSelected(a.filter(e=>!t.contains(o,e))),o.forEach(e=>{const t=r.getModel(e,s);t&&!t.get("selectable")||(!n&&this.removeSelected(a.filter(e=>e!==t)),this.addSelected(t,i),l=t)})},addSelected(e,i={}){const n=r.getModel(e,s),o=t.isArray(n)?n:[n];o.forEach(e=>{if(e&&!e.get("selectable"))return;const t=this.get("selected");i.forceChange&&t.remove(e,i),t.push(e,i)})},removeSelected(e,t={}){this.get("selected").remove(r.getModel(e,s),t)},toggleSelected(e,i={}){const n=r.getModel(e,s),o=t.isArray(n)?n:[n];o.forEach(e=>{this.get("selected").contains(e)?this.removeSelected(e,i):this.addSelected(e,i)})},setHovered(e,t={}){const i=r.getModel(e,s);i&&!i.get("hoverable")||(t.forceChange&&this.set("componentHovered",""),this.set("componentHovered",i,t))},getHovered(){return this.get("componentHovered")},setComponents(e){return this.get("DomComponents").setComponents(e)},getComponents(){var e=this.get("DomComponents"),t=this.get("CodeManager");if(e&&t){var s=e.getComponents();return t.getCode(s,"json")}},setStyle(e){for(var t=this.get("CssComposer").getAll(),s=0,i=t.length;s<i;s++)t.pop();return t.add(e),this},getStyle(){return this.get("CssComposer").getAll()},setState(e){return this.set("state",e),this},getState(){return this.get("state")},getHtml(){const e=this.config,t=e.exportWrapper,s=e.wrapperIsBody,i=e.jsInHtml?this.getJs():"";var n=this.get("DomComponents").getComponent(),r=this.get("CodeManager").getCode(n,"html",{exportWrapper:t,wrapperIsBody:s});return r+=i?`<script>${i}<\/script>`:""},getCss(e={}){const s=this.config,i=s.wrapperIsBody,n=e.avoidProtected,r=t.isUndefined(e.keepUnusedStyles)?s.keepUnusedStyles:e.keepUnusedStyles,o=this.get("CssComposer"),a=this.get("DomComponents").getComponent(),l=n?"":s.protectedCss;return l+this.get("CodeManager").getCode(a,"css",{cssc:o,wrapperIsBody:i,keepUnusedStyles:r})},getJs(){var e=this.get("DomComponents").getWrapper();return this.get("CodeManager").getCode(e,"js").trim()},store(e){var t=this.get("StorageManager"),s={};if(t)return this.get("storables").forEach(e=>{var t=e.store(1);for(var i in t)s[i]=t[i]}),t.store(s,t=>{e&&e(t),this.set("changesCount",0),this.trigger("storage:store",s)}),s},load(e=null){this.getCacheLoad(1,t=>{this.get("storables").forEach(module=>module.load(t)),e&&e(t)})},getCacheLoad(e,s){if(this.cacheLoad&&!e)return this.cacheLoad;const i=this.get("StorageManager"),n=[];if(!i)return{};this.get("storables").forEach(e=>{let s=e.storageKey;s=t.isFunction(s)?s():s;const i=t.isArray(s)?s:[s];i.forEach(e=>n.push(e))}),i.load(n,e=>{this.cacheLoad=e,s&&s(e),setTimeout(()=>this.trigger("storage:load",e))})},getDeviceModel(){var e=this.get("device");return this.get("DeviceManager").get(e)},runDefault(e={}){var t=this.get("Commands").get(this.config.defaultCommand);t&&!this.defaultRunning&&(t.stop(this,this,e),t.run(this,this,e),this.defaultRunning=1)},stopDefault(e={}){var t=this.get("Commands").get(this.config.defaultCommand);t&&(t.stop(this,this,e),this.defaultRunning=0)},refreshCanvas(){this.set("canvasOffset",null),this.set("canvasOffset",this.get("Canvas").getOffset())},clearSelection(e){var t=e||window;t.getSelection().removeAllRanges()},getCurrentMedia(){const e=this.config,t=this.getDeviceModel(),s=e.mediaCondition,i=e.devicePreviewMode,n=t&&t.get("widthMedia");return t&&n&&!i?`(${s}: ${n})`:""},getWrapper(){return this.get("DomComponents").getWrapper()},setCurrentFrame(e){return this.set("currentFrame",e)},getCurrentFrame(){return this.get("currentFrame")},getCurrentFrameModel(){return(this.getCurrentFrame()||{}).model},getDirtyCount(){return this.get("changesCount")},getZoomDecimal(){return this.get("Canvas").getZoomDecimal()},getZoomMultiplier(){return this.get("Canvas").getZoomMultiplier()},setDragMode(e){return this.set("dmode",e)},t(...e){return this.get("I18n").t(...e)},inAbsoluteMode(){return"absolute"===this.get("dmode")},destroyAll(){const{DomComponents:e,CssComposer:t,UndoManager:i,Panels:n,Canvas:r,Keymaps:o,RichTextEditor:a}=this.attributes;e.clear(),t.clear(),i.clear().removeAll(),n.getPanels().reset(),r.getCanvasView().remove(),o.removeAll(),a.destroy(),this.view.remove(),this.stopListening(),s(this.config.el).empty().attr(this.attrsOrig)},setEditing(e){return this.set("editing",e),this},isEditing(){return!!this.get("editing")},log(e,t={}){const{ns:s,level:i="debug"}=t;if(this.trigger("log",e,t),i&&this.trigger(`log:${i}`,e,t),s){const n=`log-${s}`;this.trigger(n,e,t),i&&this.trigger(`${n}:${i}`,e,t)}},logInfo(t,s){this.log(t,e.mixin({},s,{evel:"info"}))},logWarning(t,s){this.log(t,e.mixin({},s,{evel:"warning"}))},logError(t,s){this.log(t,e.mixin({},s,{evel:"error"}))},initBaseColorPicker(t,i={}){const n=this.getConfig(),{colorPicker:r={}}=n,o=n.el,a=n.stylePrefix;return s(t).spectrum(e.mixin({containerClassName:`${a}one-bg ${a}two-color`,appendTo:o||"body",maxSelectionSize:8,showPalette:!0,palette:[],showAlpha:!0,chooseText:"Ok",cancelText:"⨯"},i,r))},data(e,s,i){if(e["_gjs-data"]||(e["_gjs-data"]={}),t.isUndefined(i))return e["_gjs-data"][s];e["_gjs-data"][s]=i}})}),e("skylark-grapejs/editor/view/EditorView",["skylark-jquery","skylark-backbone","../../utils/mixins"],function(e,t,s){"use strict";return t.View.extend({initialize(){const{model:e}=this;e.view=this,this.conf=e.config,this.pn=e.get("Panels"),this.cv=e.get("Canvas"),e.on("loaded",()=>{this.pn.active(),this.pn.disableButtons(),setTimeout(()=>{e.runDefault(),e.trigger("load",e.get("Editor"))})})},render(){const{model:t,$el:i,conf:n}=this,r=n.stylePrefix,o=e(n.el||`body ${n.container}`);return s.appendStyles(n.cssIcons,{unique:1,prepand:1}),i.empty(),n.width&&o.css("width",n.width),n.height&&o.css("height",n.height),i.append(this.cv.render()),i.append(this.pn.render()),i.attr("class",`${r}editor ${r}one-bg ${r}two-color`),o.addClass(`${r}editor-cont`).empty().append(i),this}})}),e("skylark-grapejs/editor/index",["skylark-langx/langx","skylark-jquery","./config/config","./model/Editor","./view/EditorView"],function(e,t,s,i,n){"use strict";return(r={})=>{const o=e.mixin({},s,r);o.pStylePrefix=o.stylePrefix;var a=new i(o),l=new n({model:a,config:o});return{$:t,editor:a,I18n:a.get("I18n"),DomComponents:a.get("DomComponents"),LayerManager:a.get("LayerManager"),CssComposer:a.get("CssComposer"),StorageManager:a.get("StorageManager"),AssetManager:a.get("AssetManager"),BlockManager:a.get("BlockManager"),TraitManager:a.get("TraitManager"),SelectorManager:a.get("SelectorManager"),CodeManager:a.get("CodeManager"),Commands:a.get("Commands"),Keymaps:a.get("Keymaps"),Modal:a.get("Modal"),Panels:a.get("Panels"),StyleManager:a.get("StyleManager"),Canvas:a.get("Canvas"),UndoManager:a.get("UndoManager"),DeviceManager:a.get("DeviceManager"),RichTextEditor:a.get("RichTextEditor"),Parser:a.get("Parser"),Utils:a.get("Utils"),Config:a.get("Config"),init(){return a.init(this),a.on("loaded",()=>{this.UndoManager.clear(),a.get("modules").forEach(module=>{module.postRender&&module.postRender(l)})}),this},getConfig:e=>a.getConfig(e),getHtml:e=>a.getHtml(e),getCss:e=>a.getCss(e),getJs:()=>a.getJs(),getComponents:()=>a.get("DomComponents").getComponents(),getWrapper:()=>a.get("DomComponents").getWrapper(),setComponents(e){return a.setComponents(e),this},addComponents(e,t){return this.getWrapper().append(e,t)},getStyle:()=>a.get("CssComposer").getAll(),setStyle(e){return a.setStyle(e),this},getSelected:()=>a.getSelected(),getSelectedAll:()=>a.getSelectedAll(),getSelectedToStyle(){let e=a.getSelected();if(e)return this.StyleManager.getModelToStyle(e)},select(e,t){return a.setSelected(e,t),this},selectAdd(e){return a.addSelected(e),this},selectRemove(e){return a.removeSelected(e),this},selectToggle(e){return a.toggleSelected(e),this},setDevice(e){return a.set("device",e),this},getDevice:()=>a.get("device"),runCommand:(e,t={})=>a.get("Commands").run(e,t),stopCommand:(e,t={})=>a.get("Commands").stop(e,t),store:e=>a.store(e),load:e=>a.load(e),getContainer:()=>o.el,getDirtyCount:()=>a.getDirtyCount(),refresh(){a.refreshCanvas()},setCustomRte(e){this.RichTextEditor.customRte=e},setCustomParserCss(e){return this.Parser.getConfig().parserCss=e,this},setDragMode(e){return a.setDragMode(e),this},log(e,t={}){return a.log(e,t),this},t:(...e)=>a.t(...e),on(e,t){return a.on(e,t),this},once(e,t){return a.once(e,t),this},off(e,t){return a.off(e,t),this},trigger(e){return a.trigger.apply(a,arguments),this},destroy:()=>a.destroyAll(),getEl:()=>l.el,getModel:()=>a,render:()=>(l.render(),l.el)}}}),e("skylark-grapejs/utils/polyfills",[],function(){"use strict";return()=>{if((()=>{let e;const t=window.navigator.userAgent,s=[["edge",/Edge\/([0-9\._]+)/],["ie",/MSIE\s(7\.0)/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/]];for(let i=0;i<s.length;i++){const n=s[i];if(e=n[1].exec(t))break}return!!e})()){const e=DOMImplementation.prototype.createHTMLDocument;DOMImplementation.prototype.createHTMLDocument=(t=>(t||(t=""),e.apply(document.implementation,[t])))}}}),e("skylark-grapejs/plugin_manager/config/config",[],function(){"use strict";return{plugins:[]}}),e("skylark-grapejs/plugin_manager/index",["./config/config"],function(e){"use strict";return t=>{for(var s in e)s in e||(c[s]=e[s]);var i={};return{add:(e,t)=>i[e]?i[e]:(i[e]=t,t),get:e=>i[e],getAll:()=>i}}}),e("skylark-grapejs/main",["skylark-langx/langx","skylark-jquery","./editor/index","skylark-underscore","./utils/polyfills","./plugin_manager/index"],function(e,t,s,i,n,r){"use strict";n();const o=r(),a=[],l={autorender:1,plugins:[],pluginsOpts:{}};return{$:t,editors:a,plugins:o,version:"<# VERSION #>",init(t={}){const n=t.container;if(!n)throw new Error("'container' is required");(t=e.mixin({},l,t)).el=i.isElement(n)?n:document.querySelector(n);const r=s(t).init();return t.plugins.forEach(e=>{let s=o.get(e);const n=t.pluginsOpts[e]||{};if(!s){const t=window[e];s=t&&t.default?t.default:t}s?s(r,n):i.isFunction(e)?e(r,n):console.warn(`Plugin ${e} not found`)}),r.getModel().loadOnStart(),t.autorender&&r.render(),a.push(r),r}}}),e("skylark-grapejs",["skylark-grapejs/main"],function(e){return e})}(s),!i){var o=require("skylark-langx-ns");n?module.exports=o:t.skylarkjs=o}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-grapejs.js.map
